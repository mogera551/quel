(()=>{"use strict";const e=class{static raise(e){throw e}static isFunction=e=>{const t=Object.prototype.toString.call(e).slice(8,-1).toLowerCase();return"function"===t||"asyncfunction"===t};static isInputableElement(e){return e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&"button"!==e.type}};class t{static localeString=(e,t)=>null!=e?Number(e).toLocaleString():null;static fixed=(e,t)=>null!=e?Number(e).toFixed(t[0]??0):null;static styleDisplay=(e,t)=>e?t[0]??"":"none";static truthy=(e,t)=>!!e;static falsey=(e,t)=>!e;static not=this.falsey;static upperCase=(e,t)=>null!=e?String(e).toUpperCase():null;static lowerCase=(e,t)=>null!=e?String(e).toLowerCase():null;static eq=(e,t)=>e==t[0];static ne=(e,t)=>e!=t[0];static lt=(e,t)=>Number(e)<Number(t[0]);static le=(e,t)=>Number(e)<=Number(t[0]);static gt=(e,t)=>Number(e)>Number(t[0]);static ge=(e,t)=>Number(e)>=Number(t[0]);static embed=(e,t)=>null!=e?decodeURI((t[0]??"").replaceAll("%s",e)):null;static ifText=(e,t)=>e?t[0]??null:t[1]??null;static null=(e,t)=>null==e}class n{static number=(e,t)=>Number(e);static boolean=(e,t)=>Boolean(e)}class s{name;options;static applyForInput(e,t){return t.reduceRight(((e,t)=>t.name in n?n[t.name](e,t.options):e),e)}static applyForOutput(e,n){return n.reduce(((e,n)=>n.name in t?t[n.name](e,n.options):e),e)}static regist(s,o,i){s in t&&e.raise(`regist filter error duplicate name (${s})`),s in n&&e.raise(`regist filter error duplicate name (${s})`),o&&(t[s]=o),i&&(n[s]=i)}}class o{#e;get node(){return this.#e}set node(e){this.#e=e}get element(){return this.node instanceof HTMLElement?this.node:e.raise("not HTMLElement")}#t;get nodeProperty(){return this.#t}set nodeProperty(e){this.#t=e}#n;get nodePropertyElements(){return this.#n}set nodePropertyElements(e){this.#n=e}component;viewModel;#s;get viewModelProperty(){return this.#s}set viewModelProperty(e){this.#s=e}filters;#o;get indexes(){return this.#o}set indexes(e){this.#o=e,this.#i=e.toString(),this.#r=this.viewModelProperty+"\t"+this.#i}#i;get indexesString(){return this.#i}#r;get viewModelPropertyKey(){return this.#r}contextIndexes;lastNodeValue;lastViewModelValue;updateNode(){}updateViewModel(){}changeIndexes(e,t){this.indexes[e]=this.indexes[e]+t,this.contextIndexes[e]=this.contextIndexes[e]+t}removeFromParent(){}}const i=e=>Array.from(e.childNodes).flatMap((e=>i(e).concat((e=>e instanceof Comment&&"@"===e.textContent[0]&&"@"===e.textContent[1]&&"@"!==e.textContent[2])(e)?e:null))).filter((e=>e)),r=class{static listOfRouteIndexesByTemplate=new Map;static getTargetNodes(e,t){let n;return this.listOfRouteIndexesByTemplate.has(e)?n=this.listOfRouteIndexesByTemplate.get(e).map((e=>e.reduce(((e,t)=>e.childNodes[t]),t))):(n=Array.from(t.querySelectorAll("[data-bind]")).concat(i(t)),this.listOfRouteIndexesByTemplate.set(e,n.map((e=>(e=>{let t=[];for(;null!=e.parentNode;)t=[Array.from(e.parentNode.childNodes).indexOf(e)].concat(t),e=e.parentNode;return t})(e))))),n}},a=class{static bind(e,t,n){}},l="quel",d=Symbol.for(`${l}:viewModel.indexes`),p=Symbol.for(`${l}:viewModel.target`),c=Symbol.for(`${l}:viewModel.dependentMap`),h=Symbol.for(`${l}:viewModel.directGet`),u=Symbol.for(`${l}:viewModel.directSet`),m=Symbol.for(`${l}:viewModel.directCall`),y=Symbol.for(`${l}:viewModel.init`),f=Symbol.for(`${l}:viewModel.connect`),P=Symbol.for(`${l}:viewModel.write`),w=Symbol.for(`${l}:viewModel.clearCache`),g=Symbol.for(`${l}:viewModel.notifyForDependentProps`),v=Symbol.for(`${l}:arrayHandler.isProxy`),M=Symbol.for(`${l}:arrayHandler.raw`),b=Symbol.for(`${l}:componentData.bindData`),x=Symbol.for(`${l}:componentData.bindProperty`);class N{binds;childNodes;fragment;get lastNode(){return this.childNodes[this.childNodes.length-1]}get nodesForAppend(){return this.fragment.childNodes.length>0?[this.fragment]:this.childNodes}get setOfNodes(){return new Set(this.childNodes)}removeFromParent(){this.childNodes.forEach((e=>e.parentNode?.removeChild(e))),this.binds.forEach((e=>e.removeFromParent()))}updateNode(){this.binds.forEach((e=>{e.updateNode()}))}changeIndex(e,t){this.binds.forEach((n=>n.changeIndexes(e,t)))}static create(e,t){const{component:n,template:s}=e,o=document.importNode(s.content,!0),i=ce.bind(s,o,n,t),r=Array.from(o.childNodes);return Object.assign(new N,{binds:i,childNodes:r,fragment:o})}}class E extends o{get node(){return super.node}set node(e){const t=(e=>e instanceof HTMLTemplateElement?e:utils.raise("not HTMLTemplateElement"))(e),n=document.createComment(`template ${t.dataset.bind}`);t.parentNode.replaceChild(n,t),super.node=n,this.template=t}templateChildren=[];#a;get template(){return this.#a}set template(e){this.#a=e}updateNode(){const e="loop"===this.nodeProperty?this.expandLoop():this.expandIf();this.lastViewModelValue=e instanceof Array?e.slice():e}removeFromParent(){this.templateChildren.forEach((e=>e.removeFromParent()))}appendToParent(){const e=document.createDocumentFragment();this.templateChildren.forEach((t=>e.appendChild(...t.nodesForAppend))),this.node.after(e)}expandIf(){const{viewModel:e,viewModelProperty:t,indexes:n,filters:o}=this,i=this.lastViewModelValue,r=s.applyForOutput(e[h](t,n),o);return i!==r&&(this.removeFromParent(),r?(this.templateChildren=[N.create(this,n)],this.appendToParent()):this.templateChildren=[]),this.templateChildren.forEach((e=>e.updateNode())),r}expandLoop(){const{viewModel:e,viewModelProperty:t,indexes:n,filters:o}=this,i=this.lastViewModelValue??[],r=s.applyForOutput(e[h](t,n),o)??[],a=i.reduce(((e,t,n)=>(e.get(t)?.push(n)??e.set(t,[n]),e)),new Map),l=new Map,d=[],p=r.map(((e,t)=>{const s=a.get(e);if(void 0===s)return l.set(t,void 0),d.push(t),N.create(this,n.concat(t));{const e=s.shift();l.set(t,e);const o=this.templateChildren[e];t!==e&&o.changeIndex(n.length,t-e);const i=l.get(t-1);return(void 0===i||i>e)&&d.push(t),o}}));for(const e of a.values())for(const t of e)this.templateChildren[t].removeFromParent();return d.forEach((e=>{const t=p[e];(p[e-1]?.lastNode??this.node).after(...t.nodesForAppend)})),p.forEach((e=>e.updateNode())),this.templateChildren=p,r}changeIndexes(e,t){this.indexes[e]=this.indexes[e]+t,this.templateChildren.forEach((n=>n.changeIndex(e,t)))}}class S{nodeProperty;viewModelProperty;filters}const V=e=>e.trim(),C=e=>e.length>0,I=(e,t)=>e.split(";").map(V).filter(C).map((e=>{let{nodeProperty:n,viewModelProperty:o,filters:i}=((e,t)=>{const[n,o]=["$"].concat(...e.split(":").map(V)).splice(-2),{viewModelProperty:i,filters:r}=(e=>{const[t,...n]=e.split("|").map(V);return{viewModelProperty:t,filters:n.map((e=>(e=>{const[t,...n]=e.split(",").map(V);return Object.assign(new s,{name:t,options:n})})(e)))}})(o);return{nodeProperty:n,viewModelProperty:i,filters:r}})(e);return o="@"===o?prop:o,n="$"===n?t:n,{nodeProperty:n,viewModelProperty:o,filters:i}})),k=class{static bindTextsByKey=new Map;static parse(e,t){const n=e+"\t"+t;let s=this.bindTextsByKey.get(n);return void 0===s&&(s=I(e,t).map((e=>Object.assign(new S,e))),this.bindTextsByKey.set(n,s)),s}},L=class{static getInfo(t,n){const s={type:null,nodePropertyElements:[],eventType:null};return t instanceof HTMLTemplateElement?(s.type=90,s):(s.nodePropertyElements=n.split("."),t instanceof Ne?(s.type=92,s):(1===s.nodePropertyElements.length?s.nodePropertyElements[0].startsWith("on")?(s.type=91,s.eventType=s.nodePropertyElements[0].slice("on".length)):"radio"===s.nodePropertyElements[0]?s.type=20:"checkbox"===s.nodePropertyElements[1]?s.type=30:s.type=1:2===s.nodePropertyElements.length?"className"===s.nodePropertyElements[0]?s.type=10:s.type=2:3===s.nodePropertyElements.length?s.type=3:e.raise(`unknown property ${n}`),s))}};class T{component;name;#o;get indexes(){return this.#o}set indexes(e){this.#o=e,this.#i=e.toString(),this.#l=this.name+"\t"+this.#i}#i;get indexesString(){return this.#i}#l;get key(){return this.#l}constructor(e,t,n){this.component=e,this.name=t,this.indexes=n}}const O=e=>e.key;class B{target;thisArgument;argumentsList;constructor(e,t,n){this.target=e,this.thisArgument=t,this.argumentsList=n}}const R=1,j=2,$=3,F=4,A=5,H=6;class D{#d;#p;#c;#h;#u;#m;#y;constructor(e=null,t=null){this.#d=new class{queue=[];#f;constructor(e){this.#f=e}async exec(){this.#f&&this.#f(R);try{for(;this.queue.length>0;){const e=this.queue.splice(0);for(const t of e)await Reflect.apply(t.target,t.thisArgument,t.argumentsList)}}finally{this.#f&&this.#f(j)}}get isEmpty(){return 0===this.queue.length}}(t),this.#p=new class{queue=[];#f;constructor(e){this.#f=e}async exec(){this.#f&&this.#f($);try{for(;this.queue.length>0;){const e=this.queue.splice(0).reduce(((e,t)=>(e.get(t.component)?.push(t)??e.set(t.component,[t]),e)),new Map);for(const[t,n]of e.entries()){const e=new Set(n.map(O));t.notify(e)}}}finally{this.#f&&this.#f(F)}}get isEmpty(){return 0===this.queue.length}}(t),this.#c=new U(t),this.#h=e,this.#u=new Promise(((e,t)=>{this.#m=e,this.#y=t}))}resolve(){this.#m&&this.#m(),this.#m=null}reject(){this.#y&&this.#y(),this.#y=null}async waiting(){return this.#u}async exec(){do{await this.#d.exec(),await this.#p.exec(),await this.#c.exec()}while(!this.#d.isEmpty||!this.#p.isEmpty||!this.#c.isEmpty)}addProcess(e){this.#d.queue.push(e),this.resolve()}addNotify(e){this.#p.queue.push(e),this.resolve()}addNodeUpdate(e){this.#c.queue.push(e),this.resolve()}callback(){this.#h&&this.#h()}static create(e,t){return new D(e,t)}}class q{#m;#y;constructor(){this.main()}async#P(){return new Promise(((e,t)=>{this.#m=e,this.#y=t}))}stop(){this.#y()}wakeup(e){this.#m(e)}async main(){for(;;)try{const e=await this.#P();await e.waiting(),Ee.debug&&performance.mark("slot-exec:start");try{await e.exec(),Ee.debug&&(performance.mark("slot-exec:end"),performance.measure("slot-exec","slot-exec:start","slot-exec:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures(),performance.clearMarks())}finally{e.callback()}}catch(e){if(void 0!==e&&(console.error(e),!confirm("致命的なエラーが発生しました。続行しますか？")))break}}}class K{node;property;updateFunc;constructor(e,t,n){this.node=e,this.property=t,this.updateFunc=n}}const U=class{queue=[];#f;constructor(e){this.#f=e}reorder(e){return e.sort(((e,t)=>t.node instanceof HTMLTemplateElement||e.node instanceof HTMLSelectElement&&"value"===e.property?1:-1)),e}async exec(){this.#f&&this.#f(A);try{for(;this.queue.length>0;)this.reorder(this.queue.splice(0)).forEach((e=>Reflect.apply(e.updateFunc,e,[])))}finally{this.#f&&this.#f(H)}}get isEmpty(){return 0===this.queue.length}};class W extends o{updateNode(){const{component:e,node:t,nodeProperty:n,viewModel:o,viewModelProperty:i,indexes:r,filters:a}=this,l=s.applyForOutput(o[h](i,r),a);this.lastViewModelValue!==l&&(e.updateSlot.addNodeUpdate(new K(t,n,(()=>{t[n]=l??""}))),this.lastViewModelValue=l)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:n,viewModelProperty:o,indexes:i,filters:r}=this,a=s.applyForInput(e[t],r);n[u](o,i,a),this.lastViewModelValue=a}}class G extends o{get nodeProperty1(){return this.nodePropertyElements[0]}get nodeProperty2(){return this.nodePropertyElements[1]}updateNode(){const{component:e,node:t,nodeProperty:n,viewModel:o,viewModelProperty:i,indexes:r,filters:a}=this,{nodeProperty1:l,nodeProperty2:d}=this,p=s.applyForOutput(o[h](i,r),a);this.lastViewModelValue!==p&&(e.updateSlot.addNodeUpdate(new K(t,n,(()=>{t[l][d]=p??""}))),this.lastViewModelValue=p)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:n,viewModelProperty:o,indexes:i,filters:r}=this,{nodeProperty1:a,nodeProperty2:l}=this,d=s.applyForInput(e[a][l],r);n[u](o,i,d),this.lastViewModelValue=d}}class _ extends o{get nodeProperty1(){return this.nodePropertyElements[0]}get nodeProperty2(){return this.nodePropertyElements[1]}get nodeProperty3(){return this.nodePropertyElements[2]}updateNode(){const{component:e,node:t,nodeProperty:n,viewModel:o,viewModelProperty:i,indexes:r,filters:a}=this,{nodeProperty1:l,nodeProperty2:d,nodeProperty3:p}=this,c=s.applyForOutput(o[h](i,r),a);this.lastViewModelValue!==c&&(e.updateSlot.addNodeUpdate(new K(t,n,(()=>{t[l][d][p]=c??""}))),this.lastViewModelValue=c)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:n,viewModelProperty:o,indexes:i,filters:r}=this,{nodeProperty1:a,nodeProperty2:l,nodeProperty3:d}=this,p=s.applyForInput(e[a][l][d],r);n[u](o,i,p),this.lastViewModelValue=p}}const z=e=>e instanceof HTMLElement?e:utils.raise("not HTMLElement");class J extends o{get className(){return this.nodePropertyElements[1]}updateNode(){const{component:e,node:t,nodeProperty:n,viewModel:o,viewModelProperty:i,indexes:r,filters:a,className:l}=this,d=z(t),p=s.applyForOutput(o[h](i,r),a);this.lastViewModelValue!==p&&(e.updateSlot.addNodeUpdate(new K(t,n,(()=>{p?d.classList.add(l):d.classList.remove(l)}))),this.lastViewModelValue=p)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:n,viewModelProperty:o,indexes:i,filters:r,className:a}=this,l=z(e),d=s.applyForInput(l.classList.contains(a),r);n[u](o,i,d),this.lastViewModelValue=d}}const Q=t=>t instanceof HTMLInputElement?t:e.raise();class X extends o{updateNode(){const{component:e,node:t,nodeProperty:n,viewModel:o,viewModelProperty:i,indexes:r,filters:a}=this,l=Q(t),d=s.applyForOutput(o[h](i,r),a);this.lastViewModelValue!==d&&(e.updateSlot.addNodeUpdate(new K(t,n,(()=>{l.checked=d===l.value}))),this.lastViewModelValue=d)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:n,viewModelProperty:o,indexes:i,filters:r}=this,a=Q(e),l=s.applyForInput(a.value,r);a.checked&&(n[u](o,i,l),this.lastViewModelValue=l)}}const Y=t=>t instanceof HTMLInputElement?t:e.raise();class Z extends o{updateNode(){const{component:e,node:t,nodeProperty:n,viewModel:o,viewModelProperty:i,indexes:r,filters:a}=this,l=Y(t),d=s.applyForOutput(o[h](i,r),a);this.lastViewModelValue!==d&&(e.updateSlot.addNodeUpdate(new K(t,n,(()=>{l.checked=d.find((e=>e===l.value))}))),this.lastViewModelValue=d)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:n,viewModelProperty:o,indexes:i,filters:r}=bind,a=Y(e),l=s.applyForInput(a.value,r),d=new Set(n[h](o,i));a.checked?d.add(l):d.delete(l);const p=Array.from(d);n[u](o,i,p),this.lastViewModelValue=p}}class ee extends o{#w;get eventType(){return this.#w}set eventType(e){this.#w=e}addEventListener(){const{component:e,element:t,eventType:n,viewModel:s,viewModelProperty:o}=this;t.addEventListener(n,(t=>{t.stopPropagation();const n=this.contextIndexes,i=new B(s[m],s,[o,n,t]);e.updateSlot.addProcess(i)}))}}class te{name;elements;loopLevel;parentName;lastElement;regexp;isPrimitive;privateName;isObject;isLoop;isNotPrimitive;constructor(e){this.name=e,this.elements=e.split("."),this.loopLevel=this.elements.reduce(((e,t)=>e+("*"===t?1:0)),0),this.parentName=this.elements.slice(0,-1).join("."),this.lastElement=this.elements.at(-1)??null,this.regexp=this.loopLevel>0?new RegExp("^"+e.replaceAll("*","(\\w+)").replaceAll(".","\\.")+"$"):null,this.isPrimitive=1===this.elements.length&&0===this.loopLevel,this.privateName=this.isPrimitive?"_"+e:null,this.isObject=this.elements.length>1&&0===this.loopLevel,this.isLoop=this.elements.length>1&&this.loopLevel>0,this.isNotPrimitive=!this.isPrimitive}get parentProperty(){return te.create(this.parentName)}primitiveGetter(e){return e[this.privateName]}primitiveSetter(e,t){return e[this.privateName]=t,!0}nonPrimitiveGetter(e){const{parentName:t,loopLevel:n,lastElement:s}=this,o="*"===s?e[d][n-1]:s;return e[t][o]}nonPrimitiveSetter(e,t){const{parentName:n,loopLevel:s,lastElement:o}=this,i="*"===o?e[d][s-1]:o;return e[n][i]=t,!0}createPropertyDescriptor(e){return{get:this.isPrimitive?()=>Reflect.apply(this.primitiveGetter,this,[e.viewModel]):()=>Reflect.apply(this.nonPrimitiveGetter,this,[e.viewModel]),set:this.isPrimitive?t=>Reflect.apply(this.primitiveSetter,this,[e.viewModel,t]):t=>Reflect.apply(this.nonPrimitiveSetter,this,[e.viewModel,t]),enumerable:!0,configurable:!0}}expand(e,t){if(this.loopLevel===t.length)return[t];if(this.loopLevel<t.length)return[t.slice(0,this.loopLevel)];{const n=(s,o,i)=>{const r=""!==s?s+".":s,a=this.elements[o],l=this.elements.length-1===o;let d;return d="*"===a?i.length<t.length?l?[t.slice(0,i.length+1)]:n(r+a,o+1,t.slice(0,i.length+1)):(e[h](s,i)??[]).flatMap(((e,t)=>l?i.concat(t):n(r+a,o+1,i.concat(t)))):l?[i]:n(r+a,o+1,i),d};return n("",0,[])}}static#g=new Map;static create(e){if(""===e)return;let t=this.#g.get(e);return void 0===t&&(t=new te(e),this.#g.set(e,t)),t}}const ne=e=>e instanceof Ne?e:void 0;class se extends o{get node(){return super.node}set node(e){const t=ne(e);t?.data[b](t),super.node=e}get nodeProperty(){return super.nodeProperty}bindProp(){const e=ne(this.node);e?.data[x](this.dataProperty,this.viewModelProperty,this.indexes)}set nodeProperty(e){super.nodeProperty=e}get viewModelProperty(){return super.viewModelProperty}set viewModelProperty(e){super.viewModelProperty=e,this.viewModelProperty&&this.nodePropertyElements&&this.bindProp()}get nodePropertyElements(){return super.nodePropertyElements}set nodePropertyElements(e){super.nodePropertyElements=e,this.viewModelProperty&&this.nodePropertyElements&&this.bindProp()}get dataNameProperty(){return this.nodePropertyElements[0]}get dataProperty(){return this.nodePropertyElements[1]}updateNode(){const{node:e,dataProperty:t}=this,n=ne(e);n.viewModel?.[g](`$data.${t}`,[])}updateViewModel(){}}const oe=new Map;oe.set(1,((e,t)=>Object.assign(new W,e,t))),oe.set(2,((e,t)=>Object.assign(new G,e,t))),oe.set(3,((e,t)=>Object.assign(new _,e,t))),oe.set(10,((e,t)=>Object.assign(new J,e,t))),oe.set(20,((e,t)=>Object.assign(new X,e,t))),oe.set(30,((e,t)=>Object.assign(new Z,e,t))),oe.set(90,((e,t)=>Object.assign(new E,e,t))),oe.set(91,((e,t)=>Object.assign(new ee,e,t))),oe.set(92,((e,t)=>Object.assign(new se,e,t)));class ie{static create({component:e,node:t,nodeProperty:n,viewModel:s,viewModelProperty:o,filters:i,indexes:r}){const a={component:e,node:t,nodeProperty:n,viewModel:s,viewModelProperty:o,filters:i},l=te.create(o);a.indexes=r.slice(0,l.loopLevel),a.contextIndexes=r;const d=L.getInfo(t,n);return oe.get(d.type)(a,d)}}const re=class extends a{static bind(t,n,s){const o=n.viewModel,i=(t=>t instanceof HTMLTemplateElement?t:e.raise("not HTMLTemplateElement"))(t),r=i.dataset.bind,a=k.parse(r,"").map((e=>ie.create(Object.assign(e,{node:t,component:n,viewModel:o,indexes:s.slice()}))));if(0===a.length)return[];const l=(e=>e instanceof E?e:void 0)(a[0]);if(l)return"if"!==l.nodeProperty&&"loop"!==l.nodeProperty&&e.raise(`unknown node property ${l.nodeProperty}`),l.updateNode(),[l];e.raise("not template bind")}},ae="oninput",le=ae.slice(2),de=class extends a{static bind(t,n,s){const o=n.viewModel,i=(t=>t instanceof HTMLElement?t:e.raise("not HTMLElement"))(t),r=i.dataset.bind,a=(e=>e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLOptionElement?"value":e instanceof HTMLInputElement?"radio"===e.type||"checkbox"===e.type?"checked":"value":"textContent")(i),l=k.parse(r,a).map((e=>{const i=ie.create(Object.assign(e,{node:t,component:n,viewModel:o,indexes:s.slice()}));return i.updateNode(),i}));let d=!1,p=null;return l.forEach((e=>{d||=e.nodeProperty===ae,p=e.nodeProperty===a?e:p;const t=(e=>e instanceof ee?e:void 0)(e);t&&t.addEventListener()})),p&&!d&&i.addEventListener(le,(e=>{e.stopPropagation();const t=new B(p.updateViewModel,p,[]);n.updateSlot.addProcess(t)})),l}},pe=class extends a{static bind(t,n,s){const o=n.viewModel,i=(t=>t instanceof Comment?t:e.raise("not Comment"))(t),r=i.textContent.slice(2),a=document.createTextNode("");return i.parentNode.replaceChild(a,i),k.parse(r,"textContent").map((e=>{const t=ie.create(Object.assign(e,{node:a,component:n,viewModel:o,indexes:s.slice()}));return t.updateNode(),t}))}},ce=class{static bind(t,n,s,o=[]){return r.getTargetNodes(t,n).flatMap((t=>t instanceof HTMLTemplateElement?re.bind(t,s,o):t instanceof HTMLElement?de.bind(t,s,o):t instanceof Comment?pe.bind(t,s,o):e.raise("unknown node type")))}},he=e=>e instanceof E?e:void 0;class ue{template;rootElement;constructor(e,t){this.template=e,this.rootElement=t}render(e){const t=document.importNode(this.template.content,!0),n=new class{#v;#M=new Map;constructor(e){this.#v=e,this.buildMap()}buildMap(){const e=t=>{t.forEach((t=>{this.#M.get(t.viewModelPropertyKey)?.push(t)??this.#M.set(t.viewModelPropertyKey,[t]),(he(t)?.templateChildren??[]).forEach((t=>e(t.binds)))}))};this.#M.clear(),e(this.#v)}getTemplateBinds(e){const t=[],n=[{binds:this.#v,children:null,index:-1}];for(;n.length>0;){const s=n[n.length-1];if(s.index++,s.binds)if(s.index<s.binds.length){const o=he(s.binds[s.index]);o&&(e.has(o.viewModelPropertyKey)?t.push(o):o.templateChildren.length>0&&n.push({binds:null,children:o.templateChildren,index:-1}))}else n.pop();else if(s.index<s.children.length){const e=s.children[s.index];e.binds.length>0&&n.push({binds:e.binds,children:null,index:-1})}else n.pop()}return t}updateViewModel(e){const t=new Set(this.getTemplateBinds(e));if(t.size>0){for(const e of t)e.updateNode();this.buildMap()}const n=s=>{s.forEach((s=>{!t.has(s)&&e.has(s.viewModelPropertyKey)&&s.updateNode(),he(s)?.templateChildren.forEach((e=>n(e.binds)))}))};n(this.#v)}}(ce.bind(this.template,t,e));return this.rootElement.appendChild(t),n}}const me=e=>"_"!==e[0],ye="$dependentProps",fe=class{static convert(t,n){let s=new Map;if(ye in n){const e=Object.getOwnPropertyDescriptor(n,ye);e.enumerable=!1,Object.defineProperty(n,ye,e),s=function(e){const t=new Map;return Object.entries(e).forEach((([e,n])=>{n.forEach((n=>{t.get(n)?.push(e)??t.set(n,[e])}))})),t}(e.value)}for(const[e,t]of Object.entries(Object.getOwnPropertyDescriptors(n)))me(e)||(t.enumerable=!1,Object.defineProperty(n,e,t));Object.keys(n).filter(me).map((e=>te.create(e))).forEach((e=>{const s=n[e.name];delete n[e.name];const o=e.createPropertyDescriptor(t);if(Object.defineProperty(n,e.name,o),!(e.privateName in n)){const t={value:s,writable:!0,enumerable:!1,configurable:!0};Object.defineProperty(n,e.privateName,t)}}));for(const[t,s]of Object.entries(Object.getOwnPropertyDescriptors(Object.getPrototypeOf(n))))"constructor"!==t&&(e.isFunction(s.value)||(s.enumerable=!0,Object.defineProperty(n,t,s)));const o=Object.keys(n).map((e=>te.create(e)));return o.forEach((e=>{if(e.isPrimitive)return;const t=s.get(e.parentName)?.concat(e.name)??[e.name];s.set(e.parentName,t)})),{viewModel:n,definedProperties:o,dependentMap:s}}};class Pe{dirty=!1;value;constructor(e){this.value=e}}class we{#b;#x;#o;constructor(e,t,n){this.#b=e,this.#x=t,this.#o=n}get(e,t,n){return t===v||(t===M?e:Reflect.get(e,t,n))}set(e,t,n,s){if(Reflect.set(e,t,n,s),"length"===t){const t=this.#b,n=t.viewModel,s=this.#x.name;t.updateSlot.addProcess(new B((()=>{n[s]=e}),n,[]))}return!0}}const ge=new Set([...Array(8)].map(((e,t)=>"$"+(t+1)))),ve=(e,t,n,s)=>(s=s?.[v]?s[M]:s)instanceof Array?function(e,t,n,s){return new Proxy(e,new we(t,n,s))}(s,e,t,n):s;class Me{cache;propertyInfoAndIndexesByProp=new Map;stackIndexes=[];component;definedPropertyByProp=new Map;loopProperties=[];dependentMap;setOfDependentPropNamesByPropName=new Map;constructor(e,t,n){this.component=e,this.definedPropertyByProp=new Map(t.map((e=>[e.name,e]))),this.loopProperties=t.filter((e=>e.isLoop)),this.dependentMap=n,this.cache=new class{#N=new Map;#E;#S;#V;constructor(e){this.#E=e,this.#S=e.filter((e=>""!==e.parentName)).reduce(((e,t)=>(e.get(t.parentName)?.push(t)??e.set(t.parentName,[t]),e)),new Map);const t=(e,n)=>((this.#S.get(n)??[]).forEach((n=>{e.push(n),t(e,n.name)})),e);this.#V=new Map(e.map((e=>[e.name,t(new Array,e.name)])))}get(e,t){const n=this.#N.get(e)?.get(t.toString());return n?n.dirty?void 0:n.value:void 0}set(e,t,n){let s=this.#N.get(e);void 0===s&&(s=new Map,this.#N.set(e,s)),s.set(t.toString(),new Pe(n))}has(e,t){const n=this.#N.get(e)?.get(t.toString());return!!n&&!n.dirty}delete(e,t){const n=t.slice(0,e.loopLevel).toString(),s=n+",";let o=this.#N.get(e);if(o)for(const e of o.keys())(""===n||e===n||e.startsWith(s))&&(o.get(e).dirty=!0);(this.#V.get(e.name)??[]).forEach((e=>{const t=this.#N.get(e);if(void 0!==t)for(const e of t.keys())(""===n||e===n||e.startsWith(s))&&(t.get(e).dirty=!0)}))}clear(){this.#N.clear()}}(t);const s=(e,t)=>((n.get(t)??[]).forEach((t=>{e.has(t)||(e.add(t),s(e,t))})),e);this.setOfDependentPropNamesByPropName=new Map(Array.from(n.keys()).map((e=>[e,s(new Set,e)])))}get lastIndexes(){return this.stackIndexes[this.stackIndexes.length-1]??[]}async[y](e,t){if("$oninit"in e)return await Reflect.apply(e.$oninit,t,[])}async[f](e,t){if("$onconnect"in e)return await Reflect.apply(e.$onconnect,t,[])}[P](e,t,n,s){if("$onwrite"in n){const{component:o}=this,i=new B(n.$onwrite,s,[e,t]);o.updateSlot.addProcess(i)}}#C(e,t,n){const{component:s,lastIndexes:o,cache:i}=this,r=o.slice(0,t.loopLevel),a=i.get(t,r);if(void 0!==a)return ve(s,t,r,a);const l=Reflect.get(e,t.name,n);return i.set(t,r,l),ve(s,t,r,l)}[h](e,t,n,s){let o;this.stackIndexes.push(t);try{o=s[e]}finally{this.stackIndexes.pop()}return o}[g](e,t,n,s){const{dependentMap:o,setOfDependentPropNamesByPropName:i,component:r}=this;o.has(e)&&(i.get(e)??new Set).forEach((e=>{if(e.startsWith("$data"))r.updateSlot.addNotify(new T(r,e,[]));else{const n=te.create(e);if(t.length<n.loopLevel)n.expand(s,t).forEach((e=>{r.updateSlot.addNotify(new T(r,n.name,e))}));else{const e=t.slice(0,n.loopLevel);r.updateSlot.addNotify(new T(r,n.name,e))}}}))}#I(e,t,n,s){const{component:o,lastIndexes:i,cache:r}=this;n=n?.[v]?n[M]:n;const a=i.slice(0,t.loopLevel);return Reflect.set(e,t.name,n,s),o.updateSlot.addNotify(new T(o,t.name,a)),this[g](t.name,a,e,s),this[P](t.name,i,e,s),!0}[u](e,t,n,s,o){this.stackIndexes.push(t);try{o[e]=n}finally{this.stackIndexes.pop()}return!0}async[m](e,t,n,s,o){this.stackIndexes.push(t);try{await Reflect.apply(s[e],o,[n,...t])}finally{this.stackIndexes.pop()}}[w](e,t){this.cache.clear()}#k(e){let{loopProperty:t,indexes:n}=this.propertyInfoAndIndexesByProp.get(e)??{};if(void 0===t)for(const s of this.loopProperties){const o=s.regexp.exec(e);if(o){n=o.slice(1).map(Number),t=s,this.propertyInfoAndIndexesByProp.set(e,{loopProperty:t,indexes:n});break}}return{loopProperty:t,indexes:n}}get(e,t,n){const{lastIndexes:s,component:o,cache:i,dependentMap:r}=this;if("symbol"==typeof t)switch(t){case h:return(t,s)=>Reflect.apply(this[h],this,[t,s,e,n]);case u:return(t,s,o)=>Reflect.apply(this[u],this,[t,s,o,e,n]);case d:return s;case m:return(t,s,o)=>Reflect.apply(this[m],this,[t,s,o,e,n]);case y:return()=>Reflect.apply(this[y],this,[e,n]);case P:return(t,s)=>Reflect.apply(this[P],this,[t,s,e,n]);case f:return()=>Reflect.apply(this[f],this,[e,n]);case w:return()=>Reflect.apply(this[w],this,[e,n]);case g:return(t,s)=>Reflect.apply(this[g],this,[t,s,e,n]);case p:return e;case c:return r}if(ge.has(t))return s[Number(t.slice(1))-1];if("$component"===t)return o;if("$data"===t)return o.data;if("$openDialog"===t)return async(e,t,n)=>{const s=document.createElement(Ee.prefix?Ee.prefix+"-"+e:e);return Object.entries(n??{}).forEach((([e,t])=>{s.setAttribute(e,t)})),s.data[b](t??{}),document.body.appendChild(s),s.alivePromise};if("$closeDialog"===t)return e=>{Object.assign(o.data,e),o.parentNode.removeChild(o)};if("$notify"===t)return(e,t)=>{o.updateSlot.addNotify(new T(o,e,t))};const a=this.definedPropertyByProp.get(t);if(a)return this.#C(e,a,n);if("@"===t[0]){const s=t.slice(1),o=this.definedPropertyByProp.get(s);if(o)return o.expand(n,[]).map((t=>[this[h](s,t,e,n),t]))}if("_"!==t[0]){const{loopProperty:s,indexes:o}=this.#k(t);if(s&&o)return this[h](s.name,o,e,n)}return Reflect.get(e,t,n)}set(e,t,n,s){const o=this.definedPropertyByProp.get(t);if(o)return this.#I(e,o,n,s);if("@"===t[0]){const o=t.slice(1),i=this.definedPropertyByProp.get(o);if(i)return i.expand(s,[]).forEach((t=>{this[u](o,t,n,e,s)})),!0}if("_"!==t[0]){const{loopProperty:o,indexes:i}=this.#k(t);if(o&&i)return this[u](o.name,i,n,e,s),!0}return Reflect.set(e,t,n,s),!0}}function be(e,t){let n=0;return e.replaceAll("*",(()=>t[n++]??"*"))}class xe{#L={};#b;#T=new Map;get data(){return(this.#b?this.#b?.parentComponent?.viewModel:this.#L)??{}}[b](e){e instanceof Ne?this.#b=e:this.#L=e}[x](e,t,n){this.#T.set(e,{bindProp:t,indexes:n})}get(e,t,n){if(t===b)return e=>Reflect.apply(this[b],this,[e]);if(t===x)return(e,t,n)=>Reflect.apply(this[x],this,[e,t,n]);const{data:s}=this,{bindProp:o,indexes:i}=this.#T.get(t)??{bindProp:t,indexes:[]},r=be(o,i);return Reflect.get(s,r,s)}set(e,t,n,s){const{data:o}=this,{bindProp:i,indexes:r}=this.#T.get(t)??{bindProp:t,indexes:[]},a=be(i,r);return Reflect.set(o,a,n,o)}}class Ne extends HTMLElement{static html;static template;static ViewModel;viewModel;#O;#v;#B;#R;get updateSlot(){return void 0===this.#R&&(this.#R=D.create((()=>{this.#R=void 0}),(e=>{e===R&&this.viewModel[w](),e===$&&this.viewModel[w]()})),this.#B.wakeup(this.#R)),this.#R}#L=function(e){return new Proxy({},new xe(e))}(this);get data(){return this.#L}constructor(){super(),this.#j=new Promise(((e,t)=>{this.#$=e,this.#F=t}))}static get observedAttributes(){return[]}get noShadowRoot(){return this.hasAttribute("no-shadow-root")}get viewRootElement(){return this.shadowRoot??this}async build(){const{template:e,ViewModel:t}=this.constructor;this.noShadowRoot||this.attachShadow({mode:"open"}),this.#B=new q,this.#O=new ue(e,this.viewRootElement);const n=Reflect.construct(t,[]);this.viewModel=function(e,t){const{viewModel:n,definedProperties:s,dependentMap:o}=fe.convert(e,t);return new Proxy(n,new Me(e,s,o))}(this,n),await this.viewModel[y](),this.updateSlot.addProcess(new B((async()=>{this.#v=this.#O.render(this),await this.viewModel[f]()}),this,[]))}#j;#$;#F;get initialPromise(){return this.#j}#A;#H;#D;get alivePromise(){return this.#A}#q;get parentComponent(){return void 0===this.#q&&(this.#q=(e=>{for(;;){if(null==(e=e.parentNode))return null;if(e instanceof Ne)return e;if(e instanceof ShadowRoot){if(e.host instanceof Ne)return e.host;e=e.host}}})(this)),this.#q}async connectedCallback(){try{this.parentComponent&&await this.parentComponent.initialPromise,this.#A=new Promise(((e,t)=>{this.#H=e,this.#D=t})),await this.build()}finally{this.#$&&this.#$()}}disconnectedCallback(){this.#H&&this.#H(this.data)}adoptedCallback(){}attributeChangedCallback(e,t,n){}notify(e){this.#v?.updateViewModel(e)}static regist(e,t){const n=((e,t)=>{const n=document.createElement("template");return n.innerHTML=(t?`<style>\n${t}\n</style>`:"")+(e?(e=>{const t=[];return e.replaceAll(/\{\{([^\}]+)\}\}/g,((e,n)=>(n=n.trim()).startsWith("loop:")||n.startsWith("if:")?(t.push(n),`<template data-bind="${n}">`):n.startsWith("else:")?`</template><template data-bind="${t.at(-1)}|not">`:n.startsWith("end:")?(t.pop(),"</template>"):`\x3c!--@@${n}--\x3e`))})(e):""),n})(t.html,t.css),s=class extends Ne{static template=n;static ViewModel=t.ViewModel};customElements.define(e,s)}}class Ee{static#K={prefix:void 0,debug:!1};static components(e){const t=this.prefix;return Object.entries(e).forEach((([e,n])=>{const s=t?t+"-"+e:e;Ne.regist(s,n)})),this}static filters(e){return Object.entries(e).forEach((([e,t])=>{const{input:n,output:o}=t;s.regist(e,o,n)})),this}static config({prefix:e,debug:t=!1}){return this.#K=Object.assign(this.#K,{prefix:e,debug:t}),this}static get debug(){return this.#K.debug}static get prefix(){return this.#K.prefix}}window[l]=Ee})();