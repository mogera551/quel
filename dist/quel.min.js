const e={debug:!1,useShadowRoot:!1,useKeyed:!0,useWebComponent:!0,useLocalTagName:!0,useLocalSelector:!0,useOverscrollBehavior:!0};function t(e){return new URL(e.url).search.slice(1)}async function n(e){return await fetch(e.url.replace(".js",".html")).then((e=>e.text()))}async function s(e){return await fetch(e.url.replace(".js",".css")).then((e=>e.text()))}class i{defaultNameType="lowerCamel";defaultPath="./";loadNames=[];prefixMap}class r{prefix;path;get matchPrefix(){return`${this.prefix}-`}constructor(e,t){this.prefix=e,this.path=t}isMatch(e){return e.startsWith(this.matchPrefix)}getNames(e){const{prefix:t,path:n}=this;if(e.startsWith(this.matchPrefix)){return{prefixName:t,subName:e.slice(this.matchPrefix.length),path:n}}}}const o=e=>"string"==typeof e?e.replaceAll(/[\._]/g,"-").replaceAll(/([A-Z])/g,((e,t,n)=>(n>0?"-":"")+t.toLowerCase())):e;function a(e){const t=o(e),n=t.replaceAll("-","_"),s=t.replaceAll("-","."),i=t.split("-").map(((e,t)=>(void 0!==e[0]&&(e=e[0].toUpperCase()+e.slice(1)),e))).join(""),r=i.length>0?i[0].toLowerCase()+i.slice(1):i;return{kebab:t,snake:n,upperCamel:i,lowerCamel:r,dotted:s}}const l=a("prefix-name"),d=a("sub-name");function c(e,t,n,s){const[i,r]=e.split("#");let o=i,c=r;const u=a(t),p=a(n);return o=o.replaceAll(`{${l.kebab}}`,u.kebab),o=o.replaceAll(`{${l.snake}}`,u.snake),o=o.replaceAll(`{${l.lowerCamel}}`,u.lowerCamel),o=o.replaceAll(`{${l.upperCamel}}`,u.upperCamel),o=o.replaceAll(`{${l.dotted}}`,u.dotted),o=o.replaceAll(`{${d.kebab}}`,p.kebab),o=o.replaceAll(`{${d.snake}}`,p.snake),o=o.replaceAll(`{${d.lowerCamel}}`,p.lowerCamel),o=o.replaceAll(`{${d.upperCamel}}`,p.upperCamel),o=o.replaceAll(`{${d.dotted}}`,p.dotted),i===o&&".js"!==o.slice(-3)&&(o=o+("/"!==e.slice(-1)?"/":"")+p[s]+".js"),c&&(c=c.replaceAll(`{${d.kebab}}`,p.kebab),c=c.replaceAll(`{${d.snake}}`,p.snake),c=c.replaceAll(`{${d.lowerCamel}}`,p.lowerCamel),c=c.replaceAll(`{${d.upperCamel}}`,p.upperCamel),c=c.replaceAll(`{${d.dotted}}`,p.dotted)),{filePath:o,exportName:c}}class u{static raise(e){throw new Error(e)}static toKebabCase=e=>"string"==typeof e?e.replaceAll(/_/g,"-").replaceAll(/([A-Z])/g,((e,t,n)=>(n>0?"-":"")+t.toLowerCase())):e;static createUUID(){return window?.crypto?.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=((new Date).getTime()+16*Math.random())%16|0;return("x"==e?t:3&t|8).toString(16)}))}}class p{#e;#t;#n=new Map;#s;#i;constructor(e){this.#s=e,this.#i=window.location,this.#t=Object.assign(new i)}setConfig(e){this.#t=Object.assign(new i,e),"prefixMap"in e&&void 0!==e.prefixMap&&this.setPrefixMap(e.prefixMap)}getConfig(){return this.#t}setPrefixMap(e){this.#n=new Map(Object.entries(e).map((([e,t])=>[o(e),new r(e,t)])))}getPrefixMap(){return this.#n}configFile(e){return this.#e=e,this}config(e){return this.setConfig(e),this}prefixMap(e){return this.setPrefixMap(e),this}get registrar(){return this.#s}async loadConfig(e){const t=this.#i.pathname.split("/");t[t.length-1]=e;const n=this.#i.origin+t.join("/");try{const e=await fetch(n),t=await e.json();return Object.assign(new i,t)}catch(t){throw console.error(`config file load error (configFile:${e}, ${n})`,t),new Error("config file load error")}}async load(...e){if(void 0!==this.#e){const e=await this.loadConfig(this.#e);this.setConfig(e)}if(void 0===this.#n)throw new Error("prefixMap is not defined");if(void 0===this.#s)throw new Error("registrar is not defined");const t=Array.from(this.#n.values()),{defaultNameType:n,defaultPath:s}=this.#t;e=e.length>0?e:this.#t.loadNames;for(let i of e){let e;i=o(i);const r=t.find((e=>e.isMatch(i)));if(void 0!==r){const t=r.getNames(i)??u.raise(`names not found (loadName:${i})`);e=c(t.path,t.prefixName,t.subName,n)}if(void 0===e&&void 0!==s&&(e=c(s,"",i,n)),void 0===e)throw new Error(`unmatch prefix and no defaultPath (loadName:${i})`);const a=this.#i.pathname.split("/");a[a.length-1]=e.filePath;const l=this.#i.origin+a.join("/");let d,p;try{d=await import(l)}catch(e){throw console.error(`import error (loadName:${i}, ${l})`,e),new Error("import error")}if(void 0!==e.exportName){if(void 0!==d.default?e.exportName in d.default&&(p=d.default[e.exportName]):e.exportName in d&&(p=d[e.exportName]),void 0===p)throw new Error(`${e.exportName} not found in module (exportName:${e.exportName}, ${e.filePath})`)}else p=void 0!==d.default?d.default:Object.assign({},d);this.#s(i,p)}return this}static create(e){return new p(e)}}const h={objectClass:Object,prefix:"object",prefixShort:"o",prototypeFuncs:new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),staticFuncs:new Set(["create","defineProperties","defineProperty","entries","fromEntries","getOwnPropertyDescriptor","getOwnPropertyDescriptors","getOwnPropertyNames","getOwnPropertySymbols","getPrototypeOf","is","isExtensible","isFrozen","isSealed","keys","preventExtensions","values"])},f={objectClass:Array,prefix:"array",prefixShort:"a",prototypeFuncs:new Set(["at","concat","entries","flat","includes","indexOf","join","keys","lastIndexOf","slice","toLocaleString","toReversed","toSorted","toSpliced","values","with","toString"]),staticFuncs:new Set(["from","isArray","of"])},m={objectClass:Number,prefix:"number",prefixShort:"n",prototypeFuncs:new Set(["toExponential","toFixed","toLocaleString","toPrecision","toString","valueOf"]),staticFuncs:new Set(["isFinite","isInteger","isNaN","isSafeInteger","parseFloat","parseInt"])},g={objectClass:String,prefix:"string",prefixShort:"s",prototypeFuncs:new Set(["at","charAt","charCodeAt","codePointAt","concat","endsWith","includes","indexOf","lastIndexOf","localeCompare","match","normalize","padEnd","padStart","repeat","replace","replaceAll","search","slice","split","startsWith","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim","trimEnd","trimStart","valueOf","toString"]),staticFuncs:new Set(["fromCharCode","fromCodePoint","raw"])},y={objectClass:Date,prefix:"date",prefixShort:"",prototypeFuncs:new Set(["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","toDateString","toISOString","toJSON","toLocaleDateString","toLocaleString","toLocaleTimeString","toTimeString","toUTCString","valueOf","toString"]),staticFuncs:new Set(["now","parse","UTC"])},b={objectClass:Set,prefix:"set",prefixShort:"",prototypeFuncs:new Set(["entries","forEach","has","keys","values"]),staticFuncs:new Set([])},x={objectClass:Map,prefix:"map",prefixShort:"",prototypeFuncs:new Set(["entries","forEach","get","has","keys","values"]),staticFuncs:new Set(["groupBy"])},v={objectClass:JSON,prefix:"json",prefixShort:"",prototypeFuncs:new Set([]),staticFuncs:new Set(["parse","stringify"])},C={objectClass:Math,prefix:"math",prefixShort:"",prototypeFuncs:new Set([]),staticFuncs:new Set(["abs","acos","acosh","asin","asinh","atan","atan2","atanh","cbrt","ceil","clz32","cos","cosh","exp","expm1","floor","fround","hypot","imul","log","log10","log1p","log2","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc"])},w={objectClass:RegExp,prefix:"regexp",prefixShort:"",prototypeFuncs:new Set(["exec","test","toString"]),staticFuncs:new Set([])};class P{static"truthy*"=e=>e=>!!e;static"falsey*"=e=>e=>!e;static"not*"=this["falsey*"];static eq=e=>t=>t==e[0];static ne=e=>t=>t!=e[0];static lt=e=>t=>Number(t)<Number(e[0]);static le=e=>t=>Number(t)<=Number(e[0]);static gt=e=>t=>Number(t)>Number(e[0]);static ge=e=>t=>Number(t)>=Number(e[0]);static oi=e=>t=>Number(e[0])<Number(t)&&Number(t)<Number(e[1]);static ci=e=>t=>Number(e[0])<=Number(t)&&Number(t)<=Number(e[1]);static embed=e=>t=>(e[0]??"").replaceAll("%s",t);static iftext=e=>t=>t?e[0]??null:e[1]??null;static"isnull*"=e=>e=>null==e;static offset=e=>t=>Number(t)+Number(e[0]);static unit=e=>t=>String(t)+String(e[0]);static inc=this.offset;static mul=e=>t=>Number(t)*Number(e[0]);static div=e=>t=>Number(t)/Number(e[0]);static mod=e=>t=>Number(t)%Number(e[0]);static prop=e=>t=>t[e[0]];static prefix=e=>t=>String(e[0])+String(t);static suffix=this.unit;static date=e=>t=>Date.prototype.toLocaleDateString.apply(t,["sv-SE",e[0]?e[0]:{}]);static"isnan*"=e=>e=>isNaN(e)}new Set([]);const S=new Set(["truthy*","falsey*","not*","eq","ne","lt","le","gt","ge","oi","ci","embed","iftext","isnull*","offset","unit","inc","mul","div","mod","prop","prefix","suffix","date","isnan*"]);function B(e,t){if(Reflect.has(e,"prototype")){const n=Reflect.get(e,"prototype");if(Reflect.has(n,t)){const e=Reflect.get(n,t);return t=>n=>e.apply(n,t)}}}function N(e,t){if(Reflect.has(e,t)){const n=Reflect.get(e,t);return e=>t=>n.apply(null,[t,...e])}}const E=[y,b,x,v,w,f,h,m,g,C],M=e=>t=>n=>null==n?n:e(t)(n),$=(e,t)=>t(e),I=e=>e=>e;class F{static create(e,t){const n=[];for(let s=0;s<e.length;s++){const i=e[s],r=t.getFilterFunc(i.name)(i.options);n.push(r)}return n}}class L{ambigousNames=new Set;funcByName=new Map;registerFilter(e,t){const n=e.endsWith("*"),s=n?e.slice(0,-1):e;this.funcByName.has(s)&&u.raise(`${this.constructor.name}: ${s} is already registered`);const i=n?t:M(t);this.funcByName.set(s,i)}getFilterFunc(e){return this.ambigousNames.has(e)&&u.raise(`${this.constructor.name}: ${e} is ambigous`),this.funcByName.get(e)??I}static applyFilter(e,t){return t.reduce($,e)}}class T extends L{constructor(){super(),this.ambigousNames=new Set(T.#r),this.funcByName=new Map(T.#o)}static#r=new Set;static#o=new Map;static{const e=new Set,t=new Map;for(const n of E){for(const s of n.prototypeFuncs){const i=s.endsWith("*"),r=i?s.slice(0,-1):s,o=B(n.objectClass,r);if(void 0!==o){const s=i?o:M(o);n.prefix&&t.set(`${n.prefix}.${r}`,s),n.prefixShort&&t.set(`${n.prefixShort}.${r}`,s),t.has(r)?e.add(r):t.set(r,s)}}for(const s of n.staticFuncs){const i=s.endsWith("*"),r=i?s.slice(0,-1):s,o=N(n.objectClass,r);if(void 0!==o){const s=i?o:M(o);n.prefix&&t.set(`${n.prefix}.${r}`,s),n.prefixShort&&t.set(`${n.prefixShort}.${r}`,s),t.has(r)?e.add(r):t.set(r,s)}}}for(const e of S){const n=e.endsWith("*"),s=n?e.slice(0,-1):e,i=Reflect.get(P,e);void 0===i&&u.raise(`${this.name}: ${e} is not found in defaultFilterGroup`);const r=n?i:M(i);t.set(s,r)}for(const n of e)t.delete(n);this.#r=e,this.#o=t}static registerFilter(e,t){const n=e.endsWith("*"),s=n?e.slice(0,-1):e;this.#o.has(s)&&u.raise(`${this.name}: ${s} is already registered`);const i=n?t:M(t);this.#o.set(s,i)}}class A{static date=e=>e=>""===e?null:new Date(new Date(e).setHours(0));static number=e=>e=>""===e?null:Number(e);static boolean=e=>e=>"false"!==e&&""!==e}class R extends L{constructor(){super(),this.ambigousNames=new Set(R.#r),this.funcByName=new Map(R.#o)}static#r=new Set;static#o=new Map;static{this.#o.set("date",A.date),this.#o.set("number",A.number),this.#o.set("boolean",A.boolean)}static registerFilter(e,t){this.#o.has(e)&&u.raise(`${this.name}: ${e} is already registered`),this.#o.set(e,t)}}class k{static preventDefault=e=>e=>(e.preventDefault(),e);static noStopPropagation=e=>e=>(Reflect.set(e,"noStopPropagation",!0),e);static pd=this.preventDefault;static nsp=this.noStopPropagation}class V extends L{constructor(){super(),this.ambigousNames=new Set(V.#r),this.funcByName=new Map(V.#o)}static#r=new Set;static#o=new Map;static{this.#o.set("preventDefault",k.preventDefault),this.#o.set("noStopPropagation",k.noStopPropagation),this.#o.set("pd",k.preventDefault),this.#o.set("nsp",k.noStopPropagation)}static registerFilter(e,t){this.#o.has(e)&&u.raise(`${this.name}: ${e} is already registered`),this.#o.set(e,t)}}const O="data-bind",j="data-uuid",D={};function H(e){const t=Array.from(e.childNodes);for(let e=0;e<t.length;e++){const n=t[e];n.nodeType===Node.TEXT_NODE&&(n.textContent?.match(/^\s*$/)&&n.parentNode?.removeChild(n))}}function W(e){return D[e]}function U(e,t,n){const s=document.createElement("template");return s.innerHTML=function(e,t,n){const s=[],i=e.replaceAll(/\{\{([^\}]+)\}\}/g,((e,t)=>{if((t=t.trim()).startsWith("loop:")||t.startsWith("if:"))return s.push(t),`<template data-bind="${t}">`;if(t.startsWith("else:")){const e=s[s.length-1];return void 0!==e&&e.startsWith("if:")||u.raise(`Template: endif: is not matched with if:, but {{ ${t} }} `),`</template><template data-bind="${e}|not">`}if(t.startsWith("end:"))return void 0===s.pop()&&u.raise(`Template: end: is not matched with loop: or if:, but {{ ${t} }} `),"</template>";if(t.startsWith("endif:")){const e=s.pop();return void 0!==e&&e.startsWith("if:")||u.raise(`Template: endif: is not matched with if:, but {{ ${e} }} `),"</template>"}if(t.startsWith("endloop:")){const e=s.pop();return void 0!==e&&e.startsWith("loop:")||u.raise(`Template: endloop: is not matched with loop:, but {{ ${e} }} `),"</template>"}return`\x3c!--@@:${t}--\x3e`}));s.length>0&&u.raise(`Template: loop: or if: is not matched with endloop: or endif:, but {{ ${s[s.length-1]} }} `);const r=document.createElement("template");r.innerHTML=i;const o=n.map((e=>u.toKebabCase(e))),a=e=>{for(const n of o){const s=Array.from(e.querySelectorAll(n));for(const e of s){const s=document.createElement(`${n}-${t}`);for(let t=0;t<e.attributes.length;t++){const n=e.attributes[t];s.setAttribute(n.name,n.value)}s.setAttribute("data-orig-tag-name",n),e.parentNode?.replaceChild(s,e)}const i=Array.from(e.querySelectorAll(`[is="${n}"]`));for(const e of i){const s=document.createElement(e.tagName,{is:`${n}-${t}`});for(let t=0;t<e.attributes.length;t++){const n=e.attributes[t];"is"!==n.name&&s.setAttribute(n.name,n.value)}s.setAttribute("data-orig-is",n),e.parentNode?.replaceChild(s,e)}}const n=Array.from(e.querySelectorAll("template"));for(const e of n)a(e.content)};o.length>0&&a(r.content);const l=e=>{let t;for(;t=e.querySelector("template");){const e=u.createUUID(),n=document.createComment(`@@|${e}`);if(t.parentNode?.replaceChild(n,t),t.constructor!==HTMLTemplateElement){const e=document.createElement("template");for(let n of Array.from(t.childNodes))e.content.appendChild(n);const n=t.getAttribute(O);n&&e.setAttribute(O,n),t=e}t.setAttribute(j,e),l(t.content),H(t.content),D[e]=t}};return l(r.content),r.innerHTML}(e,t,n),s.setAttribute(j,t),H(s.content),D[t]=s,s}const K=new Map;function _(e,t){const n=K.get(t);if(n)return n;const s=function(e){const t=new CSSStyleSheet;return t.replaceSync(e),t}(e);return K.set(t,s),s}class q{#a=u.createUUID();get uuid(){return this.#a}html="";css;get template(){const t=this.config.useLocalTagName??e.useLocalTagName?Object.keys(this.componentModules??{}):[];return U(this.html,this.uuid,t)}get styleSheet(){return this.css?_(this.css,this.uuid):void 0}State=class{};config={};moduleConfig={};options={};filters={};componentModules;get componentModulesForRegister(){if((this.config.useLocalTagName??e.useLocalTagName)&&void 0!==this.componentModules){const e={};for(const[t,n]of Object.entries(this.componentModules))e[`${u.toKebabCase(t)}-${this.uuid}`]=n;return e}return this.componentModules}}const z="state",G=Symbol.for(`${z}.accessorProperties`),Q=Symbol.for(`${z}.dependencies`),J=Symbol.for(`${z}.connectedEvent`),Y=Symbol.for(`${z}.disconnectedEvent`),Z=Symbol.for(`${z}.updatedEvent`),X=Symbol.for(`${z}.connectedCallback`),ee=Symbol.for(`${z}.disconnectedCallback`),te=Symbol.for(`${z}.updatedCallback`),ne=Symbol.for(`${z}.directlyCallApi`),se=Symbol.for(`${z}.notifyForDependentPropsApi`),ie=Symbol.for(`${z}.getDependentPropsApi`),re=Symbol.for(`${z}.clearCacheApi`),oe=Symbol.for(`${z}.createBufferApi`),ae=Symbol.for(`${z}.flushBufferApi`),le=new Set(["articles","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]),de=e=>-1!==e.indexOf("-");const ce=new Map;function ue(e,t){Array.from(e.cssRules).map((e=>{if("CSSImportRule"===e.constructor.name){const n=e;n.styleSheet?ue(n.styleSheet,t):console.log(`import rule not found: ${n.href}`)}else t.insertRule(e.cssText,t.cssRules.length)}))}function pe(e){const t=new CSSStyleSheet,n=Array.from(document.styleSheets).filter((t=>t.title===e));if(0!==n.length)return n.forEach((e=>ue(e,t))),ce.set(e,t),t;console.log(`style sheet not found: ${e}`)}const he=e=>ce.get(e)??pe(e),fe=e=>void 0!==e;const me=async e=>Reflect.apply(e.target,e.thisArgument,e.argumentList);async function ge(e,t){for(let e=0;e<t.length;e++)await me(t[e]);return e.retrieveAllUpdatedStateProperties()}function ye(e,t,n){const s=n.map((e=>({name:e.pattern,indexes:e.indexes})));e.addProcess((async()=>{await t.current[te](s)}),void 0,[])}async function be(e,t){const n=[];return await t.writable((async()=>{for(;;){const s=e.retrieveAllProcesses();if(0===s.length)break;const i=await ge(e,s);i.length>0&&(n.push(...i),ye(e,t,i))}})),n}const xe=new Map;function ve(e){let t;return xe.get(e)??(t=function(e){const t=e.split("."),n=[],s=[];for(let e=0;e<t.length;e++){let i="";for(let n=0;n<=e;n++)i+=t[n]+(n<e?".":"");"*"===t[e]&&s.push(i),n.push(i)}return{patternElements:t,patternPaths:n,wildcardPaths:s}}(e),xe.set(e,t),t)}const Ce=new Map;function we(e){let t;return Ce.get(e)??(t=function(e){const t=e.split("."),n=t.slice(0),s=[],i=[];let r=-1,o=0,a=0,l="";for(let e=0;e<t.length;e++){const d=t[e];if("*"===d)s.push(void 0),n[e]="*",r=s.length-1,o++;else{const t=Number(d);Number.isNaN(t)||(s.push(t),n[e]="*",a++)}l+=d,i.push(l),l+=e<t.length-1?".":""}const d=n.join("."),c=s.length;return Object.assign({name:e,pattern:d,elements:t,patternElements:n,paths:i,wildcardCount:c,wildcardIndexes:s,lastIncompleteWildcardIndex:r,allComplete:a===c,allIncomplete:o===c},ve(d))}(e),Ce.set(e,t),t)}class Pe{#l;#d;#c;#u;get pattern(){return this.#l}get indexes(){return this.#d}get propInfo(){return void 0===this.#c&&(this.#c=we(this.pattern)),this.#c}get key(){return void 0===this.#u&&(this.#u=this.pattern+"\t"+this.indexes.toString()),this.#u}constructor(e,t){this.#l=e,this.#d=t.slice()}}function Se(e,t){return new Pe(e,t)}const Be="do-notation",Ne=Symbol.for(`${Be}.getDirect`),Ee=Symbol.for(`${Be}.setDirect`);function Me(e,t,n,s=new Set([])){const{propInfo:i,indexes:r}=t,o=i.pattern+"\t"+r.toString();if(s.has(o))return[];s.add(o);const a=e[ie]().propsByRefProp[i.pattern];if(void 0===a)return[];const l=[],d=[],c=[];for(let e=0;e<r.length;e++)c.push(r[e]),d.push(c.toString());for(const t of a){const i=ve(t),o=i.wildcardPaths.some(((e,t)=>{const s=ve(e),i=s.patternPaths[s.patternPaths.length-2]+"\t"+(d[t-1]??"");return n.has(i)}));if(!o){if(r.length<i.wildcardPaths.length){const n=$e(e,Se(t,r));l.push(...n.map((e=>Se(t,e))))}else{const e=r.slice(0,i.wildcardPaths.length);l.push(Se(t,e))}l.push(...Me(e,Se(t,r),n,s))}}return l}function $e(e,t){const{propInfo:n,indexes:s}=t;if(n.wildcardCount===s.length)return[s];if(n.wildcardCount<s.length)return[s.slice(0,n.wildcardCount)];{const t=(t,n)=>e[Ne](t,n).length,i=(e,r,o)=>{const a=""!==e?e+".":e,l=n.elements[r];if(n.elements.length-1===r){if("*"===l){const n=[],s=t(e,o);for(let e=0;e<s;e++)n.push(o.concat(e));return n}return[o]}{const n=a+l;if("*"===l){if(o.length<s.length)return i(n,r+1,s.slice(0,o.length+1));{const s=[],a=t(e,o);for(let e=0;e<a;e++)s.push(...i(n,r+1,o.concat(e)));return s}}return i(n,r+1,o)}};return i("",0,[])}}function Ie(e,t){const n=t.slice(0),s=new Set(t.map((e=>e.propInfo.pattern+"\t"+e.indexes.toString())));for(let i=0;i<t.length;i++)n.push.apply(n,Me(e.current,t[i],s));return n}const Fe=(e,t)=>e.stateProperty.propInfo.wildcardCount-t.stateProperty.propInfo.wildcardCount;function Le(e,t,n,s){const i=Array.from(t.expandableBindings).toSorted(Fe);t.update((t=>{for(let r=0;r<i.length;r++){const o=i[r];if(!t.exists(o))continue;if(!n.has(o.stateProperty.key))continue;const a=o.stateProperty.key+".",l=s.some((e=>e.startsWith(a)));e.setFullRebuild(l,(()=>{o.rebuild()}))}}))}function Te(e,t,n,s){t?.applyNodeUpdatesByBinding(e,(()=>{n.applyToChildNodes(s)}))}function Ae(e,t,n){const s={};for(const e of n){const t=e.propInfo.patternElements;if("*"!==t[t.length-1])continue;const n=e.indexes,i=n?.[n.length-1];if(void 0===i)continue;const r=e.propInfo.patternPaths,o=r[r.length-2]+"\t"+n.slice(0,-1);s[o]?.add(i)??(s[o]=new Set([i]))}for(const[n,i]of Object.entries(s)){const s=t.bindingsByKey.get(n);if(void 0!==s)for(const t of s)Te(t,e,t.nodeProperty,i)}}function Re(e,t=new Map){const n=[];for(let s of t.keys()){const t=e.bindingsByKey.get(s);void 0!==t&&n.push.apply(n,t)}const s=Array.from(new Set(n)),i=[];for(let e=0;e<s.length;e++){const t=s[e];t.nodeProperty.isSelectValue?i.push(t):t.updateNodeForNoRecursive()}for(let e=0;e<i.length;e++)i[e].updateNodeForNoRecursive()}class ke{#p;processQueue=[];updatedStateProperties=[];expandedStateProperties=[];updatedBindings=new Set;bindingsForUpdateNode=[];executing=!1;get states(){return this.#p.states}get bindingSummary(){return this.#p.bindingSummary}get component(){return this.#p}constructor(e){this.#p=e}addProcess(e,t,n){this.processQueue.push({target:e,thisArgument:t,argumentList:n}),this.executing||this.exec()}retrieveAllProcesses(){const e=this.processQueue;return this.processQueue=[],e}addUpdatedStateProperty(e){this.updatedStateProperties.push(e)}retrieveAllUpdatedStateProperties(){const e=this.updatedStateProperties;return this.updatedStateProperties=[],e}async execCallbackWithPerformance(t){this.executing=!0,e.debug&&performance.mark("Updator.exec:start");try{await t()}finally{e.debug&&(performance.mark("Updator.exec:end"),performance.measure("Updator.exec","Updator.exec:start","Updator.exec:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures("Updator.exec"),performance.clearMarks("Updator.exec:start"),performance.clearMarks("Updator.exec:end")),this.executing=!1}}async exec(){await this.execCallbackWithPerformance((async()=>{for(;this.processQueue.length>0;){this.updatedBindings.clear();const e=await be(this,this.states),t=e.map((e=>e.key)),n=Ie(this.states,e),s=new Map(n.map((e=>[e.key,e])));Le(this,this.bindingSummary,s,t),Ae(this,this.bindingSummary,n),Re(this.bindingSummary,s)}}))}applyNodeUpdatesByBinding(e,t){if(!this.updatedBindings.has(e))try{t(this)}finally{this.updatedBindings.add(e)}}#h;get isFullRebuild(){return void 0===this.#h&&u.raise("fullRebuild is not set"),this.#h}setFullRebuild(e,t){this.#h=e;try{t()}finally{this.#h=void 0}}}const Ve=Symbol.for("component.isComponent"),Oe="props",je=Symbol.for(`${Oe}.bindProperty`),De=Symbol.for(`${Oe}.setBuffer`),He=Symbol.for(`${Oe}.getBuffer`),We=Symbol.for(`${Oe}.clearBuffer`),Ue=Symbol.for(`${Oe}.createBuffer`),Ke=Symbol.for(`${Oe}.flushBuffer`),_e=Symbol.for(`${Oe}.clear`),qe=new RegExp(/^\$([0-9]+)$/);function ze(e){return e.parentComponent?.popoverContextIndexesById?.get(e.id)}const Ge=(e,t)=>{let n;const s=ve(t.name);return s.wildcardPaths.length>0&&0===t.indexes.length&&e.component.hasAttribute("popover")&&(n=ze(e.component)?.slice(0,s.wildcardPaths.length)),n??t.indexes};let Qe=class{constructor(e){this.#p=e}#p;get component(){return this.#p}#f;get buffer(){return this.#f}#m=[];get binds(){return this.#m}#g={};#y(e,t){this.#g[e]=Object.getOwnPropertyDescriptor(this.#p.states.base,e)??{value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(this.#p.states.base,e,{get:((e,t,n)=>function(){if(void 0!==e.buffer)return e.buffer[t];{void 0===n&&u.raise("PropertyAccess is required");const t=qe.exec(n.name);if(t){const s=Number(t[1])-1;let i=n.loopContext?.indexes??[];return 0===i.length&&e.component.hasAttribute("popover")&&(i=ze(e.component)??[]),i[s]}{const t=Ge(e,n);return e.component.parentComponent?.states.current[Ne](n.name,t)??u.raise(`Property ${n.name} is not found`)}}})(this,e,t),set:((e,t,n)=>function(s){if(void 0!==e.buffer)e.buffer[t]=s;else{void 0===n&&u.raise("PropertyAccess is required");const t=Ge(e,n);e.component.parentComponent?.states.writable((async()=>{e.component.parentComponent?.states.current[Ee](n.name,t,s)??u.raise(`Property ${n.name} is not found`)}))}return!0})(this,e,t),configurable:!0,enumerable:!0}),void 0!==t&&this.#m.push({prop:e,propAccess:t})}#b(e){this.#f=e;for(const t in e)this.#y(t),this.#p.states.current[se](t,[])}#x(){return this.#f}#v(){this.#f=void 0}#C(){let e;return e=this.#p.parentComponent?.states.current[oe](this.#p)??u.raise("CreateBufferApiSymbol is not found"),void 0!==e||(e={},this.#m.forEach((({prop:t,propAccess:n})=>{const s=Ge(this,n);e[t]=this.#p.parentComponent?.states.current[Ne](n.name,s)??u.raise(`Property ${n.name} is not found`)}))),e}#w(){if(void 0!==this.#f){const e=this.#f;this.#p.parentComponent?.states.writable((async()=>{!0!==(this.#p.parentComponent?.states.current[ae](e,this.#p)??u.raise("FlushBufferApiSymbol is not found"))&&this.#m.forEach((({prop:t,propAccess:n})=>{const s=Ge(this,n);this.#p.parentComponent?.states.current[Ee](n.name,s,e[t])??u.raise(`Property ${n.name} is not found`)}))}))}}#P(){this.#f=void 0,this.#m=[];for(const[e,t]of Object.entries(this.#g))Object.defineProperty(this.#p.states.base,e,t);this.#g={}}get(e,t,n){return t===je?(e,t)=>this.#y(e,t):t===De?e=>this.#b(e):t===He?()=>this.#x():t===We?()=>this.#v():t===Ue?()=>this.#C():t===Ke?()=>this.#w():t===_e?()=>this.#P():this.#p.states.current[t]}set(e,t,n,s){return this.#p.states.writable((async()=>{this.#p.states.current[t]=n})),!0}ownKeys(e){return void 0!==this.buffer?Reflect.ownKeys(this.buffer):this.#m.map((({prop:e})=>e))}getOwnPropertyDescriptor(e,t){return{enumerable:!0,configurable:!0}}};const Je=Symbol.for("globalData.boundByComponent"),Ye=e=>function(t,n,s,i,r,o,a){let l,d,c,p=n[r];return(l=Reflect.get(t,p,a))??(p in t||0===r?l:(d=s[r],c="*"===d,e.getValue(t,n,s,i,r-1,o-(c?1:0),a)[c?i[o]??u.raise("wildcard is undefined"):d]))};class Ze{#S;#d;wildcardCount;pattern;get indexes(){return void 0===this.#d&&(this.#d=this.#S.slice(0,this.wildcardCount)),this.#d}constructor(e,t,n){this.pattern=e,this.wildcardCount=t,this.#S=n,this.#d=t===n.length?n:void 0}}function Xe(e,t,n){return new Ze(e,t,n)}const et=e=>function(t,n,s){const{stackNamedWildcardIndexes:i,stackIndexes:r}=e;i.push(function(e,t){const n={};for(let s=0;s<e.wildcardPaths.length;s++){const i=e.wildcardPaths[s];n[i]=Xe(i,s+1,t)}return n}(t,n)),r.push(n);try{return s()}finally{i.pop(),r.pop()}},tt=e=>function(t,n,s,i,r){const o=et(e);return 1===n.paths.length?Reflect.set(t,n.name,i,r):(o(n,s,(()=>{if(n.name in t)Reflect.set(t,n.name,i,r);else{const o=n.patternElements[n.patternElements.length-1],a=n.elements[n.elements.length-1],l=e.getValue(t,n.patternPaths,n.patternElements,s,n.paths.length-2,n.wildcardCount-("*"===o?1:0)-1,r);"*"===o?l[s[s.length-1]??u.raise("wildcard is undefined")]=i:l[a]=i}})),!0)};let nt=class{stackIndexes=[];stackNamedWildcardIndexes=[];get lastStackIndexes(){return this.stackIndexes[this.stackIndexes.length-1]}getLastIndexes=(e=>function(t){const n=e.stackNamedWildcardIndexes;return n[n.length-1]?.[t]?.indexes})(this);getValue=Ye(this);getValueWithIndexes=(e=>function(t,n,s,i){return et(e)(n,s,(()=>e.getValue(t,n.patternPaths,n.patternElements,s,n.paths.length-1,n.wildcardCount-1,i)))})(this);getValueWithoutIndexes=(e=>function(t,n,s){const i=we(n),r=e.getLastIndexes(i.wildcardPaths[i.wildcardPaths.length-1]??"")??[],o=i.allComplete?i.wildcardIndexes:i.allIncomplete?r:i.wildcardIndexes.map(((e,t)=>e??r[t]));return e.getValueWithIndexes(t,i,o,s)})(this);setValueWithIndexes=tt(this);setValueWithoutIndexes=(e=>function(t,n,s,i){const r=we(n),o=e.getLastIndexes(r.wildcardPaths[r.wildcardPaths.length-1]??"")??[],a=r.allComplete?r.wildcardIndexes:r.allIncomplete?o:r.wildcardIndexes.map(((e,t)=>e??o[t]));return e.setValueWithIndexes(t,r,a,s,i)})(this);getExpandValues=(e=>function(t,n,s){const i=et(e),r=we(n);let o,a;for(let t=r.wildcardPaths.length-1;t>=0;t--){const n=r.wildcardPaths[t];if(o=e.getLastIndexes(n),void 0!==o)break}o=o??[];const l=r.wildcardIndexes.map(((e,t)=>void 0===e?(a=t,o[t]):e)),d=a??l.length-1,c=we(r.wildcardPaths[d]??u.raise("wildcard path is undefined")),p=we(c.paths[c.paths.length-2]??u.raise("wildcard parent path is undefined"));return i(r,l,(()=>{const n=e.getValue(t,p.patternPaths,p.patternElements,l,p.paths.length-1,p.wildcardCount-1,s);Array.isArray(n)||u.raise("parent value is not array");const o=[];for(let a=0;a<n.length;a++)l[d]=a,o.push(i(r,l,(()=>e.getValueWithoutIndexes(t,r.pattern,s))));return o}))})(this);setExpandValues=(e=>function(t,n,s,i){const r=et(e),o=we(n);let a,l;for(let t=o.wildcardPaths.length-1;t>=0;t--){const n=o.wildcardPaths[t];if(a=e.getLastIndexes(n),void 0!==a)break}a=a??[];const d=o.wildcardIndexes.map(((e,t)=>void 0===e?(l=t,a[t]):e)),c=l??d.length-1,p=we(o.wildcardPaths[c]??u.raise("wildcard path is undefined")),h=we(p.paths[p.paths.length-2]??u.raise("wildcard parent path is undefined"));r(o,d,(()=>{const n=e.getValue(t,h.patternPaths,h.patternElements,d,h.paths.length-1,h.wildcardCount-1,i);Array.isArray(n)||u.raise("parent value is not array");for(let a=0;a<n.length;a++)d[c]=a,r(o,d,Array.isArray(s)?()=>e.setValueWithoutIndexes(t,o.pattern,s[a],i):()=>e.setValueWithoutIndexes(t,o.pattern,s,i))}))})(this);getValueDirect=(e=>function(t,n,s,i){const r=et(e);"string"!=typeof n&&u.raise("prop is not string");const o="$"===n[0],a="@"===n[0],l=we(a?n.slice(1):n);return r(l,s,(()=>o||a?e.get(t,n,i):l.allIncomplete?e.getValue(t,l.patternPaths,l.patternElements,s,l.paths.length-1,l.wildcardCount-1,i):e.getValueWithoutIndexes(t,n,i)))})(this);setValueDirect=(e=>function(t,n,s,i,r){"string"!=typeof n&&u.raise("prop is not string");const o=et(e),a="$"===n[0],l="@"===n[0],d=we(l?n.slice(1):n);return a||l?o(d,s,(()=>e.set(t,n,i,r))):e.setValueWithIndexes(t,d,s,i,r)})(this);get(e,t,n){const s="string"==typeof t;do{if(s&&(t.startsWith("@@__")||"constructor"===t))break;if(t===Ne)return(t,s)=>this.getValueDirect.apply(this,[e,t,s,n]);if(t===Ee)return(t,s,i)=>this.setValueDirect.apply(this,[e,t,s,i,n]);if(!s)break;if("$"===t[0]){const e=Number(t.slice(1));if(isNaN(e))break;return(this.lastStackIndexes??[])[e-1]}if("@"===t[0]){const s=t.slice(1);return this.getExpandValues(e,s,n)}return this.getValueWithoutIndexes(e,t,n)}while(0);return Reflect.get(e,t,n)}set(e,t,n,s){const i="string"==typeof t;do{if(i&&t.startsWith("@@__"))break;if(!i)break;if("$"===t[0]){const e=Number(t.slice(1));if(isNaN(e))break;u.raise(`context index(${t}) is read only`)}else if("@"===t[0]){const i=t.slice(1);return this.setExpandValues(e,i,n,s),!0}return this.setValueWithoutIndexes(e,t,n,s)}while(0);return Reflect.set(e,t,n,s)}};class st extends nt{#B=new Map;get(e,t,n){return t===Je?(e,t)=>{let n=this.#B.get(t);void 0===n?this.#B.set(t,new Set([e])):n.add(e)}:super.get(e,t,n)}set(e,t,n,s){if("string"!=typeof t)return Reflect.set(e,t,n,s);const{pattern:i,wildcardIndexes:r}=we(t),o=s[Ee](i,r,n);let a=this.#B.get(i);if(a)for(const e of a)e.states.current[se]("$globals."+i,r);return o}}class it{static create(e={}){return new Proxy(e,new st)}static#N=this.create();static get data(){return this.#N}static set data(e){this.#N=this.create(e)}}class rt extends nt{#p;setOfProps=new Set;constructor(e){super(),this.#p=e}bindProperty(e){it.data[Je](this.#p,e),this.setOfProps.add(e)}directGet=(e,t)=>(this.setOfProps.has(e)||this.bindProperty(e),it.data[Ne](e,t));directSet=(e,t,n)=>(this.setOfProps.has(e)||this.bindProperty(e),it.data[Ee](e,t,n));get(e,t,n){if(t===Ne)return this.directGet;if(t===Ee)return this.directSet;if("string"!=typeof t)return Reflect.get(e,t,n);const{pattern:s,wildcardIndexes:i}=we(t);return this.directGet(s,i)}set(e,t,n,s){if("string"!=typeof t)return Reflect.set(e,t,n,s);const{pattern:i,wildcardIndexes:r}=we(t);return this.directSet(i,r,n)}}const ot=e=>e,at={Text:e=>{const t=document.createTextNode("");return e.parentNode?.replaceChild(t,e),t},HTMLElement:ot,SVGElement:ot,Template:ot};const lt=e=>{const t=e;return t.removeAttribute("data-bind"),t},dt=e=>e,ct={HTMLElement:lt,SVGElement:lt,Text:dt,Template:dt};const ut=new Set(["button","image","hidden","reset","submit","unknown"]),pt=e=>!1,ht={HTMLElement:e=>e instanceof HTMLElement&&(e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&!ut.has(e.type)),SVGElement:pt,Text:pt,Template:pt};const ft=e=>e.trim(),mt=e=>e.length>0,gt=new RegExp(/^#(.*)#$/),yt=e=>{const t=gt.exec(e);return t?decodeURIComponent(t[1]):e},bt=e=>{const[t,...n]=e.split(",").map(ft);return{name:t,options:n.map(yt)}},xt=e=>{const[t,...n]=e.split("|").map(ft);return{property:t,filters:n.map(bt)}},vt=(e,t)=>e.split(";").map(ft).filter(mt).map((e=>{let{nodeProperty:n,stateProperty:s,inputFilters:i,outputFilters:r}=((e,t)=>{const[n,s]=[t].concat(...e.split(":").map(ft)).splice(-2),{property:i,filters:r}=xt(n),{property:o,filters:a}=xt(s);return{nodeProperty:i,stateProperty:o,inputFilters:r,outputFilters:a}})(e,"$");return s="@"===s?n:s,n="$"===n?t:n,{nodeProperty:n,stateProperty:s,inputFilters:i,outputFilters:r}})),Ct={};const wt="textContent",Pt={radio:"checked",checkbox:"checked",button:"onclick"},St={},Bt=e=>{},Nt={HTMLElement:e=>e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLOptionElement?"value":e instanceof HTMLButtonElement||e instanceof HTMLAnchorElement?"onclick":e instanceof HTMLFormElement?"onsubmit":e instanceof HTMLInputElement?Pt[e.type]??"value":wt,SVGElement:Bt,Text:e=>wt,Template:Bt};class Et{#E;get node(){return this.#E}#M;get name(){return this.#M}#$;get nameElements(){return this.#$}get value(){return Reflect.get(this.node,this.name)}set value(e){Reflect.set(this.node,this.name,e)}#I;get filters(){return this.#I}get filteredValue(){return 0===this.filters.length?this.value:L.applyFilter(this.value,this.filters)}get applicable(){return!0}#F;get binding(){return this.#F}get expandable(){return!1}get isSelectValue(){return!1}get revisionForLoop(){return u.raise("not loopable")}get loopable(){return!1}constructor(e,t,n,s){t instanceof Node||u.raise("NodeProperty: not Node"),this.#F=e,this.#E=t,this.#M=n,this.#$=n.split("."),this.#I=F.create(s,this.binding.inputFilterManager)}initialize(){}postUpdate(e){}equals(e){return this.value===e}applyToChildNodes(e){}dispose(){}revisionUpForLoop(){return 0}}class Mt extends Et{#L;get template(){return void 0===this.#L&&(this.#L=W(this.uuid)??u.raise(`TemplateProperty: invalid uuid ${this.uuid}`)),this.#L}#a;get uuid(){var e;return void 0===this.#a&&(this.#a=(e=this.node,e.textContent?.slice(3)??u.raise("TemplateProperty: invalid node"))),this.#a}get expandable(){return!0}constructor(e,t,n,s){t instanceof Comment||u.raise("TemplateProperty: not Comment"),super(e,t,n,s)}}class $t extends Mt{#T=0;get revisionForLoop(){return this.#T}get loopable(){return!0}dispose(){super.dispose(),this.#T++}revisionUpForLoop(){return++this.#T}}const It=e=>e.rebuild();class Ft extends $t{get value(){return this.binding.childrenContentBindings}set value(e){Array.isArray(e)||u.raise(`Repeat: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not array`);const t=this.value.length;if(this.revisionUpForLoop(),t<e.length){this.binding.childrenContentBindings.forEach(It);for(let n=t;n<e.length;n++){const e=Nn(this.template,this.binding);this.binding.appendChildContentBindings(e),e.rebuild()}}else if(t>e.length){const t=this.binding.childrenContentBindings.splice(e.length);this.binding.childrenContentBindings.forEach(It),t.forEach((e=>e.dispose()))}else this.binding.childrenContentBindings.forEach(It)}constructor(e,t,n,s){"loop"!==n&&u.raise(`Repeat: invalid property name '${n}'`),super(e,t,n,s)}equals(e){return!1}}class Lt extends Et{get element(){return this.node}constructor(e,t,n,s){t instanceof Element||u.raise("ElementBase: not element"),super(e,t,n,s)}}class Tt{value;enabled=!1;constructor(e,t){this.value=e,this.enabled=t}}class At extends Lt{get inputElement(){return this.node}_value=new Tt(void 0,!1);get value(){return this._value.value=this.inputElement.value,this._value.enabled=this.inputElement.checked,this._value}set value(e){Array.isArray(e)||u.raise(`Checkbox: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not array`);const t=this.filteredValue;this.inputElement.checked=e.some((e=>e===t.value))}_filteredValue=new Tt(void 0,!1);get filteredValue(){const e=this.value;return this._filteredValue.value=this.filters.length>0?L.applyFilter(e.value,this.filters):e.value,this._filteredValue.enabled=e.enabled,this._filteredValue}constructor(e,t,n,s){t instanceof HTMLInputElement||u.raise("Checkbox: not htmlInputElement"),"checkbox"!==t.type&&u.raise("Checkbox: not checkbox"),super(e,t,n,s)}equals(e){return!1}}class Rt extends Lt{get inputElement(){return this.element}_value=new Tt(void 0,!1);get value(){return this._value.value=this.inputElement.value,this._value.enabled=this.inputElement.checked,this._value}set value(e){const t=this.filteredValue;this.inputElement.checked=e===t.value}_filteredValue=new Tt(void 0,!1);get filteredValue(){const e=this.value;return this._filteredValue.value=this.filters.length>0?L.applyFilter(e.value,this.filters):e.value,this._filteredValue.enabled=e.enabled,this._filteredValue}constructor(e,t,n,s){t instanceof HTMLInputElement||u.raise("Radio: not htmlInputElement");const i=t;"radio"!==i.type&&"checkbox"!==i.type&&u.raise("Radio: not radio or checkbox"),super(e,t,n,s)}equals(e){return!1}}class kt extends Lt{get eventType(){return this.name.slice(2)}get applicable(){return!1}#A;get handler(){return void 0===this.#A&&(this.#A=e=>this.eventHandler(e)),this.#A}#R;get eventFilters(){return this.#R}constructor(e,t,n,s){n.startsWith("on")||u.raise(`ElementEvent: invalid property name ${n}`),super(e,t,n,s),this.#R=F.create(s,e.eventFilterManager)}initialize(){this.element.addEventListener(this.eventType,this.handler)}async directlyCall(e){if(this.binding.bindingSummary?.exists(this.binding))return this.binding.stateProperty.state[ne](this.binding.stateProperty.name,this.binding.parentContentBindings.currentLoopContext,e)}eventHandler(e){this.binding.bindingSummary?.exists(this.binding)&&(e=this.eventFilters.length>0?L.applyFilter(e,this.eventFilters):e,!1===(Reflect.get(e,"noStopPropagation")??!1)&&e.stopPropagation(),this.binding.updator?.addProcess(this.directlyCall,this,[e]))}}class Vt extends Lt{#k;get isSelectValue(){return void 0===this.#k&&(this.#k=this.node.constructor===HTMLSelectElement&&"value"===this.name),this.#k}}class Ot{#V;get name(){return this.#V.name}get indexes(){return this.#V.indexes}get loopContext(){return this.#V.binding.parentContentBindings.currentLoopContext}constructor(e){this.#V=e}}class jt extends Lt{get propertyName(){return this.nameElements[1]}get applicable(){return!0}get thisComponent(){return this.node}constructor(e,t,n,s){!0!==Reflect.get(t,Ve)&&u.raise("ComponentProperty: not Quel Component"),super(e,t,n,s)}get value(){return super.value}set value(e){try{this.thisComponent.states.current[se](this.propertyName,[])}catch(e){console.log(e)}}initialize(){this.thisComponent.props[je](this.propertyName,new Ot(this.binding.stateProperty))}postUpdate(e){const t=this.binding.stateProperty.name;for(const[n,s]of e.entries())if(s.pattern===t||s.propInfo.patternPaths.includes(t)){const e=s.pattern.slice(t.length);this.thisComponent.states.current[te]([Se(`${this.propertyName}${e}`,s.indexes)]),this.thisComponent.states.current[se](`${this.propertyName}${e}`,s.indexes)}}equals(e){return!1}}const Dt=new Set(["boolean","number","string"]);class Ht extends $t{#O=new Map;#j=new Set;#D=new Set;#H=new Map;#W=[];get value(){return this.#W}set value(e){Array.isArray(e)||u.raise(`RepeatKeyed: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not array`),this.revisionUpForLoop(),this.#O.clear(),this.#j.clear(),this.#D.clear(),this.#H.clear();const t=this.binding.childrenContentBindings,n=e.length;let s=!0;for(let e=0;e<n;e++){const n=this.binding.stateProperty.getChildValue(e),i=this.#W.indexOf(n,this.#O.get(n)??0);-1===i?this.#D.add(e):(this.#O.set(n,i+1),this.#j.add(i),this.#H.set(e,t[i]),s=!1)}for(let e=0;e<t.length;e++)this.#j.has(e)||t[e].dispose();if(s){const e=this.node.nextSibling,s=this.node.parentNode??u.raise("parentNode is null"),i=this.binding,r=this.template;for(let o=0;o<n;o++){const n=Nn(r,i);t[o]=n,n.rebuild(),s.insertBefore(n.fragment,e)}}else{let e;const s=this.node.parentNode??u.raise("parentNode is null");for(let i=0;i<n;i++){const n=i;let r;const o=e?.lastChildNode??this.node;this.#D.has(n)?(r=Nn(this.template,this.binding),t[n]=r,r.rebuild(),s.insertBefore(r.fragment,o.nextSibling)):(r=this.#H.get(n)??u.raise("contentBindings is undefined"),r.childNodes[0]?.previousSibling!==o?(r.removeChildNodes(),t[n]=r,this.binding.updator?.isFullRebuild&&r.rebuild(),s.insertBefore(r.fragment,o.nextSibling)):(t[n]=r,this.binding.updator?.isFullRebuild&&r.rebuild())),e=r}}n<t.length&&(t.length=n),this.#W=e.slice()}applyToChildNodes(e){this.revisionUpForLoop();const t=new Map;for(const n of e){const e=this.binding.childrenContentBindings[n];if(void 0===e)continue;const s=this.#W[n],i=typeof s;"undefined"!==i&&(Dt.has(i)||(e.removeChildNodes(),t.set(s,e)))}const n=[];for(const s of Array.from(e).sort()){const e=this.binding.stateProperty.getChildValue(s),i=typeof e;if("undefined"===i)continue;if(Dt.has(i))continue;let r=t.get(e);void 0===r?(r=Nn(this.template,this.binding),this.binding.replaceChildContentBindings(r,s),r.rebuild(),n.push(...r.allChildBindings)):(this.binding.replaceChildContentBindings(r,s),r.rebuild(),n.push(...r.allChildBindings))}this.#W=this.binding.stateProperty.value.slice();const s=this.binding.bindingSummary;void 0!==s&&s.partialUpdate(n)}initialize(){super.initialize(),this.#W=[]}dispose(){super.dispose(),this.#W=[]}}const Wt={0:{class:class extends Lt{get value(){return this.element.className.length>0?this.element.className.split(" "):[]}set value(e){Array.isArray(e)||u.raise(`ElementClassName: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not array`),this.element.className=e.join(" ")}constructor(e,t,n,s){"class"!==n&&u.raise(`ElementClassName: invalid property name ${n}`),super(e,t,n,s)}},checkbox:At,radio:Rt},1:{if:class extends Mt{get value(){return this.binding.childrenContentBindings.length>0}set value(e){if("boolean"!=typeof e&&u.raise(`Branch: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not boolean`),this.value!==e)if(e){const e=Nn(this.template,this.binding);this.binding.appendChildContentBindings(e),e.rebuild()}else this.binding.removeAllChildrenContentBindings();else this.binding.childrenContentBindings.forEach((e=>e.rebuild()))}constructor(e,t,n,s){"if"!==n&&u.raise(`Branch: invalid property name ${n}`),super(e,t,n,s)}equals(e){return!1}}}},Ut=e=>(t,n,s,i)=>Reflect.construct(e,[t,n,s,i]),Kt={class:class extends Lt{get className(){return this.nameElements[1]}get value(){return this.element.classList.contains(this.className)}set value(e){"boolean"!=typeof e&&u.raise(`ElementClass: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not boolean`),e?this.element.classList.add(this.className):this.element.classList.remove(this.className)}constructor(e,t,n,s){n.startsWith("class.")||u.raise(`ElementClass: invalid property name ${n}`),super(e,t,n,s)}},attr:class extends Lt{get attributeName(){return this.nameElements[1]}get value(){return this.element.getAttribute(this.attributeName)}set value(e){this.element.setAttribute(this.attributeName,e)}},style:class extends Lt{get htmlElement(){return this.node}get styleName(){return this.nameElements[1]}get value(){return this.htmlElement.style.getPropertyValue(this.styleName)}set value(e){this.htmlElement.style.setProperty(this.styleName,e)}constructor(e,t,n,s){t instanceof HTMLElement||u.raise("ElementStyle: not htmlElement"),super(e,t,n,s)}},props:jt};const _t={};function qt(e,t,n){const s=e instanceof Comment,i=e instanceof Element,r=s+"\t"+i+"\t"+t+"\t"+n;return _t[r]??(_t[r]=function(e,t,n,s){let i;do{if(i=Wt[e?1:0][n],void 0!==i)break;if(e&&"loop"===n){i=s?Ht:Ft;break}e&&u.raise(`NodePropertyCreateor: unknown node property ${n}`);const r=n.split(".");if(i=Kt[r[0]],void 0!==i)break;i=t?n.startsWith("on")?kt:Vt:Et}while(0);return Ut(i)}(s,i,t,n))}class zt{get state(){return this.#F.state??u.raise("StateProperty: state is undefined")}#M;get name(){return this.#M}#U;get childName(){return this.#U}#c;get propInfo(){return this.#c}#K;get level(){return this.#K}get indexes(){const e=this.binding.parentContentBindings?.currentLoopContext?.indexes??[];return e.length===this.level?e:e.slice(0,this.level)}get indexesString(){return this.indexes.toString()}get key(){return this.name+"\t"+this.indexesString}#_="";get oldKey(){return this.#_}get isChagedKey(){return this.#_!==this.key}getKey(){return this.#_=this.key,this.key}get value(){return this.state[Ne](this.name,this.indexes)}set value(e){const t=e=>{this.state[Ee](this.name,this.indexes,e)};if(e instanceof Tt){const n=this.value;if(Array.isArray(n)){const s=new Set(n);e.enabled?s.add(e.value):s.delete(e.value),t(Array.from(s))}else t(e.enabled?e.value:void 0)}else t(e)}#I;get filters(){return this.#I}get filteredValue(){return 0===this.filters.length?this.value:L.applyFilter(this.value,this.filters)}get applicable(){return!0}#F;get binding(){return this.#F}constructor(e,t,n){this.#F=e,this.#M=t,this.#U=t+".*",this.#I=F.create(n,e.outputFilterManager),this.#c=we(t),this.#K=this.#c.wildcardCount}initialize(){}getChildValue(e){return this.state[Ne](this.#U,this.indexes.concat(e))}setChildValue(e,t){return this.state[Ee](this.#U,this.indexes.concat(e),t)}dispose(){}}const Gt=RegExp(/^\$[0-9]+$/);class Qt extends zt{#q;get index(){return this.#q}get value(){return this.binding.parentContentBindings?.currentLoopContext?.indexes[this.index]??u.raise(`ContextIndex: invalid index ${this.name}`)}get indexes(){return[]}get indexesString(){return""}constructor(e,t,n){Gt.test(t)||u.raise(`ContextIndex: invalid name ${t}`),super(e,t,n),this.#q=Number(t.slice(1))-1}}const Jt=RegExp(/^\$[0-9]+$/),Yt=e=>(t,n,s)=>Reflect.construct(e,[t,n,s]);function Zt(e){const t=Jt.test(e)?Qt:zt;return Yt(t)}function Xt(e,t,n,s){return{nodePropertyConstructor:qt(e,t,s),statePropertyConstructor:Zt(n)}}function en(e,t){t.applicable&&(t.value=e.filteredValue)}function tn(e,t,n,s){n.applicable&&t?.applyNodeUpdatesByBinding(e,(()=>{n.value=s.filteredValue??""}))}let nn=1;class sn{#z;#G;#V;childrenContentBindings=[];#Q;get id(){return this.#z.toString()}get nodeProperty(){return this.#G}get stateProperty(){return this.#V}get statePropertyName(){return this.#V.name}get parentContentBindings(){return this.#Q}get loopable(){return this.#G.loopable}get expandable(){return this.#G.expandable}get component(){return this.#Q.component}get updator(){return this.component?.updator}get bindingSummary(){return this.component?.bindingSummary}get state(){return this.component?.states.current}get selectorName(){return this.component?.selectorName}get eventFilterManager(){return this.component?.eventFilterManager??u.raise("Binding.eventFilterManager: undefined")}get inputFilterManager(){return this.component?.inputFilterManager??u.raise("Binding.inputFilterManager: undefined")}get outputFilterManager(){return this.component?.outputFilterManager??u.raise("Binding.outputFilterManager: undefined")}constructor(e,t,n,s,i,r,o,a){this.#z=++nn,this.#Q=e,this.#G=s(this,t,n,i),this.#V=o(this,r,a)}execDefaultEventHandler(e){if(!this.bindingSummary?.exists(this))return;e.stopPropagation();const{nodeProperty:t,stateProperty:n}=this;this.updator?.addProcess(en,void 0,[t,n])}#J=void 0;get defaultEventHandler(){var e;return void 0===this.#J&&(this.#J=(e=this,t=>e.execDefaultEventHandler(t))),this.#J}initialize(){this.nodeProperty.initialize(),this.stateProperty.initialize()}appendChildContentBindings(e){this.expandable||u.raise("Binding.appendChild: not expandable"),this.childrenContentBindings.push(e);const t=this.childrenContentBindings[this.childrenContentBindings.length-1],n=this.nodeProperty.node.parentNode,s=t?.lastChildNode??this.nodeProperty.node;n?.insertBefore(e.fragment,s.nextSibling??null)}replaceChildContentBindings(e,t){this.expandable||u.raise("Binding.replaceChild: not expandable"),this.childrenContentBindings[t]=e;const n=this.childrenContentBindings[t-1],s=this.nodeProperty.node.parentNode,i=n?.lastChildNode??this.nodeProperty.node;s?.insertBefore(e.fragment,i.nextSibling??null)}removeAllChildrenContentBindings(){const e=this.childrenContentBindings;this.childrenContentBindings=[];for(let t=0;t<e.length;t++)e[t].dispose();return e}dispose(){this.bindingSummary?.delete(this),this.nodeProperty.dispose(),this.stateProperty.dispose(),this.childrenContentBindings.forEach((e=>e.dispose())),this.childrenContentBindings=[]}rebuild(){const{updator:e,nodeProperty:t,stateProperty:n}=this;tn(this,e,t,n)}updateNodeForNoRecursive(){if(!this.expandable){const{updator:e,nodeProperty:t,stateProperty:n}=this;tn(this,e,t,n)}}}const rn=(e,t)=>(n,s)=>function(e,t,n,s,i,r,o,a){const l=new sn(e,t,n,s,i,r,o,a);return l.initialize(),l}(n,s,e.nodeProperty,t.nodePropertyConstructor,e.inputFilters,e.stateProperty,t.statePropertyConstructor,e.outputFilters);const on=()=>{},an={HTMLElement:function(e,t,n,s){const i=e;let r=!1,o=null,a=null,l=null;for(let e=0;e<n.length;e++){const t=n[e];r||="oninput"===t.nodeProperty.name,a=t.nodeProperty.constructor===Rt?t:a,l=t.nodeProperty.constructor===At?t:l,o=t.nodeProperty.name===s?t:o}if(!r){const e=(e=>t=>e.addEventListener("input",t.defaultEventHandler))(i);a?e(a):l?e(l):o&&t&&e(o)}},SVGElement:on,Text:on,Template:on};class ln{nodeType;nodeRoute;nodeRouteKey;bindTexts;acceptInput;defaultProperty;initializeForNode;constructor(e,t,n,s,i,r){var o;this.nodeType=e,this.nodeRoute=t,this.nodeRouteKey=n,this.bindTexts=s,this.acceptInput=i,this.defaultProperty=r,this.initializeForNode=(o=this,(e,t)=>an[o.nodeType](e,o.acceptInput,t,o.defaultProperty))}}function dn(e,t,n,s){e=function(e,t){return at[t](e)}(e,t),function(e,t){ct[t](e)}(e,t);const i=function(e,t){return ht[t](e)}(e,t),r=function(e,t){const n=e.constructor.name+"\t"+(e.type??"");return St[n]??(St[n]=Nt[t](e))}(e,t)??"",o=function(e,t){if(""===e.trim())return[];const n=e+"\t"+t;return Ct[n]??(Ct[n]=vt(e,t))}(n,r),a=[];for(let t=0;t<o.length;t++){const n=o[t],{nodeProperty:i,stateProperty:r}=n,l=Xt(e,i,r,s);a.push({...n,...l,createBinding:rn(n,l)})}const l=function(e){let t=[];for(;null!==e.parentNode;)t=[Array.from(e.parentNode.childNodes).indexOf(e),...t],e=e.parentNode;return t}(e),d=l.join(",");return new ln(t,l,d,a,i,r)}const cn="bind",un={HTMLElement:e=>e.dataset[cn]??"",SVGElement:e=>e.dataset[cn]??"",Text:e=>e.textContent?.slice(3)??"",Template:e=>W(e.textContent?.slice(3)??"")?.dataset[cn]??""};function pn(e,t){return un[t](e)}const hn=e=>e instanceof Comment&&((e.textContent?.startsWith("@@:")??!1)||(e.textContent?.startsWith("@@|")??!1));function fn(e){return Array.from(e.childNodes).flatMap((e=>fn(e).concat(hn(e)?e:[])))}const mn=e=>e.constructor.name+"\t"+(e instanceof Comment?e.textContent?.[2]??"":""),gn={},yn=e=>e instanceof Comment&&":"===e.textContent?.[2]?"Text":e instanceof HTMLElement?"HTMLElement":e instanceof Comment&&"|"===e.textContent?.[2]?"Template":e instanceof SVGElement?"SVGElement":u.raise(`Unknown NodeType: ${e.nodeType}`);function bn(e,t=mn(e)){return gn[t]??(gn[t]=yn(e))}function xn(e,t){const n=[],s=e.content,i=Array.from(s.querySelectorAll("[data-bind]")).concat(fn(s));for(let e=0;e<i.length;e++){const s=i[e],r=bn(s),o=pn(s,r);""!==o.trim()&&(n[n.length]=dn(i[e],r,o,t))}return n}function vn(e,t){for(let n=0;void 0!==e&&n<t.length;e=e.childNodes[t[n++]]);return e}const Cn={};class wn{#L;#Y;constructor(e,t){this.#L=e,this.#Y=xn(this.#L,t)}createBindings(e,t){return function(e,t,n){const s=[];for(let i=0;i<n.length;i++){const r=n[i],o=vn(e,r.nodeRoute)??u.raise(`Node not found: ${r.nodeRoute}`),a=[];for(let e=0;e<r.bindTexts.length;e++)a[a.length]=r.bindTexts[e].createBinding(t,o);r.initializeForNode(o,a),s.push(...a)}return s}(e,t,this.#Y)}}class Pn{#Z;#X;#q;#ee;#te=!1;#ne;#se;#ie;#re;constructor(e){this.#re=e.parentBinding??u.raise("parentBinding is undefined"),!0===this.#re.loopable||u.raise("parentBinding is not loopable"),this.#ne=this.#re.statePropertyName??u.raise("statePropertyName is undefined"),this.#X=e,this.#se=ve(this.#ne+".*"),this.#ie=this.#se.wildcardPaths[this.#se.wildcardPaths.length-1]??u.raise("patternName is undefined")}get patternName(){return this.#ie}get parentLoopContext(){if(this.checkRevision(),!this.#te){const e=this.#se.wildcardPaths[this.#se.wildcardPaths.length-2];let t;if(void 0!==e){for(t=this.#re.parentContentBindings;void 0!==t&&(void 0===t.loopContext||t.loopContext.patternName!==e);)t=t.parentBinding?.parentContentBindings;void 0===t&&u.raise("parentLoopContext is undefined")}this.#ee=t?.loopContext,this.#te=!0}return this.#ee}get index(){return this.checkRevision(),void 0===this.#q&&(this.#q=this.#re.childrenContentBindings.indexOf(this.#X)),this.#q}#d;get indexes(){return this.checkRevision(),void 0===this.#d&&(void 0===this.parentLoopContext?this.#d=[this.index]:this.#d=this.parentLoopContext.indexes.concat(this.index)),this.#d}checkRevision(){const e=this.#X.parentBinding?.nodeProperty.revisionForLoop;return(void 0===this.#Z||this.#Z!==e)&&(this.#q=void 0,this.#d=void 0,this.#te=!1,this.#Z=e,!0)}find(e){let t=this.#X;for(;void 0!==t&&(void 0===t.loopContext||t.loopContext.patternName!==e);)t=t.parentBinding?.parentContentBindings;return t?.loopContext}}class Sn{#p;template;#oe;#re;#ae;#le;#de;get component(){return this.#p}get childBindings(){return void 0===this.#oe&&u.raise("childBindings is undefined"),this.#oe}get parentBinding(){return this.#re}set parentBinding(e){this.#re=e,this.#p=e?.component??this.#p,this.#ae=!0===e?.loopable?new Pn(this):void 0}get loopContext(){return this.#ae}get childNodes(){return void 0===this.#le&&u.raise("childNodes is undefined"),this.#le}get lastChildNode(){return this.childNodes[this.childNodes.length-1]}get currentLoopContext(){return void 0===this.#ae?this.parentContentBindings?.loopContext:this.#ae}get parentContentBindings(){return this.parentBinding?.parentContentBindings}get fragment(){return void 0===this.#de&&u.raise("fragment is undefined"),this.#de}get allChildBindings(){const e=[];for(let t=0;t<this.childBindings.length;t++){e.push(this.childBindings[t]);for(let n=0;n<this.childBindings[t].childrenContentBindings.length;n++)e.push(...this.childBindings[t].childrenContentBindings[n].allChildBindings)}return e}constructor(e,t,n){void 0===n&&void 0===t&&u.raise("component and parentBinding are undefined"),void 0!==n&&void 0!==t&&u.raise("component and parentBinding are both defined"),this.#p=t?.component??n,this.parentBinding=t,this.template=e}initialize(){const e=function(e,t){const n=e.dataset.uuid??u.raise("uuid not found");return Cn[n]??(Cn[n]=new wn(e,t))}(this.template,this.component?.useKeyed??u.raise("useKeyed is undefined"));this.#de=document.importNode(this.template.content,!0),this.#oe=e.createBindings(this.#de,this),this.#le=Array.from(this.#de.childNodes)}removeChildNodes(){this.fragment.append.apply(this.fragment,this.childNodes)}registerBindingsToSummary(){const e=this.component?.bindingSummary??u.raise("bindingSummary is undefined");for(let t=0;t<this.childBindings.length;t++)e.add(this.childBindings[t])}dispose(){this.childBindings.forEach((e=>e.dispose())),this.#re=void 0,this.#ae=void 0,this.#p=void 0,this.removeChildNodes();const e=this.template.dataset.uuid??u.raise("uuid is undefined");Bn[e]?.push(this)??(Bn[e]=[this])}rebuild(){const e=[];for(let t=0;t<this.childBindings.length;t++){const n=this.childBindings[t];n.nodeProperty.isSelectValue?e.push(n):n.rebuild()}for(let t=0;t<e.length;t++)e[t].rebuild()}}const Bn={};function Nn(e,t,n){const s=e.dataset.uuid??u.raise("uuid is undefined");let i=Bn[s]?.pop();return void 0!==i?i.parentBinding=t:(i=new Sn(e,t,n),i.initialize()),i.registerBindingsToSummary(),i}const En=e=>e.stateProperty.key,Mn=e=>e.nodeProperty.expandable,$n=e=>e.nodeProperty.constructor===jt;class In{#ce=!1;get updated(){return this.#ce}set updated(e){this.#ce=e}#ue=!1;#pe=0;get updateRevision(){return this.#pe}#he=new Map;get bindingsByKey(){return this.#ue&&u.raise("BindingSummary.bindingsByKey can only be called after BindingSummary.update()"),this.#he}#fe=new Map;#me=new Set;get expandableBindings(){return this.#ue&&u.raise("BindingSummary.expandableBindings can only be called after BindingSummary.update()"),this.#me}#ge=new Set;get componentBindings(){return this.#ue&&u.raise("BindingSummary.componentBindings can only be called after BindingSummary.update()"),this.#ge}#ye=new Set;get allBindings(){return this.#ye}add(e){this.#ue||u.raise("BindingSummary.add() can only be called in BindingSummary.update()"),this.#ce=!0,this.#ye.add(e)}delete(e){this.#ue||u.raise("BindingSummary.delete() can only be called in BindingSummary.update()"),this.#ce=!0,this.#ye.delete(e)}exists(e){return this.#ye.has(e)}#be(){e.debug&&performance.mark("BindingSummary.flush:start");try{this.rebuild(this.#ye)}finally{e.debug&&(performance.mark("BindingSummary.flush:end"),performance.measure("BindingSummary.flush","BindingSummary.flush:start","BindingSummary.flush:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures("BindingSummary.flush"),performance.clearMarks("BindingSummary.flush:start"),performance.clearMarks("BindingSummary.flush:end"))}}update(e){this.#ue=!0,this.#ce=!1,this.#pe++;try{e(this)}finally{this.#ce&&this.#be(),this.#ue=!1}}rebuild(e){this.#ye=e;const t=Array.from(e);this.#fe=new Map(t.map((e=>[e,En(e)]))),this.#he=Map.groupBy(t,(e=>this.#fe.get(e))),this.#me=new Set(t.filter(Mn)),this.#ge=new Set(t.filter($n))}partialUpdate(e){for(let t=0;t<e.length;t++){const n=e[t],s=this.#fe.get(n)??u.raise("BindingSummary.partialUpdate: key is undefined"),i=this.#he.get(s)??u.raise("BindingSummary.partialUpdate: bindings is undefined"),r=i.indexOf(n);i.splice(r,1);const o=En(n);this.#fe.set(n,o),this.#he.get(o)?.push(n)??this.#he.set(o,[n])}}}const Fn=e=>function(t,n,s,i,r,o,a){const l=e.dependentProps,d=Ye(e);return n.length>1&&l.setDefaultProp(n[r]),d(t,n,s,i,r,o,a)},Ln={[ne]:({state:e,stateProxy:t,handler:n})=>async(s,i,r)=>await n.directlyCallback(i,(async()=>await e[s].apply(t,[r,...i?.indexes??[]]))),[se]:({handler:e})=>(t,n)=>e.updator.addUpdatedStateProperty(Se(t,n)),[ie]:({handler:e})=>()=>e.dependentProps,[re]:({handler:e})=>()=>e.clearCache(),[oe]:({stateProxy:e})=>t=>e.$createBuffer?.apply(e,[t]),[ae]:({stateProxy:e})=>(t,n)=>e.$flushBuffer?.apply(e,[t,n])};const Tn={[J]:(...e)=>({}),[Y]:(...e)=>({}),[Z]:(...e)=>({props:e})},An={[J]:"connected",[Y]:"disconnected",[Z]:"updated"};const Rn={[X]:"$connectedCallback",[ee]:"$disconnectedCallback",[te]:"$updatedCallback"},kn=new Set([X,ee,te]),Vn={[X]:J,[ee]:Y,[te]:Z},On=(e,t,n,s)=>async(...i)=>{const r=e[Rn[s]]?.apply(t,i);return function(e,t,n){const s=An[t]??u.raise(`Unknown event symbol: ${t.description} `),i=(Tn[t]??u.raise(`Unknown detail function for event symbol: ${t.description}`))(...n),r=new CustomEvent(s,{detail:i});e.dispatchEvent(r)}(n.element,Vn[s],i),r};function jn(e,t){return void 0!==e.prototype&&(e.prototype!==Object.prototype&&(void 0!==e.prototype[t]||jn(Object.getPrototypeOf(e),t)))}const Dn=new Set(["element","addProcess","viewRootElement ","queryRoot","asyncShowModal","asyncShow","asyncShowPopover","cancelPopover"]);class Hn{get(e,t){return Dn.has(t)||jn(e.baseClass,t)?Reflect.get(e,t):void u.raise(`property ${t} is not found in ${e.baseClass.name}`)}}const Wn="$globals",Un="$dependentProps",Kn="$component",_n="$addProcess",qn={[Wn]:({handler:e})=>e.element.globals,[Un]:({state:e})=>e[Un],[Kn]:({handler:e})=>{return t=e.element,new Proxy(t,new Hn);var t},[_n]:({handler:e,stateProxy:t})=>n=>e.updator.addProcess(n,t,[])};function zn(e){const t=function(e){const t={};let n=e;for(;n!==Object.prototype;){const e=Object.getOwnPropertyDescriptors(n);for(const[n,s]of Object.entries(e))Reflect.has(t,n)||(t[n]=s);n=Object.getPrototypeOf(n)}return t}(e),n=[];for(const[e,s]of Object.entries(t))(s.get||s.set)&&n.push(e);return n}const Gn=new Map;function Qn(e){let t=Gn.get(e.constructor);return void 0===t&&(t=zn(e),{}.constructor!==e.constructor&&Gn.set(e.constructor,t)),t}class Jn{#xe=new Set;#ve={};constructor(e){this.#Ce(e)}get propsByRefProp(){return this.#ve}setDefaultProp(e){if(this.#xe.has(e))return;const t=ve(e);for(let e=t.patternPaths.length-1;e>=1;e--){const n=t.patternPaths[e-1],s=t.patternPaths[e];this.#ve[n]?.add(s)??(this.#ve[n]=new Set([s])),this.#xe.add(s)}}#Ce(e){for(const[t,n]of Object.entries(e))for(const e of n)this.#ve[e]?.add(t)??(this.#ve[e]=new Set([t]))}}function Yn(e){return new Jn(e)}const Zn=new Map;class Xn extends nt{#p;#we;#Pe;#Se;get accessorProperties(){return this.#we}get dependentProps(){return this.#Pe}get element(){return this.#p}get component(){return this.#p}get updator(){return this.component.updator}constructor(e,t){super(),this.#p=e;const{accessorProperties:n,dependentProps:s}=function(e){let t=Zn.get(e);return void 0===t&&(t={accessorProperties:new Set(Qn(e)),dependentProps:Yn(e.$dependentProps??{})},Zn.set(e,t)),t}(t);this.#we=n,this.#Pe=s,this.#Se={[G]:this.#we,[Q]:this.#Pe},this.#Be.symbol=(e,t,n)=>this.#Ne.apply(this,[e,t,n]),this.#Be.string=(e,t,n)=>this.#Ee.apply(this,[e,t,n])}getValue=Fn(this);#Ne(e,t,n){return this.#Se[t]??function(e,t,n,s){return kn.has(s)?(...i)=>On(e,t,n,s)(...i):void 0}(e,n,this,t)??function(e,t,n,s){return Ln[s]?.({state:e,stateProxy:t,handler:n})}(e,n,this,t)??void 0}#Ee(e,t,n){return function(e,t,n,s){return qn[s]?.({state:e,stateProxy:t,handler:n,prop:s})}(e,n,this,t)??void 0}#Be={};get(e,t,n){return this.#Be[typeof t]?.(e,t,n)??super.get(e,t,n)}clearCache(){}async directlyCallback(e,t){}}class es extends Xn{#Me={};get cache(){return this.#Me}getValue=(e=>{const t=Fn(e);return function(n,s,i,r,o,a,l){const{accessorProperties:d,cache:c}=e,u=s[o];if(s.length>1||d.has(u)){let e,d=u+":";for(let e=0;e<=a;e++)d+=r[e]+",";return(e=c[d])??(d in c?e:c[d]=t(n,s,i,r,o,a,l))}return t(n,s,i,r,o,a,l)}})(this);clearCache(){this.#Me={}}set(e,t,n,s){u.raise("ReadonlyHandler: set is not allowed")}}class ts extends Xn{#ae;#$e=!1;get loopContext(){return this.#ae}async withLoopContext(e,t){this.#$e&&u.raise("Writable: already set loopContext"),this.#$e=!0,this.#ae=e;try{return await t()}finally{this.#$e=!1,this.#ae=void 0}}async directlyCallback(e,t){return await this.withLoopContext(e,(async()=>(void 0!==this.lastStackIndexes&&u.raise("Writable: already set stackIndexes"),await t())))}getLastIndexes=(e=>function(t){const{stackNamedWildcardIndexes:n,loopContext:s}=e;return n[n.length-1]?.[t]?.indexes??s?.find(t)?.indexes})(this);setValueWithIndexes=(e=>function(t,n,s,i,r){const o=tt(e);try{return o(t,n,s,i,r)}finally{e.updator.addUpdatedStateProperty(Se(n.pattern,s))}})(this)}class ns{#Ie;#Fe;#Le;#Te=!1;constructor(e,t,n){this.#Ie=e,this.#Fe=t,this.#Le=n}get base(){return this.#Ie}get#Ae(){return this.#Te}set#Ae(e){this.#Te=e,!1===e&&this.#Fe[re]()}get current(){return this.#Ae?this.#Le:this.#Fe}async writable(e){this.#Ae&&u.raise("States: already writable"),this.#Ae=!0;try{return await e()}finally{this.#Ae=!1}}}function ss(e,t,n=function(e,t){return new Proxy(t,new es(e,t))}(e,t),s=function(e,t){return new Proxy(t,new ts(e,t))}(e,t)){return new ns(t,n,s)}const is="--adopted-css",rs=e=>e.trim(),os=e=>e.length>0;const as=new Map,ls=new Map;function ds(e){return class extends e{constructor(...e){super(),this.#Re=ss(this,Reflect.construct(this.State,[])),this.#ke=new In,this.#Ve=Promise.withResolvers(),this.#Oe=new ke(this),this.#je=function(e){return new Proxy({},new Qe(e))}(this),this.#De=function(e){return new Proxy({},new rt(e))}(this)}get component(){return this}#He;get parentComponent(){return void 0===this.#He&&(this.#He=(e=>{let t=e;for(;;){if(t=t.parentNode,null==t)return;if(!0===Reflect.get(t,"isQuelComponent"))return t;if(t instanceof ShadowRoot){if(!0===Reflect.get(t.host,"isQuelComponent"))return t.host;t=t.host}const e=as.get(t);if(void 0!==e)return e}})(this)),this.#He}#Ve;get initialPromises(){return this.#Ve}#We;get alivePromises(){return this.#We??u.raise("alivePromises is undefined")}set alivePromises(e){this.#We=e}#Re;get states(){return this.#Re}#Ue;get rootBindingManager(){return this.#Ue??u.raise("rootBindingManager is undefined")}set rootBindingManager(e){this.#Ue=e}get viewRootElement(){return this.useWebComponent?this.shadowRoot??this:this.pseudoParentNode}get queryRoot(){return this.viewRootElement}#Ke;get pseudoParentNode(){return this.useWebComponent?u.raise("mixInComponent: useWebComponent must be false"):this.#Ke??u.raise("pseudoParentNode is undefined")}set pseudoParentNode(e){this.#Ke=e}#_e;get pseudoNode(){return this.#_e??u.raise("pseudoNode is undefined")}set pseudoNode(e){this.#_e=e}get shadowRootOrDocument(){let e=this.parentNode;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}return document}#ke;get bindingSummary(){return this.#ke}#Oe;get updator(){return this.#Oe}#je;get props(){return this.#je}#De;get globals(){return this.#De}async build(){if(t=this.tagName.toLowerCase(),(de(t)||le.has(t))&&this.useShadowRoot&&this.useWebComponent){const t=this.attachShadow({mode:"open"}),n=function(e){return e.map(he).filter(fe)}((e=this,getComputedStyle(e)?.getPropertyValue(is)?.split(" ").map(rs).filter(os)??[]));void 0!==this.styleSheet&&n.push(this.styleSheet),t.adoptedStyleSheets=n}else if(void 0!==this.styleSheet){let e=this.styleSheet;if(this.useLocalSelector){const t=ls.get(this.tagName);void 0!==t?e=t:(e=function(e,t){for(let n=0;n<e.cssRules.length;n++){const s=e.cssRules[n];if(s instanceof CSSStyleRule){const e=s.selectorText.split(",").map((e=>e.trim().startsWith(":host")?e.replace(":host",t):`${t} ${e}`)).join(",");s.selectorText=e}}return e}(this.styleSheet,this.selectorName),ls.set(this.tagName,e))}const t=this.shadowRootOrDocument,n=t.adoptedStyleSheets;n.includes(e)||(t.adoptedStyleSheets=n.concat(e))}var e,t;this.useOverscrollBehavior&&("DIALOG"===this.tagName||this.hasAttribute("popover"))&&(this.style.overscrollBehavior="contain"),this.states.writable((async()=>{await this.states.current[X]()})),this.bindingSummary.update((e=>{this.template.dataset.uuid??u.raise("uuid is undefined"),this.rootBindingManager=Nn(this.template,void 0,this),this.rootBindingManager.rebuild()})),this.useWebComponent?this.viewRootElement.appendChild(this.rootBindingManager.fragment):(this.viewRootElement.insertBefore(this.rootBindingManager.fragment,this.pseudoNode?.nextSibling??null),this.rootBindingManager.childNodes.forEach((e=>as.set(e,this))))}async connectedCallback(){try{if(this.parentComponent&&await this.parentComponent.initialPromises.promise,!this.useWebComponent){const e=document.createComment(`@@/${this.tagName}`);this.pseudoParentNode=this.parentNode??u.raise("parentNode is undefined"),this.pseudoNode=e,this.pseudoParentNode.replaceChild(e,this)}this.alivePromises=Promise.withResolvers(),await this.build()}finally{this.initialPromises?.resolve&&this.initialPromises.resolve()}}async disconnectedCallback(){this.updator.addProcess((async()=>{await this.states.current[ee]()}),void 0,[])}}}function cs(e){for(const[t,n]of Object.entries(e))ms(t,n)}const us=new Map,ps=new Map,hs=new Map,fs=t=>{const n=function(e){return Object.assign(new q,e)}(t);n.filters=Object.assign({},t.filters),n.config=Object.assign({},t.moduleConfig),n.options=Object.assign({},t.options);const s=n.config?.extends??n.options?.extends,i=function(t,n){const s=class extends n{#qe=t;get module(){return this.#qe}get isQuelComponent(){return!0}#ze;get customElementInfo(){return void 0===this.#ze&&(this.#ze=ps.get(this.thisClass)??u.raise("customElementInfo is not found ")),this.#ze}#Ge(){if(void 0===ps.get(this.thisClass)){const e=this.tagName.toLowerCase(),t=e.includes("-"),n=this.getAttribute("is"),s=!!n,i=t?e:`${e}[is="${n}"]`;ps.set(this.thisClass,{selectorName:i,lowerTagName:e,isAutonomousCustomElement:t,isCostomizedBuiltInElement:s})}}get template(){return this.module.template}get styleSheet(){return this.module.styleSheet}get State(){return this.module.State}get inputFilters(){return this.module.filters.input??{}}get outputFilters(){return this.module.filters.output??{}}get eventFilters(){return this.module.filters.event??{}}get useShadowRoot(){return this.module.moduleConfig.useShadowRoot??e.useShadowRoot}get useWebComponent(){return this.module.moduleConfig.useWebComponent??e.useWebComponent}get useLocalTagName(){return this.module.moduleConfig.useLocalTagName??e.useLocalTagName}get useKeyed(){return this.module.moduleConfig.useKeyed??e.useKeyed}get useLocalSelector(){return this.module.moduleConfig.useLocalSelector??e.useLocalSelector}get useOverscrollBehavior(){return this.module.moduleConfig.useOverscrollBehavior??e.useOverscrollBehavior}get lowerTagName(){return this.customElementInfo.lowerTagName}get selectorName(){return this.customElementInfo.selectorName}get isAutonomousCustomElement(){return this.customElementInfo.isAutonomousCustomElement}get isCostomizedBuiltInElement(){return this.customElementInfo.isCostomizedBuiltInElement}#Qe;get filterManagers(){return void 0===this.#Qe&&(this.#Qe=hs.get(this.thisClass)??u.raise(`filterManagers is not found for ${this.tagName}`)),this.#Qe}#Je(){if(void 0===hs.get(this.thisClass)){const e={inputFilterManager:new R,outputFilterManager:new T,eventFilterManager:new V};for(const[t,n]of Object.entries(this.inputFilters))e.inputFilterManager.registerFilter(t,n);for(const[t,n]of Object.entries(this.outputFilters))e.outputFilterManager.registerFilter(t,n);for(const[t,n]of Object.entries(this.eventFilters))e.eventFilterManager.registerFilter(t,n);hs.set(this.thisClass,e)}}get inputFilterManager(){return this.filterManagers.inputFilterManager}get outputFilterManager(){return this.filterManagers.outputFilterManager}get eventFilterManager(){return this.filterManagers.eventFilterManager}get element(){return this}constructor(){super(),this.#Ge(),this.#Je()}static baseClass=n;get baseClass(){return Reflect.get(this.constructor,"baseClass")}static thisClass;get thisClass(){return Reflect.get(this.constructor,"thisClass")}};return s.thisClass=s,us.set(s,t),s}(n,s?document.createElement(s).constructor:HTMLElement),r=function(e){return class extends e{#Ye=!1;get canceled(){return this.#Ye}set canceled(e){this.#Ye=e}#Ze;get popoverPromises(){return this.#Ze}set popoverPromises(e){this.#Ze=e}#Xe;get popoverContextIndexesById(){return void 0===this.#Xe&&(this.#Xe=new Map),this.#Xe}constructor(...e){super(),this.addEventListener("hidden",(()=>{if(void 0!==this.popoverPromises){if(this.canceled)this.popoverPromises.reject();else{const e=this.props[He]();this.props[We](),this.popoverPromises.resolve(e)}this.popoverPromises=void 0}this.useBufferedBind&&void 0!==this.parentComponent&&(this.canceled||this.props[Ke]()),this.canceled=!0;const e=this.id;void 0!==e&&this.popoverContextIndexesById.delete(e)})),this.addEventListener("shown",(()=>{if(this.canceled=!0,this.useBufferedBind&&void 0!==this.parentComponent){const e=this.props[Ue]();this.props[De](e)}for(const e in this.props)this.states.current[se](e,[])})),this.addEventListener("toggle",(e=>{const t=e;if("closed"===t.newState){const e=new CustomEvent("hidden");this.dispatchEvent(e)}else if("open"===t.newState){const e=new CustomEvent("shown");this.dispatchEvent(e)}}))}async asyncShowPopover(e){return this.popoverPromises=Promise.withResolvers(),this.props[De](e),HTMLElement.prototype.showPopover.apply(this),this.popoverPromises.promise}hidePopover(){this.canceled=!1,HTMLElement.prototype.hidePopover.apply(this)}cancelPopover(){HTMLElement.prototype.hidePopover.apply(this)}}}((o=ds(i),class extends o{#et;get dialogPromises(){return this.#et}set dialogPromises(e){this.#et=e}#tt="";get returnValue(){return this.#tt}set returnValue(e){this.#tt=e}get useBufferedBind(){return this.hasAttribute("buffered-bind")}constructor(...e){super(),this.addEventListener("closed",(()=>{if(void 0!==this.dialogPromises){if(""===this.returnValue)this.dialogPromises.reject();else{const e=this.props[He]();this.props[We](),this.dialogPromises.resolve(e)}this.dialogPromises=void 0}this.useBufferedBind&&void 0!==this.parentComponent&&""!==this.returnValue&&this.props[Ke]()})),this.addEventListener("close",(()=>{const e=new CustomEvent("closed");this.dispatchEvent(e)}))}async#nt(e,t=!0){return this.returnValue="",this.dialogPromises=Promise.withResolvers(),this.props[De](e),t?HTMLDialogElement.prototype.showModal.apply(this):HTMLDialogElement.prototype.show.apply(this),this.dialogPromises.promise}async asyncShowModal(e){return this instanceof HTMLDialogElement||u.raise("DialogComponent: asyncShowModal is only for HTMLDialogElement"),this.#nt(e,!0)}async asyncShow(e){return this instanceof HTMLDialogElement||u.raise("DialogComponent: asyncShow is only for HTMLDialogElement"),this.#nt(e,!1)}showModal(){if(this instanceof HTMLDialogElement||u.raise("DialogComponent: showModal is only for HTMLDialogElement"),this.useBufferedBind&&void 0!==this.parentComponent){this.returnValue="";const e=this.props[Ue]();this.props[De](e)}return HTMLDialogElement.prototype.showModal.apply(this)}show(){if(this instanceof HTMLDialogElement||u.raise("DialogComponent: show is only for HTMLDialogElement"),this.useBufferedBind&&void 0!==this.parentComponent){this.returnValue="";const e=this.props[Ue]();this.props[De](e)}return HTMLDialogElement.prototype.show.apply(this)}close(e=""){return this instanceof HTMLDialogElement||u.raise("DialogComponent: close is only for HTMLDialogElement"),HTMLDialogElement.prototype.close.apply(this,[e])}}));var o;return cs(n.componentModulesForRegister??{}),r};function ms(e,t){const n=u.toKebabCase(e),s=fs(t),i=t.moduleConfig?.extends??t.options?.extends;void 0===i?customElements.define(n,s):customElements.define(n,s,{extends:i})}const gs="*filter-";const ys=p.create(((e,t)=>{if(e.startsWith(gs)){const n=e.slice(8),{output:s,input:i,event:r}=t;s&&T.registerFilter(n,s),i&&R.registerFilter(n,i),r&&V.registerFilter(n,r)}else!function(e,t){if("function"!=typeof e)return!1;let n=e;for(;n;){if(n===t)return!0;n=Object.getPrototypeOf(n)}return!1}(t,HTMLElement)?"State"in t&&"html"in t&&ms(e,t):customElements.define(e,t)}));async function bs(t,n){const s=await fetch(t.resolve(n??"./quel.config.json")),i=await s.json();for(let[t,n]of Object.entries(e))e[t]=void 0!==i[t]?i[t]:n;await ys.config(i).load()}function xs(e){return e.replaceAll(/<!--\{\{([^\}]+)\}\}-->/g,((e,t)=>`{{${t}}}`))}async function vs(e){const t=document.createElement("template"),n=await fetch(function(e,t){return e.resolve(t)}(import.meta,e));let s;t.innerHTML=(await n.text()).replaceAll(/\{\{([^\}]+)\}\}/g,((e,t)=>`\x3c!--{{${t}}}--\x3e`));const i=t.content.querySelector("script");let r;i?(s=await import("data:text/javascript;charset=utf-8,"+i.text),i.remove()):s={State:class{}};const o=t.content.querySelector("style");o?(r={css:o.textContent},o.remove()):r={};const a={html:xs(t.innerHTML).trim()};return Object.assign({},s,a,r)}async function Cs(e,t){ms(e,await vs(t))}async function ws(e){for(const[t,n]of Object.entries(e??{}))Cs(t,n)}async function Ps(e){const t=await vs(e);return fs(t)}function Ss(e){Object.entries(e).forEach((([e,t])=>{const{input:n,output:s,event:i}=t;n&&R.registerFilter(e,n),s&&T.registerFilter(e,s),i&&V.registerFilter(e,i)}))}function Bs(e){Object.assign(it.data,e)}void 0===Map.groupBy&&(Map.groupBy=function(e,t){return e.reduce(((e,n,s)=>{const i=t(n,s);return e.has(i)||e.set(i,[]),e.get(i).push(n),e}),new Map)}),void 0===Object.groupBy&&(Object.groupBy=function(e,t){return e.reduce((function(e,n){return(e[n[t]]=e[n[t]]||[]).push(n),e}),{})}),void 0===Promise.withResolvers&&(Promise.withResolvers=function(){let e,t;return{promise:new Promise(((n,s)=>{e=n,t=s})),resolve:e,reject:t}}),void 0===Array.prototype.toSorted&&(Array.prototype.toSorted=function(e){return this.slice().sort(e)}),void 0===Array.prototype.toReversed&&(Array.prototype.toReversed=function(){return this.slice().reverse()});export{bs as bootFromImportMeta,e as config,fs as generateComponentClass,Ps as generateSingleFileComponentClass,t as getCustomTagFromImportMeta,s as importCssFromImportMeta,n as importHtmlFromImportMeta,vs as loadSingleFileComponent,ys as loader,cs as registerComponentModules,Ss as registerFilters,Bs as registerGlobal,ws as registerSingleFileComponents};
