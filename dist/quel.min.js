const e="quel",t="*",s="dot-notation",n={directlyGet:Symbol.for(s+".direct_get"),directlySet:Symbol.for(s+".direct_set"),isSupportDotNotation:Symbol.for(s+".is_support_dot_notation")},i=new RegExp(/^\$([0-9]+)$/);class r{#e;get name(){return this.#e}#t;get pathNames(){return this.#t}#s;get parentPathNames(){return this.#s}#n;get parentPath(){return this.#n}#i;get parentPaths(){return this.#i}#r;get setOfParentPaths(){return this.#r}#a;get lastPathName(){return this.#a}#o;get regexp(){return this.#o}#l;get level(){return this.#l}#d;get isPrimitive(){return this.#d}#c;get nearestWildcardName(){return this.#c}#p;get nearestWildcardParentName(){return this.#p}constructor(e){if(this.#e=e,this.#t=e.split("."),this.#s=this.#t.slice(0,-1),this.#i=this.#s.reduce(((e,t)=>(e.push(e.at(-1)?.concat(t)??[t]),e)),[]).map((e=>e.join("."))),this.#r=new Set(this.#i),this.#n=this.#s.join("."),this.#a=this.#t.at(-1),this.#o=new RegExp("^"+e.replaceAll(".","\\.").replaceAll("*","([0-9a-zA-Z_]*)")+"$"),this.#l=this.#t.reduce(((e,s)=>e+(s===t?1:0)),0),this.#d=1===this.#t.length,this.#c=void 0,this.#p=void 0,this.#l>0)for(let e=this.#t.length-1;e>=0;e--)if(this.#t[e]===t){this.#c=this.#t.slice(0,e+1).join("."),this.#p=this.#t.slice(0,e).join(".");break}}static create(e){const t=this.propertyNameByName.get(e);if(void 0!==t)return t;const s=new r(e);return this.propertyNameByName.set(e,s),s}static propertyNameByName=new Map;static parse(e){const t=[],s=[];for(const n of e.split(".")){const e=Number(n);isNaN(e)?s.push(n):(t.push(e),s.push("*"))}return{propName:r.create(s.join(".")),indexes:t}}}let a=class{#h=[];#u=new Map;get lastIndexes(){return this.#h[this.#h.length-1]}get stackIndexes(){return this.#h}get matchByName(){return this.#u}getByPropertyName(e,{propName:s},n){let i;if(Reflect.has(e,s.name))i=Reflect.get(e,s.name,n);else if(""!==s.parentPath){const a=r.create(s.parentPath),o=this.getByPropertyName(e,{propName:a},n);if(void 0!==o){const e=s.lastPathName===t?this.lastIndexes[s.level-1]:s.lastPathName;i=Reflect.get(o,e)}}return i}setByPropertyName(e,{propName:s,value:n},i){let a=!1;if(Reflect.has(e,s.name)||s.isPrimitive)a=Reflect.set(e,s.name,n,i);else{const o=r.create(s.parentPath),l=this.getByPropertyName(e,{propName:o},i);if(void 0!==l){const e=s.lastPathName===t?this.lastIndexes[s.level-1]:s.lastPathName;a=Reflect.set(l,e,n)}}return a}pushIndexes(e,t){this.#h.push(e);try{return Reflect.apply(t,this,[])}finally{this.#h.pop()}}getFunc=(e,t)=>({propName:s,indexes:n})=>this.pushIndexes(n,(()=>this.getByPropertyName(e,{propName:s},t)));setFunc=(e,t)=>({propName:s,indexes:n},i)=>this.pushIndexes(n,(()=>this.setByPropertyName(e,{propName:s,value:i},t)));getExpandLastLevel(e,{propName:t,indexes:s},n){const i=this.getFunc(e,n);if(void 0===t.nearestWildcardName)throw new Error(`not found wildcard path of '${t.name}'`);const a=r.create(t.nearestWildcardParentName);return i({propName:a,indexes:s}).map(((e,n)=>i({propName:t,indexes:s.concat(n)})))}setExpandLastLevel(e,{propName:t,indexes:s,values:n},i){const a=this.getFunc(e,i),o=this.setFunc(e,i);if(void 0===t.nearestWildcardName)throw new Error(`not found wildcard path of '${t.name}'`);const l=r.create(t.nearestWildcardParentName),d=a({propName:l,indexes:s}),c=Array.isArray(n)?n:[...Array(d.length)].map((e=>n));if(t.nearestWildcardName===t.name)o({propName:l,indexes:s},c);else{if(c.length!==d.length)throw new Error(`not match array count '${t.name}'`);for(let e in d)o({propName:t,indexes:s.concat(Number(e))},c[e])}return!0}directlyGet(e,{prop:t,indexes:s},n){const i=r.create(t);return this.pushIndexes(s,(()=>this.getByPropertyName(e,{propName:i},n)))}directlySet(e,{prop:t,indexes:s,value:n},i){const a=r.create(t);return this.pushIndexes(s,(()=>this.setByPropertyName(e,{propName:a,value:n},i)))}get(e,t,s){const a="string"==typeof t;if(a&&(t.startsWith("@@__")||"constructor"===t))return Reflect.get(e,t,s);const o=this.getFunc(e,s),l=this.lastIndexes;let d;if(t===n.directlyGet)return(t,n)=>Reflect.apply(this.directlyGet,this,[e,{prop:t,indexes:n},s]);if(t===n.directlySet)return(t,n,i)=>Reflect.apply(this.directlySet,this,[e,{prop:t,indexes:n,value:i},s]);if(t===n.isSupportDotNotation)return!0;if(a){if(d=i.exec(t))return l?.[Number(d[1])-1]??void 0;if("@"===t.at(0)){const n=t.slice(1),i=r.create(n);if((l?.length??0)+1<i.level)throw new Error("array level not match");const a=l?.slice(0,i.level-1)??[];return this.getExpandLastLevel(e,{propName:i,indexes:a},s)}if(this.#u.has(t))return o(this.#u.get(t));const n=r.parse(t);return n.propName.level===n.indexes.length?(this.#u.set(t,n),o(n)):o({propName:n.propName,indexes:n.indexes.concat(l?.slice(n.indexes.length)??[])})}return Reflect.get(e,t,s)}set(e,t,s,n){if("string"==typeof t){if(t.startsWith("@@__")||"constructor"===t)return Reflect.set(e,t,s,n);const i=this.setFunc(e,n),a=this.lastIndexes;if("@"===t.at(0)){const i=t.slice(1),a=r.create(i);if((this.lastIndexes?.length??0)+1<a.level)throw new Error("array level not match");const o=this.lastIndexes?.slice(0,a.level-1)??[];return this.setExpandLastLevel(e,{propName:a,indexes:o,values:s},n)}if(this.#u.has(t))return i(this.#u.get(t),s);const o=r.parse(t);return o.propName.level===o.indexes.length?(this.#u.set(t,o),i(o,s)):i({propName:o.propName,indexes:o.indexes.concat(a?.slice(o.indexes.length)??[])},s)}return Reflect.set(e,t,s,n)}};const o=Object.assign({connectedCallback:Symbol.for(`${e}:viewModel.connectedCallback`),disconnectedCallback:Symbol.for(`${e}:viewModel.disconnectedCallback`),writeCallback:Symbol.for(`${e}:viewModel.writeCallback`),getDependentProps:Symbol.for(`${e}:viewModel.getDependentProps`),clearCache:Symbol.for(`${e}:viewModel.clearCache`),directlyCall:Symbol.for(`${e}:viewModel.directCall`),notifyForDependentProps:Symbol.for(`${e}:viewModel.notifyForDependentProps`),boundByComponent:Symbol.for(`${e}:globalData.boundByComponent`),bindTo:Symbol.for(`${e}:componentModule.bindTo`),bindProperty:Symbol.for(`${e}:props.bindProperty`),toObject:Symbol.for(`${e}:props.toObject`),propInitialize:Symbol.for(`${e}:props.initialize`),isComponent:Symbol.for(`${e}:component.isComponent`)},n),l={debug:!1,useShadowRoot:!1,useKeyed:!0,useWebComponent:!0,useLocalTagName:!0};class d{static raise(e){throw new Error(e)}static toKebabCase=e=>"string"==typeof e?e.replaceAll(/_/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e;static createUUID(){return window?.crypto?.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=((new Date).getTime()+16*Math.random())%16|0;return("x"==e?t:3&t|8).toString(16)}))}}class c{static templateByUUID=new Map}const p="data-bind";class h{static create(e,t,s,n){const i=document.createElement("template");return i.innerHTML=(t?`<style>\n${t}\n</style>`:"")+(e?this.replaceTag(e,s,n):""),i}static replaceTag(e,t,s){const n=[],i=e.replaceAll(/\{\{([^\}]+)\}\}/g,((e,t)=>{if((t=t.trim()).startsWith("loop:")||t.startsWith("if:"))return n.push(t),`<template data-bind="${t}">`;if(t.startsWith("else:")){return`</template><template data-bind="${n.at(-1)}|not">`}return t.startsWith("end:")?(n.pop(),"</template>"):`\x3c!--@@:${t}--\x3e`})),r=document.createElement("template");r.innerHTML=i;const a=s.map((e=>d.toKebabCase(e))),o=e=>{for(const s of a){const n=Array.from(e.querySelectorAll(s));for(const e of n){const n=document.createElement(`${s}-${t}`);if(e.hasAttributes){for(const t of e.attributes)n.setAttribute(t.name,t.value);n.setAttribute("data-orig-tag-name",s)}e.parentNode.replaceChild(n,e)}const i=Array.from(e.querySelectorAll(`[is="${s}"]`));for(const e of i){const n=document.createElement(e.tagName,{is:`${s}-${t}`});if(e.hasAttributes){for(const t of e.attributes)"is"!==t.name&&n.setAttribute(t.name,t.value);n.setAttribute("data-orig-is",s)}e.parentNode.replaceChild(n,e)}}const s=Array.from(e.querySelectorAll("template"));for(const e of s)o(e.content)};a.length>0&&o(r.content);const l=e=>{let t;for(;t=e.querySelector("template");){const e=d.createUUID(),s=document.createComment(`@@|${e}`);if(t.parentNode.replaceChild(s,t),t.constructor!==HTMLTemplateElement){const e=document.createElement("template");for(let s of Array.from(t.childNodes))e.content.appendChild(s);e.setAttribute(p,t.getAttribute(p)),t=e}t.setAttribute("data-uuid",e),l(t.content),c.templateByUUID.set(e,t)}};return l(r.content),r.innerHTML}}class u{#m=d.createUUID();get uuid(){return this.#m}html="";css;get template(){const e=this.useLocalTagName??l.useLocalTagName?Object.keys(this.componentModules??{}):[];return h.create(this.html,this.css,this.uuid,e)}ViewModel=class{};extendTag;useWebComponent;useShadowRoot;useLocalTagName;useKeyed;useBufferedBind;inputFilters;outputFilters;componentModules;get componentModulesForRegist(){if((this.useLocalTagName??l.useLocalTagName)&&void 0!==this.componentModules){const e={};for(const[t,s]of Object.entries(this.componentModules))e[`${d.toKebabCase(t)}-${this.uuid}`]=s;return e}return this.componentModules}}let m=class{#g;constructor(e){this.#g=e}#f(e,t){var s,n;Object.defineProperty(this.#g.baseViewModel,e,{get:(s=this.#g,n=t,function(){return s.parentComponent.writableViewModel[o.directlyGet](n.name,n.indexes)}),set:((e,t)=>function(s){return e.parentComponent.writableViewModel[o.directlySet](t.name,t.indexes,s),!0})(this.#g,t),configurable:!0})}get(e,t,s){return t===o.bindProperty?(e,t)=>this.#f(e,t):this.#g.viewModel[t]}set(e,t,s,n){return this.#g.viewModel[t]=s,!0}};class g extends a{#y=new Map;get(e,t,s){return t===o.boundByComponent?(e,t)=>{let s=this.#y.get(t);null==s?this.#y.set(t,new Set([e])):s.add(e)}:super.get(e,t,s)}set(e,t,s,n){const{propName:i,indexes:a}=r.parse(t),l=n[o.directlySet](i.name,a,s);let d=this.#y.get(i.name);if(d)for(const e of d)e.viewModel[o.notifyForDependentProps]("$globals."+i.name,a);return l}}class f{static create(){return new Proxy({},new g)}static data=this.create()}class y{#g;setOfProps=new Set;constructor(e){this.#g=e}bindProperty(e){f.data[o.boundByComponent](this.#g,e),this.setOfProps.add(e)}directGet=(e,t)=>(this.setOfProps.has(e)||this.bindProperty(e),f.data[o.directlyGet](e,t));directSet=(e,t,s)=>(this.setOfProps.has(e)||this.bindProperty(e),f.data[o.directlySet](e,t,s));get(e,t,s){if(t===o.directlyGet)return this.directGet;if(t===o.directlySet)return this.directSet;if(t===o.isSupportDotNotation)return!0;const{propName:n,indexes:i}=r.parse(t);return this.directGet(n.name,i)}set(e,t,s,n){const{propName:i,indexes:a}=r.parse(t);return this.directSet(i.name,a,s)}}class b extends Error{}class x{#b;#x=!0;get alive(){return this.#x}constructor(){this.main()}async#v(){return this.#b=Promise.withResolvers(),this.#b.promise}stop(){this.#b.reject(new b("stop"))}wakeup(e){this.#b.resolve(e)}async main(){for(;;)try{const e=await this.#v();await e.waitPromises.promise,l.debug&&performance.mark("slot-exec:start");try{await e.exec(),l.debug&&(performance.mark("slot-exec:end"),performance.measure("slot-exec","slot-exec:start","slot-exec:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures(),performance.clearMarks())}finally{e.callback()}}catch(e){if(e instanceof b)break;if(console.error(e),!confirm("致命的なエラーが発生しました。続行しますか？"))break}this.#x=!1}}class v{target;thisArgument;argumentsList;constructor(e,t,s){this.target=e,this.thisArgument=t,this.argumentsList=s}}class w{queue=[];async exec(){for(;this.queue.length>0;){const e=this.queue.splice(0);for(const t of e)await Reflect.apply(t.target,t.thisArgument,t.argumentsList)}}get isEmpty(){return 0===this.queue.length}}class P extends a{#g;get component(){return this.#g}#w;get dependentProps(){return this.#w}#P;get setOfAccessorProperties(){return this.#P}constructor(e,t,s){super(),this.#g=e,this.#P=t,this.#w=s}addProcess(e,t,s){this.#g.updateSlot?.addProcess(new v(e,t,s))}addNotify(e,t,s){this.#g.updateSlot?.addNotify(t)}static makeNotifyForDependentProps(e,t,s=new Set([])){const{propName:n,indexes:i}=t,a=n.name+"\t"+i.toString();if(s.has(a))return[];s.add(a);const l=e[o.getDependentProps]().setOfPropsByRefProp.get(n.name),d=[];if(void 0===l)return[];for(const t of l){const n=r.create(t);if(i.length<n.level){const t=P.expandIndexes(e,{propName:n,indexes:i});d.push(...t.map((e=>({propName:n,indexes:e}))))}else{const e=i.slice(0,n.level);d.push({propName:n,indexes:e})}d.push(...this.makeNotifyForDependentProps(e,{propName:n,indexes:i},s))}return d}static expandIndexes(e,t){const{propName:s,indexes:n}=t;if(s.level===n.length)return[n];if(s.level<n.length)return[n.slice(0,s.level)];{const t=(i,r,a)=>{const l=""!==i?i+".":i,d=s.pathNames[r],c=s.pathNames.length-1===r,p=l+d;let h;return h=c?"*"===d?e[o.directlyGet](i,a).flatMap(((e,t)=>[a.concat(t)])):[a]:"*"===d?a.length<n.length?t(p,r+1,n.slice(0,a.length+1)):e[o.directlyGet](i,a).flatMap(((e,s)=>t(p,r+1,a.concat(s)))):t(p,r+1,a),h};return t("",0,[])}}}class N{queue=[];#g;constructor(e){this.#g=e}async exec(){for(;this.queue.length>0;){const e=this.queue.splice(0),t=[];for(const s of e)t.push(...P.makeNotifyForDependentProps(this.#g.viewModel,s));const s=e.concat(t).reduce(((e,t)=>e.set(t.propName.name+"\t"+t.indexes.toString(),t)),new Map);this.#g.updateNode(s)}}get isEmpty(){return 0===this.queue.length}}const C=0,B=1,M=2,S=100;class E{#N;get viewModelUpdator(){return this.#N}#C;get nodeUpdator(){return this.#C}#B;#M;get waitPromises(){return this.#M}#S;get alivePromises(){return this.#S}#E;#T=C;get phase(){return this.#T}set phase(e){const t=this.#T;this.#T=e,void 0!==this.#E&&this.#E(e,t)}constructor(e,t=null,s=null){this.#N=new w,this.#C=new N(e),this.#B=t,this.#E=s,this.#M=Promise.withResolvers(),this.#S=Promise.withResolvers()}get isEmpty(){return this.#N.isEmpty&&this.#C.isEmpty}async exec(){do{this.phase=B,await this.#N.exec(),this.phase=M,await this.#C.exec()}while(!this.#N.isEmpty||!this.#C.isEmpty);this.phase=S,this.#S.resolve()}addProcess(e){this.#N.queue.push(e),this.#M.resolve(!0)}addNotify(e){this.#C.queue.push(e),this.#M.resolve(!0)}callback(){this.#B&&this.#B()}static create(e,t,s){return new E(e,t,s)}}class T{static setOfAttachableTags=new Set(["articles","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]);static isCustomTag(e){return-1!==e.indexOf("-")}static isAttachable(e){return this.isCustomTag(e)||this.setOfAttachableTags.has(e)}}const A=(e,t,s)=>{if(null==e)return e;const n=Number(e);return isNaN(n)?e:s(n,t)},L=(e,t,s)=>null==e?e:s(String(e),t),O=(e,t,s)=>Array.isArray(e)?s(e,t):e;class I{static styleDisplay=(e,t)=>e?t[0]??"":"none";static truthy=(e,t)=>!!e;static falsey=(e,t)=>!e;static not=this.falsey;static eq=(e,t)=>e==t[0];static ne=(e,t)=>e!=t[0];static lt=(e,t)=>Number(e)<Number(t[0]);static le=(e,t)=>Number(e)<=Number(t[0]);static gt=(e,t)=>Number(e)>Number(t[0]);static ge=(e,t)=>Number(e)>=Number(t[0]);static embed=(e,t)=>null!=e?decodeURIComponent((t[0]??"").replaceAll("%s",e)):null;static ifText=(e,t)=>e?t[0]??null:t[1]??null;static null=(e,t)=>null==e;static offset=(e,t)=>Number(e)+Number(t[0]);static unit=(e,t)=>String(e)+String(t[0]);static inc=this.offset;static mul=(e,t)=>Number(e)*Number(t[0]);static div=(e,t)=>Number(e)/Number(t[0]);static mod=(e,t)=>Number(e)%Number(t[0]);static"str.at"=(e,t)=>L(e,t,((e,t)=>e.at(...t)));static"str.charAt"=(e,t)=>L(e,t,((e,t)=>e.charAt(...t)));static"str.charCodeAt"=(e,t)=>L(e,t,((e,t)=>e.charCodeAt(...t)));static"str.codePointAt"=(e,t)=>L(e,t,((e,t)=>e.codePointAt(...t)));static"str.concat"=(e,t)=>L(e,t,((e,t)=>e.concat(...t)));static"str.endsWith"=(e,t)=>L(e,t,((e,t)=>e.endsWith(...t)));static"str.includes"=(e,t)=>L(e,t,((e,t)=>e.includes(...t)));static"str.indexOf"=(e,t)=>L(e,t,((e,t)=>e.indexOf(...t)));static"str.lastIndexOf"=(e,t)=>L(e,t,((e,t)=>e.lastIndexOf(...t)));static"str.localeCompare"=(e,t)=>L(e,t,((e,t)=>e.localeCompare(...t)));static"str.match"=(e,t)=>L(e,t,((e,t)=>e.match(...t)));static"str.normalize"=(e,t)=>L(e,t,((e,t)=>e.normalize(...t)));static"str.padEnd"=(e,t)=>L(e,t,((e,t)=>e.padEnd(...t)));static"str.padStart"=(e,t)=>L(e,t,((e,t)=>e.padStart(...t)));static"str.repeat"=(e,t)=>L(e,t,((e,t)=>e.repeat(...t)));static"str.replace"=(e,t)=>L(e,t,((e,t)=>e.replace(...t)));static"str.replaceAll"=(e,t)=>L(e,t,((e,t)=>e.replaceAll(...t)));static"str.search"=(e,t)=>L(e,t,((e,t)=>e.search(...t)));static"str.slice"=(e,t)=>L(e,t,((e,t)=>e.slice(...t)));static"str.split"=(e,t)=>L(e,t,((e,t)=>e.split(...t)));static"str.startsWith"=(e,t)=>L(e,t,((e,t)=>e.startsWith(...t)));static"str.substring"=(e,t)=>L(e,t,((e,t)=>e.substring(...t)));static"str.toLocaleLowerCase"=(e,t)=>L(e,t,((e,t)=>e.toLocaleLowerCase(...t)));static"str.toLocaleUpperCase"=(e,t)=>L(e,t,((e,t)=>e.toLocaleUpperCase(...t)));static"str.toLowerCase"=(e,t)=>L(e,t,((e,t)=>e.toLowerCase(...t)));static"str.toUpperCase"=(e,t)=>L(e,t,((e,t)=>e.toUpperCase(...t)));static"str.trim"=(e,t)=>L(e,t,((e,t)=>e.trim(...t)));static"str.trimEnd"=(e,t)=>L(e,t,((e,t)=>e.trimEnd(...t)));static"str.trimStart"=(e,t)=>L(e,t,((e,t)=>e.trimStart(...t)));static"num.toExponential"=(e,t)=>A(e,t,((e,t)=>e.toExponential(...t)));static"num.toFixed"=(e,t)=>A(e,t,((e,t)=>e.toFixed(...t)));static"num.toLocaleString"=(e,t)=>A(e,t,((e,t)=>e.toLocaleString(...t)));static"num.toPrecision"=(e,t)=>A(e,t,((e,t)=>e.toPrecision(...t)));static"arr.at"=(e,t)=>O(e,t,((e,t)=>e.at(...t)));static"arr.concat"=(e,t)=>O(e,t,((e,t)=>e.concat(...t)));static"arr.entries"=(e,t)=>O(e,t,((e,t)=>e.entries(...t)));static"arr.flat"=(e,t)=>O(e,t,((e,t)=>e.flat(...t)));static"arr.includes"=(e,t)=>O(e,t,((e,t)=>e.includes(...t)));static"arr.indexOf"=(e,t)=>O(e,t,((e,t)=>e.indexOf(...t)));static"arr.join"=(e,t)=>O(e,t,((e,t)=>e.join(...t)));static"arr.keys"=(e,t)=>O(e,t,((e,t)=>e.keys(...t)));static"arr.lastIndexOf"=(e,t)=>O(e,t,((e,t)=>e.lastIndexOf(...t)));static"arr.slice"=(e,t)=>O(e,t,((e,t)=>e.slice(...t)));static"arr.toLocaleString"=(e,t)=>O(e,t,((e,t)=>e.toLocaleString(...t)));static"arr.toReversed"=(e,t)=>O(e,t,((e,t)=>e.toReversed(...t)));static"arr.toSorted"=(e,t)=>O(e,t,((e,t)=>e.toSorted(...t)));static"arr.toSpliced"=(e,t)=>O(e,t,((e,t)=>e.toSpliced(...t)));static"arr.values"=(e,t)=>O(e,t,((e,t)=>e.values(...t)));static"arr.with"=(e,t)=>O(e,t,((e,t)=>e.with(...t)));static get at(){return(e,t)=>(Array.isArray(e)?this["arr.at"]:this["str.at"])(e,t)}static get charAt(){return this["str.charAt"]}static get charCodeAt(){return this["str.charCodeAt"]}static get codePointAt(){return this["str.codePointAt"]}static get concat(){return(e,t)=>(Array.isArray(e)?this["arr.concat"]:this["str.concat"])(e,t)}static get endsWith(){return this["str.endsWith"]}static get entries(){return this["arr.entries"]}static get flat(){return this["arr.flat"]}static get includes(){return(e,t)=>(Array.isArray(e)?this["arr.includes"]:this["str.includes"])(e,t)}static get indexOf(){return(e,t)=>(Array.isArray(e)?this["arr.indexOf"]:this["str.indexOf"])(e,t)}static get join(){return this["arr.join"]}static get keys(){return this["arr.keys"]}static get lastIndexOf(){return(e,t)=>(Array.isArray(e)?this["arr.lastIndexOf"]:this["str.lastIndexOf"])(e,t)}static get localeCompare(){return this["str.localeCompare"]}static get match(){return this["str.match"]}static get normalize(){return this["str.normalize"]}static get padEnd(){return this["str.padEnd"]}static get padStart(){return this["str.padStart"]}static get repeat(){return this["str.repeat"]}static get replace(){return this["str.replace"]}static get replaceAll(){return this["str.replaceAll"]}static get search(){return this["str.search"]}static get slice(){return(e,t)=>(Array.isArray(e)?this["arr.slice"]:this["str.slice"])(e,t)}static get split(){return this["str.split"]}static get startsWith(){return this["str.startsWith"]}static get substring(){return this["str.substring"]}static get toExponential(){return this["num.toExponential"]}static get toFixed(){return this["num.toFixed"]}static get toLocaleString(){return(e,t)=>(Array.isArray(e)?this["arr.toLocaleString"]:this["num.toLocaleString"])(e,t)}static get toLocaleLowerCase(){return this["str.toLocaleLowerCase"]}static get toLocaleUpperCase(){return this["str.toLocaleUpperCase"]}static get toLowerCase(){return this["str.toLowerCase"]}static get toPrecision(){return this["num.toPrecision"]}static get toReversed(){return this["arr.toReversed"]}static get toSorted(){return this["arr.toSorted"]}static get toSpliced(){return this["arr.toSpliced"]}static get toUpperCase(){return this["str.toUpperCase"]}static get trim(){return this["str.trim"]}static get trimEnd(){return this["str.trimEnd"]}static get trimStart(){return this["str.trimStart"]}static get values(){return this["arr.values"]}static get with(){return this["arr.with"]}}class k{static number=(e,t)=>""===e?null:Number(e);static boolean=(e,t)=>""===e?null:Boolean(e)}const $=e=>Array.from(e.childNodes).flatMap((e=>$(e).concat((e=>e instanceof Comment&&(e.textContent.startsWith("@@:")||e.textContent.startsWith("@@|")))(e)?e:null))).filter((e=>e));class _{static listOfRouteIndexesByTemplate=new Map;static getTargetNodes(e,t){let s;void 0===e&&d.raise("Selector: template is undefined"),void 0===t&&d.raise("Selector: rootElement is undefined");const n=this.listOfRouteIndexesByTemplate.get(e);return void 0!==n?s=n.map((e=>((e,t)=>{for(let s=0;s<t.length;s++)e=e.childNodes[t[s]];return e})(t,e))):(s=Array.from(t.querySelectorAll("[data-bind]")).concat($(t)),this.listOfRouteIndexesByTemplate.set(e,s.map((e=>(e=>{let t=[];for(;null!==e.parentNode;)t=[Array.from(e.parentNode.childNodes).indexOf(e)].concat(t),e=e.parentNode;return t})(e))))),s}}class R{name;options;static applyForInput(e,t,s){return t.reduceRight(((e,t)=>t.name in s?s[t.name](e,t.options):e),e)}static applyForOutput(e,t,s){return t.reduce(((e,t)=>t.name in s?s[t.name](e,t.options):e),e)}static regist(e,t,s){e in I&&d.raise(`regist filter error duplicate name (${e})`),e in k&&d.raise(`regist filter error duplicate name (${e})`),t&&(I[e]=t),s&&(k[e]=s)}}class V{#A;get node(){return this.#A}#e;get name(){return this.#e}#L=[];get nameElements(){return this.#L}get value(){return this.node[this.name]}set value(e){this.node[this.name]=e}#O;get filters(){return this.#O}#I;get filterFuncs(){return this.#I}get filteredValue(){return this.filters.length>0?R.applyForInput(this.value,this.filters,this.filterFuncs):this.value}get applicable(){return!0}#k;get binding(){return this.#k}get expandable(){return!1}get isSelectValue(){return!1}get loopable(){return!1}constructor(e,t,s,n,i){t instanceof Node||d.raise("NodeProperty: not Node"),this.#k=e,this.#A=t,this.#e=s,this.#L=s.split("."),this.#O=n,this.#I=i}initialize(){}postUpdate(e){}isSameValue(e){return this.value===e}applyToChildNodes(e){}clearValue(){}}class F extends V{get template(){return c.templateByUUID.get(this.uuid)}get uuid(){return F.getUUID(this.node)}static getUUID(e){return e.textContent.slice("@@|".length)}get expandable(){return!0}constructor(e,t,s,n,i){t instanceof Comment||d.raise("TemplateProperty: not Comment");const r=F.getUUID(t);void 0===c.templateByUUID.get(r)&&d.raise(`TemplateProperty: invalid uuid ${r}`),super(e,t,s,n,i)}}const U=e=>e.applyToNode();class D extends F{get loopable(){return!0}get value(){return this.binding.children.length}set value(e){if(Array.isArray(e)||d.raise("Repeat: value is not array"),this.value<e.length){this.binding.children.forEach(U);for(let t=this.value;t<e.length;t++){const[e,s]=[this.binding.viewModelProperty.name,t],n=Se.create(this.binding.component,this.template,this.binding,{name:e,index:s});this.binding.appendChild(n),n.registBindingsToSummary(),n.applyToNode()}}else if(this.value>e.length){const t=this.binding.children.splice(e.length);this.binding.children.forEach(U),t.forEach((e=>e.dispose()))}else this.binding.children.forEach(U)}constructor(e,t,s,n,i){"loop"!==s&&d.raise(`Repeat: invalid property name '${s}'`),super(e,t,s,n,i)}isSameValue(e){return!1}}class W extends F{get value(){return this.binding.children.length>0}set value(e){if("boolean"!=typeof e&&d.raise("Branch: value is not boolean"),this.value!==e)if(e){const e=Se.create(this.binding.component,this.template,this.binding);this.binding.appendChild(e),e.registBindingsToSummary()}else{this.binding.children.splice(0,this.binding.children.length).forEach((e=>e.dispose()))}this.binding.children.forEach((e=>e.applyToNode()))}constructor(e,t,s,n,i){"if"!==s&&d.raise(`Branch: invalid property name ${s}`),super(e,t,s,n,i)}isSameValue(e){return!1}}class K{#$;get value(){return this.#$}#_;get enabled(){return this.#_}constructor(e,t){this.#$=e,this.#_=t}}class j{get viewModel(){return this.#k.component.viewModel}#e;get name(){return this.#e}#R;get propertyName(){return this.#R}#l;get level(){return this.#l}get indexes(){return this.binding.newLoopContext?.indexes.slice(0,this.level)??[]}get indexesString(){return this.indexes.toString()}get key(){return this.name+"\t"+this.indexesString}#V;get oldKey(){return this.#V}get isChagedKey(){return this.#V!==this.key}getKey(){return this.#V=this.key,this.key}get value(){return console.log("ViewModelProperty get value",this.binding.id),this.viewModel[o.directlyGet](this.name,this.indexes)}set value(e){const t=e=>{this.viewModel[o.directlySet](this.name,this.indexes,e)};if(e instanceof K){const s=this.value;if(Array.isArray(s)){const n=new Set(s);e.enabled?n.add(e.value):n.delete(e.value),t(Array.from(n))}else e.enabled&&t(e.value)}else t(e)}#O;get filters(){return this.#O}#I;get filterFuncs(){return this.#I}get filteredValue(){return this.filters.length>0?R.applyForOutput(this.value,this.filters,this.filterFuncs):this.value}get applicable(){return!0}#k;get binding(){return this.#k}constructor(e,t,s,n){this.#k=e,this.#e=t,this.#O=s,this.#I=n,this.#R=r.create(this.name),this.#l=this.#R.level}initialize(){}getChildValue(e){return this.viewModel[o.directlyGet](`${this.name}.*`,this.indexes.concat(e))}setChildValue(e,t){return this.viewModel[o.directlySet](`${this.name}.*`,this.indexes.concat(e),t)}}const H=RegExp(/^\$[0-9]+$/);class z extends j{get index(){return Number(this.name.slice(1))-1}get value(){return this.binding.newLoopContext.allIndexes[this.index]}get indexes(){return[]}get indexesString(){return""}constructor(e,t,s,n){H.test(t)||d.raise(`ContextIndex: invalid name ${t}`),super(e,t,s,n)}}class q extends V{get element(){return this.node}constructor(e,t,s,n,i){t instanceof Element||d.raise("ElementBase: not element"),super(e,t,s,n,i)}}class G extends q{get value(){return this.element.className.length>0?this.element.className.split(" "):[]}set value(e){Array.isArray(e)||d.raise("ElementClassName: value is not array"),this.element.className=e.join(" ")}constructor(e,t,s,n,i){"class"!==s&&d.raise(`ElementClassName: invalid property name ${s}`),super(e,t,s,n,i)}}class Z extends q{get inputElement(){return this.node}get value(){return new K(this.inputElement.value,this.inputElement.checked)}set value(e){Array.isArray(e)||d.raise("Checkbox: value is not array");const t=this.filteredValue;this.inputElement.checked=!!e.find((e=>e===t.value))}get filteredValue(){const e=this.value;return new K(this.filters.length>0?R.applyForInput(e.value,this.filters,this.filterFuncs):e.value,e.enabled)}constructor(e,t,s,n,i){t instanceof HTMLInputElement||d.raise("Checkbox: not htmlInputElement"),"checkbox"!==t.type&&d.raise("Checkbox: not checkbox"),super(e,t,s,n,i)}isSameValue(e){return!1}}class J extends q{get inputElement(){return this.element}get value(){return new K(this.inputElement.value,this.inputElement.checked)}set value(e){const t=this.filteredValue;this.inputElement.checked=e===t.value}get filteredValue(){const e=this.value;return new K(this.filters.length>0?R.applyForInput(e.value,this.filters,this.filterFuncs):e.value,e.enabled)}constructor(e,t,s,n,i){t instanceof HTMLInputElement||d.raise("Radio: not htmlInputElement"),"radio"!==t.type&&d.raise("Radio: not radio"),super(e,t,s,n,i)}isSameValue(e){return!1}}class Q extends q{get eventType(){return this.name.slice("on".length)}get applicable(){return!1}#F;get handler(){return void 0===this.#F&&(this.#F=e=>this.eventHandler(e)),this.#F}constructor(e,t,s,n,i){s.startsWith("on")||d.raise(`ElementEvent: invalid property name ${s}`),super(e,t,s,n,i)}initialize(){this.element.addEventListener(this.eventType,this.handler)}async directlyCall(e){const{viewModelProperty:t,newLoopContext:s}=this.binding;return t.viewModel[o.directlyCall](t.name,s,e)}createProcessData(e){return new v(this.directlyCall,this,[e])}eventHandler(e){if(!this.binding.component.bindingSummary.allBindings.has(this.binding))return;e.stopPropagation();const t=this.createProcessData(e);this.binding.component.updateSlot.addProcess(t)}}class X extends q{get className(){return this.nameElements[1]}get value(){return this.element.classList.contains(this.className)}set value(e){e?this.element.classList.add(this.className):this.element.classList.remove(this.className)}constructor(e,t,s,n,i){s.startsWith("class.")||d.raise(`ElementClass: invalid property name ${s}`),super(e,t,s,n,i)}}class Y extends q{get attributeName(){return this.nameElements[1]}get value(){return this.element.getAttribute(this.attributeName)}set value(e){this.element.setAttribute(this.attributeName,e)}}class ee extends q{get htmlElement(){return this.node}get styleName(){return this.nameElements[1]}get value(){return this.htmlElement.style[this.styleName]}set value(e){this.htmlElement.style[this.styleName]=e}constructor(e,t,s,n,i){t instanceof HTMLElement||d.raise("ElementStyle: not htmlElement"),super(e,t,s,n,i)}}class te extends q{#U;get isSelectValue(){return void 0===this.#U&&(this.#U=this.node.constructor===HTMLSelectElement&&"value"===this.name),this.#U}}class se{get name(){return this.#D.name}get indexes(){return this.#D.indexes}#D;constructor(e){this.#D=e}}class ne extends q{get propName(){return this.nameElements[1]}get applicable(){return!1}get thisComponent(){return this.node}constructor(e,t,s,n,i){t.constructor[o.isComponent]||d.raise("ComponentProperty: not Component"),super(e,t,s,n,i)}initialize(){this.thisComponent.props[o.bindProperty](this.propName,new se(this.binding.viewModelProperty))}postUpdate(e){const t=this.binding.viewModelProperty.name,s=this.propName;for(const[n,i]of e.entries())if(i.propName.name===t||i.propName.setOfParentPaths.has(t)){const e=i.propName.name.slice(t.length);this.thisComponent.viewModel?.[o.writeCallback](`${s}${e}`,i.indexes),this.thisComponent.viewModel?.[o.notifyForDependentProps](`${s}${e}`,i.indexes)}}isSameValue(e){return!1}}class ie extends D{get loopable(){return!0}#W=[];get value(){return this.#W}set value(e){Array.isArray(e)||d.raise("RepeatKeyed: value is not array");const t=new Map,s=new Set;let n;const i=new Set,r=new Map;for(let n=0;n<e.length;n++){const e=this.binding.viewModelProperty.getChildValue(n),a=this.#W.indexOf(e,t.get(e)??0);-1===a||!1===a?i.add(n):(t.set(e,a+1),s.add(a),r.set(n,a))}for(let e=0;e<this.binding.children.length;e++)s.has(e)||this.binding.children[e].dispose();const a=e.map(((e,t)=>{let s;const a=n?.lastNode??this.node,o=this.node.parentNode;if(i.has(t)){const[e,n]=[this.binding.viewModelProperty.name,t];s=Se.create(this.binding.component,this.template,this.binding,{name:e,index:n}),o.insertBefore(s.fragment,a.nextSibling??null)}else{const e=r.get(t);s=this.binding.children[e],e!==t&&(s.thisLoopContext.index=t),s.nodes&&s.nodes[0].previousSibling!==a&&(s.removeNodes(),o.insertBefore(s.fragment,a.nextSibling??null))}return n=s,s}));this.binding.children.splice(0,this.binding.children.length,...a),a.forEach((e=>{e.registBindingsToSummary(),e.applyToNode()})),this.#W=e.slice()}applyToChildNodes(e){const t=new Map;for(const s of e){const e=this.binding.children[s];if(void 0===e)continue;e.removeNodes();const n=this.#W[s];void 0!==n&&t.set(n,e)}for(const s of Array.from(e).sort()){const e=this.binding.viewModelProperty.getChildValue(s);if(void 0===e)continue;let n=t.get(e);if(void 0!==n)n.thisLoopContext.index=s;else{const e=this.binding.viewModelProperty.name;n=Se.create(this.binding.component,this.template,this.binding,{name:e,index:s})}this.binding.replaceChild(s,n),n.registBindingsToSummary(),n.applyToNode()}}clearValue(){this.#W=[]}}const re=RegExp(/^\$[0-9]+$/);class ae{static#K;static get classOfNodePropertyByNameByIsComment(){return void 0===this.#K&&(this.#K={true:{if:W},false:{class:G,checkbox:Z,radio:J}}),this.#K}static#j;static get classOfNodePropertyByFirstName(){return void 0===this.#j&&(this.#j={class:X,attr:Y,style:ee,props:ne}),this.#j}static create(e,t,s,n,i,r){let a;const o=re.test(i)?z:j;do{const n=t instanceof Comment;if(a=this.classOfNodePropertyByNameByIsComment[n][s],void 0!==a)break;if(n&&"loop"===s){a=e.component.useKeyed?ie:D;break}n&&d.raise(`Factory: unknown node property ${s}`);const i=s.split(".");if(a=this.classOfNodePropertyByFirstName[i[0]],void 0!==a)break;a=t instanceof Element?s.startsWith("on")?Q:te:V}while(0);return Me.create(e,t,s,a,i,o,r)}}class oe{nodeProperty;viewModelProperty;filters}const le=e=>e.trim(),de=e=>e.length>0,ce=e=>{const[t,...s]=e.split("|").map(le);return{viewModelProperty:t,filters:s.map((e=>(e=>{const[t,...s]=e.split(",").map(le);return Object.assign(new R,{name:t,options:s})})(e)))}},pe=(e,t)=>e.split(";").map(le).filter(de).map((e=>{let{nodeProperty:s,viewModelProperty:n,filters:i}=((e,t)=>{const[s,n]=[t].concat(...e.split(":").map(le)).splice(-2),{viewModelProperty:i,filters:r}=ce(n);return{nodeProperty:s,viewModelProperty:i,filters:r}})(e,"$");return n="@"===n?s:n,s="$"===s?t:s,void 0===s&&d.raise("parseBindText: default property undefined"),{nodeProperty:s,viewModelProperty:n,filters:i}}));class he{static bindTextsByKey={};static parse(e,t){if(void 0===e&&d.raise("Parser: text is undefined"),""===e.trim())return[];const s=e+"\t"+t;let n=this.bindTextsByKey[s];return void 0===n&&(n=pe(e,t).map((e=>Object.assign(new oe,e))),this.bindTextsByKey[s]=n),n}}class ue{static parseBindText=(e,t,s,n,i)=>(void 0===n&&d.raise("BindToDom: text is undefined"),""===n.trim()?[]:he.parse(n,i).map((n=>ae.create(e,t,n.nodeProperty,s,n.viewModelProperty,n.filters))))}const me="data-bind",ge="oninput",fe=ge.slice(2);class ye{static bind(e,t){const s=e.component.viewModel,n=(e=>e instanceof HTMLElement?e:d.raise("BindToHTMLElement: not HTMLElement"))(t),i=n.getAttribute(me)??void 0;void 0===i&&d.raise("BindToHTMLElement: data-bind is not defined"),n.removeAttribute(me);const r=(e=>e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLOptionElement?"value":e instanceof HTMLButtonElement||e instanceof HTMLAnchorElement?"onclick":e instanceof HTMLInputElement?"radio"===e.type||"checkbox"===e.type?"checked":"button"===e.type?"onclick":"value":"textContent")(n),a=ue.parseBindText(e,t,s,i,r);let o=!1,l=null,c=null,p=null;a.forEach((e=>{o||=e.nodeProperty.name===ge,c=e.nodeProperty.constructor===J?e:c,p=e.nodeProperty.constructor===Z?e:p,l=e.nodeProperty.name===r?e:l}));const h=e=>{n.addEventListener(fe,e.defaultEventHandler)};return c?o||h(c):p?o||h(p):l&&!o&&(e=>e instanceof HTMLElement&&(e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&"button"!==e.type))(t)&&h(l),a}}const be="data-bind";class xe{static bind(e,t){const s=e.component.viewModel,n=(e=>e instanceof SVGElement?e:d.raise("BindToSVGElement: not SVGElement"))(t),i=n.getAttribute(be)??void 0;void 0===i&&d.raise("BindToSVGElement: data-bind is not defined"),n.removeAttribute(be);return ue.parseBindText(e,t,s,i,undefined)}}class ve{static bind(e,t){const s=e.component.viewModel,n=(e=>e instanceof Comment?e:d.raise("BindToText: not Comment"))(t),i=n.parentNode??void 0;void 0===i&&d.raise("BindToText: no parent");const r=n.textContent.slice(3);if(""===r.trim())return[];const a=document.createTextNode("");i.replaceChild(a,n);return ue.parseBindText(e,a,s,r,"textContent")}}class we{static bind(e,t){const s=e.component.viewModel,n=(e=>e instanceof Comment?e:d.raise("BindToTemplate: not Comment"))(t),i=n.textContent.slice(3),r=c.templateByUUID.get(i);void 0===r&&d.raise("BindToTemplate: template not found");const a=r.getAttribute("data-bind")??void 0;void 0===a&&d.raise("BindToTemplate: data-bind is not defined");return ue.parseBindText(e,t,s,a,void 0)}}class Pe{static bind(e,t){return t.flatMap((t=>t instanceof Comment&&":"==t.textContent[2]?ve.bind(e,t):t instanceof HTMLElement?ye.bind(e,t):t instanceof Comment&&"|"==t.textContent[2]?we.bind(e,t):t instanceof SVGElement?xe.bind(e,t):d.raise("Binder: unknown node type")))}}class Ne{static#H=new Map;static dispose(e){e.removeNodes(),e.parentBinding=void 0,e.bindings.forEach((t=>{t.nodeProperty.clearValue(),e.component.bindingSummary.delete(t);t.children.splice(0).forEach((e=>e.dispose()))})),e.component.useKeyed||(this.#H.get(e.template)?.push(e)??this.#H.set(e.template,[e]))}static create(e,t,s,n){let i=this.#H.get(t)?.pop();return"object"!=typeof i?(i=new Se(e,t,s,n),i.initialize()):i.parentBinding=s,i}}class Ce{get parent(){return this.#z.parentBinding?.loopContext}#q;get directParent(){if(void 0!==this.parent&&void 0===this.#q){const e=r.create(this.name);if(e.level>0){let t=this.parent;for(;void 0!==t;){if(t.name===e.nearestWildcardParentName){this.#q=t;break}t=t.parent}}}return this.#q}#e;get name(){return this.#e}#G;get index(){return this.#G}set index(e){this.#G=e;try{this.#Z=!0,this.#z.postUpdateIndexForLoopContext()}finally{this.#Z=!1}}#Z=!1;get updated(){return this.#Z||(this.parent?.updated??!1)}get directUpdated(){return this.#Z||(this.directParent?.directUpdated??!1)}#J;get indexes(){return void 0===this.#J&&(this.#J=this.parent?.indexes.concat(this.#G)??[this.#G]),this.#J}#Q;get directIndexes(){return void 0===this.#Q&&(this.#Q=this.directParent?.directIndexes.concat(this.#G)??[this.#G]),this.#Q}clear(){this.#Q=void 0,this.#J=void 0,this.#q=void 0}postUpdateIndex(){this.directUpdated&&(this.#Q=void 0),this.updated&&(this.#J=void 0)}#z;get bindingManager(){return this.#z}set bindingManager(e){this.#z=e}constructor(e,t,s){this.#z=e,this.#e=t,this.#G=s}find(e){let t=this;for(;void 0!==t;){if(t.name===e)return t;t=t.directParent}}}class Be{#z;get bindingManager(){return this.#z}get parentBindingManager(){return this.bindingManager.parentBinding?.bindingManager}get binding(){return this.bindingManager.parentBinding}get nearestBindingManager(){const e=r.create(this.name);if(e.level<=0)return;const t=r.create(e.nearestWildcardParentName).name;let s=this.parentBindingManager;for(;void 0!==s;){if(s.newLoopContext.binding.viewModelProperty.name===t)return s;s=s.newLoopContext.parentBindingManager}}get nearestLoopContext(){return this.nearestBindingManager?.newLoopContext}get _index(){return this.binding.children.indexOf(this.#z)}get index(){if(this.binding?.loopable)return this._index;{const e=this.parentBindingManager?.newLoopContext;return e?.index??-1}}get name(){if(this.binding?.loopable)return this.binding.viewModelProperty.name;{const e=this.parentBindingManager?.newLoopContext;return e?.name??""}}get indexes(){if(this.binding?.loopable)return this.nearestLoopContext?.indexes.concat(this.index)??[this.index];{const e=this.parentBindingManager?.newLoopContext;return e?.indexes??[]}}get allIndexes(){if(void 0===this.binding)return[];const e=this.binding.loopable?this._index:-1,t=this.parentBindingManager.newLoopContext.allIndexes;return e>=0?t.concat(e):t}constructor(e){this.#z=e}find(e){let t=this;for(;void 0!==t;){if(t.name===e)return t;t=t.parentBindingManager.newLoopContext}}}class Me{static seq=0;#X;get id(){return this.#X}#z;get bindingManager(){return this.#z}#Y;get nodeProperty(){return this.#Y}#D;get viewModelProperty(){return this.#D}get component(){return this.#z.component}get loopContext(){return this.#z.loopContext}get newLoopContext(){return this.#z.newLoopContext}#ee=[];get children(){return this.#ee}get expandable(){return this.nodeProperty.expandable}get loopable(){return this.nodeProperty.loopable}get isSelectValue(){return this.nodeProperty.isSelectValue}constructor(e,t,s,n,i,r,a){this.#X=++Me.seq,this.#z=e,this.#Y=new n(this,t,s,a,e.component.filters.in),this.#D=new r(this,i,a,e.component.filters.out)}applyToNode(){const{component:e,nodeProperty:t,viewModelProperty:s}=this;if(!e.bindingSummary.updatedBindings.has(this))try{if(!t.applicable)return;const e=s.filteredValue??"";if(t.isSameValue(e))return;t.value=e}finally{e.bindingSummary.updatedBindings.add(this)}}applyToChildNodes(e){this.nodeProperty.applyToChildNodes(e)}applyToViewModel(){const{viewModelProperty:e,nodeProperty:t}=this;e.applicable&&(e.value=t.filteredValue)}execDefaultEventHandler(e){if(!this.component.bindingSummary.allBindings.has(this))return;e.stopPropagation();const t=new v(this.applyToViewModel,this,[]);this.component.updateSlot.addProcess(t)}#te;get defaultEventHandler(){var e;return void 0===this.#te&&(this.#te=(e=this,t=>e.execDefaultEventHandler(t))),this.#te}initialize(){this.nodeProperty.initialize(),this.viewModelProperty.initialize()}appendChild(e){this.expandable||d.raise("Binding.appendChild: not expandable");const t=this.children[this.children.length-1];this.children.push(e);const s=this.nodeProperty.node.parentNode,n=t?.lastNode??this.nodeProperty.node;s.insertBefore(e.fragment,n.nextSibling??null)}replaceChild(e,t){this.expandable||d.raise("Binding.replaceChild: not expandable");const s=this.children[e-1];this.children[e]=t;const n=this.nodeProperty.node.parentNode,i=s?.lastNode??this.nodeProperty.node;n.insertBefore(t.fragment,i.nextSibling??null)}static create(e,t,s,n,i,r,a){const o=new Me(e,t,s,n,i,r,a);return o.initialize(),o}}class Se{#g;get component(){return this.#g}#se=[];get bindings(){return this.#se}#ne=[];get nodes(){return this.#ne}get lastNode(){return this.#ne[this.#ne.length-1]}#ie;get fragment(){return this.#ie}#re;get loopContext(){return this.#re??this.#ae?.loopContext}get thisLoopContext(){return this.#re}#oe;get newLoopContext(){return this.#oe}#le;get template(){return this.#le}#ae;get parentBinding(){return this.#ae}set parentBinding(e){this.#ae=e}constructor(e,t,s,n){this.#ae=s,this.#re=n?new Ce(this,n.name,n.index):void 0,this.#g=e,this.#le=t,this.#oe=new Be(this)}initialize(){const e=document.importNode(this.#le.content,!0),t=_.getTargetNodes(this.#le,e);this.#se=Pe.bind(this,t),this.#ne=Array.from(e.childNodes),this.#ie=e}registBindingsToSummary(){this.#se.forEach((e=>this.#g.bindingSummary.add(e)))}applyToNode(){const e=new Set;for(const t of this.bindings)t.isSelectValue?e.add(t):t.applyToNode();for(const t of e)t.applyToNode()}applyToViewModel(){this.bindings.forEach((e=>e.applyToViewModel()))}removeNodes(){this.#ne.forEach((e=>this.fragment.appendChild(e)))}dispose(){Ne.dispose(this)}postUpdateIndexForLoopContext(){for(const e of this.#se)for(const t of e.children)t.postUpdateIndexForLoopContext()}replaceLoopContext(e){this.#re=e?new Ce(this,e.name,e.index):void 0}static updateNode(e,t){const{bindingSummary:s}=e.component;s.updatedBindings.clear();const n=Array.from(s.expandableBindings);n.sort(((e,t)=>{const s=e.viewModelProperty.propertyName.level-t.viewModelProperty.propertyName.level;if(0!==s)return s;return e.viewModelProperty.propertyName.pathNames.length-t.viewModelProperty.propertyName.pathNames.length}));for(const e of n)t.has(e.viewModelProperty.key)&&e.applyToNode();s.flush();const i=new Map;for(const e of t.values()){if("*"!==e.propName.lastPathName)continue;const t=e.indexes?.at(-1);if(void 0===t)continue;const s=e.propName.parentPath+"\t"+e.indexes.slice(0,e.indexes.length-1);i.get(s)?.add(t)??i.set(s,new Set([t]))}for(const[e,t]of i.entries()){const n=s.bindingsByKey.get(e)??new Set;for(const e of n)s.updatedBindings.has(e)||e.expandable&&e.applyToChildNodes(t)}const r=new Set;for(const e of t.keys())for(const t of s.bindingsByKey.get(e)??new Set)t.expandable||(t.isSelectValue?r.add(t):t.applyToNode());for(const e of r)e.applyToNode();for(const e of s.componentBindings)e.nodeProperty.postUpdate(t)}static create(e,t,s,n){return Ne.create(e,t,s,n)}}class Ee{#de=new Set;#ce=new Map;get setOfPropsByRefProp(){return this.#ce}hasDefaultProp(e){return this.#de.has(e)}addDefaultProp(e){let t=r.create(e);for(;""!==t.parentPath;){const e=r.create(t.parentPath);this.#de.has(t.name)||(this.#ce.get(e.name)?.add(t.name)??this.#ce.set(e.name,new Set([t.name])),this.#de.add(t.name)),t=e}}setDependentProps(e){for(const[t,s]of Object.entries(e))for(const e of s)this.#ce.get(e)?.add(t)??this.#ce.set(e,new Set([t]))}}const Te={[o.connectedCallback]:"$connectedCallback",[o.disconnectedCallback]:"$disconnectedCallback",[o.writeCallback]:"$writeCallback"},Ae=new Set([o.connectedCallback,o.disconnectedCallback,o.writeCallback]);class Le{static get(e,t,s,n){const i=Te[n],r=(...s)=>async()=>Reflect.apply(e[i],t,s);return n===o.connectedCallback?i in e?(...e)=>r(...e)():()=>{}:i in e?(...e)=>s.addProcess(r(...e),t,[]):()=>{}}static has(e){return Ae.has(e)}}const Oe=new Set([o.directlyCall,o.getDependentProps,o.notifyForDependentProps,o.clearCache]),Ie={[o.directlyCall]:({viewModel:e,viewModelProxy:t,handler:s})=>async(n,i,r)=>s.directlyCallback(i,(async()=>Reflect.apply(e[n],t,[r,...i?.allIndexes??[]]))),[o.notifyForDependentProps]:({viewModel:e,viewModelProxy:t,handler:s})=>(n,i)=>s.addNotify(e,{propName:r.create(n),indexes:i},t),[o.getDependentProps]:({handler:e})=>()=>e.dependentProps,[o.clearCache]:({handler:e})=>()=>e.cache.clear()};class ke{static get(e,t,s,n){return Ie[n]?.({viewModel:e,viewModelProxy:t,handler:s})}static has(e){return Oe.has(e)}}const $e="$globals",_e="$dependentProps",Re="$component",Ve=new Set([$e,_e,Re]),Fe={[$e]:({component:e})=>e.globals,[_e]:({viewModel:e})=>e[_e],[Re]:({component:e})=>e};class Ue{static get(e,t,s){return Fe[s]?.({component:e,viewModel:t})}static has(e){return Ve.has(e)}}class De{#pe=new Map;get(e,t){return this.#pe.get(e)?.get(t.toString())??void 0}set(e,t,s){return this.#pe.get(e)?.set(t.toString(),s)??this.#pe.set(e,new Map([[t.toString(),s]])),s}clear(){this.#pe.clear()}}class We extends P{#he=new De;get cache(){return this.#he}getByPropertyName(e,{propName:t},s){if(t.isPrimitive||!this.dependentProps.hasDefaultProp(t.name)&&this.dependentProps.addDefaultProp(t.name),Ue.has(t.name))return Ue.get(this.component,e,t.name);if(!t.isPrimitive||this.setOfAccessorProperties.has(t.name)){const n=t.level>0?this.lastIndexes.slice(0,t.level):[];let i=this.#he.get(t,n);return void 0===i&&(i=super.getByPropertyName(e,{propName:t},s),this.#he.set(t,n,i)),i}return super.getByPropertyName(e,{propName:t},s)}setByPropertyName(e,{propName:t,value:s},n){d.raise("ReadOnlyViewModelHandler: viewModel is read only")}get(e,t,s){return Le.has(t)?Le.get(e,s,this,t):ke.has(t)?ke.get(e,s,this,t):super.get(e,t,s)}set(e,t,s,n){d.raise("ReadOnlyViewModelHandler: viewModel is read only")}}class Ke{static getDescByName(e){const t=new Map;let s=e;for(;s!==Object.prototype;){const e=Object.getOwnPropertyDescriptors(s);for(const[s,n]of Object.entries(e))t.has(s)||t.set(s,n);s=Object.getPrototypeOf(s)}return t}static getMethods(e,t){return e.filter((([e,s])=>s.value!==t&&"function"==typeof s.value))}static getProperties(e,t){return e.filter((([e,s])=>s.value!==t&&"function"!=typeof s.value))}static viewModelize(e){let t=this.viewModelInfoByConstructor.get(e.constructor);if(!t){const s=this.getDescByName(e),n=Array.from(s.entries()),i=[],a=[],o=[],l=this.getMethods(n,e.constructor).map((([e,t])=>e));this.getProperties(n,e.constructor).forEach((([e,t])=>{a.push(e);r.create(e).isPrimitive||"value"in t&&void 0===t.value&&i.push(e),"get"in t&&void 0!==t.get&&o.push(e)})),t={removeProps:i,definedProps:a,methods:l,accessorProps:o},this.viewModelInfoByConstructor.set(e.constructor,t)}return t.removeProps.forEach((t=>Reflect.deleteProperty(e,t))),{definedProps:t.definedProps,methods:t.methods,accessorProps:t.accessorProps,viewModel:e}}static viewModelInfoByConstructor=new Map}class je{#oe;get newLoopContext(){return this.#oe}async callback(e,t){void 0!==this.#oe&&d.raise("DirectlyCallContext: already set newLoopContext"),this.#oe=e;try{return await t()}finally{this.#oe=void 0}}}class He extends P{#ue=new je;getByPropertyName(e,{propName:t},s){return t.isPrimitive||!this.dependentProps.hasDefaultProp(t.name)&&this.dependentProps.addDefaultProp(t.name),Ue.has(t.name)?Ue.get(this.component,e,t.name):super.getByPropertyName(e,{propName:t},s)}setByPropertyName(e,{propName:t,value:s},n){t.isPrimitive||!this.dependentProps.hasDefaultProp(t.name)&&this.dependentProps.addDefaultProp(t.name);const i=super.setByPropertyName(e,{propName:t,value:s},n),r=this.lastIndexes;return n[o.writeCallback](t.name,r),this.addNotify(e,{propName:t,indexes:r},n),i}async directlyCallback(e,t){return this.#ue.callback(e,(async()=>{this.stackIndexes.push(void 0);try{return await t()}finally{this.stackIndexes.pop()}}))}findLoopContext(e){if(void 0===this.#ue.newLoopContext)return;if("string"!=typeof e||e.startsWith("@@__")||"constructor"===e)return;const t=r.create(e);if(0===t.level||"@"===e.at(0))return;const s=this.#ue.newLoopContext.find(t.nearestWildcardParentName);return void 0===s&&d.raise(`WritableViewModelHandler: ${e} is outside loop`),s}get(e,t,s){if(Le.has(t))return Le.get(e,s,this,t);if(ke.has(t))return ke.get(e,s,this,t);{const n=this.findLoopContext(t);return void 0!==n?this.directlyGet(e,{prop:t,indexes:n.allIndexes},s):super.get(e,t,s)}}set(e,t,s,n){const i=this.findLoopContext(t);return void 0!==i?this.directlySet(e,{prop:t,indexes:i.allIndexes,value:s},n):super.set(e,t,s,n)}}const ze="$dependentProps";class qe{#me=new Map;get bindingsByKey(){return this.#me}#ge=new Set;get expandableBindings(){return this.#ge}#fe=new Set;get componentBindings(){return this.#fe}#ye=new Set;#be=new Set;get allBindings(){return this.#be}#xe=new Set;get updatedBindings(){return this.#xe}add(e){if(this.#ye.has(e))return void this.#ye.delete(e);const t=e.viewModelProperty.oldKey,s=e.viewModelProperty.getKey();if(console.log("add",e.id,s,t),void 0!==t&&t!==s)return console.log("change key",e.id,s,t),this.#me.get(t)?.delete(e),void(this.#me.get(s)?.add(e)??this.#me.set(s,new Set([e])));this.#be.add(e),this.#me.get(s)?.add(e)??this.#me.set(s,new Set([e])),e.nodeProperty.expandable&&this.#ge.add(e),e.nodeProperty.constructor===ne&&this.#fe.add(e)}delete(e){console.log("delete",e.id),this.#ye.add(e)}#ve(e){console.log("#delete",e.id,e.viewModelProperty.oldKey),this.#be.delete(e),this.#me.get(e.viewModelProperty.oldKey)?.delete(e),this.#ge.delete(e),this.#fe.delete(e)}flush(){console.log("flush");const e=this.#be.size-this.#ye.size;if(this.#ye.size>10*e){const e=Array.from(this.#be).filter((e=>!this.#ye.has(e)));this.rebuild(e)}else for(const e of this.#ye)this.#ve(e);for(const e of this.#be)if(e.viewModelProperty.isChagedKey){this.#me.get(e.viewModelProperty.oldKey)?.delete(e);const t=e.viewModelProperty.getKey();this.#me.get(t)?.add(e)??this.#me.set(t,new Set([e]))}this.#ye=new Set}rebuild(e){this.#be=new Set(e);const t=Map.groupBy(e,(e=>e.viewModelProperty.key));this.#me=new Map(Array.from(t.entries()).map((([e,t])=>[e,new Set(t)]))),this.#ge=new Set(e.filter((e=>e.nodeProperty.expandable))),this.#fe=new Set(e.filter((e=>e.nodeProperty.constructor===ne))),this.#ye=new Set}}const Ge=new WeakMap,Ze={get baseViewModel(){return this._viewModels.base},get writableViewModel(){return this._viewModels.writable},get readOnlyViewModel(){return this._viewModels.readonly},get viewModel(){return void 0===this.updateSlot||this.updateSlot.phase!==M?this.writableViewModel:this.readOnlyViewModel},get rootBinding(){return this._rootBinding},set rootBinding(e){this._rootBinding=e},get thread(){return this._thread},set thread(e){this._thread=e},get updateSlot(){if(void 0!==this._thread)return void 0===this._updateSlot&&(this._updateSlot=E.create(this,(()=>{this._updateSlot=void 0}),(e=>{e===M&&this.viewModel[o.clearCache]()})),this.thread.wakeup(this._updateSlot)),this._updateSlot},set updateSlot(e){this._updateSlot=e},get props(){return this._props},set props(e){for(const[t,s]of Object.entries(e))this._props[t]=s},get globals(){return this._globals},get initialPromises(){return this._initialPromises},get alivePromises(){return this._alivePromises},set alivePromises(e){this._alivePromises=e},get parentComponent(){return void 0===this._parentComponent&&(this._parentComponent=(e=>{for(;;){if(null==(e=e.parentNode))return null;if(e.constructor[o.isComponent])return e;if(e instanceof ShadowRoot){if(e.host.constructor[o.isComponent])return e.host;e=e.host}const t=Ge.get(e);if(void 0!==t)return t}})(this)),this._parentComponent},get useShadowRoot(){return this._useShadowRoot},get useWebComponent(){return this._useWebComponent},get useLocalTagName(){return this._useLocalTagName},get useKeyed(){return this._useKeyed},get useBufferedBind(){return this._useBufferedBind},get viewRootElement(){return this.useWebComponent?this.shadowRoot??this:this.pseudoParentNode},get pseudoParentNode(){return this.useWebComponent?d.raise("mixInComponent: useWebComponent must be false"):this._pseudoParentNode},get pseudoNode(){return this._pseudoNode},get filters(){return this._filters},get bindingSummary(){return this._bindingSummary},initialize({useWebComponent:e,useShadowRoot:t,useLocalTagName:s,useKeyed:n,useBufferedBind:i}){this._viewModels=function(e,t){const s=Ke.viewModelize(Reflect.construct(t,[])),{viewModel:n,accessorProps:i}=s,r=new Set(i),a=new Ee;return a.setDependentProps(n[ze]??{}),{readonly:new Proxy(n,new We(e,r,a)),writable:new Proxy(n,new He(e,r,a)),base:n}}(this,this.constructor.ViewModel),this._rootBinding=void 0,this._thread=void 0,this._updateSlot=void 0,this._props=new Proxy({},new m(this)),this._globals=function(e){return new Proxy({},new y(e))}(),this._initialPromises=void 0,this._alivePromises=void 0,this._parentComponent=void 0,this._useShadowRoot=t,this._useWebComponent=e,this._useLocalTagName=s,this._useKeyed=n,this._useBufferedBind=i,this._pseudoParentNode=void 0,this._pseudoNode=void 0,this._filters={in:class extends k{},out:class extends I{}},this._bindingSummary=new qe,this._initialPromises=Promise.withResolvers()},async build(){const{template:e,inputFilters:t,outputFilters:s}=this.constructor;if(void 0!==t)for(const[e,s]of Object.entries(t))e in this.filters.in&&d.raise(`mixInComponent: already exists filter ${e}`),this.filters.in[e]=s;if(void 0!==s)for(const[e,t]of Object.entries(s))e in this.filters.out&&d.raise(`mixInComponent: already exists filter ${e}`),this.filters.out[e]=t;T.isAttachable(this.tagName.toLowerCase())&&this.useShadowRoot&&this.useWebComponent&&this.attachShadow({mode:"open"}),this.thread=new x,await this.viewModel[o.connectedCallback](),this.rootBinding=Se.create(this,e),this.rootBinding.registBindingsToSummary(),this.rootBinding.applyToNode(),this.bindingSummary.flush(),this.useWebComponent?this.viewRootElement.appendChild(this.rootBinding.fragment):(this.viewRootElement.insertBefore(this.rootBinding.fragment,this.pseudoNode.nextSibling),this.rootBinding.nodes.forEach((e=>Ge.set(e,this)))),this.updateSlot.isEmpty&&this.updateSlot.waitPromises.resolve(!0),await this.updateSlot.alivePromises.promise},async connectedCallback(){try{if(this.parentComponent&&await this.parentComponent.initialPromises.promise,!this.useWebComponent){const e=document.createComment(`@@/${this.tagName}`);this._pseudoParentNode=this.parentNode,this._pseudoNode=e,this.pseudoParentNode.replaceChild(e,this)}this.alivePromises=Promise.withResolvers(),await this.build()}finally{this.initialPromises?.resolve&&this.initialPromises.resolve()}},disconnectedCallback(){this.alivePromises?.resolve&&this.alivePromises.resolve(this.props[o.toObject]())},updateNode(e){this.rootBinding&&Se.updateNode(this.rootBinding,e)},async popup(e,t=!0){this instanceof HTMLDialogElement||d.raise("mixInComponent: popup is only for HTMLDialogElement"),this.returnValue="";const s=Promise.withResolvers(),n=new CustomEvent("closed");return this.addEventListener("closed",(()=>{""===this.returnValue?s.reject():s.resolve(this.props[o.toObject]())})),this.addEventListener("close",(()=>{this.dispatchEvent(n)})),this.props=e,t?this.showModal():this.show(),s.promise}};class Je{static generate(e){const t=Object.assign(new u,e),s=function(e){return class extends HTMLElement{static template=e.template;static ViewModel=e.ViewModel;static inputFilters=e.inputFilters;static outputFilters=e.outputFilters;static useShadowRoot=e.useShadowRoot??l.useShadowRoot;static useWebComponent=e.useWebComponent??l.useWebComponent;static useLocalTagName=e.useLocalTagName??l.useLocalTagName;static useKeyed=e.useKeyed??l.useKeyed;static useBufferedBind=e.useBufferedBind??l.useBufferedBind;static get[o.isComponent](){return!0}constructor(){super();const e={},t=(e,t,s)=>{this.hasAttribute(e)?s[t]=!0:this.hasAttribute("no-"+e)?s[t]=!1:s[t]=this.constructor[t]};t("shadow-root","useShadowRoot",e),t("web-component","useWebComponent",e),t("local-tag-name","useLocalTagName",e),t("keyed","useKeyed",e),t("buffered-bind","useBufferedBind",e),this.initialize(e)}}}(t);if(void 0===t.extendTag);else{const e=document.createElement(t.extendTag).constructor;s.prototype.__proto__=e.prototype,s.__proto__=e}for(let[e,t]of Object.entries(Object.getOwnPropertyDescriptors(Ze)))Object.defineProperty(s.prototype,e,t);return Ye(t.componentModulesForRegist),s}}function Qe(e){return Je.generate(e)}function Xe(e,t){const s=d.toKebabCase(e),n=Je.generate(t);void 0===t.extendTag?customElements.define(s,n):customElements.define(s,n,{extends:t.extendTag})}function Ye(e){for(const[t,s]of Object.entries(e??{}))Xe(t,s)}class et{static regist(e,t){}}class tt{static toKebabCase=e=>"string"==typeof e?e.replaceAll(/[\._]/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e}const st="kebab",nt="snake",it="uppercamel",rt="lowercamel",at="dotted";class ot{static getNames(e){const t=tt.toKebabCase(e),s=t.replaceAll("-","_"),n=t.replaceAll("-","."),i=t.split("-").map(((e,t)=>(void 0!==e[0]&&(e=e[0].toUpperCase()+e.slice(1)),e))).join(""),r=i.length>0?i[0].toLowerCase()+i.slice(1):i;return{[st]:t,[nt]:s,[it]:i,[rt]:r,[at]:n}}}const lt=rt;class dt{defaultNameType=lt;defaultPath="./";loadNames=[];prefixMap}class ct{prefix;path;get matchPrefix(){return`${this.prefix}-`}isMatch(e){return e.startsWith(this.matchPrefix)}getNames(e){const{prefix:t,path:s}=this;if(e.startsWith(this.matchPrefix)){return{prefixName:t,subName:e.slice(this.matchPrefix.length),path:s}}}}const pt=ot.getNames("prefix-name"),ht=ot.getNames("sub-name");class ut{static getPathInfo(e,t,s,n){const[i,r]=e.split("#");let a=i,o=r;const l=ot.getNames(t),d=ot.getNames(s);return a=a.replaceAll(`{${pt[st]}}`,l[st]),a=a.replaceAll(`{${pt[nt]}}`,l[nt]),a=a.replaceAll(`{${pt[rt]}}`,l[rt]),a=a.replaceAll(`{${pt[it]}}`,l[it]),a=a.replaceAll(`{${pt[at]}}`,l[at]),a=a.replaceAll(`{${ht[st]}}`,d[st]),a=a.replaceAll(`{${ht[nt]}}`,d[nt]),a=a.replaceAll(`{${ht[rt]}}`,d[rt]),a=a.replaceAll(`{${ht[it]}}`,d[it]),a=a.replaceAll(`{${ht[at]}}`,d[at]),i===a&&".js"!==a.slice(-3)&&(a=a+("/"!==e.slice(-1)?"/":"")+d[n]+".js"),o&&(o=o.replaceAll(`{${ht[st]}}`,d[st]),o=o.replaceAll(`{${ht[nt]}}`,d[nt]),o=o.replaceAll(`{${ht[rt]}}`,d[rt]),o=o.replaceAll(`{${ht[it]}}`,d[it]),o=o.replaceAll(`{${ht[at]}}`,d[at])),{filePath:a,exportName:o}}}class mt{#we;#Pe;#Ne;#Ce;#Be;constructor(e){this.#Ce=e,this.#Be=window.location,this.setConfig(new dt)}setConfig(e){this.#Pe=Object.assign(new dt,e),"prefixMap"in e&&void 0!==e.prefixMap&&this.setPrefixMap(e.prefixMap)}getConfig(){return this.#Pe}setPrefixMap(e){this.#Ne=new Map(Object.entries(e).map((([e,t])=>[e=tt.toKebabCase(e),Object.assign(new ct,{prefix:e,path:t})])))}getPrefixMap(){return this.#Ne}configFile(e){return this.#we=e,this}config(e){return this.setConfig(e),this}prefixMap(e){return this.setPrefixMap(e),this}get registrar(){return this.#Ce}async loadConfig(e){const t=this.#Be.pathname.split("/");t[t.length-1]=e;const s=this.#Be.origin+t.join("/");try{const e=await fetch(s),t=await e.json();return Object.assign(new dt,t)}catch(e){throw new Error(e)}}async load(...e){if(void 0!==this.#we){const e=await this.loadConfig(this.#we);this.setConfig(e)}if(void 0===this.#Ne)throw new Error("prefixMap is not defined");if(void 0===this.#Ce)throw new Error("registrar is not defined");const t=Array.from(this.#Ne.values()),{defaultNameType:s,defaultPath:n}=this.#Pe;e=e.length>0?e:this.#Pe.loadNames;for(let i of e){let e;i=tt.toKebabCase(i);const r=t.find((e=>e.isMatch(i)));if(void 0!==r){const t=r.getNames(i);e=ut.getPathInfo(t.path,t.prefixName,t.subName,s)}if(void 0===e&&void 0!==n&&(e=ut.getPathInfo(n,"",i,s)),void 0===e)throw new Error(`unmatch prefix and no defaultPath (loadName:${i})`);const a=this.#Be.pathname.split("/");a[a.length-1]=e.filePath;const o=this.#Be.origin+a.join("/");let l,d;try{l=await import(o)}catch(e){throw new Error(e)}if(void 0!==e.exportName){if(!(e.exportName in l))throw new Error(`${e.exportName} not found in module (exportName:${e.exportName}, ${e.filePath})`);d=l[e.exportName]}else d=l.default;this.#Ce.regist(i,d)}return this}static create(e){return new mt(e)}}const gt="filter-";const ft=mt.create(class extends et{static regist(e,t){if(e.startsWith(gt)){const s=e.slice(gt.length),{output:n,input:i}=t;R.regist(s,n,i)}else Xe(e,t)}});function yt(e){Object.entries(e).forEach((([e,t])=>{const{input:s,output:n}=t;R.regist(e,n,s)}))}function bt(e){Object.assign(f.data,e)}export{l as config,Qe as generateComponentClass,ft as loader,Ye as registComponentModules,yt as registFilters,bt as registGlobal};
