const e="quel",t="*",s="dot-notation",i={directlyGet:Symbol.for(s+".direct_get"),directlySet:Symbol.for(s+".direct_set"),isSupportDotNotation:Symbol.for(s+".is_support_dot_notation")},n=new RegExp(/^\$([0-9]+)$/);class r{#e;get name(){return this.#e}#t;get pathNames(){return this.#t}#s;get parentPathNames(){return this.#s}#i;get parentPath(){return this.#i}#n;get parentPaths(){return this.#n}#r;get setOfParentPaths(){return this.#r}#a;get lastPathName(){return this.#a}#o;get regexp(){return this.#o}#l;get level(){return this.#l}#c;get isPrimitive(){return this.#c}#d;get nearestWildcardName(){return this.#d}#h;get nearestWildcardParentName(){return this.#h}constructor(e){if(this.#e=e,this.#t=e.split("."),this.#s=this.#t.slice(0,-1),this.#n=this.#s.reduce(((e,t)=>(e.push(e.at(-1)?.concat(t)??[t]),e)),[]).map((e=>e.join("."))),this.#r=new Set(this.#n),this.#i=this.#s.join("."),this.#a=this.#t.at(-1),this.#o=new RegExp("^"+e.replaceAll(".","\\.").replaceAll("*","([0-9a-zA-Z_]*)")+"$"),this.#l=this.#t.reduce(((e,s)=>e+(s===t?1:0)),0),this.#c=1===this.#t.length,this.#d=void 0,this.#h=void 0,this.#l>0)for(let e=this.#t.length-1;e>=0;e--)if(this.#t[e]===t){this.#d=this.#t.slice(0,e+1).join("."),this.#h=this.#t.slice(0,e).join(".");break}}static create(e){const t=this.propertyNameByName.get(e);if(void 0!==t)return t;const s=new r(e);return this.propertyNameByName.set(e,s),s}static propertyNameByName=new Map;static parse(e){const t=[],s=[];for(const i of e.split(".")){const e=Number(i);isNaN(e)?s.push(i):(t.push(e),s.push("*"))}return{propName:r.create(s.join(".")),indexes:t}}}let a=class{#p=[];#u=new Map;get lastIndexes(){return this.#p[this.#p.length-1]}get stackIndexes(){return this.#p}get matchByName(){return this.#u}getByPropertyName(e,{propName:s},i){let n;if(Reflect.has(e,s.name))n=Reflect.get(e,s.name,i);else if(""!==s.parentPath){const a=r.create(s.parentPath),o=this.getByPropertyName(e,{propName:a},i);if(void 0!==o){const e=s.lastPathName===t?this.lastIndexes[s.level-1]:s.lastPathName;n=Reflect.get(o,e)}}return n}setByPropertyName(e,{propName:s,value:i},n){let a=!1;if(Reflect.has(e,s.name)||s.isPrimitive)a=Reflect.set(e,s.name,i,n);else{const o=r.create(s.parentPath),l=this.getByPropertyName(e,{propName:o},n);if(void 0!==l){const e=s.lastPathName===t?this.lastIndexes[s.level-1]:s.lastPathName;a=Reflect.set(l,e,i)}}return a}pushIndexes(e,t){this.#p.push(e);try{return Reflect.apply(t,this,[])}finally{this.#p.pop()}}getFunc=(e,t)=>({propName:s,indexes:i})=>this.pushIndexes(i,(()=>this.getByPropertyName(e,{propName:s},t)));setFunc=(e,t)=>({propName:s,indexes:i},n)=>this.pushIndexes(i,(()=>this.setByPropertyName(e,{propName:s,value:n},t)));getExpandLastLevel(e,{propName:t,indexes:s},i){const n=this.getFunc(e,i);if(void 0===t.nearestWildcardName)throw new Error(`not found wildcard path of '${t.name}'`);const a=r.create(t.nearestWildcardParentName);return n({propName:a,indexes:s}).map(((e,i)=>n({propName:t,indexes:s.concat(i)})))}setExpandLastLevel(e,{propName:t,indexes:s,values:i},n){const a=this.getFunc(e,n),o=this.setFunc(e,n);if(void 0===t.nearestWildcardName)throw new Error(`not found wildcard path of '${t.name}'`);const l=r.create(t.nearestWildcardParentName),c=a({propName:l,indexes:s}),d=Array.isArray(i)?i:[...Array(c.length)].map((e=>i));if(t.nearestWildcardName===t.name)o({propName:l,indexes:s},d);else{if(d.length!==c.length)throw new Error(`not match array count '${t.name}'`);for(let e in c)o({propName:t,indexes:s.concat(Number(e))},d[e])}return!0}directlyGet(e,{prop:t,indexes:s},i){const n=r.create(t);return this.pushIndexes(s,(()=>this.getByPropertyName(e,{propName:n},i)))}directlySet(e,{prop:t,indexes:s,value:i},n){const a=r.create(t);return this.pushIndexes(s,(()=>this.setByPropertyName(e,{propName:a,value:i},n)))}get(e,t,s){const a="string"==typeof t;if(a&&(t.startsWith("@@__")||"constructor"===t))return Reflect.get(e,t,s);const o=this.getFunc(e,s),l=this.lastIndexes;let c;if(t===i.directlyGet)return(t,i)=>Reflect.apply(this.directlyGet,this,[e,{prop:t,indexes:i},s]);if(t===i.directlySet)return(t,i,n)=>Reflect.apply(this.directlySet,this,[e,{prop:t,indexes:i,value:n},s]);if(t===i.isSupportDotNotation)return!0;if(a){if(c=n.exec(t))return l?.[Number(c[1])-1]??void 0;if("@"===t.at(0)){const i=t.slice(1),n=r.create(i);if((l?.length??0)+1<n.level)throw new Error("array level not match");const a=l?.slice(0,n.level-1)??[];return this.getExpandLastLevel(e,{propName:n,indexes:a},s)}if(this.#u.has(t))return o(this.#u.get(t));const i=r.parse(t);return i.propName.level===i.indexes.length?(this.#u.set(t,i),o(i)):o({propName:i.propName,indexes:i.indexes.concat(l?.slice(i.indexes.length)??[])})}return Reflect.get(e,t,s)}set(e,t,s,i){if("string"==typeof t){if(t.startsWith("@@__")||"constructor"===t)return Reflect.set(e,t,s,i);const n=this.setFunc(e,i),a=this.lastIndexes;if("@"===t.at(0)){const n=t.slice(1),a=r.create(n);if((this.lastIndexes?.length??0)+1<a.level)throw new Error("array level not match");const o=this.lastIndexes?.slice(0,a.level-1)??[];return this.setExpandLastLevel(e,{propName:a,indexes:o,values:s},i)}if(this.#u.has(t))return n(this.#u.get(t),s);const o=r.parse(t);return o.propName.level===o.indexes.length?(this.#u.set(t,o),n(o,s)):n({propName:o.propName,indexes:o.indexes.concat(a?.slice(o.indexes.length)??[])},s)}return Reflect.set(e,t,s,i)}};const o=Object.assign({connectedCallback:Symbol.for(`${e}:viewModel.connectedCallback`),disconnectedCallback:Symbol.for(`${e}:viewModel.disconnectedCallback`),writeCallback:Symbol.for(`${e}:viewModel.writeCallback`),getDependentProps:Symbol.for(`${e}:viewModel.getDependentProps`),clearCache:Symbol.for(`${e}:viewModel.clearCache`),directlyCall:Symbol.for(`${e}:viewModel.directCall`),notifyForDependentProps:Symbol.for(`${e}:viewModel.notifyForDependentProps`),boundByComponent:Symbol.for(`${e}:globalData.boundByComponent`),bindTo:Symbol.for(`${e}:componentModule.bindTo`),bindProperty:Symbol.for(`${e}:props.bindProperty`),toObject:Symbol.for(`${e}:props.toObject`),isComponent:Symbol.for(`${e}:component.isComponent`)},i);let l=class{static raise(e){throw new Error(e)}static isFunction=e=>{const t=Object.prototype.toString.call(e).slice(8,-1).toLowerCase();return"function"===t||"asyncfunction"===t};static isInputableElement(e){return e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&"button"!==e.type}static toKebabCase=e=>"string"==typeof e?e.replaceAll(/_/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e;static createUUID(){return window?.crypto?.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=((new Date).getTime()+16*Math.random())%16|0;return("x"==e?t:3&t|8).toString(16)}))}};class c{static templateByUUID=new Map}const d="data-bind";class h{static create(e,t,s,i){const n=document.createElement("template");return n.innerHTML=(t?`<style>\n${t}\n</style>`:"")+(e?this.replaceTag(e,s,i):""),n}static replaceTag(e,t,s){const i=[],n=e.replaceAll(/\{\{([^\}]+)\}\}/g,((e,t)=>{if((t=t.trim()).startsWith("loop:")||t.startsWith("if:"))return i.push(t),`<template data-bind="${t}">`;if(t.startsWith("else:")){return`</template><template data-bind="${i.at(-1)}|not">`}return t.startsWith("end:")?(i.pop(),"</template>"):`\x3c!--@@:${t}--\x3e`})),r=document.createElement("template");r.innerHTML=n;const a=s.map((e=>l.toKebabCase(e))),o=e=>{for(const s of a){const i=Array.from(e.querySelectorAll(s));for(const e of i){const i=document.createElement(`${s}-${t}`);if(e.hasAttributes){for(const t of e.attributes)i.setAttribute(t.name,t.value);i.setAttribute("data-orig-tag-name",s)}e.parentNode.replaceChild(i,e)}const n=Array.from(e.querySelectorAll(`[is="${s}"]`));for(const e of n){const i=document.createElement(e.tagName,{is:`${s}-${t}`});if(e.hasAttributes){for(const t of e.attributes)"is"!==t.name&&i.setAttribute(t.name,t.value);i.setAttribute("data-orig-is",s)}e.parentNode.replaceChild(i,e)}}const s=Array.from(e.querySelectorAll("template"));for(const e of s)o(e.content)};a.length>0&&o(r.content);const h=e=>{let t;for(;t=e.querySelector("template");){const e=l.createUUID(),s=document.createComment(`@@|${e}`);if(t.parentNode.replaceChild(s,t),t.constructor!==HTMLTemplateElement){const e=document.createElement("template");for(let s of Array.from(t.childNodes))e.content.appendChild(s);e.setAttribute(d,t.getAttribute(d)),t=e}t.setAttribute("data-uuid",e),h(t.content),c.templateByUUID.set(e,t)}};return h(r.content),r.innerHTML}}class p{#m=l.createUUID();get uuid(){return this.#m}html;css;get template(){const e=this.useTagNamespace?Object.keys(this.componentModules??{}):[];return h.create(this.html,this.css,this.uuid,e)}ViewModel;extendClass;extendTag;usePseudo=!1;useShadowRoot=!1;useTagNamespace=!0;useKeyed;inputFilters;outputFilters;componentModules;get componentModulesForRegist(){if(this.useTagNamespace){const e={};if(void 0!==this.componentModules){for(const[t,s]of Object.entries(this.componentModules??{}))e[`${l.toKebabCase(t)}-${this.uuid}`]=s;return e}}return this.componentModules}}let u=class{#g;#f=new Map;#y=new Proxy({},new a);get hasParent(){return null!=this.#g?.parentComponent?.viewModel}get data(){return this.hasParent?this.#g.parentComponent.viewModel:this.#y}get object(){const e={};if(this.hasParent){const t=this.#g.parentComponent.viewModel;for(const[s,i]of this.#f.entries()){const{name:n,indexes:r}=i;e[s]=t[o.directlyGet](n,r)}}else for(const[t,s]of Object.entries(this.#y))e[t]=s;return e}constructor(e){this.#g=e}get(e,t,s){if(t===o.bindProperty)return(e,t)=>this.#f.set(e,t);if(t===o.toObject)return()=>this.object;const{data:i}=this;if(this.hasParent){const{name:e,indexes:s}=this.#f.get(t)??{};return e?i[o.directlyGet](e,s):void console.error(`undefined property ${t}`)}return Reflect.get(i,t)}set(e,t,s,i){const{data:n}=this;if(this.hasParent){const{name:e,indexes:i}=this.#f.get(t)??{};return e?n[o.directlySet](e,i,s):(console.error(`undefined property ${t}`),!1)}return Reflect.set(n,t,s)}};class m extends a{#v=new Map;get(e,t,s){return t===o.boundByComponent?(e,t)=>{let s=this.#v.get(t);null==s?this.#v.set(t,new Set([e])):s.add(e)}:super.get(e,t,s)}set(e,t,s,i){const{propName:n,indexes:a}=r.parse(t),l=i[o.directlySet](n.name,a,s);let c=this.#v.get(n.name);if(c)for(const e of c)e.viewModel[o.notifyForDependentProps]("$globals."+n.name,a);return l}}class g{static create(){return new Proxy({},new m)}static data=this.create()}class f{#g;setOfProps=new Set;constructor(e){this.#g=e}bindProperty(e){g.data[o.boundByComponent](this.#g,e),this.setOfProps.add(e)}directGet=(e,t)=>(this.setOfProps.has(e)||this.bindProperty(e),g.data[o.directlyGet](e,t));directSet=(e,t,s)=>(this.setOfProps.has(e)||this.bindProperty(e),g.data[o.directlySet](e,t,s));get(e,t,s){if(t===o.directlyGet)return this.directGet;if(t===o.directlySet)return this.directSet;if(t===o.isSupportDotNotation)return!0;const{propName:i,indexes:n}=r.parse(t);return this.directGet(i.name,n)}set(e,t,s,i){const{propName:n,indexes:a}=r.parse(t);return this.directSet(n.name,a,s)}}const y=new class{debug=!1;useKeyed=!1};class v extends Error{}class P{#P;#b;#x=!0;get alive(){return this.#x}constructor(){this.main()}async#w(){return new Promise(((e,t)=>{this.#P=e,this.#b=t}))}stop(){this.#b(new v("stop"))}wakeup(e){this.#P(e)}async main(){for(;;)try{const e=await this.#w();await e.waiting(),y.debug&&performance.mark("slot-exec:start");try{await e.exec(),y.debug&&(performance.mark("slot-exec:end"),performance.measure("slot-exec","slot-exec:start","slot-exec:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures(),performance.clearMarks())}finally{e.callback()}}catch(e){if(e instanceof v)break;if(console.error(e),!confirm("致命的なエラーが発生しました。続行しますか？"))break}this.#x=!1}}class b{queue=new Map;reorder(e){return e.sort(((e,t)=>e.isSelectValue&&t.isSelectValue?0:e.isSelectValue?1:t.isSelectValue?-1:0)),e}async exec(){for(;this.queue.size>0;){const e=this.reorder(Array.from(this.queue.keys()));for(const t of e)t.nodeProperty.assignValue(this.queue.get(t));this.queue=new Map}}get isEmpty(){return 0===this.queue.size}}class x{target;thisArgument;argumentsList;constructor(e,t,s){this.target=e,this.thisArgument=t,this.argumentsList=s}}class w{queue=[];async exec(){for(;this.queue.length>0;){const e=this.queue.splice(0);for(const t of e)await Reflect.apply(t.target,t.thisArgument,t.argumentsList)}}get isEmpty(){return 0===this.queue.length}}class N extends a{#g;get component(){return this.#g}#N;get dependentProps(){return this.#N}#C;get setOfAccessorProperties(){return this.#C}constructor(e,t,s){super(),this.#g=e,this.#C=t,this.#N=s}addProcess(e,t,s){this.#g.updateSlot?.addProcess(new x(e,t,s))}addNotify(e,t,s){this.#g.updateSlot?.addNotify(t)}static makeNotifyForDependentProps(e,t,s=new Set([])){const{propName:i,indexes:n}=t,a=i.name+"\t"+n.toString();if(s.has(a))return[];s.add(a);const l=e[o.getDependentProps]().setOfPropsByRefProp.get(i.name),c=[];if(void 0===l)return[];for(const t of l){const a=r.create(t);if(n.length<a.level){if(a.setOfParentPaths.has(i.name))continue;const t=N.expandIndexes(e,{propName:a,indexes:n});c.push(...t.map((e=>({propName:a,indexes:e}))))}else{const e=n.slice(0,a.level);c.push({propName:a,indexes:e})}c.push(...this.makeNotifyForDependentProps(e,{propName:a,indexes:n},s))}return c}static expandIndexes(e,t){const{propName:s,indexes:i}=t;if(s.level===i.length)return[i];if(s.level<i.length)return[i.slice(0,s.level)];{const t=(n,r,a)=>{const l=""!==n?n+".":n,c=s.pathNames[r],d=s.pathNames.length-1===r,h=l+c;let p;return p=d?"*"===c?e[o.directlyGet](n,a).flatMap(((e,t)=>[a.concat(t)])):[a]:"*"===c?a.length<i.length?t(h,r+1,i.slice(0,a.length+1)):e[o.directlyGet](n,a).flatMap(((e,s)=>t(h,r+1,a.concat(s)))):t(h,r+1,a),p};return t("",0,[])}}}class C{queue=[];#g;constructor(e){this.#g=e}async exec(){for(;this.queue.length>0;){const e=this.queue.splice(0),t=[];for(const s of e)t.push(...N.makeNotifyForDependentProps(this.#g.viewModel,s));const s=new Set(e.concat(t).map((e=>e.propName.name+"\t"+e.indexes.toString())));this.#g.updateNode(s)}}get isEmpty(){return 0===this.queue.length}}const M=0,S=1,B=2,E=3,A=100;class R{#M;get viewModelUpdator(){return this.#M}#S;get notifyReceiver(){return this.#S}#B;get nodeUpdator(){return this.#B}#E;#A;#R;#O;#k;#T;#$;#_;#I=M;get phase(){return this.#I}set phase(e){const t=this.#I;this.#I=e,void 0!==this.#_&&this.#_(e,t)}constructor(e,t=null,s=null){this.#M=new w,this.#S=new C(e),this.#B=new b,this.#E=t,this.#_=s,this.#A=new Promise(((e,t)=>{this.#O=e,this.#k=t})),this.#R=new Promise(((e,t)=>{this.#T=e,this.#$=t}))}async waiting(){return this.#A}waitResolve(e){this.#O(e)}waitReject(){this.#k()}async alive(){return this.#R}get isEmpty(){return this.#M.isEmpty&&this.#S.isEmpty&&this.#B.isEmpty}async exec(){do{this.phase=S,await this.#M.exec(),this.phase=B,await this.#S.exec(),this.phase=E,await this.#B.exec()}while(!this.#M.isEmpty||!this.#S.isEmpty||!this.#B.isEmpty);this.phase=A,this.#T()}async addProcess(e){this.#M.queue.push(e),this.#O(!0)}async addNotify(e){this.#S.queue.push(e),this.#O(!0)}async addNodeUpdate(e,t){this.#B.queue.set(e,t),this.#O(!0)}callback(){this.#E&&this.#E()}static create(e,t,s){return new R(e,t,s)}}class O{static setOfAttachableTags=new Set(["articles","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]);static isCustomTag(e){return-1!==e.indexOf("-")}static isAttachable(e){return this.isCustomTag(e)||this.setOfAttachableTags.has(e)}}const k=(e,t,s)=>{if(null==e)return e;const i=Number(e);return isNaN(i)?e:s(i,t)},T=(e,t,s)=>null==e?e:s(String(e),t),$=(e,t,s)=>Array.isArray(e)?s(e,t):e;class _{static styleDisplay=(e,t)=>e?t[0]??"":"none";static truthy=(e,t)=>!!e;static falsey=(e,t)=>!e;static not=this.falsey;static eq=(e,t)=>e==t[0];static ne=(e,t)=>e!=t[0];static lt=(e,t)=>Number(e)<Number(t[0]);static le=(e,t)=>Number(e)<=Number(t[0]);static gt=(e,t)=>Number(e)>Number(t[0]);static ge=(e,t)=>Number(e)>=Number(t[0]);static embed=(e,t)=>null!=e?decodeURIComponent((t[0]??"").replaceAll("%s",e)):null;static ifText=(e,t)=>e?t[0]??null:t[1]??null;static null=(e,t)=>null==e;static offset=(e,t)=>Number(e)+Number(t[0]);static unit=(e,t)=>String(e)+String(t[0]);static inc=this.offset;static mul=(e,t)=>Number(e)*Number(t[0]);static div=(e,t)=>Number(e)/Number(t[0]);static mod=(e,t)=>Number(e)%Number(t[0]);static"str.at"=(e,t)=>T(e,t,((e,t)=>e.at(...t)));static"str.charAt"=(e,t)=>T(e,t,((e,t)=>e.charAt(...t)));static"str.charCodeAt"=(e,t)=>T(e,t,((e,t)=>e.charCodeAt(...t)));static"str.codePointAt"=(e,t)=>T(e,t,((e,t)=>e.codePointAt(...t)));static"str.concat"=(e,t)=>T(e,t,((e,t)=>e.concat(...t)));static"str.endsWith"=(e,t)=>T(e,t,((e,t)=>e.endsWith(...t)));static"str.includes"=(e,t)=>T(e,t,((e,t)=>e.includes(...t)));static"str.indexOf"=(e,t)=>T(e,t,((e,t)=>e.indexOf(...t)));static"str.lastIndexOf"=(e,t)=>T(e,t,((e,t)=>e.lastIndexOf(...t)));static"str.localeCompare"=(e,t)=>T(e,t,((e,t)=>e.localeCompare(...t)));static"str.match"=(e,t)=>T(e,t,((e,t)=>e.match(...t)));static"str.normalize"=(e,t)=>T(e,t,((e,t)=>e.normalize(...t)));static"str.padEnd"=(e,t)=>T(e,t,((e,t)=>e.padEnd(...t)));static"str.padStart"=(e,t)=>T(e,t,((e,t)=>e.padStart(...t)));static"str.repeat"=(e,t)=>T(e,t,((e,t)=>e.repeat(...t)));static"str.replace"=(e,t)=>T(e,t,((e,t)=>e.replace(...t)));static"str.replaceAll"=(e,t)=>T(e,t,((e,t)=>e.replaceAll(...t)));static"str.search"=(e,t)=>T(e,t,((e,t)=>e.search(...t)));static"str.slice"=(e,t)=>T(e,t,((e,t)=>e.slice(...t)));static"str.split"=(e,t)=>T(e,t,((e,t)=>e.split(...t)));static"str.startsWith"=(e,t)=>T(e,t,((e,t)=>e.startsWith(...t)));static"str.substring"=(e,t)=>T(e,t,((e,t)=>e.substring(...t)));static"str.toLocaleLowerCase"=(e,t)=>T(e,t,((e,t)=>e.toLocaleLowerCase(...t)));static"str.toLocaleUpperCase"=(e,t)=>T(e,t,((e,t)=>e.toLocaleUpperCase(...t)));static"str.toLowerCase"=(e,t)=>T(e,t,((e,t)=>e.toLowerCase(...t)));static"str.toUpperCase"=(e,t)=>T(e,t,((e,t)=>e.toUpperCase(...t)));static"str.trim"=(e,t)=>T(e,t,((e,t)=>e.trim(...t)));static"str.trimEnd"=(e,t)=>T(e,t,((e,t)=>e.trimEnd(...t)));static"str.trimStart"=(e,t)=>T(e,t,((e,t)=>e.trimStart(...t)));static"num.toExponential"=(e,t)=>k(e,t,((e,t)=>e.toExponential(...t)));static"num.toFixed"=(e,t)=>k(e,t,((e,t)=>e.toFixed(...t)));static"num.toLocaleString"=(e,t)=>k(e,t,((e,t)=>e.toLocaleString(...t)));static"num.toPrecision"=(e,t)=>k(e,t,((e,t)=>e.toPrecision(...t)));static"arr.at"=(e,t)=>$(e,t,((e,t)=>e.at(...t)));static"arr.concat"=(e,t)=>$(e,t,((e,t)=>e.concat(...t)));static"arr.entries"=(e,t)=>$(e,t,((e,t)=>e.entries(...t)));static"arr.flat"=(e,t)=>$(e,t,((e,t)=>e.flat(...t)));static"arr.includes"=(e,t)=>$(e,t,((e,t)=>e.includes(...t)));static"arr.indexOf"=(e,t)=>$(e,t,((e,t)=>e.indexOf(...t)));static"arr.join"=(e,t)=>$(e,t,((e,t)=>e.join(...t)));static"arr.keys"=(e,t)=>$(e,t,((e,t)=>e.keys(...t)));static"arr.lastIndexOf"=(e,t)=>$(e,t,((e,t)=>e.lastIndexOf(...t)));static"arr.slice"=(e,t)=>$(e,t,((e,t)=>e.slice(...t)));static"arr.toLocaleString"=(e,t)=>$(e,t,((e,t)=>e.toLocaleString(...t)));static"arr.toReversed"=(e,t)=>$(e,t,((e,t)=>e.toReversed(...t)));static"arr.toSorted"=(e,t)=>$(e,t,((e,t)=>e.toSorted(...t)));static"arr.toSpliced"=(e,t)=>$(e,t,((e,t)=>e.toSpliced(...t)));static"arr.values"=(e,t)=>$(e,t,((e,t)=>e.values(...t)));static"arr.with"=(e,t)=>$(e,t,((e,t)=>e.with(...t)));static get at(){return(e,t)=>(Array.isArray(e)?this["arr.at"]:this["str.at"])(e,t)}static get charAt(){return this["str.charAt"]}static get charCodeAt(){return this["str.charCodeAt"]}static get codePointAt(){return this["str.codePointAt"]}static get concat(){return(e,t)=>(Array.isArray(e)?this["arr.concat"]:this["str.concat"])(e,t)}static get endsWith(){return this["str.endsWith"]}static get entries(){return this["arr.entries"]}static get flat(){return this["arr.flat"]}static get includes(){return(e,t)=>(Array.isArray(e)?this["arr.includes"]:this["str.includes"])(e,t)}static get indexOf(){return(e,t)=>(Array.isArray(e)?this["arr.indexOf"]:this["str.indexOf"])(e,t)}static get join(){return this["arr.join"]}static get keys(){return this["arr.keys"]}static get lastIndexOf(){return(e,t)=>(Array.isArray(e)?this["arr.lastIndexOf"]:this["str.lastIndexOf"])(e,t)}static get localeCompare(){return this["str.localeCompare"]}static get match(){return this["str.match"]}static get normalize(){return this["str.normalize"]}static get padEnd(){return this["str.padEnd"]}static get padStart(){return this["str.padStart"]}static get repeat(){return this["str.repeat"]}static get replace(){return this["str.replace"]}static get replaceAll(){return this["str.replaceAll"]}static get search(){return this["str.search"]}static get slice(){return(e,t)=>(Array.isArray(e)?this["arr.slice"]:this["str.slice"])(e,t)}static get split(){return this["str.split"]}static get startsWith(){return this["str.startsWith"]}static get substring(){return this["str.substring"]}static get toExponential(){return this["num.toExponential"]}static get toFixed(){return this["num.toFixed"]}static get toLocaleString(){return(e,t)=>(Array.isArray(e)?this["arr.toLocaleString"]:this["num.toLocaleString"])(e,t)}static get toLocaleLowerCase(){return this["str.toLocaleLowerCase"]}static get toLocaleUpperCase(){return this["str.toLocaleUpperCase"]}static get toLowerCase(){return this["str.toLowerCase"]}static get toPrecision(){return this["num.toPrecision"]}static get toReversed(){return this["arr.toReversed"]}static get toSorted(){return this["arr.toSorted"]}static get toSpliced(){return this["arr.toSpliced"]}static get toUpperCase(){return this["str.toUpperCase"]}static get trim(){return this["str.trim"]}static get trimEnd(){return this["str.trimEnd"]}static get trimStart(){return this["str.trimStart"]}static get values(){return this["arr.values"]}static get with(){return this["arr.with"]}}class I{static number=(e,t)=>""===e?null:Number(e);static boolean=(e,t)=>""===e?null:Boolean(e)}const F=e=>Array.from(e.childNodes).flatMap((e=>F(e).concat((e=>e instanceof Comment&&(e.textContent.startsWith("@@:")||e.textContent.startsWith("@@|")))(e)?e:null))).filter((e=>e));class j{static listOfRouteIndexesByTemplate=new Map;static getTargetNodes(e,t){let s;if(this.listOfRouteIndexesByTemplate.has(e)){s=this.listOfRouteIndexesByTemplate.get(e).map((e=>((e,t)=>{for(let s=0;s<t.length;s++)e=e.childNodes[t[s]];return e})(t,e)))}else s=Array.from(t.querySelectorAll("[data-bind]")).concat(F(t)),this.listOfRouteIndexesByTemplate.set(e,s.map((e=>(e=>{let t=[];for(;null!=e.parentNode;)t=[Array.from(e.parentNode.childNodes).indexOf(e)].concat(t),e=e.parentNode;return t})(e))));return s}}class L{name;options;static applyForInput(e,t,s){return t.reduceRight(((e,t)=>t.name in s?s[t.name](e,t.options):e),e)}static applyForOutput(e,t,s){return t.reduce(((e,t)=>t.name in s?s[t.name](e,t.options):e),e)}static regist(e,t,s){e in _&&l.raise(`regist filter error duplicate name (${e})`),e in I&&l.raise(`regist filter error duplicate name (${e})`),t&&(_[e]=t),s&&(I[e]=s)}}class D{#F;get node(){return this.#F}#e;get name(){return this.#e}#j=[];get nameElements(){return this.#j}get value(){return this.node[this.name]}set value(e){this.node[this.name]=e}#L;get filters(){return this.#L}#D;get filterFuncs(){return this.#D}get filteredValue(){return this.filters.length>0?L.applyForInput(this.value,this.filters,this.filterFuncs):this.value}get applicable(){return!0}#U;get binding(){return this.#U}get expandable(){return!1}get isSelectValue(){return!1}constructor(e,t,s,i,n){t instanceof Node||l.raise("not Node"),this.#U=e,this.#F=t,this.#e=s,this.#j=s.split("."),this.#L=i,this.#D=n}initialize(){}beforeUpdate(e){}isSameValue(e){return this.value===e}assignFromViewModelValue(){this.value=this.binding.viewModelProperty.filteredValue??""}assignValue(e){this.value=e}}class U extends D{get template(){return c.templateByUUID.get(this.uuid)}get uuid(){return U.getUUID(this.node)}static getUUID(e){return e.textContent.slice(3)}get expandable(){return!0}constructor(e,t,s,i,n){t instanceof Comment||l.raise("not Comment");const r=U.getUUID(t);void 0===r&&l.raise(`invalid uuid ${r}`),super(e,t,s,i,n)}}const V=e=>e.applyToNode();class W extends U{get value(){return this.binding.children.length}set value(e){if(Array.isArray(e)||l.raise("value is not array"),this.value<e.length){this.binding.children.forEach(V);for(let t=this.value;t<e.length;t++){const e=this.binding.viewModelProperty.createChildContext(t),s=Re.create(this.binding.component,this.template,e);this.binding.appendChild(s)}}else if(this.value>e.length){const t=this.binding.children.splice(e.length);this.binding.children.forEach(V),t.forEach((e=>e.removeFromParent()))}else this.binding.children.forEach(V)}constructor(e,t,s,i,n){"loop"!==s&&l.raise(`invalid property name ${s}`),super(e,t,s,i,n)}isSameValue(e){return!1}}class K extends U{get isSelectValue(){return!1}get value(){return this.binding.children.length>0}set value(e){if("boolean"!=typeof e&&l.raise("value is not boolean"),this.value!==e)if(e){const e=Re.create(this.binding.component,this.template,this.binding.context);this.binding.appendChild(e)}else{this.binding.children.splice(0,this.binding.children.length).forEach((e=>e.removeFromParent()))}else this.binding.children.forEach((e=>e.applyToNode()))}constructor(e,t,s,i,n){"if"!==s&&l.raise(`invalid property name ${s}`),super(e,t,s,i,n)}isSameValue(e){return!1}}class H{#V;get value(){return this.#V}#W;get enabled(){return this.#W}constructor(e,t){this.#V=e,this.#W=t}}class q{#K;get propName(){return this.#K}#H=[];get indexes(){return this.#H}#q;get pos(){return this.#q}constructor(e,t,s){this.#K=e,this.#H=t,this.#q=s}}class z{#H=[];get indexes(){return this.#H}#z=[];get stack(){return this.#z}copy(e){this.#H=e.indexes.slice(),this.#z=e.stack.slice()}}class G{static create(){return new z}static clone(e){const t=new z;return t.copy(e),t}}class Z{get viewModel(){return this.#U.component.viewModel}#e;get name(){return this.#e}get propertyName(){return r.create(this.name)}get indexes(){return this.binding.contextParam?.indexes??[]}get indexesString(){return this.indexes.toString()}#G;get key(){return this.name+"\t"+this.indexesString}get value(){return this.viewModel[o.directlyGet](this.name,this.indexes)}set value(e){const t=e=>{this.viewModel[o.directlySet](this.name,this.indexes,e)};if(e instanceof H){const s=this.value;if(Array.isArray(s)){const i=new Set(s);e.enabled?i.add(e.value):i.delete(e.value),t(Array.from(i))}else e.enabled&&t(e.value)}else t(e)}#L;get filters(){return this.#L}#D;get filterFuncs(){return this.#D}get filteredValue(){return this.filters.length>0?L.applyForOutput(this.value,this.filters,this.filterFuncs):this.value}get applicable(){return!0}#U;get binding(){return this.#U}constructor(e,t,s,i){this.#U=e,this.#e=t,this.#L=s,this.#D=i}createChildContext(e){const t=this.binding.context.indexes.length,s=this.propertyName,i=this.binding.contextParam?.indexes??[],n=G.clone(this.binding.context);return n.indexes.push(e),n.stack.push(new q(s,i.concat(e),t)),n}initialize(){}isUpdate(e){return e.has(this.key)&&!this.binding.component.updateSlot.nodeUpdator.queue.has(this)}assignFromNodeValue(){this.value=this.binding.nodeProperty.filteredValue}assignValue(e){this.value=e}}const J=RegExp(/^\$[0-9]+$/);class Q extends Z{get index(){return Number(this.name.slice(1))-1}get value(){return this.binding.context.indexes[this.index]}get indexes(){return[]}get indexesString(){return""}constructor(e,t,s,i){J.test(t)||l.raise(`invalid name ${t}`),super(e,t,s,i)}}class X extends D{get element(){return this.node}constructor(e,t,s,i,n){t instanceof Element||l.raise("not element"),super(e,t,s,i,n)}}class Y extends X{get value(){return this.element.className.length>0?this.element.className.split(" "):[]}set value(e){this.element.className=e.join(" ")}}class ee extends X{get isSelectValue(){return!1}get inputElement(){return this.node}get value(){return new H(this.inputElement.value,this.inputElement.checked)}set value(e){const t=e,s=this.filteredValue;this.inputElement.checked=!!t.find((e=>e===s.value))}get filteredValue(){const e=this.value;return new H(this.filters.length>0?L.applyForInput(e.value,this.filters,this.filterFuncs):e.value,e.enabled)}constructor(e,t,s,i,n){t instanceof HTMLInputElement||l.raise("not htmlInputElement"),"checkbox"!==t.type&&l.raise("not checkbox"),super(e,t,s,i,n)}isSameValue(e){return!1}}class te extends X{get inputElement(){return this.node}get value(){return new H(this.inputElement.value,this.inputElement.checked)}set value(e){const t=this.filteredValue;this.inputElement.checked=e===t.value}get filteredValue(){const e=this.value;return new H(this.filters.length>0?L.applyForInput(e.value,this.filters,this.filterFuncs):e.value,e.enabled)}constructor(e,t,s,i,n){t instanceof HTMLInputElement||l.raise("not htmlInputElement"),"radio"!==t.type&&l.raise("not radio"),super(e,t,s,i,n)}isSameValue(e){return!1}}class se extends X{get eventType(){return this.name.slice(2)}get applicable(){return!1}constructor(e,t,s,i,n){s.startsWith("on")||l.raise(`invalid property name ${s}`),super(e,t,s,i,n)}initialize(){this.element.addEventListener(this.eventType,(e=>this.eventHandler(e)))}async directlyCall(e){const{viewModelProperty:t,context:s}=this.binding;return t.viewModel[o.directlyCall](t.name,s,e)}createProcessData(e){return new x(this.directlyCall,this,[e])}eventHandler(e){e.stopPropagation();const t=this.createProcessData(e);this.binding.component.updateSlot.addProcess(t)}}class ie extends X{get className(){return this.nameElements[1]}get value(){return this.element.classList.contains(this.className)}set value(e){e?this.element.classList.add(this.className):this.element.classList.remove(this.className)}}class ne extends X{get attributeName(){return this.nameElements[1]}get value(){return this.element.getAttribute(this.attributeName)}set value(e){this.element.setAttribute(this.attributeName,e)}}class re extends X{get htmlElement(){return this.node}get styleName(){return this.nameElements[1]}get value(){return this.htmlElement.style[this.styleName]}set value(e){this.htmlElement.style[this.styleName]=e}constructor(e,t,s,i,n){t instanceof HTMLElement||l.raise("not htmlElement"),super(e,t,s,i,n)}}class ae extends X{#Z;get isSelectValue(){return void 0===this.#Z&&(this.#Z=this.node.constructor===HTMLSelectElement&&"value"===this.name),this.#Z}}class oe{get name(){return this.#J.name}get indexes(){return this.#J.indexes}#J;constructor(e){this.#J=e}}class le extends X{get propName(){return this.nameElements[1]}get applicable(){return!1}get thisComponent(){return this.node}constructor(e,t,s,i,n){t[o.isComponent]||l.raise("not Component"),super(e,t,s,i,n)}initialize(){var e;this.thisComponent.props[o.bindProperty](this.propName,new oe(this.binding.viewModelProperty)),Object.defineProperty(this.thisComponent.viewModel,this.propName,{get:(e=this.propName,function(){return this.$props[e]}),set:(e=>function(t){this.$props[e]=t})(this.propName),configurable:!0})}beforeUpdate(e){const t=this.binding.viewModelProperty.name,s=this.propName;for(const i of e){const[e,n]=i.split("\t");if(e===t||r.create(e).setOfParentPaths.has(t)){const i=e.slice(t.length),r=((n||null)?.split(",")??[]).map((e=>Number(e)));this.thisComponent.viewModel?.[o.writeCallback](`$props.${s}${i}`,r),this.thisComponent.viewModel?.[o.writeCallback](`${s}${i}`,r),this.thisComponent.viewModel?.[o.notifyForDependentProps](`$props.${s}${i}`,r),this.thisComponent.viewModel?.[o.notifyForDependentProps](`${s}${i}`,r)}}}isSameValue(e){return!1}}const ce=e=>e.applyToNode();class de extends W{#Q=[];get value(){return this.#Q}set value(e){Array.isArray(e)||l.raise("value is not array");const t=e=>this.binding.viewModelProperty.createChildContext(e),s=new Map,i=new Map,n=[],r=new Set,a=e.map(((e,a)=>{const o=this.#Q.indexOf(e,s.get(e)??0);let l;if(-1===o||!1===o)i.set(a,void 0),n.push(a),l=Re.create(this.binding.component,this.template,t(a));else{l=this.binding.children[o],s.set(e,o+1),i.set(a,o),r.add(o),a!==o&&l.setContext(this.binding.component,t(a));const c=i.get(a-1);0!==a&&(void 0===c||c>o)&&n.push(a)}return l}));for(let e=0;e<this.binding.children.length;e++)r.has(e)||this.binding.children[e].removeFromParent();for(const e of n){const t=a[e];(a[e-1]?.lastNode??this.binding.nodeProperty.node).after(...t.nodes)}this.binding.children.splice(0,this.binding.children.length,...a),this.binding.children.forEach(ce),this.#Q=e.slice()}}const he=RegExp(/^\$[0-9]+$/);class pe{static#X;static get classOfNodePropertyByNameByIsComment(){return void 0===this.#X&&(this.#X={true:{if:K},false:{class:Y,checkbox:ee,radio:te}}),this.#X}static#Y;static get classOfNodePropertyByFirstName(){return void 0===this.#Y&&(this.#Y={class:ie,attr:ne,style:re,props:le}),this.#Y}static create(e,t,s,i,n,r){let a;const o=he.test(n)?Q:Z;do{const i=t instanceof Comment;if(a=this.classOfNodePropertyByNameByIsComment[i][s],void 0!==a)break;if(i&&"loop"===s){a=e.component.useKeyed?de:W;break}i&&l.raise(`unknown node property ${s}`);const n=s.split(".");if(a=this.classOfNodePropertyByFirstName[n[0]],void 0!==a)break;a=t instanceof Element?s.startsWith("on")?se:ae:D}while(0);const c=Ae.create(e,t,s,a,n,o,r);return c.initialize(),c}}class ue{nodeProperty;viewModelProperty;filters}const me=e=>e.trim(),ge=e=>e.length>0,fe=e=>{const[t,...s]=e.split("|").map(me);return{viewModelProperty:t,filters:s.map((e=>(e=>{const[t,...s]=e.split(",").map(me);return Object.assign(new L,{name:t,options:s})})(e)))}},ye=(e,t)=>e.split(";").map(me).filter(ge).map((e=>{let{nodeProperty:s,viewModelProperty:i,filters:n}=((e,t)=>{const[s,i]=[t].concat(...e.split(":").map(me)).splice(-2),{viewModelProperty:n,filters:r}=fe(i);return{nodeProperty:s,viewModelProperty:n,filters:r}})(e,"$");return i="@"===i?s:i,s="$"===s?t:s,void 0===s&&l.raise("default property undefined"),{nodeProperty:s,viewModelProperty:i,filters:n}}));class ve{static bindTextsByKey={};static parse(e,t){const s=e+"\t"+t;let i=this.bindTextsByKey[s];return void 0===i&&(i=ye(e,t).map((e=>Object.assign(new ue,e))),this.bindTextsByKey[s]=i),i}}class Pe{static parseBindText=(e,t,s,i,n)=>ve.parse(i,n).map((i=>pe.create(e,t,i.nodeProperty,s,i.viewModelProperty,i.filters)))}const be="data-bind",xe="oninput",we=xe.slice(2);class Ne{static bind(e,t){const s=e.component.viewModel,i=(e=>e instanceof HTMLElement?e:l.raise("not HTMLElement"))(t),n=i.getAttribute(be);i.removeAttribute(be);const r=(e=>e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLOptionElement?"value":e instanceof HTMLButtonElement||e instanceof HTMLAnchorElement?"onclick":e instanceof HTMLInputElement?"radio"===e.type||"checkbox"===e.type?"checked":"button"===e.type?"onclick":"value":"textContent")(i),a=Pe.parseBindText(e,t,s,n,r);let o=!1,c=null,d=null,h=null;a.forEach((e=>{o||=e.nodeProperty.name===xe,d=e.nodeProperty.constructor===te?e:d,h=e.nodeProperty.constructor===ee?e:h,c=e.nodeProperty.name===r?e:c}));const p=e=>{i.addEventListener(we,e.defaultEventHandler)};return d?p(d):h?p(h):c&&!o&&(e=>e instanceof HTMLElement&&(e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement))(t)&&p(c),a}}const Ce="data-bind";class Me{static bind(e,t){const s=e.component.viewModel,i=(e=>e instanceof SVGElement?e:l.raise("not SVGElement"))(t),n=i.getAttribute(Ce);i.removeAttribute(Ce);return Pe.parseBindText(e,t,s,n,undefined)}}class Se{static bind(e,t){const s=e.component.viewModel,i=(e=>e instanceof Comment?e:l.raise("not Comment"))(t),n=i.textContent.slice(3),r=document.createTextNode("");i.parentNode.replaceChild(r,i);return Pe.parseBindText(e,r,s,n,"textContent")}}class Be{static bind(e,t){const s=e.component.viewModel,i=(e=>e instanceof Comment?e:l.raise("not Comment"))(t),n=i.textContent.slice(3),r=c.templateByUUID.get(n).getAttribute("data-bind");return Pe.parseBindText(e,t,s,r,void 0)}}class Ee{static bind(e,t){return t.flatMap((t=>t instanceof Comment&&":"==t.textContent[2]?Se.bind(e,t):t instanceof HTMLElement?Ne.bind(e,t):t instanceof Comment&&"|"==t.textContent[2]?Be.bind(e,t):t instanceof SVGElement?Me.bind(e,t):l.raise("unknown node type")))}}class Ae{static seq=0;#ee;get id(){return this.#ee}#te;get bindingManager(){return this.#te}#se;get nodeProperty(){return this.#se}#J;get viewModelProperty(){return this.#J}get component(){return this.#te.component}get context(){return this.#te.context}#ie;get contextParam(){if(void 0===this.#ie){const e=r.create(this.viewModelProperty.name);e.level>0?this.#ie=this.context.stack.find((t=>t.propName.name===e.nearestWildcardParentName)):this.#ie=null}return this.#ie}#ne=[];get children(){return this.#ne}get expandable(){return this.nodeProperty.expandable}get isSelectValue(){return this.nodeProperty.isSelectValue}build(e,t,s,i,n,r,a){this.#ee=++Ae.seq,this.#te=e,this.#se=new i(this,t,s,a,e.component.filters.in),this.#J=new r(this,n,a,e.component.filters.out)}applyToNode(){const{component:e,nodeProperty:t,viewModelProperty:s,expandable:i}=this;if(!t.applicable)return;const n=s.filteredValue??"";t.isSameValue(n)||(i?t.assignFromViewModelValue():e.updateSlot.addNodeUpdate(this,n))}applyToViewModel(){const{viewModelProperty:e}=this;e.applicable&&e.assignFromNodeValue()}execDefaultEventHandler(e){e.stopPropagation();const t=new x(this.applyToViewModel,this,[]);this.component.updateSlot.addProcess(t)}get defaultEventHandler(){return e=this,t=>e.execDefaultEventHandler(t);var e}initialize(){this.nodeProperty.initialize(),this.viewModelProperty.initialize(),this.applyToNode()}appendChild(e){this.expandable||l.raise("not expandable");const t=this.children[this.children.length-1];this.children.push(e);const s=this.nodeProperty.node.parentNode,i=t?.lastNode??this.nodeProperty.node;s.insertBefore(e.fragment,i.nextSibling??null)}changeContext(){this.#ie=void 0}static create(e,t,s,i,n,r,a){const o=new Ae;return o.build(e,t,s,i,n,r,a),o}}class Re{#g;get component(){return this.#g}#re=[];get bindings(){return this.#re}#ae=[];get nodes(){return this.#ae}get lastNode(){return this.#ae[this.#ae.length-1]}#oe;get fragment(){return this.#oe}#le;get context(){return this.#le}#ce;constructor(e,t,s){this.#le=s,this.#g=e,this.#ce=t;const i=document.importNode(t.content,!0),n=j.getTargetNodes(t,i);this.#re=Ee.bind(this,n),this.#re.forEach((t=>e.bindingSummary.add(t))),this.#ae=Array.from(i.childNodes),this.#oe=i}setContext(e,t){this.#g=e,this.#le=t,this.bindings.forEach((e=>e.changeContext()))}applyToNode(){this.bindings.forEach((e=>e.applyToNode()))}applyToViewModel(){this.bindings.forEach((e=>e.applyToViewModel()))}removeFromParent(){this.component.useKeyed?this.#de():this.#he()}#he(){this.#ae.forEach((e=>this.fragment.appendChild(e))),this.bindings.forEach((e=>{this.component.bindingSummary.delete(e);e.children.splice(0).forEach((e=>e.removeFromParent()))}));(Re.bindingsByTemplate.get(this.#ce)??Re.bindingsByTemplate.set(this.#ce,[]).get(this.#ce)).push(this)}#de(){this.#ae.forEach((e=>e.parentNode.removeChild(e))),this.bindings.forEach((e=>{this.component.bindingSummary.delete(e);e.children.splice(0).forEach((e=>e.removeFromParent()))}))}updateNode(e){const{bindingSummary:t}=this.component,s=Array.from(t.expandableBindings);s.sort(((e,t)=>{const s=e.viewModelProperty.propertyName.level-t.viewModelProperty.propertyName.level;if(0!==s)return s;return e.viewModelProperty.propertyName.pathNames.length-t.viewModelProperty.propertyName.pathNames.length}));for(const t of s)e.has(t.viewModelProperty.key)&&t.applyToNode();t.flush();for(const s of e){const e=t.bindingsByKey.get(s)??new Set;for(const t of e)t.expandable||t.applyToNode()}for(const s of t.componentBindings)s.nodeProperty.beforeUpdate(e)}static bindingsByTemplate=new Map;static create(e,t,s){if(!e.useKeyed){const i=this.bindingsByTemplate.get(t)??[];if(i.length>0){const t=i.pop();t.setContext(e,s);const n=(e,t)=>{for(const t of e){t.applyToNode();for(const e of t.children)n(e.bindings)}};return n(t.bindings),t.bindings.forEach((t=>e.bindingSummary.add(t))),t}}return new Re(e,t,s)}}class Oe{#pe=new Set;#ue=new Map;get setOfPropsByRefProp(){return this.#ue}hasDefaultProp(e){return this.#pe.has(e)}addDefaultProp(e){let t=r.create(e);for(;""!==t.parentPath;){const e=r.create(t.parentPath);this.#pe.has(t.name)||(this.#ue.get(e.name)?.add(t.name)??this.#ue.set(e.name,new Set([t.name])),this.#pe.add(t.name)),t=e}}setDependentProps(e){for(const[t,s]of Object.entries(e))for(const e of s)this.#ue.get(e)?.add(t)??this.#ue.set(e,new Set([t]))}}const ke={[o.connectedCallback]:"$connectedCallback",[o.disconnectedCallback]:"$disconnectedCallback",[o.writeCallback]:"$writeCallback"},Te=new Set([o.connectedCallback,o.disconnectedCallback,o.writeCallback]);class $e{static get(e,t,s,i){const n=ke[i],r=(...s)=>async()=>Reflect.apply(e[n],t,s);return i===o.connectedCallback?n in e?(...e)=>r(...e)():()=>{}:n in e?(...e)=>s.addProcess(r(...e),t,[]):()=>{}}static has(e){return Te.has(e)}}const _e=new Set([o.directlyCall,o.getDependentProps,o.notifyForDependentProps,o.clearCache]),Ie={[o.directlyCall]:({viewModel:e,viewModelProxy:t,handler:s})=>async(i,n,r)=>s.directlyCallback(n,(async()=>Reflect.apply(e[i],t,[r,...n.indexes]))),[o.notifyForDependentProps]:({viewModel:e,viewModelProxy:t,handler:s})=>(i,n)=>s.addNotify(e,{propName:r.create(i),indexes:n},t),[o.getDependentProps]:({handler:e})=>()=>e.dependentProps,[o.clearCache]:({handler:e})=>()=>e.cache.clear()};class Fe{static get(e,t,s,i){return Ie[i]?.({viewModel:e,viewModelProxy:t,handler:s})}static has(e){return _e.has(e)}}class je{static async open(e,t,s){const i=utils.toKebabCase(e),n=document.createElement(i);return Object.entries(s).forEach((([e,t])=>{n.setAttribute(e,t)})),Object.entries(t).forEach((([e,t])=>{n.props[Symbols.bindProperty](e,{name:e,indexes:[]}),n.props[e]=t})),document.body.appendChild(n),n.alivePromise}static close(e,t){Object.entries(t).forEach((([t,s])=>{e.props[t]=s})),e.parentNode.removeChild(e)}}const Le="$props",De="$globals",Ue="$dependentProps",Ve="$openDialog",We="$closeDialog",Ke="$component",He=new Set([Le,De,Ue,Ve,We,Ke]),qe={[Le]:({component:e})=>e.props,[De]:({component:e})=>e.globals,[Ue]:({viewModel:e})=>e[Ue],[Ve]:()=>async(e,t={},s={})=>je.open(e,t,s),[Ke]:({component:e})=>e,[We]:({component:e})=>(t={})=>je.close(e,t)};class ze{static get(e,t,s){return qe[s]?.({component:e,viewModel:t})}static has(e){return He.has(e)}}class Ge{#me=new Map;get(e,t){const s=this.#me.get(e);return s?s.get(t.toString()):void 0}set(e,t,s){let i=this.#me.get(e);return void 0===i&&(i=new Map,this.#me.set(e,i)),i.set(t.toString(),s),s}clear(){this.#me.clear()}}class Ze extends N{#ge=new Ge;get cache(){return this.#ge}getByPropertyName(e,{propName:t},s){if(t.isPrimitive||!this.dependentProps.hasDefaultProp(t.name)&&this.dependentProps.addDefaultProp(t.name),ze.has(t.name))return ze.get(this.component,e,t.name);if(!t.isPrimitive||this.setOfAccessorProperties.has(t.name)){const i=t.level>0?this.lastIndexes.slice(0,t.level):[];let n=this.#ge.get(t,i);return void 0===n&&(n=super.getByPropertyName(e,{propName:t},s),this.#ge.set(t,i,n)),n}return super.getByPropertyName(e,{propName:t},s)}setByPropertyName(e,{propName:t,value:s},i){l.raise("viewModel is read only")}get(e,t,s){return $e.has(t)?$e.get(e,s,this,t):Fe.has(t)?Fe.get(e,s,this,t):super.get(e,t,s)}set(e,t,s,i){l.raise("viewModel is read only")}}class Je{static getDescByName(e){const t=new Map;let s=e;for(;s!==Object.prototype;){const e=Object.getOwnPropertyDescriptors(s);for(const[s,i]of Object.entries(e))t.has(s)||t.set(s,i);s=Object.getPrototypeOf(s)}return t}static getMethods(e,t){return e.filter((([e,s])=>s.value!==t&&"function"==typeof s.value))}static getProperties(e,t){return e.filter((([e,s])=>s.value!==t&&"function"!=typeof s.value))}static viewModelize(e){let t=this.viewModelInfoByConstructor.get(e.constructor);if(!t){const s=this.getDescByName(e),i=Array.from(s.entries()),n=[],a=[],o=[],l=this.getMethods(i,e.constructor).map((([e,t])=>e));this.getProperties(i,e.constructor).forEach((([e,t])=>{a.push(e);r.create(e).isPrimitive||"value"in t&&void 0===t.value&&n.push(e),"get"in t&&void 0!==t.get&&o.push(e)})),t={removeProps:n,definedProps:a,methods:l,accessorProps:o},this.viewModelInfoByConstructor.set(e.constructor,t)}return t.removeProps.forEach((t=>Reflect.deleteProperty(e,t))),{definedProps:t.definedProps,methods:t.methods,accessorProps:t.accessorProps,viewModel:e}}static viewModelInfoByConstructor=new Map}class Qe{#le;get context(){return this.#le}async callback(e,t){void 0!==this.#le&&l.raise("already set context"),this.#le=e;try{return await t()}finally{this.#le=void 0}}}class Xe extends N{#fe=new Qe;getByPropertyName(e,{propName:t},s){return t.isPrimitive||!this.dependentProps.hasDefaultProp(t.name)&&this.dependentProps.addDefaultProp(t.name),ze.has(t.name)?ze.get(this.component,e,t.name):super.getByPropertyName(e,{propName:t},s)}setByPropertyName(e,{propName:t,value:s},i){t.isPrimitive||!this.dependentProps.hasDefaultProp(t.name)&&this.dependentProps.addDefaultProp(t.name);const n=super.setByPropertyName(e,{propName:t,value:s},i),r=this.lastIndexes;return i[o.writeCallback](t.name,r),this.addNotify(e,{propName:t,indexes:r},i),n}async directlyCallback(e,t){return this.#fe.callback(e,(async()=>{this.stackIndexes.push(void 0);try{return await t()}finally{this.stackIndexes.pop()}}))}findParam(e){if(void 0===this.#fe.context)return;if("string"!=typeof e||e.startsWith("@@__")||"constructor"===e)return;const t=r.create(e);if(0===t.level||"@"===e.at(0))return;const s=this.#fe.context.stack.find((e=>e.propName.name===t.nearestWildcardParentName));return void 0===s&&l.raise(`${e} is outside loop`),s}get(e,t,s){if($e.has(t))return $e.get(e,s,this,t);if(Fe.has(t))return Fe.get(e,s,this,t);{const i=this.findParam(t);return void 0!==i?this.directlyGet(e,{prop:t,indexes:i.indexes},s):super.get(e,t,s)}}set(e,t,s,i){const n=this.findParam(t);return void 0!==n?this.directlySet(e,{prop:t,indexes:n.indexes,value:s},i):super.set(e,t,s,i)}}const Ye="$dependentProps";class et{#ye=new Map;get bindingsByKey(){return this.#ye}#ve=new Set;get expandableBindings(){return this.#ve}#Pe=new Set;get componentBindings(){return this.#Pe}#be=new Set;#xe=new Set;add(e){this.#xe.add(e);const t=this.#ye.get(e.viewModelProperty.key);void 0!==t?t.add(e):this.#ye.set(e.viewModelProperty.key,new Set([e])),e.nodeProperty.expandable&&this.#ve.add(e),e.nodeProperty.constructor===le&&this.#Pe.add(e)}delete(e){this.#be.add(e)}#we(e){this.#xe.delete(e);const t=this.#ye.get(e.viewModelProperty.key);void 0!==t&&t.delete(e),this.#ve.delete(e),this.#Pe.delete(e)}flush(){const e=this.#xe.size-this.#be.size;if(this.#be.size>10*e){const e=Array.from(this.#xe).filter((e=>!this.#be.has(e)));this.rebuild(e)}else for(const e of this.#be)this.#we(e);this.#be=new Set}rebuild(e){this.clear();for(const t of e)this.add(t)}clear(){this.#xe=new Set,this.#ye=new Map,this.#ve=new Set,this.#Pe=new Set}}const tt=new WeakMap,st={get viewModel(){return void 0===this.updateSlot||this.updateSlot.phase!==B&&this.updateSlot.phase!==E?this._viewModels.writable:this._viewModels.readonly},get rootBinding(){return this._rootBinding},set rootBinding(e){this._rootBinding=e},get thread(){return this._thread},set thread(e){this._thread=e},get updateSlot(){if(void 0!==this._thread)return void 0===this._updateSlot&&(this._updateSlot=R.create(this,(()=>{this._updateSlot=void 0}),(e=>{e===B&&this.viewModel[o.clearCache]()})),this.thread.wakeup(this._updateSlot)),this._updateSlot},set updateSlot(e){this._updateSlot=e},get props(){return this._props},get globals(){return this._globals},get initialResolve(){return this._initialResolve},set initialResolve(e){this._initialResolve=e},get initialReject(){return this._initialReject},set initialReject(e){this._initialReject=e},get initialPromise(){return this._initialPromise},set initialPromise(e){this._initialPromise=e},get aliveResolve(){return this._aliveResolve},set aliveResolve(e){this._aliveResolve=e},get aliveReject(){return this._aliveReject},set aliveReject(e){this._aliveReject=e},get alivePromise(){return this._alivePromise},set alivePromise(e){this._alivePromise=e},get parentComponent(){return void 0===this._parentComponent&&(this._parentComponent=(e=>{for(;;){if(null==(e=e.parentNode))return null;if(e[o.isComponent])return e;if(e instanceof ShadowRoot){if(e.host[o.isComponent])return e.host;e=e.host}const t=tt.get(e);if(void 0!==t)return t}})(this)),this._parentComponent},get useShadowRoot(){return this._useShadowRoot},get usePseudo(){return this._usePseudo},get useTagNamesapce(){return this._useTagNamesapce},get useKeyed(){return this._useKeyed},get viewRootElement(){return this.usePseudo?this.pseudoParentNode:this.shadowRoot??this},get pseudoParentNode(){return this.usePseudo?this._pseudoParentNode:l.raise("not usePseudo")},get pseudoNode(){return this._pseudoNode},get filters(){return this._filters},get bindingSummary(){return this._bindingSummary},initialize(){this._viewModels=function(e,t){const s=Je.viewModelize(Reflect.construct(t,[])),{viewModel:i,accessorProps:n}=s,r=new Set(n),a=new Oe;return a.setDependentProps(i[Ye]??{}),{readonly:new Proxy(i,new Ze(e,r,a)),writable:new Proxy(i,new Xe(e,r,a))}}(this,this.constructor.ViewModel),this._rootBinding=void 0,this._thread=void 0,this._updateSlot=void 0,this._props=new Proxy({},new u(this)),this._globals=function(e){return new Proxy({},new f(e))}(),this._initialPromise=void 0,this._initialResolve=void 0,this._initialReject=void 0,this._alivePromise=void 0,this._aliveResolve=void 0,this._aliveReject=void 0,this._parentComponent=void 0,this._useShadowRoot=this.constructor.useShadowRoot,this._usePseudo=this.constructor.usePseudo,this._useTagNamespace=this.constructor.useTagNamespace,this._useKeyed=this.constructor.useKeyed,this._pseudoParentNode=void 0,this._pseudoNode=void 0,this._filters={in:class extends I{},out:class extends _{}},this._bindingSummary=new et,this.initialPromise=new Promise(((e,t)=>{this.initialResolve=e,this.initialReject=t}))},async build(){const{template:e,inputFilters:t,outputFilters:s}=this.constructor;if(void 0!==t)for(const[e,s]of Object.entries(t))e in this.filters.in&&l.raise(`already exists filter ${e}`),this.filters.in[e]=s;if(void 0!==s)for(const[e,t]of Object.entries(s))e in this.filters.out&&l.raise(`already exists filter ${e}`),this.filters.out[e]=t;O.isAttachable(this.tagName.toLowerCase())&&this.useShadowRoot&&!this.usePseudo&&this.attachShadow({mode:"open"}),this.thread=new P,await this.viewModel[o.connectedCallback](),this.rootBinding=Re.create(this,e,G.create()),this.bindingSummary.flush(),this.usePseudo?(this.viewRootElement.insertBefore(this.rootBinding.fragment,this.pseudoNode.nextSibling),this.rootBinding.nodes.forEach((e=>tt.set(e,this)))):this.viewRootElement.appendChild(this.rootBinding.fragment),this.updateSlot.isEmpty&&this.updateSlot.waitResolve(!0),await this.updateSlot.alive()},async connectedCallback(){try{if(this.parentComponent&&await this.parentComponent.initialPromise,this.usePseudo){const e=document.createComment(`@@/${this.tagName}`);this._pseudoParentNode=this.parentNode,this._pseudoNode=e,this.pseudoParentNode.replaceChild(e,this)}this.alivePromise=new Promise(((e,t)=>{this.aliveResolve=e,this.aliveReject=t})),await this.build()}finally{this.initialResolve&&this.initialResolve()}},disconnectedCallback(){this.aliveResolve&&this.aliveResolve(this.props[o.toObject]())},updateNode(e){this.rootBinding?.updateNode(e)}};class it{static generate(e){const t=Object.assign(new p,e),s=function(e){return class extends HTMLElement{static template=e.template;static ViewModel=e.ViewModel;static inputFilters=e.inputFilters;static outputFilters=e.outputFilters;static useShadowRoot=e.useShadowRoot;static usePseudo=e.usePseudo;static useTagNamespace=e.useTagNamespace;static useKeyed=e.useKeyed??y.useKeyed;get[o.isComponent](){return!0}constructor(){super(),this.initialize()}}}(t);if(void 0===t.extendClass&&void 0===t.extendTag);else{const e=t.extendClass??document.createElement(t.extendTag).constructor;s.prototype.__proto__=e.prototype,s.__proto__=e}for(let[e,t]of Object.entries(Object.getOwnPropertyDescriptors(st)))Object.defineProperty(s.prototype,e,t);return at(t.componentModulesForRegist),s}}function nt(e){return it.generate(e)}function rt(e,t){const s=l.toKebabCase(e),i=it.generate(t);t.extendTag?customElements.define(s,i,{extends:t.extendTag}):void 0===t?.extendClass?customElements.define(s,i):l.raise("extendTag should be set")}function at(e){for(const[t,s]of Object.entries(e??{}))rt(t,s)}class ot{static regist(e,t){}}class lt{static toKebabCase=e=>"string"==typeof e?e.replaceAll(/[\._]/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e}const ct="kebab",dt="snake",ht="uppercamel",pt="lowercamel",ut="dotted";class mt{static getNames(e){const t=lt.toKebabCase(e),s=t.replaceAll("-","_"),i=t.replaceAll("-","."),n=t.split("-").map(((e,t)=>(void 0!==e[0]&&(e=e[0].toUpperCase()+e.slice(1)),e))).join(""),r=n.length>0?n[0].toLowerCase()+n.slice(1):n;return{[ct]:t,[dt]:s,[ht]:n,[pt]:r,[ut]:i}}}const gt=pt;class ft{defaultNameType=gt;defaultPath="./";loadNames=[];prefixMap}class yt{prefix;path;get matchPrefix(){return`${this.prefix}-`}isMatch(e){return e.startsWith(this.matchPrefix)}getNames(e){const{prefix:t,path:s}=this;if(e.startsWith(this.matchPrefix)){return{prefixName:t,subName:e.slice(this.matchPrefix.length),path:s}}}}const vt=mt.getNames("prefix-name"),Pt=mt.getNames("sub-name");class bt{static getPathInfo(e,t,s,i){const[n,r]=e.split("#");let a=n,o=r;const l=mt.getNames(t),c=mt.getNames(s);return a=a.replaceAll(`{${vt[ct]}}`,l[ct]),a=a.replaceAll(`{${vt[dt]}}`,l[dt]),a=a.replaceAll(`{${vt[pt]}}`,l[pt]),a=a.replaceAll(`{${vt[ht]}}`,l[ht]),a=a.replaceAll(`{${vt[ut]}}`,l[ut]),a=a.replaceAll(`{${Pt[ct]}}`,c[ct]),a=a.replaceAll(`{${Pt[dt]}}`,c[dt]),a=a.replaceAll(`{${Pt[pt]}}`,c[pt]),a=a.replaceAll(`{${Pt[ht]}}`,c[ht]),a=a.replaceAll(`{${Pt[ut]}}`,c[ut]),n===a&&".js"!==a.slice(-3)&&(a=a+("/"!==e.slice(-1)?"/":"")+c[i]+".js"),o&&(o=o.replaceAll(`{${Pt[ct]}}`,c[ct]),o=o.replaceAll(`{${Pt[dt]}}`,c[dt]),o=o.replaceAll(`{${Pt[pt]}}`,c[pt]),o=o.replaceAll(`{${Pt[ht]}}`,c[ht]),o=o.replaceAll(`{${Pt[ut]}}`,c[ut])),{filePath:a,exportName:o}}}class xt{#Ne;#Ce;#Me;#Se;#Be;constructor(e){this.#Se=e,this.#Be=window.location,this.setConfig(new ft)}setConfig(e){this.#Ce=Object.assign(new ft,e),"prefixMap"in e&&void 0!==e.prefixMap&&this.setPrefixMap(e.prefixMap)}getConfig(){return this.#Ce}setPrefixMap(e){this.#Me=new Map(Object.entries(e).map((([e,t])=>[e=lt.toKebabCase(e),Object.assign(new yt,{prefix:e,path:t})])))}getPrefixMap(){return this.#Me}configFile(e){return this.#Ne=e,this}config(e){return this.setConfig(e),this}prefixMap(e){return this.setPrefixMap(e),this}get registrar(){return this.#Se}async loadConfig(e){const t=this.#Be.pathname.split("/");t[t.length-1]=e;const s=this.#Be.origin+t.join("/");try{const e=await fetch(s),t=await e.json();return Object.assign(new ft,t)}catch(e){throw new Error(e)}}async load(...e){if(void 0!==this.#Ne){const e=await this.loadConfig(this.#Ne);this.setConfig(e)}if(void 0===this.#Me)throw new Error("prefixMap is not defined");if(void 0===this.#Se)throw new Error("registrar is not defined");const t=Array.from(this.#Me.values()),{defaultNameType:s,defaultPath:i}=this.#Ce;e=e.length>0?e:this.#Ce.loadNames;for(let n of e){let e;n=lt.toKebabCase(n);const r=t.find((e=>e.isMatch(n)));if(void 0!==r){const t=r.getNames(n);e=bt.getPathInfo(t.path,t.prefixName,t.subName,s)}if(void 0===e&&void 0!==i&&(e=bt.getPathInfo(i,"",n,s)),void 0===e)throw new Error(`unmatch prefix and no defaultPath (loadName:${n})`);const a=this.#Be.pathname.split("/");a[a.length-1]=e.filePath;const o=this.#Be.origin+a.join("/");let l,c;try{l=await import(o)}catch(e){throw new Error(e)}if(void 0!==e.exportName){if(!(e.exportName in l))throw new Error(`${e.exportName} not found in module (exportName:${e.exportName}, ${e.filePath})`);c=l[e.exportName]}else c=l.default;this.#Se.regist(n,c)}return this}static create(e){return new xt(e)}}const wt=xt.create(class extends ot{static regist(e,t){if(e.startsWith("filter-")){const s=e.slice("filter-".length),{output:i,input:n}=t;L.regist(s,i,n)}else rt(e,t)}});function Nt(e){Object.entries(e).forEach((([e,t])=>{const{input:s,output:i}=t;L.regist(e,i,s)}))}function Ct(e){Object.assign(g.data,e)}export{y as config,nt as generateComponentClass,wt as loader,at as registComponentModules,Nt as registFilters,Ct as registGlobal};
