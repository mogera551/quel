class e{static raise(e){throw new Error(e)}static isFunction=e=>{const t=Object.prototype.toString.call(e).slice(8,-1).toLowerCase();return"function"===t||"asyncfunction"===t};static isInputableElement(e){return e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&"button"!==e.type}static toKebabCase=e=>"string"==typeof e?e.replaceAll(/_/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e}class t{static localeString=(e,t)=>null!=e?Number(e).toLocaleString():null;static fixed=(e,t)=>null!=e?Number(e).toFixed(t[0]??0):null;static styleDisplay=(e,t)=>e?t[0]??"":"none";static truthy=(e,t)=>!!e;static falsey=(e,t)=>!e;static not=this.falsey;static upperCase=(e,t)=>null!=e?String(e).toUpperCase():null;static lowerCase=(e,t)=>null!=e?String(e).toLowerCase():null;static eq=(e,t)=>e==t[0];static ne=(e,t)=>e!=t[0];static lt=(e,t)=>Number(e)<Number(t[0]);static le=(e,t)=>Number(e)<=Number(t[0]);static gt=(e,t)=>Number(e)>Number(t[0]);static ge=(e,t)=>Number(e)>=Number(t[0]);static embed=(e,t)=>null!=e?decodeURIComponent((t[0]??"").replaceAll("%s",e)):null;static ifText=(e,t)=>e?t[0]??null:t[1]??null;static null=(e,t)=>null==e}class s{static number=(e,t)=>""===e?null:Number(e);static boolean=(e,t)=>""===e?null:Boolean(e)}class n{name;options;static applyForInput(e,t){return t.reduceRight(((e,t)=>t.name in s?s[t.name](e,t.options):e),e)}static applyForOutput(e,s){return s.reduce(((e,s)=>s.name in t?t[s.name](e,s.options):e),e)}static regist(n,r,o){n in t&&e.raise(`regist filter error duplicate name (${n})`),n in s&&e.raise(`regist filter error duplicate name (${n})`),r&&(t[n]=r),o&&(s[n]=o)}}const r=1,o=2,i=3,a=10,l=20,p=30,c=90,d=91,h=92,u="loop";class m{type;nodePropertyElements=[];eventType;static get(t,s){const n=new m;return n.nodePropertyElements=s.split("."),t instanceof HTMLTemplateElement&&("if"===s||s===u)?(n.type=c,n):t instanceof Ae&&"$props"===n.nodePropertyElements[0]?(n.type=h,n):(1===n.nodePropertyElements.length?n.nodePropertyElements[0].startsWith("on")?(n.type=d,n.eventType=n.nodePropertyElements[0].slice("on".length)):"radio"===n.nodePropertyElements[0]?n.type=l:"checkbox"===n.nodePropertyElements[0]?n.type=p:n.type=r:2===n.nodePropertyElements.length?"className"===n.nodePropertyElements[0]?n.type=a:n.type=o:3===n.nodePropertyElements.length?n.type=i:e.raise(`unknown property ${s}`),n)}}const y="quel",f="*",P="dot-notation",g={directlyGet:Symbol.for(P+".direct_get"),directlySet:Symbol.for(P+".direct_set"),isSupportDotNotation:Symbol.for(P+".is_support_dot_notation")},w=new RegExp(/^\$([0-9]+)$/);class x{name;pathNames=[];parentPathNames=[];parentPath;parentPaths=[];setOfParentPaths;regexp;level=0;isPrimitive;constructor(e){this.name=e,this.pathNames=e.split("."),this.parentPathNames=this.pathNames.slice(0,-1),this.parentPaths=this.parentPathNames.reduce(((e,t)=>(e.push(e.at(-1)?.concat(t)??[t]),e)),[]).map((e=>e.join("."))),this.setOfParentPaths=new Set(this.parentPaths),this.parentPath=this.parentPathNames.join("."),this.lastPathName=this.pathNames.at(-1),this.regexp=new RegExp("^"+e.replaceAll(".","\\.").replaceAll("*","([0-9a-zA-Z_]*)")+"$"),this.level=this.pathNames.filter((e=>e===f)).length,this.isPrimitive=1===this.pathNames.length}findNearestWildcard(){return x.findNearestWildcard(this)}static findNearestWildcard(e){return e.lastPathName===f?e:""!==e.parentPath?this.findNearestWildcard(x.create(e.parentPath)):void 0}static create(e){const t=this.propertyNameByName.get(e);if(t)return t;const s=new x(e);return this.propertyNameByName.set(e,s),s}static propertyNameByName=new Map;static parse(e){const t=[],s=[];for(const n of e.split(".")){const e=Number(n);isNaN(e)?s.push(n):(t.push(e),s.push("*"))}return{propName:x.create(s.join(".")),indexes:t}}}const v={Handler:class{#e=[];#t=new Map;get lastIndexes(){return this.#e[this.#e.length-1]}get stackIndexes(){return this.#e}get matchByName(){return this.#t}getByPropertyName(e,{propName:t},s){let n;if(Reflect.has(e,t.name))n=Reflect.get(e,t.name,s);else if(""!==t.parentPath){const r=x.create(t.parentPath),o=this.getByPropertyName(e,{propName:r},s);if(void 0!==o){const e=t.lastPathName===f?this.lastIndexes[t.level-1]:t.lastPathName;n=Reflect.get(o,e)}}return n}setByPropertyName(e,{propName:t,value:s},n){let r=!1;if(Reflect.has(e,t.name)||t.isPrimitive)r=Reflect.set(e,t.name,s,n);else{const o=x.create(t.parentPath),i=this.getByPropertyName(e,{propName:o},n);if(void 0!==i){const e=t.lastPathName===f?this.lastIndexes[t.level-1]:t.lastPathName;r=Reflect.set(i,e,s)}}return r}pushIndexes(e,t){this.#e.push(e);try{return Reflect.apply(t,this,[])}finally{this.#e.pop()}}getFunc=(e,t)=>({propName:s,indexes:n})=>this.pushIndexes(n,(()=>this.getByPropertyName(e,{propName:s},t)));setFunc=(e,t)=>({propName:s,indexes:n},r)=>this.pushIndexes(n,(()=>this.setByPropertyName(e,{propName:s,value:r},t)));getExpandLastLevel(e,{propName:t,indexes:s},n){const r=this.getFunc(e,n),o=t.findNearestWildcard();if(!o)throw new Error(`not found wildcard path of '${t.name}'`);const i=x.create(o.parentPath);return r({propName:i,indexes:s}).map(((e,n)=>r({propName:t,indexes:s.concat(n)})))}setExpandLastLevel(e,{propName:t,indexes:s,values:n},r){const o=this.getFunc(e,r),i=this.setFunc(e,r),a=t.findNearestWildcard();if(!a)throw new Error(`not found wildcard path of '${t.name}'`);const l=x.create(a.parentPath),p=o({propName:l,indexes:s});if(a.name===t.name)i({propName:l,indexes:s},n);else{if(n.length!==p.length)throw new Error(`not match value count '${t.name}'`);for(let e in p)i({propName:t,indexes:s.concat(Number(e))},n[e])}return!0}[g.directlyGet](e,{prop:t,indexes:s},n){const r=x.create(t);return this.pushIndexes(s,(()=>this.getByPropertyName(e,{propName:r},n)))}[g.directlySet](e,{prop:t,indexes:s,value:n},r){const o=x.create(t);return this.pushIndexes(s,(()=>this.setByPropertyName(e,{propName:o,value:n},r)))}get(e,t,s){if("string"==typeof t&&(t.startsWith("@@__")||"constructor"===t))return Reflect.get(e,t,s);const n=this.getFunc(e,s),r=this.lastIndexes;let o;if(t===g.directlyGet)return(t,n)=>Reflect.apply(this[g.directlyGet],this,[e,{prop:t,indexes:n},s]);if(t===g.directlySet)return(t,n,r)=>Reflect.apply(this[g.directlySet],this,[e,{prop:t,indexes:n,value:r},s]);if(t===g.isSupportDotNotation)return!0;if(o=w.exec(t))return r?.[Number(o[1])-1]??void 0;if("@"===t.at(0)){const n=t.slice(1),o=x.create(n);if((r?.length??0)+1<o.level)throw new Error("array level not match");const i=r?.slice(0,o.level-1)??[];return this.getExpandLastLevel(e,{propName:o,indexes:i},s)}if(this.#t.has(t))return n(this.#t.get(t));const i=x.parse(t);return i.propName.level===i.indexes.length&&this.#t.set(t,i),i.indexes.push(...r?.slice(i.indexes.length)??[]),n(i)}set(e,t,s,n){if("string"==typeof t&&(t.startsWith("@@__")||"constructor"===t))return Reflect.set(e,t,s,n);const r=this.setFunc(e,n),o=this.lastIndexes;if("@"===t.at(0)){const r=t.slice(1),o=x.create(r);if((this.lastIndexes?.length??0)+1<o.level)throw new Error("array level not match");const i=this.lastIndexes?.slice(0,o.level-1)??[];return this.setExpandLastLevel(e,{propName:o,indexes:i,values:s},n)}if(this.#t.has(t))return r(this.#t.get(t),s);const i=x.parse(t);return i.propName.level===i.indexes.length&&this.#t.set(t,i),this.#t.set(t,i),i.indexes.push(...o?.slice(i.indexes.length)??[]),r(i,s)}},PropertyName:x,Symbols:g,RE_CONTEXT_INDEX:w},b=v.Symbols,N=Object.assign({isProxy:Symbol.for(`${y}:arrayHandler.isProxy`),getRaw:Symbol.for(`${y}:arrayHandler.raw`),connectedCallback:Symbol.for(`${y}:viewModel.connectedCallback`),disconnectedCallback:Symbol.for(`${y}:viewModel.disconnectedCallback`),initCallback:Symbol.for(`${y}:viewModel.initCallback`),writeCallback:Symbol.for(`${y}:viewModel.writeCallback`),getDependentProps:Symbol.for(`${y}:viewModel.getDependentProps`),getHandler:Symbol.for(`${y}:viewModel.getHandler`),addNotify:Symbol.for(`${y}:viewModel.addNotify`),beCacheable:Symbol.for(`${y}:viewModel.beCacheable`),beUncacheable:Symbol.for(`${y}:viewModel.beUncacheable`),boundByComponent:Symbol.for(`${y}:globalData.boundByComponent`),directlyCall:Symbol.for(`${y}:viewModel.directCall`),bindTo:Symbol.for(`${y}:componentModule.bindTo`),bindProperty:Symbol.for(`${y}:componentModule.bindProperty`),notifyForDependentProps:Symbol.for(`${y}:viewModel.notifyForDependentProps`)},b);class M{#s;get node(){return this.#s}set node(e){this.#s=e}get element(){return this.node instanceof HTMLElement?this.node:e.raise("not HTMLElement")}contextBind;parentContextBind;#n;get nodeProperty(){return this.#n}set nodeProperty(e){this.#n=e}#r;get nodePropertyElements(){return this.#r}set nodePropertyElements(e){this.#r=e}component;viewModel;#o;get viewModelProperty(){return this.#o}set viewModelProperty(e){this.#o=e,this.#i=v.PropertyName.create(e),v.RE_CONTEXT_INDEX.exec(e)?this.#a=Number(e.slice(1))-1:this.#a=void 0}#i;get viewModelPropertyName(){return this.#i}#a;get contextIndex(){return this.#a}get isContextIndex(){return void 0!==this.#a}filters;#l;get indexes(){return this.#l}set indexes(e){this.#l=e,this.#p=e.toString(),this.#c=this.#o+"\t"+this.#p}#p;get indexesString(){return this.#p}#c;get viewModelPropertyKey(){return this.#c}contextIndexes;positionContextIndexes=-1;lastNodeValue;lastViewModelValue;getViewModelValue(){return this.isContextIndex?this.contextIndexes[this.contextIndex]:this.viewModel[N.directlyGet](this.viewModelProperty,this.indexes)}setViewModelValue(e){this.isContextIndex||this.viewModel[N.directlySet](this.viewModelProperty,this.indexes,e)}updateNode(){}updateViewModel(){}changeIndexes(e,t){const{indexes:s,contextIndexes:n}=this;this.viewModelPropertyName.setOfParentPaths.has(e.viewModelProperty)&&(s[e.indexes.length]=s[e.indexes.length]+t),n[e.contextIndexes.length]=n[e.contextIndexes.length]+t}removeFromParent(){}}const C=1,E=2,S=3,T=4,I=5,V=6;class k{node;property;viewModelProperty;value;updateFunc;constructor(e,t,s,n,r){this.node=e,this.property=t,this.viewModelProperty=s,this.value=n,this.updateFunc=r}}class B{queue=[];#d;constructor(e){this.#d=e}reorder(e){return e.sort(((e,t)=>e.node instanceof HTMLTemplateElement&&t.node instanceof HTMLTemplateElement?0:t.node instanceof HTMLTemplateElement?1:e.node instanceof HTMLTemplateElement?-1:e.node instanceof HTMLSelectElement&&"value"===e.property&&t.node instanceof HTMLSelectElement&&"value"===t.property?0:e.node instanceof HTMLSelectElement&&"value"===e.property?1:t.node instanceof HTMLSelectElement&&"value"===t.property?-1:0)),e}async exec(){this.#d&&this.#d(I);try{for(;this.queue.length>0;){const e=this.queue.splice(0),t=this.reorder(e);for(const e of t)Reflect.apply(e.updateFunc,e,[])}}finally{this.#d&&this.#d(V)}}get isEmpty(){return 0===this.queue.length}}class R extends M{updateNode(){const{component:e,node:t,nodeProperty:s,viewModelProperty:r,filters:o}=this,i=n.applyForOutput(this.getViewModelValue(),o);this.lastViewModelValue!==i&&(e.updateSlot.addNodeUpdate(new k(t,s,r,i,(()=>{t[s]=i??""}))),this.lastViewModelValue=i)}updateViewModel(){const{node:e,nodeProperty:t,filters:s}=this,r=n.applyForInput(e[t],s);this.setViewModelValue(r),this.lastViewModelValue=r}}class O extends M{get nodeProperty1(){return this.nodePropertyElements[0]}get nodeProperty2(){return this.nodePropertyElements[1]}updateNode(){const{component:e,node:t,nodeProperty:s,viewModelProperty:r,filters:o}=this,{nodeProperty1:i,nodeProperty2:a}=this,l=n.applyForOutput(this.getViewModelValue(),o);this.lastViewModelValue!==l&&(e.updateSlot.addNodeUpdate(new k(t,s,r,l,(()=>{t[i][a]=l??""}))),this.lastViewModelValue=l)}updateViewModel(){const{node:e,filters:t}=this,{nodeProperty1:s,nodeProperty2:r}=this,o=n.applyForInput(e[s][r],t);this.setViewModelValue(o),this.lastViewModelValue=o}}class $ extends M{get nodeProperty1(){return this.nodePropertyElements[0]}get nodeProperty2(){return this.nodePropertyElements[1]}get nodeProperty3(){return this.nodePropertyElements[2]}updateNode(){const{component:e,node:t,nodeProperty:s,viewModelProperty:r,filters:o}=this,{nodeProperty1:i,nodeProperty2:a,nodeProperty3:l}=this,p=n.applyForOutput(this.getViewModelValue(),o);this.lastViewModelValue!==p&&(e.updateSlot.addNodeUpdate(new k(t,s,r,p,(()=>{t[i][a][l]=p??""}))),this.lastViewModelValue=p)}updateViewModel(){const{node:e,filters:t}=this,{nodeProperty1:s,nodeProperty2:r,nodeProperty3:o}=this,i=n.applyForInput(e[s][r][o],t);this.setViewModelValue(i),this.lastViewModelValue=i}}const L=t=>t instanceof HTMLElement?t:e.raise("not HTMLElement");class A extends M{get className(){return this.nodePropertyElements[1]}updateNode(){const{component:e,node:t,nodeProperty:s,viewModelProperty:r,filters:o,className:i}=this,a=L(t),l=n.applyForOutput(this.getViewModelValue(),o);this.lastViewModelValue!==l&&(e.updateSlot.addNodeUpdate(new k(t,s,r,l,(()=>{l?a.classList.add(i):a.classList.remove(i)}))),this.lastViewModelValue=l)}updateViewModel(){const{node:e,filters:t,className:s}=this,r=L(e),o=n.applyForInput(r.classList.contains(s),t);this.setViewModelValue(o),this.lastViewModelValue=o}}const j=t=>t instanceof HTMLInputElement?t:e.raise();class F extends M{updateNode(){const{component:e,node:t,nodeProperty:s,viewModelProperty:r,filters:o}=this,i=j(t),a=n.applyForOutput(this.getViewModelValue(),o);this.lastViewModelValue!==a&&(e.updateSlot.addNodeUpdate(new k(t,s,r,a,(()=>{i.checked=a===i.value}))),this.lastViewModelValue=a)}updateViewModel(){const{node:e,filters:t}=this,s=j(e),r=n.applyForInput(s.value,t);s.checked&&(this.setViewModelValue(r),this.lastViewModelValue=r)}}const H=t=>t instanceof HTMLInputElement?t:e.raise();class D extends M{updateNode(){const{component:e,node:t,nodeProperty:s,viewModelProperty:r,filters:o}=this,i=H(t),a=n.applyForOutput(this.getViewModelValue(),o);this.lastViewModelValue!==a&&(e.updateSlot.addNodeUpdate(new k(t,s,r,a,(()=>{i.checked=a.find((e=>e===i.value))}))),this.lastViewModelValue=a)}updateViewModel(){const{node:e,filters:t}=this,s=H(e),r=n.applyForInput(s.value,t),o=new Set(this.getViewModelValue());s.checked?o.add(r):o.delete(r);const i=Array.from(o);this.setViewModelValue(i),this.lastViewModelValue=i}}const U=e=>Array.from(e.childNodes).flatMap((e=>U(e).concat((e=>e instanceof Comment&&"@"===e.textContent[0]&&"@"===e.textContent[1]&&"@"!==e.textContent[2])(e)?e:null))).filter((e=>e));class q{static listOfRouteIndexesByTemplate=new Map;static getTargetNodes(e,t){let s;if(this.listOfRouteIndexesByTemplate.has(e)){s=this.listOfRouteIndexesByTemplate.get(e).map((e=>e.reduce(((e,t)=>e.childNodes[t]),t)))}else s=Array.from(t.querySelectorAll("[data-bind]")).concat(U(t)),this.listOfRouteIndexesByTemplate.set(e,s.map((e=>(e=>{let t=[];for(;null!=e.parentNode;)t=[Array.from(e.parentNode.childNodes).indexOf(e)].concat(t),e=e.parentNode;return t})(e))));return s}}class _{binds;childNodes;fragment;get lastNode(){return this.childNodes[this.childNodes.length-1]}get nodesForAppend(){return this.fragment.childNodes.length>0?[this.fragment]:this.childNodes}removeFromParent(){this.childNodes.forEach((e=>e.parentNode?.removeChild(e))),this.binds.forEach((e=>e.removeFromParent()))}updateNode(){this.binds.forEach((e=>{e.updateNode()}))}changeIndexes(e,t){this.binds.forEach((s=>s.changeIndexes(e,t)))}static create(e,t){const{component:s,template:n}=e,r=document.importNode(n.content,!0),o=q.getTargetNodes(n,r),i=ce.bind(o,s,e,t),a=Array.from(r.childNodes);return Object.assign(new _,{binds:i,childNodes:a,fragment:r})}}class K extends M{get node(){return super.node}set node(t){const s=(t=>t instanceof HTMLTemplateElement?t:e.raise("not HTMLTemplateElement"))(t),n=document.createComment(`template ${s.dataset.bind}`);s.parentNode.replaceChild(n,s),super.node=n,this.template=s}get nodeProperty(){return super.nodeProperty}set nodeProperty(e){super.nodeProperty=e}templateChildren=[];#h;get template(){return this.#h}set template(e){this.#h=e}updateNode(){const t=this.nodeProperty===u?this.expandLoop():"if"===this.nodeProperty?this.expandIf():e.raise(`unknown property ${this.nodeProperty}`);this.lastViewModelValue=t instanceof Array?t.slice():t}removeFromParent(){this.templateChildren.forEach((e=>e.removeFromParent()))}appendToParent(){const e=document.createDocumentFragment();this.templateChildren.forEach((t=>e.appendChild(...t.nodesForAppend))),this.node.after(e)}expandIf(){const{contextIndexes:e,filters:t}=this,s=this.lastViewModelValue,r=n.applyForOutput(this.getViewModelValue(),t);return s!==r&&(this.removeFromParent(),r?(this.templateChildren=[_.create(this,e)],this.appendToParent()):this.templateChildren=[]),this.templateChildren.forEach((e=>e.updateNode())),r}expandLoop(){const{contextIndexes:e,filters:t,templateChildren:s}=this,r=this.lastViewModelValue??[],o=n.applyForOutput(this.getViewModelValue(),t)??[],i=r.reduce(((e,t,s)=>(e.get(t)?.push(s)??e.set(t,[s]),e)),new Map),a=new Map,l=[],p=o.map(((t,n)=>{const r=i.get(t);if(void 0===r||0===r.length)return a.set(n,void 0),l.push(n),_.create(this,e.concat(n));{const e=r.shift();a.set(n,e);const t=s[e];n!==e&&t.changeIndexes(this,n-e);const o=a.get(n-1);return(void 0===o||o>e)&&l.push(n),t}}));for(const e of i.values())for(const t of e)s[t].removeFromParent();return l.forEach((e=>{const t=p[e];(p[e-1]?.lastNode??this.node).after(...t.nodesForAppend)})),p.forEach((e=>e.updateNode())),this.templateChildren=p,o}changeIndexes(e,t){super.changeIndexes(e,t),this.templateChildren.forEach((s=>s.changeIndexes(e,t)))}}class W{target;thisArgument;argumentsList;constructor(e,t,s){this.target=e,this.thisArgument=t,this.argumentsList=s}}class G{queue=[];#d;constructor(e){this.#d=e}async exec(){this.#d&&this.#d(C);try{for(;this.queue.length>0;){const e=this.queue.splice(0);for(const t of e)await Reflect.apply(t.target,t.thisArgument,t.argumentsList)}}finally{this.#d&&this.#d(E)}}get isEmpty(){return 0===this.queue.length}}class z extends M{#u;get eventType(){return this.#u}set eventType(e){this.#u=e}addEventListener(){const{component:e,element:t,eventType:s,viewModel:n,viewModelProperty:r}=this;t.addEventListener(s,(t=>{t.stopPropagation();const s=this.contextIndexes,o=new W(n[N.directlyCall],n,[r,s,t]);e.updateSlot.addProcess(o)}))}}class X extends M{get node(){return super.node}set node(t){this.thisComponent=(t=>t instanceof Ae?t:e.raise("not Component"))(t),super.node=t}#m(){return void 0!==this.viewModelProperty&&void 0!==this.nodePropertyElements}get viewModelProperty(){return super.viewModelProperty}set viewModelProperty(e){super.viewModelProperty=e,this.#m()&&this.bindProperty()}get nodePropertyElements(){return super.nodePropertyElements}set nodePropertyElements(e){super.nodePropertyElements=e,this.#m()&&this.bindProperty()}get dataNameProperty(){return this.nodePropertyElements[0]}get dataProperty(){return this.nodePropertyElements[1]}#y;get thisComponent(){return this.#y}set thisComponent(e){this.#y=e}bindProperty(){this.thisComponent.props[N.bindProperty](this.dataProperty,this.viewModelProperty,this.indexes)}updateNode(){const{node:e,dataProperty:t}=this;this.thisComponent.viewModel?.[N.notifyForDependentProps](`$props.${t}`,[])}updateViewModel(){}}const Z=new Map;Z.set(r,((e,t)=>Object.assign(new R,e,t))),Z.set(o,((e,t)=>Object.assign(new O,e,t))),Z.set(i,((e,t)=>Object.assign(new $,e,t))),Z.set(a,((e,t)=>Object.assign(new A,e,t))),Z.set(l,((e,t)=>Object.assign(new F,e,t))),Z.set(p,((e,t)=>Object.assign(new D,e,t))),Z.set(c,((e,t)=>Object.assign(new K,e,t))),Z.set(d,((e,t)=>Object.assign(new z,e,t))),Z.set(h,((e,t)=>Object.assign(new X,e,t)));class J{static create({component:t,node:s,nodeProperty:n,viewModel:r,viewModelProperty:o,filters:i,contextBind:a,contextIndexes:l}){const p={component:t,node:s,nodeProperty:n,viewModel:r,viewModelProperty:o,filters:i,contextBind:a,parentContextBind:null,contextIndexes:l,positionContextIndexes:-1},c=v.PropertyName.create(o);if(c.level>0){let t=a;for(;null!=t;){if(v.PropertyName.create(t.viewModelProperty).level+1===c.level&&c.setOfParentPaths.has(t.viewModelProperty))break;t=t.contextBind}null===t&&e.raise(`not found parent contextBind, viewModelProperty = ${o}`);const s=t.contextIndexes.length;p.indexes=t.indexes.concat(l[s]),p.positionContextIndexes=s,p.parentContextBind=t}else p.indexes=[];const d=m.get(s,n);return Z.get(d.type)(p,d)}}class Q{nodeProperty;viewModelProperty;filters}const Y=e=>e.trim(),ee=e=>e.length>0,te=e=>{const[t,...s]=e.split("|").map(Y);return{viewModelProperty:t,filters:s.map((e=>(e=>{const[t,...s]=e.split(",").map(Y);return Object.assign(new n,{name:t,options:s})})(e)))}},se=(e,t)=>e.split(";").map(Y).filter(ee).map((e=>{let{nodeProperty:s,viewModelProperty:n,filters:r}=((e,t)=>{const[s,n]=[t].concat(...e.split(":").map(Y)).splice(-2),{viewModelProperty:r,filters:o}=te(n);return{nodeProperty:s,viewModelProperty:r,filters:o}})(e,"$");return n="@"===n?s:n,s="$"===s?t:s,{nodeProperty:s,viewModelProperty:n,filters:r}}));class ne{static bindTextsByKey=new Map;static parse(e,t){const s=e+"\t"+t;let n=this.bindTextsByKey.get(s);return void 0===n&&(n=se(e,t).map((e=>Object.assign(new Q,e))),this.bindTextsByKey.set(s,n)),n}}class re{static bind(e,t,s,n){}static parseBindText=(e,t,s,n,r)=>(o,i)=>ne.parse(o,i).map((o=>J.create(Object.assign(o,{node:e,component:t,viewModel:s,contextBind:n,contextIndexes:r.slice()}))));static applyUpdateNode=e=>e.updateNode()}class oe extends re{static bind(t,s,n,r){const o=s.viewModel,i=(t=>t instanceof HTMLTemplateElement?t:e.raise("not HTMLTemplateElement"))(t),a=i.dataset.bind;let l=this.parseBindText(t,s,o,n,r)(a,"");return l=l.length>0?[l[0]]:[],l.forEach(this.applyUpdateNode),l}}const ie="oninput",ae=ie.slice(2);class le extends re{static bind(t,s,n,r){const o=s.viewModel,i=(t=>t instanceof HTMLElement?t:e.raise("not HTMLElement"))(t),a=i.dataset.bind,l=(e=>e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLOptionElement?"value":e instanceof HTMLInputElement?"radio"===e.type||"checkbox"===e.type?"checked":"value":"textContent")(i),p=this.parseBindText(t,s,o,n,r)(a,l);p.forEach(this.applyUpdateNode);let c=!1,d=null;return p.forEach((e=>{c||=e.nodeProperty===ie,d=e.nodeProperty===l?e:d,(e=>e instanceof z?e:void 0)(e)?.addEventListener()})),d&&!c&&(e=>e instanceof HTMLElement&&(e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement))(t)&&i.addEventListener(ae,(e=>{e.stopPropagation();const t=new W(d.updateViewModel,d,[]);s.updateSlot.addProcess(t)})),p}}class pe extends re{static bind(t,s,n,r){const o=s.viewModel,i=(t=>t instanceof Comment?t:e.raise("not Comment"))(t),a=i.textContent.slice(2),l=document.createTextNode("");i.parentNode.replaceChild(l,i);const p=this.parseBindText(l,s,o,n,r)(a,"textContent");return p.forEach(this.applyUpdateNode),p}}class ce{static bind(t,s,n,r){return t.flatMap((t=>t instanceof HTMLTemplateElement?oe.bind(t,s,n,r):t instanceof HTMLElement?le.bind(t,s,n,r):t instanceof Comment?pe.bind(t,s,n,r):e.raise("unknown node type")))}}class de{static render(e,t,s){const n=document.importNode(s.content,!0),r=q.getTargetNodes(s,n),o=ce.bind(r,t,null,[]);return e.appendChild(n),o}}class he{#f=new Map;get(e,t){const s=this.#f.get(e);return s?s.get(t.toString()):void 0}set(e,t,s){let n=this.#f.get(e);return n||(n=new Map,this.#f.set(e,n)),n.set(t.toString(),s),s}clear(){this.#f.clear()}}class ue{static getDescByName(e){const t=new Map;let s=e;for(;s!==Object.prototype;){const e=Object.getOwnPropertyDescriptors(s);for(const[s,n]of Object.entries(e))t.has(s)||t.set(s,n);s=Object.getPrototypeOf(s)}return t}static getMethods(e,t){return e.filter((([e,s])=>s.value!==t&&"function"==typeof s.value))}static getProperties(e,t){return e.filter((([e,s])=>s.value!==t&&"function"!=typeof s.value))}static viewModelize(e){const t=e.constructor;let s=this.viewModelInfoByConstructor.get(t);if(!s){const n=this.getDescByName(e),r=Array.from(n.entries()),o=[],i=[],a=[],l=this.getMethods(r,e.constructor).map((([e,t])=>e));this.getProperties(r,e.constructor).forEach((([e,t])=>{i.push(e);x.create(e).isPrimitive||"value"in t&&void 0===t.value&&o.push(e),"get"in t&&void 0!==t.get&&a.push(e)})),s={removeProps:o,definedProps:i,methods:l,accessorProps:a},this.viewModelInfoByConstructor.set(t,s)}return s.removeProps.forEach((t=>Reflect.deleteProperty(e,t))),{definedProps:s.definedProps,methods:s.methods,accessorProps:s.accessorProps,viewModel:e}}static viewModelInfoByConstructor=new Map}let me=class{#P;get updateCallback(){return this.#P}constructor(e){this.#P=e}get(e,t,s){return t===N.isProxy||(t===N.getRaw?e:Reflect.get(e,t,s))}set(e,t,s,n){return Reflect.set(e,t,s,n),"length"===t&&this.updateCallback(),!0}};function ye(e,t){return new Proxy(e,new me(t))}class fe{#g=new Set;#w=new Map;get setOfPropsByRefProp(){return this.#w}hasDefaultProp(e){return this.#g.has(e)}addDefaultProp(e){let t=v.PropertyName.create(e);for(;""!==t.parentPath;){const e=v.PropertyName.create(t.parentPath);this.#g.has(t.name)||(this.#w.get(e.name)?.add(t.name)??this.#w.set(e.name,new Set([t.name])),this.#g.add(t.name)),t=e}}setDependentProps(e){for(const[t,s]of Object.entries(e))for(const e of s)this.#w.get(e)?.add(t)??this.#w.set(e,new Set([t]))}}const Pe={[N.connectedCallback]:"$connectedCallback",[N.disconnectedCallback]:"$disconnectedCallback",[N.writeCallback]:"$writeCallback",[N.initCallback]:"$initCallback"},ge=new Set([N.connectedCallback,N.disconnectedCallback,N.writeCallback,N.initCallback]),we=new Set([N.directlyCall,N.getDependentProps,N.notifyForDependentProps,N.getHandler,N.beCacheable,N.beUncacheable]),xe="$props",ve="$globals",be="$dependentProps",Ne=new Set([xe,ve,be]);class Me extends v.Handler{#x;get component(){return this.#x}#v=new he;get cache(){return this.#v}#b;get methods(){return this.#b}#N;get accessorProperties(){return this.#N}#M;get setOfAccessorProperties(){return this.#M}#C=new fe;get dependentProps(){return this.#C}#E=!1;get cacheable(){return this.#E}set cacheable(e){this.#E=e}constructor(e,t,s,n){super(),this.#x=e,this.#b=s,this.#N=t,this.#M=new Set(this.#N),this.#C.setDependentProps(n??{})}#S(e,t,s){this.#T(e,t,s)}getByPropertyName(e,{propName:t},s){let n;if(t.isPrimitive||!this.#C.hasDefaultProp(t.name)&&this.#C.addDefaultProp(t.name),Ne.has(t.name))return t.name===xe?this.component.props:t.name===ve?this.component.globals:Reflect.get(e,be,s);if(this.#M.has(t.name)&&this.#E){const r=t.level>0?this.lastIndexes.slice(0,t.level):[];n=this.#v.get(t,r),void 0===n&&(n=super.getByPropertyName(e,{propName:t},s),this.#v.set(t,r,n))}else n=super.getByPropertyName(e,{propName:t},s);return n}setByPropertyName(e,{propName:t,value:s},n){t.isPrimitive||!this.#C.hasDefaultProp(t.name)&&this.#C.addDefaultProp(t.name);const r=this.lastIndexes,o={propName:t,indexes:r},i=super.setByPropertyName(e,{propName:t,value:s},n);return n[N.writeCallback](t.name,r),this.#T(e,o,n),i}#I(e,t,s){this.#x.updateSlot.addProcess(new W(e,t,s))}#T(e,t,s){this.#x.updateSlot.addNotify(t)}[N.directlyGet](e,{prop:t,indexes:s},n){let r=super[N.directlyGet](e,{prop:t,indexes:s},n);if(r instanceof Array){const o=v.PropertyName.create(t);r=ye(r,(()=>{this.#S(e,{propName:o,indexes:s},n)}))}return r}[N.beCacheable](e,t){return this.cacheable=!0,this.#v.clear(),this.cacheable}[N.beUncacheable](e,t){return this.cacheable=!1,this.cacheable}async#V(e,{propName:t,indexes:s,event:n},r){this.stackIndexes.push(s);try{return await Reflect.apply(e[t.name],r,[n,...s])}finally{this.stackIndexes.pop()}}wrapArray(e,{prop:t,value:s},n){if(s instanceof Array){const r=this.lastIndexes;s=ye(s,(()=>{let{propName:s,indexes:o}=v.PropertyName.parse(t);s.isPrimitive||s.level>o.length&&(o=r.slice(0,s.level)),this.#S(e,{propName:s,indexes:o},n)}))}return s}get(e,t,s){if(ge.has(t)){const n=Pe[t],r=(...t)=>async()=>Reflect.apply(e[n],s,t);return t===N.initCallback?n in e?(...e)=>r(...e)():()=>{}:n in e?(...e)=>this.#I(r(...e),s,[]):()=>{}}if(we.has(t))return t===N.directlyCall?async(t,n,r)=>this.#V(e,{propName:v.PropertyName.create(t),indexes:n,event:r},s):t===N.notifyForDependentProps?(t,n)=>{const r={propName:v.PropertyName.create(t),indexes:n};this.#T(e,r,s)}:t===N.getDependentProps?()=>this.dependentProps:t===N.getHandler?()=>this:t===N.beCacheable?()=>Reflect.apply(this[N.beCacheable],this,[e,s]):()=>Reflect.apply(this[N.beUncacheable],this,[e,s]);{const n=super.get(e,t,s);return this.wrapArray(e,{prop:t,value:n},s)}}set(e,t,s,n){return s=s?.[N.isProxy]?s[N.getRaw]:s,super.set(e,t,s,n)}static makeNotifyForDependentProps(e,t,s=new Set([])){const{propName:n,indexes:r}=t,o=n.name+"\t"+r.toString();if(s.has(o))return[];s.add(o);const i=e[N.getDependentProps]().setOfPropsByRefProp.get(n.name),a=[];if(void 0===i)return[];for(const t of i){const n=v.PropertyName.create(t);if(r.length<n.level){const t=Me.expandIndexes(e,{propName:n,indexes:r});a.push(...t.map((e=>({propName:n,indexes:e}))))}else{const e=r.slice(0,n.level);a.push({propName:n,indexes:e})}a.push(...this.makeNotifyForDependentProps(e,{propName:n,indexes:r},s))}return a}static expandIndexes(e,t){const{propName:s,indexes:n}=t;if(s.level===n.length)return[n];if(s.level<n.length)return[n.slice(0,s.level)];{const t=(r,o,i)=>{const a=""!==r?r+".":r,l=s.pathNames[o],p=s.pathNames.length-1===o,c=a+l;let d;return d=p?"*"===l?e[N.directlyGet](r,i).flatMap(((e,t)=>[i.concat(t)])):[i]:"*"===l?i.length<n.length?t(c,o+1,n.slice(0,i.length+1)):e[N.directlyGet](r,i).flatMap(((e,s)=>t(c,o+1,i.concat(s)))):t(c,o+1,i),d};return t("",0,[])}}}const Ce=e=>e instanceof K?e:void 0;class Ee{static getTemplateBinds(e,t){const s=[],n=[{binds:e,children:null,index:-1}];for(;n.length>0;){const e=n[n.length-1];if(e.index++,e.binds)if(e.index<e.binds.length){const r=Ce(e.binds[e.index]);r&&(t.has(r.viewModelPropertyKey)?s.push(r):r.templateChildren.length>0&&n.push({binds:null,children:r.templateChildren,index:-1}))}else n.pop();else if(e.index<e.children.length){const t=e.children[e.index];t.binds.length>0&&n.push({binds:t.binds,children:null,index:-1})}else n.pop()}return s}static applyToNode(e,t){const s=new Set(this.getTemplateBinds(e,t));if(s.size>0)for(const e of s)e.updateNode();const n=e=>{e.forEach((e=>{!s.has(e)&&t.has(e.viewModelPropertyKey)&&e.updateNode(),Ce(e)?.templateChildren.forEach((e=>n(e.binds)))}))};n(e)}}let Se=class{#x;#k=new Map;#B=new Proxy({},new v.Handler);get data(){return this.#x?.parentComponent?.viewModel??this.#B}constructor(e){this.#x=e}get(e,t,s){if(t===N.bindProperty)return(e,t,s)=>this.#k.set(e,{bindProp:t,bindIndexes:s});const{data:n}=this,{bindProp:r,bindIndexes:o}=this.#k.get(t)??{};return r?n[N.directlyGet](r,o):void console.log(`undefined property ${t}`)}set(e,t,s,n){const{data:r}=this,{bindProp:o,bindIndexes:i}=this.#k.get(t)??{};return o?r[N.directlySet](o,i,s):(console.log(`undefined property ${t}`),!1)}};class Te extends v.Handler{#R=new Map;get(e,t,s){return t===N.boundByComponent?(e,t)=>{let s=this.#R.get(t);null==s?this.#R.set(t,new Set([e])):s.add(e)}:super.get(e,t,s)}set(e,t,s,n){const{propName:r,indexes:o}=v.PropertyName.parse(t),i=n[N.directlySet](r.name,o,s);let a=this.#R.get(r.name);if(a)for(const e of a)e.viewModel[N.notifyForDependentProps]("$globals."+r.name,o);return i}}class Ie{static create(){return new Proxy({},new Te)}static data=this.create()}class Ve{#x;setOfProps=new Set;constructor(e){this.#x=e}bindProperty(e){Ie.data[N.boundByComponent](this.#x,e),this.setOfProps.add(e)}directGet=(e,t)=>(this.setOfProps.has(e)||this.bindProperty(e),Ie.data[N.directlyGet](e,t));directSet=(e,t,s)=>(this.setOfProps.has(e)||this.bindProperty(e),Ie.data[N.directlySet](e,t,s));get(e,t,s){if(t===N.directlyGet)return this.directGet;if(t===N.directlySet)return this.directSet;if(t===N.isSupportDotNotation)return!0;const{propName:n,indexes:r}=v.PropertyName.parse(t);return this.directGet(n.name,r)}set(e,t,s,n){const{propName:r,indexes:o}=v.PropertyName.parse(t);return this.directSet(r.name,o,s)}}class ke{html;css;ViewModel;#h;get template(){return void 0===this.#h&&(this.#h=ke.htmlToTemplate(this.html,this.css)),this.#h}static replaceTag(e){const t=[];return e.replaceAll(/\{\{([^\}]+)\}\}/g,((e,s)=>{if((s=s.trim()).startsWith("loop:")||s.startsWith("if:"))return t.push(s),`<template data-bind="${s}">`;if(s.startsWith("else:")){return`</template><template data-bind="${t.at(-1)}|not">`}return s.startsWith("end:")?(t.pop(),"</template>"):`\x3c!--@@${s}--\x3e`}))}static htmlToTemplate(e,t){const s=document.createElement("template");return s.innerHTML=(t?`<style>\n${t}\n</style>`:"")+(e?ke.replaceTag(e):""),s}}class Be{static#O={debug:!1};static components(t){return Object.entries(t).forEach((([t,s])=>{const n=e.toKebabCase(t);customElements.define(n,s)})),this}static componentModules(t){return Object.entries(t).forEach((([t,s])=>{const n=e.toKebabCase(t),r=Ae.getClass(s);customElements.define(n,r)})),this}static filters(e){return Object.entries(e).forEach((([e,t])=>{const{input:s,output:r}=t;n.regist(e,r,s)})),this}static globals(e){Object.assign(Ie.data,e)}static config({debug:e=!1}){return this.#O=Object.assign(this.#O,{debug:e}),this}static get debug(){return this.#O.debug}}class Re extends Error{}class Oe{#$;#L;#A=!0;get alive(){return this.#A}constructor(){this.main()}async#j(){return new Promise(((e,t)=>{this.#$=e,this.#L=t}))}stop(){this.#L(new Re("stop"))}wakeup(e){this.#$(e)}async main(){for(;;)try{const e=await this.#j();await e.waiting(),Be.debug&&performance.mark("slot-exec:start");try{await e.exec(),Be.debug&&(performance.mark("slot-exec:end"),performance.measure("slot-exec","slot-exec:start","slot-exec:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures(),performance.clearMarks())}finally{e.callback()}}catch(e){if(e instanceof Re)break;if(console.error(e),!confirm("致命的なエラーが発生しました。続行しますか？"))break}this.#A=!1}}class $e{queue=[];#d;#x;constructor(e,t){this.#x=e,this.#d=t}async exec(){this.#d&&this.#d(S);try{for(;this.queue.length>0;){const e=this.queue.splice(0),t=[];for(const s of e)t.push(...Me.makeNotifyForDependentProps(this.#x.viewModel,s));const s=new Set(e.concat(t).map((e=>e.propName.name+"\t"+e.indexes.toString())));this.#x.applyToNode(s)}}finally{this.#d&&this.#d(T)}}get isEmpty(){return 0===this.queue.length}}class Le{#F;get viewModelUpdator(){return this.#F}#H;get notifyReceiver(){return this.#H}#D;get nodeUpdator(){return this.#D}#U;#q;#_;#K;#W;#G;#z;constructor(e,t=null,s=null){this.#F=new G(s),this.#H=new $e(e,s),this.#D=new B(s),this.#U=t,this.#q=new Promise(((e,t)=>{this.#K=e,this.#W=t})),this.#_=new Promise(((e,t)=>{this.#G=e,this.#z=t}))}async waiting(){return this.#q}waitResolve(e){this.#K(e)}waitReject(){this.#W()}async alive(){return this.#_}async exec(){do{await this.#F.exec(),await this.#H.exec(),await this.#D.exec()}while(!this.#F.isEmpty||!this.#H.isEmpty||!this.#D.isEmpty);this.#G()}async addProcess(e){this.#F.queue.push(e),this.#K(!0)}async addNotify(e){this.#H.queue.push(e),this.#K(!0)}async addNodeUpdate(e){this.#D.queue.push(e),this.#K(!0)}callback(){this.#U&&this.#U()}static create(e,t,s){return new Le(e,t,s)}}class Ae extends HTMLElement{static template;static ViewModel;viewModel;#X;get binds(){return this.#X}#Z;get thread(){return this.#Z}set thread(e){this.#Z=e}#J;get updateSlot(){return void 0===this.#J&&(this.#J=Le.create(this,(()=>{this.#J=void 0}),(e=>{e===C||e===S?this.viewModel[N.beUncacheable]():e===I&&this.viewModel[N.beCacheable]()})),this.#Z.wakeup(this.#J)),this.#J}set updateSlot(e){this.#J=e}#Q=function(e){return new Proxy({},new Se(e))}(this);get props(){return this.#Q}#Y=function(e){return new Proxy({},new Ve(e))}();get globals(){return this.#Y}constructor(){super(),this.#ee=new Promise(((e,t)=>{this.#te=e,this.#se=t}))}get noShadowRoot(){return this.hasAttribute("no-shadow-root")}get viewRootElement(){return this.shadowRoot??this}async build(){const{template:e,ViewModel:t}=this.constructor;this.noShadowRoot||this.attachShadow({mode:"open"}),this.#Z=new Oe,this.viewModel=function(e,t){const s=ue.viewModelize(Reflect.construct(t,[])),{viewModel:n,accessorProps:r,methods:o}=s;return new Proxy(n,new Me(e,r,o,n[be]))}(this,t),await this.viewModel[N.initCallback]();const s=this.updateSlot;s.addProcess(new W((async()=>(this.#X=de.render(this.viewRootElement,this,e),this.viewModel[N.connectedCallback]())),this,[])),await s.alive()}#ee;#te;#se;get initialPromise(){return this.#ee}#_;#G;#z;get alivePromise(){return this.#_}#ne;get parentComponent(){return void 0===this.#ne&&(this.#ne=(e=>{for(;;){if(null==(e=e.parentNode))return null;if(e instanceof Ae)return e;if(e instanceof ShadowRoot){if(e.host instanceof Ae)return e.host;e=e.host}}})(this)),this.#ne}async connectedCallback(){try{this.parentComponent&&await this.parentComponent.initialPromise,this.#_=new Promise(((e,t)=>{this.#G=e,this.#z=t})),await this.build()}finally{this.#te&&this.#te()}}disconnectedCallback(){this.#G&&this.#G(this.props)}applyToNode(e){this.#X&&Ee.applyToNode(this.#X,e)}static getClass(e){const t=Object.assign(new ke,e);return class extends Ae{static template=t.template;static ViewModel=t.ViewModel}}}function je(e){return Ae.getClass(e)}class Fe{static regist(e,t){}}class He{static toKebabCase=e=>"string"==typeof e?e.replaceAll(/[\._]/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e}const De="kebab",Ue="snake",qe="uppercamel",_e="lowercamel",Ke="dotted";class We{static getNames(e){const t=He.toKebabCase(e),s=t.replaceAll("-","_"),n=t.replaceAll("-","."),r=t.split("-").map(((e,t)=>(void 0!==e[0]&&(e=e[0].toUpperCase()+e.slice(1)),e))).join(""),o=r.length>0?r[0].toLowerCase()+r.slice(1):r;return{[De]:t,[Ue]:s,[qe]:r,[_e]:o,[Ke]:n}}}const Ge=_e;class ze{defaultNameType=Ge;defaultPath="./";loadNames=[];prefixMap}class Xe{prefix;path;get matchPrefix(){return`${this.prefix}-`}isMatch(e){return e.startsWith(this.matchPrefix)}getNames(e){const{prefix:t,path:s}=this;if(e.startsWith(this.matchPrefix))return{prefixName:t,subName:e.slice(this.matchPrefix.length),path:s}}}const Ze=We.getNames("prefix-name"),Je=We.getNames("sub-name");class Qe{static getPathInfo(e,t,s,n){const[r,o]=e.split("#");let i=r,a=o;const l=We.getNames(t),p=We.getNames(s);return i=i.replaceAll(`{${Ze[De]}}`,l[De]),i=i.replaceAll(`{${Ze[Ue]}}`,l[Ue]),i=i.replaceAll(`{${Ze[_e]}}`,l[_e]),i=i.replaceAll(`{${Ze[qe]}}`,l[qe]),i=i.replaceAll(`{${Ze[Ke]}}`,l[Ke]),i=i.replaceAll(`{${Je[De]}}`,p[De]),i=i.replaceAll(`{${Je[Ue]}}`,p[Ue]),i=i.replaceAll(`{${Je[_e]}}`,p[_e]),i=i.replaceAll(`{${Je[qe]}}`,p[qe]),i=i.replaceAll(`{${Je[Ke]}}`,p[Ke]),r===i&&".js"!==i.slice(-3)&&(i=i+("/"!==e.slice(-1)?"/":"")+p[n]+".js"),a&&(a=a.replaceAll(`{${Je[De]}}`,p[De]),a=a.replaceAll(`{${Je[Ue]}}`,p[Ue]),a=a.replaceAll(`{${Je[_e]}}`,p[_e]),a=a.replaceAll(`{${Je[qe]}}`,p[qe]),a=a.replaceAll(`{${Je[Ke]}}`,p[Ke])),{filePath:i,exportName:a}}}class Ye{#re;#oe;#ie;#ae;#le;constructor(e){this.#ae=e,this.#le=window.location,this.setConfig(new ze)}setConfig(e){this.#oe=Object.assign(new ze,e),"prefixMap"in e&&void 0!==e.prefixMap&&this.setPrefixMap(e.prefixMap)}getConfig(){return this.#oe}setPrefixMap(e){this.#ie=new Map(Object.entries(e).map((([e,t])=>[e=He.toKebabCase(e),Object.assign(new Xe,{prefix:e,path:t})])))}getPrefixMap(){return this.#ie}configFile(e){return this.#re=e,this}config(e){return this.setConfig(e),this}prefixMap(e){return this.setPrefixMap(e),this}get registrar(){return this.#ae}async loadConfig(e){const t=this.#le.pathname.split("/");t[t.length-1]=e;const s=this.#le.origin+t.join("/");try{const e=await fetch(s),t=await e.json();return Object.assign(new ze,t)}catch(e){throw new Error(e)}}async load(...e){if(void 0!==this.#re){const e=await this.loadConfig(this.#re);this.setConfig(e)}if(void 0===this.#ie)throw new Error("prefixMap is not defined");if(void 0===this.#ae)throw new Error("registrar is not defined");const t=Array.from(this.#ie.values()),{defaultNameType:s,defaultPath:n}=this.#oe;e=e.length>0?e:this.#oe.loadNames;for(let r of e){let o;r=He.toKebabCase(r);const i=t.find((e=>e.isMatch(r)));if(void 0!==i){const e=i.getNames(r);o=Qe.getPathInfo(e.path,e.prefixName,e.subName,s)}if(void 0===o&&void 0!==n&&(o=Qe.getPathInfo(n,"",r,s)),void 0===o)throw new Error(`unmatch prefix and no defaultPath (loadName:${r})`);const a=this.#le.pathname.split("/");a[a.length-1]=o.filePath;const l=this.#le.origin+a.join("/");let p,c;try{p=await import(l)}catch(e){throw new Error(e)}if(void 0!==o.exportName){if(!(o.exportName in p))throw new Error(`${o.exportName} not found in module (exportName:${o.exportName}, ${o.filePath})`);c=p[o.exportName]}else c=p.default;this.#ae.regist(r,c)}return this}static create(e){return new Ye(e)}}const et=Ye.create(class extends Fe{static regist(e,t){if(e.startsWith("filter-")){const s=e.slice("filter-".length),{output:r,input:o}=t;n.regist(s,r,o)}else{const s=e;t instanceof HTMLElement?window.customElements.define(s,t):window.customElements.define(s,Ae.getClass(t))}}});export{Be as default,je as generateComponentClass,et as loader};
