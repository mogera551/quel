class e{static raise(e){throw new Error(e)}static isFunction=e=>{const t=Object.prototype.toString.call(e).slice(8,-1).toLowerCase();return"function"===t||"asyncfunction"===t};static isInputableElement(e){return e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&"button"!==e.type}static toKebabCase=e=>"string"==typeof e?e.replaceAll(/_/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e;static createUUID(){return window?.crypto?.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=((new Date).getTime()+16*Math.random())%16|0;return("x"==e?t:3&t|8).toString(16)}))}}class t{#e=new Map;get(e,t){const s=this.#e.get(e);return s?s.get(t.toString()):void 0}set(e,t,s){let i=this.#e.get(e);return i||(i=new Map,this.#e.set(e,i)),i.set(t.toString(),s),s}clear(){this.#e.clear()}}const s="*",i="dot-notation",n={directlyGet:Symbol.for(i+".direct_get"),directlySet:Symbol.for(i+".direct_set"),isSupportDotNotation:Symbol.for(i+".is_support_dot_notation")},r=new RegExp(/^\$([0-9]+)$/);class a{name;pathNames=[];parentPathNames=[];parentPath;parentPaths=[];setOfParentPaths;regexp;level=0;isPrimitive;constructor(e){if(this.name=e,this.pathNames=e.split("."),this.parentPathNames=this.pathNames.slice(0,-1),this.parentPaths=this.parentPathNames.reduce(((e,t)=>(e.push(e.at(-1)?.concat(t)??[t]),e)),[]).map((e=>e.join("."))),this.setOfParentPaths=new Set(this.parentPaths),this.parentPath=this.parentPathNames.join("."),this.lastPathName=this.pathNames.at(-1),this.regexp=new RegExp("^"+e.replaceAll(".","\\.").replaceAll("*","([0-9a-zA-Z_]*)")+"$"),this.level=this.pathNames.filter((e=>e===s)).length,this.isPrimitive=1===this.pathNames.length,this.nearestWildcardName=void 0,this.nearestWildcardParentName=void 0,this.level>0)for(let e=this.pathNames.length-1;e>=0;e--)if(this.pathNames[e]===s){this.nearestWildcardName=this.pathNames.slice(0,e+1).join("."),this.nearestWildcardParentName=this.pathNames.slice(0,e).join(".");break}}static create(e){const t=this.propertyNameByName.get(e);if(t)return t;const s=new a(e);return this.propertyNameByName.set(e,s),s}static propertyNameByName=new Map;static parse(e){const t=[],s=[];for(const i of e.split(".")){const e=Number(i);isNaN(e)?s.push(i):(t.push(e),s.push("*"))}return{propName:a.create(s.join(".")),indexes:t}}}let o=class{#t=[];#s=new Map;get lastIndexes(){return this.#t[this.#t.length-1]}get stackIndexes(){return this.#t}get matchByName(){return this.#s}getByPropertyName(e,{propName:t},i){let n;if(Reflect.has(e,t.name))n=Reflect.get(e,t.name,i);else if(""!==t.parentPath){const r=a.create(t.parentPath),o=this.getByPropertyName(e,{propName:r},i);if(void 0!==o){const e=t.lastPathName===s?this.lastIndexes[t.level-1]:t.lastPathName;n=Reflect.get(o,e)}}return n}setByPropertyName(e,{propName:t,value:i},n){let r=!1;if(Reflect.has(e,t.name)||t.isPrimitive)r=Reflect.set(e,t.name,i,n);else{const o=a.create(t.parentPath),l=this.getByPropertyName(e,{propName:o},n);if(void 0!==l){const e=t.lastPathName===s?this.lastIndexes[t.level-1]:t.lastPathName;r=Reflect.set(l,e,i)}}return r}pushIndexes(e,t){this.#t.push(e);try{return Reflect.apply(t,this,[])}finally{this.#t.pop()}}getFunc=(e,t)=>({propName:s,indexes:i})=>this.pushIndexes(i,(()=>this.getByPropertyName(e,{propName:s},t)));setFunc=(e,t)=>({propName:s,indexes:i},n)=>this.pushIndexes(i,(()=>this.setByPropertyName(e,{propName:s,value:n},t)));getExpandLastLevel(e,{propName:t,indexes:s},i){const n=this.getFunc(e,i);if(void 0===t.nearestWildcardName)throw new Error(`not found wildcard path of '${t.name}'`);const r=a.create(t.nearestWildcardParentName);return n({propName:r,indexes:s}).map(((e,i)=>n({propName:t,indexes:s.concat(i)})))}setExpandLastLevel(e,{propName:t,indexes:s,values:i},n){const r=this.getFunc(e,n),o=this.setFunc(e,n);if(void 0===t.nearestWildcardName)throw new Error(`not found wildcard path of '${t.name}'`);const l=a.create(t.nearestWildcardParentName),c=r({propName:l,indexes:s}),p=Array.isArray(i)?i:[...Array(c.length)].map((e=>i));if(t.nearestWildcardName===t.name)o({propName:l,indexes:s},p);else{if(p.length!==c.length)throw new Error(`not match array count '${t.name}'`);for(let e in c)o({propName:t,indexes:s.concat(Number(e))},p[e])}return!0}[n.directlyGet](e,{prop:t,indexes:s},i){const n=a.create(t);return this.pushIndexes(s,(()=>this.getByPropertyName(e,{propName:n},i)))}[n.directlySet](e,{prop:t,indexes:s,value:i},n){const r=a.create(t);return this.pushIndexes(s,(()=>this.setByPropertyName(e,{propName:r,value:i},n)))}get(e,t,s){const i="string"==typeof t;if(i&&(t.startsWith("@@__")||"constructor"===t))return Reflect.get(e,t,s);const o=this.getFunc(e,s),l=this.lastIndexes;let c;if(t===n.directlyGet)return(t,i)=>Reflect.apply(this[n.directlyGet],this,[e,{prop:t,indexes:i},s]);if(t===n.directlySet)return(t,i,r)=>Reflect.apply(this[n.directlySet],this,[e,{prop:t,indexes:i,value:r},s]);if(t===n.isSupportDotNotation)return!0;if(i){if(c=r.exec(t))return l?.[Number(c[1])-1]??void 0;if("@"===t.at(0)){const i=t.slice(1),n=a.create(i);if((l?.length??0)+1<n.level)throw new Error("array level not match");const r=l?.slice(0,n.level-1)??[];return this.getExpandLastLevel(e,{propName:n,indexes:r},s)}if(this.#s.has(t))return o(this.#s.get(t));const i=a.parse(t);return i.propName.level===i.indexes.length&&this.#s.set(t,i),o({propName:i.propName,indexes:i.indexes.concat(l?.slice(i.indexes.length)??[])})}return Reflect.get(e,t,s)}set(e,t,s,i){if("string"==typeof t){if(t.startsWith("@@__")||"constructor"===t)return Reflect.set(e,t,s,i);const n=this.setFunc(e,i),r=this.lastIndexes;if("@"===t.at(0)){const n=t.slice(1),r=a.create(n);if((this.lastIndexes?.length??0)+1<r.level)throw new Error("array level not match");const o=this.lastIndexes?.slice(0,r.level-1)??[];return this.setExpandLastLevel(e,{propName:r,indexes:o,values:s},i)}if(this.#s.has(t))return n(this.#s.get(t),s);const o=a.parse(t);return o.propName.level===o.indexes.length&&this.#s.set(t,o),n({propName:o.propName,indexes:o.indexes.concat(r?.slice(o.indexes.length)??[])},s)}return Reflect.set(e,t,s,i)}};class l{static getDescByName(e){const t=new Map;let s=e;for(;s!==Object.prototype;){const e=Object.getOwnPropertyDescriptors(s);for(const[s,i]of Object.entries(e))t.has(s)||t.set(s,i);s=Object.getPrototypeOf(s)}return t}static getMethods(e,t){return e.filter((([e,s])=>s.value!==t&&"function"==typeof s.value))}static getProperties(e,t){return e.filter((([e,s])=>s.value!==t&&"function"!=typeof s.value))}static viewModelize(e){const t=e.constructor;let s=this.viewModelInfoByConstructor.get(t);if(!s){const i=this.getDescByName(e),n=Array.from(i.entries()),r=[],o=[],l=[],c=this.getMethods(n,e.constructor).map((([e,t])=>e));this.getProperties(n,e.constructor).forEach((([e,t])=>{o.push(e);a.create(e).isPrimitive||"value"in t&&void 0===t.value&&r.push(e),"get"in t&&void 0!==t.get&&l.push(e)})),s={removeProps:r,definedProps:o,methods:c,accessorProps:l},this.viewModelInfoByConstructor.set(t,s)}return s.removeProps.forEach((t=>Reflect.deleteProperty(e,t))),{definedProps:s.definedProps,methods:s.methods,accessorProps:s.accessorProps,viewModel:e}}static viewModelInfoByConstructor=new Map}const c="quel",p=Object.assign({connectedCallback:Symbol.for(`${c}:viewModel.connectedCallback`),disconnectedCallback:Symbol.for(`${c}:viewModel.disconnectedCallback`),initCallback:Symbol.for(`${c}:viewModel.initCallback`),writeCallback:Symbol.for(`${c}:viewModel.writeCallback`),getDependentProps:Symbol.for(`${c}:viewModel.getDependentProps`),getHandler:Symbol.for(`${c}:viewModel.getHandler`),addNotify:Symbol.for(`${c}:viewModel.addNotify`),beCacheable:Symbol.for(`${c}:viewModel.beCacheable`),beUncacheable:Symbol.for(`${c}:viewModel.beUncacheable`),boundByComponent:Symbol.for(`${c}:globalData.boundByComponent`),directlyCall:Symbol.for(`${c}:viewModel.directCall`),bindTo:Symbol.for(`${c}:componentModule.bindTo`),notifyForDependentProps:Symbol.for(`${c}:viewModel.notifyForDependentProps`),bindProperty:Symbol.for(`${c}:props.bindProperty`),toObject:Symbol.for(`${c}:props.toObject`),isComponent:Symbol.for(`${c}:component.isComponent`)},n),d=1,h=2,u=3,m=4,f=5,g=6;class y{target;thisArgument;argumentsList;constructor(e,t,s){this.target=e,this.thisArgument=t,this.argumentsList=s}}class b{queue=[];#i;constructor(e){this.#i=e}async exec(){this.#i&&this.#i(d);try{for(;this.queue.length>0;){const e=this.queue.splice(0);for(const t of e)await Reflect.apply(t.target,t.thisArgument,t.argumentsList)}}finally{this.#i&&this.#i(h)}}get isEmpty(){return 0===this.queue.length}}class v{#n=new Set;#r=new Map;get setOfPropsByRefProp(){return this.#r}hasDefaultProp(e){return this.#n.has(e)}addDefaultProp(e){let t=a.create(e);for(;""!==t.parentPath;){const e=a.create(t.parentPath);this.#n.has(t.name)||(this.#r.get(e.name)?.add(t.name)??this.#r.set(e.name,new Set([t.name])),this.#n.add(t.name)),t=e}}setDependentProps(e){for(const[t,s]of Object.entries(e))for(const e of s)this.#r.get(e)?.add(t)??this.#r.set(e,new Set([t]))}}const x={[p.connectedCallback]:"$connectedCallback",[p.disconnectedCallback]:"$disconnectedCallback",[p.writeCallback]:"$writeCallback",[p.initCallback]:"$initCallback"},P=new Set([p.connectedCallback,p.disconnectedCallback,p.writeCallback,p.initCallback]),w=new Set([p.directlyCall,p.getDependentProps,p.notifyForDependentProps,p.getHandler,p.beCacheable,p.beUncacheable]),N="$props",C="$globals",M="$dependentProps",E="$openDialog",S="$component",B=new Set([N,C,M,E,"$closeDialog",S]);class k extends o{#a;get component(){return this.#a}#o=new t;get cache(){return this.#o}#l;get methods(){return this.#l}#c;get accessorProperties(){return this.#c}#p;get setOfAccessorProperties(){return this.#p}#d=new v;get dependentProps(){return this.#d}#h=!1;get cacheable(){return this.#h}set cacheable(e){this.#h=e}#u;get context(){return this.#u}set context(e){this.#u=e}constructor(e,t,s,i){super(),this.#a=e,this.#l=s,this.#c=t,this.#p=new Set(this.#c),this.#d.setDependentProps(i??{})}getByPropertyName(e,{propName:t},s){let i;if(t.isPrimitive||!this.#d.hasDefaultProp(t.name)&&this.#d.addDefaultProp(t.name),B.has(t.name))return t.name===N?this.component.props:t.name===C?this.component.globals:t.name===M?Reflect.get(e,M,s):t.name===E?(t,i={},n={})=>Reflect.apply(this.#m,this,[e,{name:t,data:i,attributes:n},s]):t.name===S?this.component:(t={})=>Reflect.apply(this.#f,this,[e,t,s]);if(this.#p.has(t.name)&&this.#h){const n=t.level>0?this.lastIndexes.slice(0,t.level):[];i=this.#o.get(t,n),void 0===i&&(i=super.getByPropertyName(e,{propName:t},s),this.#o.set(t,n,i))}else i=super.getByPropertyName(e,{propName:t},s);return i}setByPropertyName(e,{propName:t,value:s},i){t.isPrimitive||!this.#d.hasDefaultProp(t.name)&&this.#d.addDefaultProp(t.name);const n=this.lastIndexes,r={propName:t,indexes:n},a=super.setByPropertyName(e,{propName:t,value:s},i);return i[p.writeCallback](t.name,n),this.#g(e,r,i),a}#y(e,t,s){this.#a.updateSlot.addProcess(new y(e,t,s))}#g(e,t,s){this.#a.updateSlot.addNotify(t)}async#m(t,{name:s,data:i,attributes:n},r){const a=e.toKebabCase(s),o=document.createElement(a);return Object.entries(n).forEach((([e,t])=>{o.setAttribute(e,t)})),Object.entries(i).forEach((([e,t])=>{o.props[p.bindProperty](e,e,[]),o.props[e]=t})),document.body.appendChild(o),o.alivePromise}#f(e,t,s){const i=this.#a;Object.entries(t).forEach((([e,t])=>{i.props[e]=t})),i.parentNode.removeChild(i)}[p.directlyGet](e,{prop:t,indexes:s},i){return super[p.directlyGet](e,{prop:t,indexes:s},i)}[p.beCacheable](e,t){return this.cacheable=!0,this.#o.clear(),this.cacheable}[p.beUncacheable](e,t){return this.cacheable=!1,this.cacheable}async#b(t,{prop:s,context:i,event:n},r){const o=a.create(s);void 0!==this.context&&e.raise("directCall already called"),this.context=i,this.stackIndexes.push(void 0);try{return await Reflect.apply(t[o.name],r,[n,...i.indexes])}finally{this.stackIndexes.pop(),this.context=void 0}}get(t,s,i){if(P.has(s)){const e=x[s],n=(...s)=>async()=>Reflect.apply(t[e],i,s);return s===p.initCallback?e in t?(...e)=>n(...e)():()=>{}:e in t?(...e)=>this.#y(n(...e),i,[]):()=>{}}if(w.has(s))return s===p.directlyCall?async(e,s,n)=>this.#b(t,{prop:e,context:s,event:n},i):s===p.notifyForDependentProps?(e,s)=>{const n={propName:a.create(e),indexes:s};this.#g(t,n,i)}:s===p.getDependentProps?()=>this.dependentProps:s===p.getHandler?()=>this:s===p.beCacheable?()=>Reflect.apply(this[p.beCacheable],this,[t,i]):()=>Reflect.apply(this[p.beUncacheable],this,[t,i]);{let n;do{if("string"==typeof s&&!s.startsWith("@@__")&&"constructor"!==s){const r=a.create(s);if(void 0!==this.context&&r.level>0&&"@"!==s.at(0)){const a=this.context.stack.find((e=>e.propName.name===r.nearestWildcardParentName));void 0===a&&e.raise(`${s} is outside loop`),n=this[p.directlyGet](t,{prop:s,indexes:a.indexes},i);break}}n=super.get(t,s,i)}while(0);return n}}set(t,s,i,n){let r;do{if("string"==typeof s&&!s.startsWith("@@__")&&"constructor"!==s){const o=a.create(s);if(void 0!==this.context&&o.level>0&&"@"!==s.at(0)){const a=this.context.stack.find((e=>e.propName.name===o.nearestWildcardParentName));void 0===a&&e.raise(`${s} is outside loop`),r=this[p.directlySet](t,{prop:s,indexes:a.indexes,value:i},n);break}}r=super.set(t,s,i,n)}while(0);return r}static makeNotifyForDependentProps(e,t,s=new Set([])){const{propName:i,indexes:n}=t,r=i.name+"\t"+n.toString();if(s.has(r))return[];s.add(r);const o=e[p.getDependentProps]().setOfPropsByRefProp.get(i.name),l=[];if(void 0===o)return[];for(const t of o){const i=a.create(t);if(n.length<i.level){const t=k.expandIndexes(e,{propName:i,indexes:n});l.push(...t.map((e=>({propName:i,indexes:e}))))}else{const e=n.slice(0,i.level);l.push({propName:i,indexes:e})}l.push(...this.makeNotifyForDependentProps(e,{propName:i,indexes:n},s))}return l}static expandIndexes(e,t){const{propName:s,indexes:i}=t;if(s.level===i.length)return[i];if(s.level<i.length)return[i.slice(0,s.level)];{const t=(n,r,a)=>{const o=""!==n?n+".":n,l=s.pathNames[r],c=s.pathNames.length-1===r,d=o+l;let h;return h=c?"*"===l?e[p.directlyGet](n,a).flatMap(((e,t)=>[a.concat(t)])):[a]:"*"===l?a.length<i.length?t(d,r+1,i.slice(0,a.length+1)):e[p.directlyGet](n,a).flatMap(((e,s)=>t(d,r+1,a.concat(s)))):t(d,r+1,a),h};return t("",0,[])}}}let R=class{#a;#v=new Map;#x=new Proxy({},new o);get hasParent(){return null!=this.#a?.parentComponent?.viewModel}get data(){return this.hasParent?this.#a.parentComponent.viewModel:this.#x}get object(){const e={};if(this.hasParent){const t=this.#a.parentComponent.viewModel;for(const[s,i]of this.#v.entries()){const{bindProp:n,bindIndexes:r}=i;e[s]=t[p.directlyGet](n,r)}}else for(const[t,s]of Object.entries(this.#x))e[t]=s;return e}constructor(e){this.#a=e}get(e,t,s){if(t===p.bindProperty)return(e,t,s)=>this.#v.set(e,{bindProp:t,bindIndexes:s});if(t===p.toObject)return()=>this.object;const{data:i}=this;if(this.hasParent){const{bindProp:e,bindIndexes:s}=this.#v.get(t)??{};return e?i[p.directlyGet](e,s):void console.error(`undefined property ${t}`)}return Reflect.get(i,t)}set(e,t,s,i){const{data:n}=this;if(this.hasParent){const{bindProp:e,bindIndexes:i}=this.#v.get(t)??{};return e?n[p.directlySet](e,i,s):(console.error(`undefined property ${t}`),!1)}return Reflect.set(n,t,s)}};class T extends o{#P=new Map;get(e,t,s){return t===p.boundByComponent?(e,t)=>{let s=this.#P.get(t);null==s?this.#P.set(t,new Set([e])):s.add(e)}:super.get(e,t,s)}set(e,t,s,i){const{propName:n,indexes:r}=a.parse(t),o=i[p.directlySet](n.name,r,s);let l=this.#P.get(n.name);if(l)for(const e of l)e.viewModel[p.notifyForDependentProps]("$globals."+n.name,r);return o}}class A{static create(){return new Proxy({},new T)}static data=this.create()}class O{#a;setOfProps=new Set;constructor(e){this.#a=e}bindProperty(e){A.data[p.boundByComponent](this.#a,e),this.setOfProps.add(e)}directGet=(e,t)=>(this.setOfProps.has(e)||this.bindProperty(e),A.data[p.directlyGet](e,t));directSet=(e,t,s)=>(this.setOfProps.has(e)||this.bindProperty(e),A.data[p.directlySet](e,t,s));get(e,t,s){if(t===p.directlyGet)return this.directGet;if(t===p.directlySet)return this.directSet;if(t===p.isSupportDotNotation)return!0;const{propName:i,indexes:n}=a.parse(t);return this.directGet(i.name,n)}set(e,t,s,i){const{propName:n,indexes:r}=a.parse(t);return this.directSet(n.name,r,s)}}class ${static templateByUUID=new Map}const I="data-bind";class L{html;css;ViewModel;extendClass;extendTag;inputFilters;outputFilters;componentModules;#w;get template(){return void 0===this.#w&&(this.#w=L.htmlToTemplate(this.html,this.css)),this.#w}static replaceTag(t){const s=[],i=t.replaceAll(/\{\{([^\}]+)\}\}/g,((e,t)=>{if((t=t.trim()).startsWith("loop:")||t.startsWith("if:"))return s.push(t),`<template data-bind="${t}">`;if(t.startsWith("else:")){return`</template><template data-bind="${s.at(-1)}|not">`}return t.startsWith("end:")?(s.pop(),"</template>"):`\x3c!--@@:${t}--\x3e`})),n=document.createElement("template");n.innerHTML=i;const r=t=>{let s;for(;s=t.querySelector("template");){const t=e.createUUID(),i=document.createComment(`@@|${t}`);if(s.parentNode.replaceChild(i,s),!(s instanceof HTMLTemplateElement)){const e=document.createElement("template");for(let t of Array.from(s.childNodes))e.content.appendChild(t);e.setAttribute(I,s.getAttribute(I)),s=e}s.setAttribute("data-uuid",t),r(s.content),$.templateByUUID.set(t,s)}};return r(n.content),n.innerHTML}static htmlToTemplate(e,t){const s=document.createElement("template");return s.innerHTML=(t?`<style>\n${t}\n</style>`:"")+(e?L.replaceTag(e):""),s}}const j=(e,t,s)=>{if(null==e)return e;const i=Number(e);return isNaN(i)?e:s(i,t)},_=(e,t,s)=>null==e?e:s(String(e),t),F=(e,t,s)=>Array.isArray(e)?s(e,t):e;class U{static styleDisplay=(e,t)=>e?t[0]??"":"none";static truthy=(e,t)=>!!e;static falsey=(e,t)=>!e;static not=this.falsey;static eq=(e,t)=>e==t[0];static ne=(e,t)=>e!=t[0];static lt=(e,t)=>Number(e)<Number(t[0]);static le=(e,t)=>Number(e)<=Number(t[0]);static gt=(e,t)=>Number(e)>Number(t[0]);static ge=(e,t)=>Number(e)>=Number(t[0]);static embed=(e,t)=>null!=e?decodeURIComponent((t[0]??"").replaceAll("%s",e)):null;static ifText=(e,t)=>e?t[0]??null:t[1]??null;static null=(e,t)=>null==e;static offset=(e,t)=>Number(e)+Number(t[0]);static unit=(e,t)=>String(e)+String(t[0]);static inc=this.offset;static mul=(e,t)=>Number(e)*Number(t[0]);static div=(e,t)=>Number(e)/Number(t[0]);static mod=(e,t)=>Number(e)%Number(t[0]);static"str.at"=(e,t)=>_(e,t,((e,t)=>e.at(...t)));static"str.charAt"=(e,t)=>_(e,t,((e,t)=>e.charAt(...t)));static"str.charCodeAt"=(e,t)=>_(e,t,((e,t)=>e.charCodeAt(...t)));static"str.codePointAt"=(e,t)=>_(e,t,((e,t)=>e.codePointAt(...t)));static"str.concat"=(e,t)=>_(e,t,((e,t)=>e.concat(...t)));static"str.endsWith"=(e,t)=>_(e,t,((e,t)=>e.endsWith(...t)));static"str.includes"=(e,t)=>_(e,t,((e,t)=>e.includes(...t)));static"str.indexOf"=(e,t)=>_(e,t,((e,t)=>e.indexOf(...t)));static"str.lastIndexOf"=(e,t)=>_(e,t,((e,t)=>e.lastIndexOf(...t)));static"str.localeCompare"=(e,t)=>_(e,t,((e,t)=>e.localeCompare(...t)));static"str.match"=(e,t)=>_(e,t,((e,t)=>e.match(...t)));static"str.normalize"=(e,t)=>_(e,t,((e,t)=>e.normalize(...t)));static"str.padEnd"=(e,t)=>_(e,t,((e,t)=>e.padEnd(...t)));static"str.padStart"=(e,t)=>_(e,t,((e,t)=>e.padStart(...t)));static"str.repeat"=(e,t)=>_(e,t,((e,t)=>e.repeat(...t)));static"str.replace"=(e,t)=>_(e,t,((e,t)=>e.replace(...t)));static"str.replaceAll"=(e,t)=>_(e,t,((e,t)=>e.replaceAll(...t)));static"str.search"=(e,t)=>_(e,t,((e,t)=>e.search(...t)));static"str.slice"=(e,t)=>_(e,t,((e,t)=>e.slice(...t)));static"str.split"=(e,t)=>_(e,t,((e,t)=>e.split(...t)));static"str.startsWith"=(e,t)=>_(e,t,((e,t)=>e.startsWith(...t)));static"str.substring"=(e,t)=>_(e,t,((e,t)=>e.substring(...t)));static"str.toLocaleLowerCase"=(e,t)=>_(e,t,((e,t)=>e.toLocaleLowerCase(...t)));static"str.toLocaleUpperCase"=(e,t)=>_(e,t,((e,t)=>e.toLocaleUpperCase(...t)));static"str.toLowerCase"=(e,t)=>_(e,t,((e,t)=>e.toLowerCase(...t)));static"str.toUpperCase"=(e,t)=>_(e,t,((e,t)=>e.toUpperCase(...t)));static"str.trim"=(e,t)=>_(e,t,((e,t)=>e.trim(...t)));static"str.trimEnd"=(e,t)=>_(e,t,((e,t)=>e.trimEnd(...t)));static"str.trimStart"=(e,t)=>_(e,t,((e,t)=>e.trimStart(...t)));static"num.toExponential"=(e,t)=>j(e,t,((e,t)=>e.toExponential(...t)));static"num.toFixed"=(e,t)=>j(e,t,((e,t)=>e.toFixed(...t)));static"num.toLocaleString"=(e,t)=>j(e,t,((e,t)=>e.toLocaleString(...t)));static"num.toPrecision"=(e,t)=>j(e,t,((e,t)=>e.toPrecision(...t)));static"arr.at"=(e,t)=>F(e,t,((e,t)=>e.at(...t)));static"arr.concat"=(e,t)=>F(e,t,((e,t)=>e.concat(...t)));static"arr.entries"=(e,t)=>F(e,t,((e,t)=>e.entries(...t)));static"arr.flat"=(e,t)=>F(e,t,((e,t)=>e.flat(...t)));static"arr.includes"=(e,t)=>F(e,t,((e,t)=>e.includes(...t)));static"arr.indexOf"=(e,t)=>F(e,t,((e,t)=>e.indexOf(...t)));static"arr.join"=(e,t)=>F(e,t,((e,t)=>e.join(...t)));static"arr.keys"=(e,t)=>F(e,t,((e,t)=>e.keys(...t)));static"arr.lastIndexOf"=(e,t)=>F(e,t,((e,t)=>e.lastIndexOf(...t)));static"arr.slice"=(e,t)=>F(e,t,((e,t)=>e.slice(...t)));static"arr.toLocaleString"=(e,t)=>F(e,t,((e,t)=>e.toLocaleString(...t)));static"arr.toReversed"=(e,t)=>F(e,t,((e,t)=>e.toReversed(...t)));static"arr.toSorted"=(e,t)=>F(e,t,((e,t)=>e.toSorted(...t)));static"arr.toSpliced"=(e,t)=>F(e,t,((e,t)=>e.toSpliced(...t)));static"arr.values"=(e,t)=>F(e,t,((e,t)=>e.values(...t)));static"arr.with"=(e,t)=>F(e,t,((e,t)=>e.with(...t)));static get at(){return(e,t)=>(Array.isArray(e)?this["arr.at"]:this["str.at"])(e,t)}static get charAt(){return this["str.charAt"]}static get charCodeAt(){return this["str.charCodeAt"]}static get codePointAt(){return this["str.codePointAt"]}static get concat(){return(e,t)=>(Array.isArray(e)?this["arr.concat"]:this["str.concat"])(e,t)}static get endsWith(){return this["str.endsWith"]}static get entries(){return this["arr.entries"]}static get flat(){return this["arr.flat"]}static get includes(){return(e,t)=>(Array.isArray(e)?this["arr.includes"]:this["str.includes"])(e,t)}static get indexOf(){return(e,t)=>(Array.isArray(e)?this["arr.indexOf"]:this["str.indexOf"])(e,t)}static get join(){return this["arr.join"]}static get keys(){return this["arr.keys"]}static get lastIndexOf(){return(e,t)=>(Array.isArray(e)?this["arr.lastIndexOf"]:this["str.lastIndexOf"])(e,t)}static get localeCompare(){return this["str.localeCompare"]}static get match(){return this["str.match"]}static get normalize(){return this["str.normalize"]}static get padEnd(){return this["str.padEnd"]}static get padStart(){return this["str.padStart"]}static get repeat(){return this["str.repeat"]}static get replace(){return this["str.replace"]}static get replaceAll(){return this["str.replaceAll"]}static get search(){return this["str.search"]}static get slice(){return(e,t)=>(Array.isArray(e)?this["arr.slice"]:this["str.slice"])(e,t)}static get split(){return this["str.split"]}static get startsWith(){return this["str.startsWith"]}static get substring(){return this["str.substring"]}static get toExponential(){return this["num.toExponential"]}static get toFixed(){return this["num.toFixed"]}static get toLocaleString(){return(e,t)=>(Array.isArray(e)?this["arr.toLocaleString"]:this["num.toLocaleString"])(e,t)}static get toLocaleLowerCase(){return this["str.toLocaleLowerCase"]}static get toLocaleUpperCase(){return this["str.toLocaleUpperCase"]}static get toLowerCase(){return this["str.toLowerCase"]}static get toPrecision(){return this["num.toPrecision"]}static get toReversed(){return this["arr.toReversed"]}static get toSorted(){return this["arr.toSorted"]}static get toSpliced(){return this["arr.toSpliced"]}static get toUpperCase(){return this["str.toUpperCase"]}static get trim(){return this["str.trim"]}static get trimEnd(){return this["str.trimEnd"]}static get trimStart(){return this["str.trimStart"]}static get values(){return this["arr.values"]}static get with(){return this["arr.with"]}}class D{static number=(e,t)=>""===e?null:Number(e);static boolean=(e,t)=>""===e?null:Boolean(e)}class H{name;options;static applyForInput(e,t,s){return t.reduceRight(((e,t)=>t.name in s?s[t.name](e,t.options):e),e)}static applyForOutput(e,t,s){return t.reduce(((e,t)=>t.name in s?s[t.name](e,t.options):e),e)}static regist(t,s,i){t in U&&e.raise(`regist filter error duplicate name (${t})`),t in D&&e.raise(`regist filter error duplicate name (${t})`),s&&(U[t]=s),i&&(D[t]=i)}}class W{static#N={debug:!1};static components(t){return Object.entries(t).forEach((([t,s])=>{const i=e.toKebabCase(t);customElements.define(i,s)})),this}static registComponentModule(t,s){const i=e.toKebabCase(t),n=Le.generate(s);s.extendTag?customElements.define(i,n,{extends:s.extendTag}):void 0===s?.extendClass?customElements.define(i,n):e.raise("extendTag should be set"),s.componentModules&&this.componentModules(s.componentModules)}static componentModules(e){return Object.entries(e).forEach((([e,t])=>{this.registComponentModule(e,t)})),this}static filters(e){return Object.entries(e).forEach((([e,t])=>{const{input:s,output:i}=t;H.regist(e,i,s)})),this}static globals(e){Object.assign(A.data,e)}static config({debug:e=!1}){return this.#N=Object.assign(this.#N,{debug:e}),this}static get debug(){return this.#N.debug}}class q extends Error{}class G{#C;#M;#E=!0;get alive(){return this.#E}constructor(){this.main()}async#S(){return new Promise(((e,t)=>{this.#C=e,this.#M=t}))}stop(){this.#M(new q("stop"))}wakeup(e){this.#C(e)}async main(){for(;;)try{const e=await this.#S();await e.waiting(),W.debug&&performance.mark("slot-exec:start");try{await e.exec(),W.debug&&(performance.mark("slot-exec:end"),performance.measure("slot-exec","slot-exec:start","slot-exec:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures(),performance.clearMarks())}finally{e.callback()}}catch(e){if(e instanceof q)break;if(console.error(e),!confirm("致命的なエラーが発生しました。続行しますか？"))break}this.#E=!1}}class V{node;property;viewModelProperty;value;updateFunc;constructor(e,t,s,i,n){this.node=e,this.property=t,this.viewModelProperty=s,this.value=i,this.updateFunc=n}}class z{queue=[];#i;constructor(e){this.#i=e}reorder(e){return e.sort(((e,t)=>e.node instanceof HTMLTemplateElement&&t.node instanceof HTMLTemplateElement?0:t.node instanceof HTMLTemplateElement?1:e.node instanceof HTMLTemplateElement?-1:e.node instanceof HTMLSelectElement&&"value"===e.property&&t.node instanceof HTMLSelectElement&&"value"===t.property?0:e.node instanceof HTMLSelectElement&&"value"===e.property?1:t.node instanceof HTMLSelectElement&&"value"===t.property?-1:0)),e}async exec(){this.#i&&this.#i(f);try{for(;this.queue.length>0;){const e=this.queue.splice(0),t=this.reorder(e);for(const e of t)Reflect.apply(e.updateFunc,e,[])}}finally{this.#i&&this.#i(g)}}get isEmpty(){return 0===this.queue.length}}class K{queue=[];#i;#a;constructor(e,t){this.#a=e,this.#i=t}async exec(){this.#i&&this.#i(u);try{for(;this.queue.length>0;){const e=this.queue.splice(0),t=[];for(const s of e)t.push(...k.makeNotifyForDependentProps(this.#a.viewModel,s));const s=new Set(e.concat(t).map((e=>e.propName.name+"\t"+e.indexes.toString())));this.#a.applyToNode(s)}}finally{this.#i&&this.#i(m)}}get isEmpty(){return 0===this.queue.length}}class Z{#B;get viewModelUpdator(){return this.#B}#k;get notifyReceiver(){return this.#k}#R;get nodeUpdator(){return this.#R}#T;#A;#O;#$;#I;#L;#j;constructor(e,t=null,s=null){this.#B=new b(s),this.#k=new K(e,s),this.#R=new z(s),this.#T=t,this.#A=new Promise(((e,t)=>{this.#$=e,this.#I=t})),this.#O=new Promise(((e,t)=>{this.#L=e,this.#j=t}))}async waiting(){return this.#A}waitResolve(e){this.#$(e)}waitReject(){this.#I()}async alive(){return this.#O}async exec(){do{await this.#B.exec(),await this.#k.exec(),await this.#R.exec()}while(!this.#B.isEmpty||!this.#k.isEmpty||!this.#R.isEmpty);this.#L()}async addProcess(e){this.#B.queue.push(e),this.#$(!0)}async addNotify(e){this.#k.queue.push(e),this.#$(!0)}async addNodeUpdate(e){this.#R.queue.push(e),this.#$(!0)}callback(){this.#T&&this.#T()}static create(e,t,s){return new Z(e,t,s)}}class J{static setOfAttachableTags=new Set(["articles","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]);static isCustomTag(e){return-1!==e.indexOf("-")}static isAttachable(e){return this.isCustomTag(e)||this.setOfAttachableTags.has(e)}}const Q=e=>Array.from(e.childNodes).flatMap((e=>Q(e).concat((e=>e instanceof Comment&&(e.textContent.startsWith("@@:")||e.textContent.startsWith("@@|")))(e)?e:null))).filter((e=>e));class X{static listOfRouteIndexesByTemplate=new Map;static getTargetNodes(e,t){let s;if(this.listOfRouteIndexesByTemplate.has(e)){s=this.listOfRouteIndexesByTemplate.get(e).map((e=>((e,t)=>{for(let s=0;s<t.length;s++)e=e.childNodes[t[s]];return e})(t,e)))}else s=Array.from(t.querySelectorAll("[data-bind]")).concat(Q(t)),this.listOfRouteIndexesByTemplate.set(e,s.map((e=>(e=>{let t=[];for(;null!=e.parentNode;)t=[Array.from(e.parentNode.childNodes).indexOf(e)].concat(t),e=e.parentNode;return t})(e))));return s}}class Y{#_;get node(){return this.#_}#F;get name(){return this.#F}#U=[];get nameElements(){return this.#U}get value(){return this.node[this.name]}set value(e){this.node[this.name]=e}#D;get filters(){return this.#D}#H;get filterFuncs(){return this.#H}get filteredValue(){return this.filters.length>0?H.applyForInput(this.value,this.filters,this.filterFuncs):this.value}get applicable(){return!0}#W;get binding(){return this.#W}get expandable(){return!1}constructor(t,s,i,n,r){s instanceof Node||e.raise("not Node"),this.#W=t,this.#_=s,this.#F=i,this.#U=i.split("."),this.#D=n,this.#H=r}initialize(){}beforeUpdate(e){}}class ee extends Y{get template(){return $.templateByUUID.get(this.uuid)}get uuid(){return ee.getUUID(this.node)}static getUUID(e){return e.textContent.slice(3)}get expandable(){return!0}constructor(t,s,i,n,r){s instanceof Comment||e.raise("not Comment");const a=ee.getUUID(s);void 0===a&&e.raise(`invalid uuid ${a}`),super(t,s,i,n,r)}}class te extends ee{get value(){return this.binding.children.length}set value(t){if(Array.isArray(t)||e.raise("value is not array"),this.value<t.length){this.binding.children.forEach((e=>e.applyToNode()));for(let e=this.value;e<t.length;e++){const t=this.binding.viewModelProperty.createChildContext(e),s=$e.create(this.binding.component,this.template,t);this.binding.appendChild(s)}}else if(this.value>t.length){const e=this.binding.children.splice(t.length);this.binding.children.forEach((e=>e.applyToNode())),e.forEach((e=>e.removeFromParent()))}else this.binding.children.forEach((e=>e.applyToNode()))}constructor(t,s,i,n,r){"loop"!==i&&e.raise(`invalid property name ${i}`),super(t,s,i,n,r)}}class se{static create(){return{indexes:[],stack:[]}}static clone(e){const t=this.create();t.indexes=e.indexes.slice();for(const s of e.stack){const e={};e.indexes=s.indexes.slice(),e.pos=s.pos,e.propName=s.propName,t.stack.push(e)}return t}}class ie extends ee{get value(){return this.binding.children.length>0}set value(t){if("boolean"!=typeof t&&e.raise("value is not boolean"),this.value!==t)if(t){const e=$e.create(this.binding.component,this.template,this.binding.context);this.binding.appendChild(e)}else{this.binding.children.splice(0,this.binding.children.length).forEach((e=>e.removeFromParent()))}else this.binding.children.forEach((e=>e.applyToNode()))}constructor(t,s,i,n,r){"if"!==i&&e.raise(`invalid property name ${i}`),super(t,s,i,n,r)}}class ne{#q;get value(){return this.#q}#G;get enabled(){return this.#G}constructor(e,t){this.#q=e,this.#G=t}}class re{#V;get viewModel(){return this.#V}#F;get name(){return this.#F}get propertyName(){return a.create(this.name)}get indexes(){return this.binding.contextParam?.indexes??[]}get indexesString(){return this.indexes.toString()}#z;get key(){return this.name+"\t"+this.indexesString}get value(){return this.viewModel[p.directlyGet](this.name,this.indexes)}set value(e){const t=e=>{this.viewModel[p.directlySet](this.name,this.indexes,e)};if(e instanceof ne){const s=this.value;if(Array.isArray(s)){const i=new Set(s);e.enabled?i.add(e.value):i.delete(e.value),t(Array.from(i))}else e.enabled&&t(e.value)}else t(e)}#D;get filters(){return this.#D}#H;get filterFuncs(){return this.#H}get filteredValue(){return this.filters.length>0?H.applyForOutput(this.value,this.filters,this.filterFuncs):this.value}get applicable(){return!0}#W;get binding(){return this.#W}constructor(e,t,s,i,n){this.#W=e,this.#V=t,this.#F=s,this.#D=i,this.#H=n}createChildContext(e){const t=this.binding.context.indexes.length,s=this.propertyName,i=this.binding.contextParam?.indexes??[],n=se.clone(this.binding.context);return n.indexes.push(e),n.stack.push({propName:s,indexes:i.concat(e),pos:t}),n}initialize(){}isUpdate(e){return e.has(this.key)}}const ae=RegExp(/^\$[0-9]+$/);class oe extends re{get index(){return Number(this.name.slice(1))-1}get value(){return this.binding.context.indexes[this.index]}get indexes(){return[]}get indexesString(){return""}constructor(t,s,i,n,r){ae.test(i)||e.raise(`invalid name ${i}`),super(t,s,i,n,r)}}class le extends Y{get element(){return this.node}constructor(t,s,i,n,r){s instanceof Element||e.raise("not element"),super(t,s,i,n,r)}}class ce extends le{get value(){return this.element.className.length>0?this.element.className.split(" "):[]}set value(e){this.element.className=e.join(" ")}}class pe extends le{get inputElement(){return this.node}get value(){return new ne(this.inputElement.value,this.inputElement.checked)}set value(e){const t=e,s=this.filteredValue;this.inputElement.checked=!!t.find((e=>e===s.value))}get filteredValue(){const e=this.value;return new ne(this.filters.length>0?H.applyForInput(e.value,this.filters,this.filterFuncs):e.value,e.enabled)}constructor(t,s,i,n,r){s instanceof HTMLInputElement||e.raise("not htmlInputElement"),"checkbox"!==s.type&&e.raise("not checkbox"),super(t,s,i,n,r)}}class de extends le{get inputElement(){return this.node}get value(){return new ne(this.inputElement.value,this.inputElement.checked)}set value(e){const t=this.filteredValue;this.inputElement.checked=e===t.value}get filteredValue(){const e=this.value;return new ne(this.filters.length>0?H.applyForInput(e.value,this.filters,this.filterFuncs):e.value,e.enabled)}constructor(t,s,i,n,r){s instanceof HTMLInputElement||e.raise("not htmlInputElement"),"radio"!==s.type&&e.raise("not radio"),super(t,s,i,n,r)}}class he extends le{get eventType(){return this.name.slice(2)}get applicable(){return!1}constructor(t,s,i,n,r){i.startsWith("on")||e.raise(`invalid property name ${i}`),super(t,s,i,n,r)}initialize(){this.element.addEventListener(this.eventType,this.binding.eventHandler)}}class ue extends le{get className(){return this.nameElements[1]}get value(){return this.element.classList.contains(this.className)}set value(e){e?this.element.classList.add(this.className):this.element.classList.remove(this.className)}}class me extends le{get attributeName(){return this.nameElements[1]}get value(){return this.element.getAttribute(this.attributeName)}set value(e){this.element.setAttribute(this.attributeName,e)}}class fe extends le{get htmlElement(){return this.node}get styleName(){return this.nameElements[1]}get value(){return this.htmlElement.style[this.styleName]}set value(e){this.htmlElement.style[this.styleName]=e}constructor(t,s,i,n,r){s instanceof HTMLElement||e.raise("not htmlElement"),super(t,s,i,n,r)}}class ge extends le{get propName(){return this.nameElements[1]}get applicable(){return!1}get thisComponent(){return this.node}constructor(t,s,i,n,r){s[p.isComponent]||e.raise("not Component"),super(t,s,i,n,r)}initialize(){var e;this.thisComponent.props[p.bindProperty](this.propName,this.binding.viewModelProperty.name,this.binding.viewModelProperty.indexes),Object.defineProperty(this.thisComponent.viewModel,this.propName,{get:(e=this.propName,function(){return this.$props[e]}),set:(e=>function(t){this.$props[e]=t})(this.propName),configurable:!0})}beforeUpdate(e){const t=this.binding.viewModelProperty.name,s=this.propName;for(const i of e){const[e,n]=i.split("\t");if(e===t||a.create(e).setOfParentPaths.has(t)){const i=e.slice(t.length),r=((n||null)?.split(",")??[]).map((e=>Number(e)));this.thisComponent.viewModel?.[p.writeCallback](`$props.${s}${i}`,r),this.thisComponent.viewModel?.[p.writeCallback](`${s}${i}`,r),this.thisComponent.viewModel?.[p.notifyForDependentProps](`$props.${s}${i}`,r),this.thisComponent.viewModel?.[p.notifyForDependentProps](`${s}${i}`,r)}}}}const ye=RegExp(/^\$[0-9]+$/);class be{static#K;static get classOfNodePropertyByNameByIsComment(){return void 0===this.#K&&(this.#K={true:{if:ie,loop:te},false:{class:ce,checkbox:pe,radio:de}}),this.#K}static#Z;static get classOfNodePropertyByFirstName(){return void 0===this.#Z&&(this.#Z={class:ue,attr:me,style:fe,props:ge}),this.#Z}static create(t,s,i,n,r,a){let o;const l=ye.test(r)?oe:re;do{const t=s instanceof Comment;if(o=this.classOfNodePropertyByNameByIsComment[t][i],void 0!==o)break;t&&e.raise(`unknown node property ${i}`);const n=i.split(".");if(o=this.classOfNodePropertyByFirstName[n[0]],void 0!==o)break;o=s instanceof Element?i.startsWith("on")?he:le:Y}while(0);const c=new Oe(t,s,i,o,n,r,l,a);return c.initialize(),c}}class ve{nodeProperty;viewModelProperty;filters}const xe=e=>e.trim(),Pe=e=>e.length>0,we=e=>{const[t,...s]=e.split("|").map(xe);return{viewModelProperty:t,filters:s.map((e=>(e=>{const[t,...s]=e.split(",").map(xe);return Object.assign(new H,{name:t,options:s})})(e)))}},Ne=(t,s)=>t.split(";").map(xe).filter(Pe).map((t=>{let{nodeProperty:i,viewModelProperty:n,filters:r}=((e,t)=>{const[s,i]=[t].concat(...e.split(":").map(xe)).splice(-2),{viewModelProperty:n,filters:r}=we(i);return{nodeProperty:s,viewModelProperty:n,filters:r}})(t,"$");return n="@"===n?i:n,i="$"===i?s:i,void 0===i&&e.raise("default property undefined"),{nodeProperty:i,viewModelProperty:n,filters:r}}));class Ce{static bindTextsByKey={};static parse(e,t){const s=e+"\t"+t;let i=this.bindTextsByKey[s];return void 0===i&&(i=Ne(e,t).map((e=>Object.assign(new ve,e))),this.bindTextsByKey[s]=i),i}}class Me{static parseBindText=(e,t,s,i,n)=>Ce.parse(i,n).map((i=>be.create(e,t,i.nodeProperty,s,i.viewModelProperty,i.filters)))}const Ee="oninput",Se=Ee.slice(2);class Be{static bind(t,s){const i=t.component.viewModel,n=(t=>t instanceof HTMLElement?t:e.raise("not HTMLElement"))(s),r=n.getAttribute("data-bind"),a=(e=>e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLOptionElement?"value":e instanceof HTMLInputElement?"radio"===e.type||"checkbox"===e.type?"checked":"value":"textContent")(n),o=Me.parseBindText(t,s,i,r,a);let l=!1,c=null,p=null,d=null;o.forEach((e=>{l||=e.nodeProperty.name===Ee,p=e.nodeProperty.constructor===de?e:p,d=e.nodeProperty.constructor===pe?e:d,c=e.nodeProperty.name===a?e:c}));const h=e=>{n.addEventListener(Se,e.defaultEventHandler)};return p?h(p):d?h(d):c&&!l&&(e=>e instanceof HTMLElement&&(e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement))(s)&&h(c),o}}class ke{static bind(t,s){const i=t.component.viewModel,n=(t=>t instanceof SVGElement?t:e.raise("not SVGElement"))(s),r=n.getAttribute("data-bind");return Me.parseBindText(t,s,i,r,undefined)}}class Re{static bind(t,s){const i=t.component.viewModel,n=(t=>t instanceof Comment?t:e.raise("not Comment"))(s),r=n.textContent.slice(3),a=document.createTextNode("");n.parentNode.replaceChild(a,n);return Me.parseBindText(t,a,i,r,"textContent")}}class Te{static bind(t,s){const i=t.component.viewModel,n=(t=>t instanceof Comment?t:e.raise("not Comment"))(s),r=n.textContent.slice(3),a=$.templateByUUID.get(r).getAttribute("data-bind");return Me.parseBindText(t,s,i,a,void 0)}}class Ae{static bind(t,s){return s.flatMap((s=>s instanceof Comment&&":"==s.textContent[2]?Re.bind(t,s):s instanceof HTMLElement?Be.bind(t,s):s instanceof Comment&&"|"==s.textContent[2]?Te.bind(t,s):s instanceof SVGElement?ke.bind(t,s):e.raise("unknown node type")))}}class Oe{static seq=0;#J;get id(){return this.#J}#Q;get bindingManager(){return this.#Q}#X;get nodeProperty(){return this.#X}#Y;get viewModelProperty(){return this.#Y}get component(){return this.bindingManager.component}get context(){return this.bindingManager.context}#ee;get contextParam(){if(void 0===this.#ee){const e=a.create(this.viewModelProperty.name);e.level>0?this.#ee=this.context.stack.find((t=>t.propName.name===e.nearestWildcardParentName)):this.#ee=null}return this.#ee}children=[];get expandable(){return this.nodeProperty.expandable}constructor(e,t,s,i,n,r,a,o){this.#J=++Oe.seq,this.#Q=e,this.#X=new i(this,t,s,o,e.component.filters.in),this.#Y=new a(this,n,r,o,e.component.filters.out)}applyToNode(){const{component:e,nodeProperty:t,viewModelProperty:s}=this;if(!t.applicable)return;const i=s.filteredValue;t.value!==(i??"")&&e.updateSlot.addNodeUpdate(new V(t.node,t.name,s.name,i,(()=>{t.value=i??""})))}applyToViewModel(){const{nodeProperty:e,viewModelProperty:t}=this;if(!t.applicable)return;const s=e.filteredValue;t.value=s}execEventHandler(e){const{component:t,viewModelProperty:s,context:i}=this;e.stopPropagation();const n=new y(s.viewModel[p.directlyCall],s.viewModel,[s.name,i,e]);t.updateSlot.addProcess(n)}get eventHandler(){return e=this,t=>e.execEventHandler(t);var e}execDefaultEventHandler(e){const{component:t}=this;e.stopPropagation();const s=new y(this.applyToViewModel,this,[]);t.updateSlot.addProcess(s)}get defaultEventHandler(){return e=this,t=>e.execDefaultEventHandler(t);var e}initialize(){this.nodeProperty.initialize(),this.viewModelProperty.initialize(),this.applyToNode()}appendChild(t){this.expandable||e.raise("not expandable");const s=this.children[this.children.length-1];this.children.push(t);const i=this.nodeProperty.node.parentNode,n=s?.lastNode??this.nodeProperty.node;i.insertBefore(t.fragment,n.nextSibling??null)}updateNode(e){this.nodeProperty.beforeUpdate(e),this.viewModelProperty.isUpdate(e)&&this.applyToNode()}changeContext(){this.#ee=void 0}}class $e{#a;get component(){return this.#a}#te=[];get bindings(){return this.#te}#se=[];get nodes(){return this.#se}get lastNode(){return this.nodes[this.nodes.length-1]}#ie;get fragment(){return this.#ie}#u;get context(){return this.#u}set context(e){this.#u=e,this.bindings.forEach((e=>e.changeContext()))}#w;get template(){return this.#w}constructor(e,t,s){this.#u=s,this.#a=e,this.#w=t;const i=document.importNode(t.content,!0),n=X.getTargetNodes(t,i);this.#te=Ae.bind(this,n),this.#se=Array.from(i.childNodes),this.#ie=i}applyToNode(){this.bindings.forEach((e=>e.applyToNode()))}applyToViewModel(){this.bindings.forEach((e=>e.applyToViewModel()))}removeFromParent(){this.nodes.forEach((e=>this.fragment.appendChild(e))),this.bindings.forEach((e=>{e.children.forEach((e=>e.removeFromParent()))}));($e.bindingsByTemplate.get(this.template)??$e.bindingsByTemplate.set(this.template,[]).get(this.template)).push(this)}getExpandableBindings(e){const t=[],s=[{bindings:this.bindings,children:null,index:-1}];for(;s.length>0;){const i=s[s.length-1];if(i.index++,i.bindings)if(i.index<i.bindings.length){const n=i.bindings[i.index];n.expandable&&(e.has(n.viewModelProperty.key)?t.push(n):n.children.length>0&&s.push({bindings:null,children:n.children,index:-1}))}else s.pop();else if(i.index<i.children.length){const e=i.children[i.index].bindings;e.length>0&&s.push({bindings:e,children:null,index:-1})}else s.pop()}return t}updateNode(e){const t=new Set(this.getExpandableBindings(e));for(const s of t)s.updateNode(e);const s=i=>{for(const n of i){if(t.has(n))return;n.updateNode(e);for(const e of n.children)s(e.bindings)}};s(this.bindings)}static bindingsByTemplate=new Map;static create(e,t,s){const i=this.bindingsByTemplate.get(t)??[];if(i.length>0){const e=i.pop();e.context=s;const t=(e,s)=>{for(const s of e){s.applyToNode();for(const e of s.children)t(e.bindings)}};return t(e.bindings),e}return new $e(e,t,s)}}const Ie={get viewModel(){return this._viewModel},set viewModel(e){this._viewModel=e},get rootBinding(){return this._rootBinding},set rootBinding(e){this._rootBinding=e},get thread(){return this._thread},set thread(e){this._thread=e},get updateSlot(){return void 0===this._updateSlot&&(this._updateSlot=Z.create(this,(()=>{this._updateSlot=void 0}),(e=>{e===d||e===u?this.viewModel[p.beUncacheable]():e===f&&this.viewModel[p.beCacheable]()})),this.thread.wakeup(this._updateSlot)),this._updateSlot},set updateSlot(e){this._updateSlot=e},get props(){return this._props},get globals(){return this._globals},get initialResolve(){return this._initialResolve},set initialResolve(e){this._initialResolve=e},get initialReject(){return this._initialReject},set initialReject(e){this._initialReject=e},get initialPromise(){return this._initialPromise},set initialPromise(e){this._initialPromise=e},get aliveResolve(){return this._aliveResolve},set aliveResolve(e){this._aliveResolve=e},get aliveReject(){return this._aliveReject},set aliveReject(e){this._aliveReject=e},get alivePromise(){return this._alivePromise},set alivePromise(e){this._alivePromise=e},get parentComponent(){return void 0===this._parentComponent&&(this._parentComponent=(e=>{for(;;){if(null==(e=e.parentNode))return null;if(e[p.isComponent])return e;if(e instanceof ShadowRoot){if(e.host[p.isComponent])return e.host;e=e.host}}})(this)),this._parentComponent},get withShadowRoot(){return this.hasAttribute("with-shadow-root")},get viewRootElement(){return this.shadowRoot??this},get filters(){return this._filters},initialize(){this._viewModel=function(e,t){const s=l.viewModelize(Reflect.construct(t,[])),{viewModel:i,accessorProps:n,methods:r}=s;return new Proxy(i,new k(e,n,r,i[M]))}(this,this.constructor.ViewModel),this._rootBinding=void 0,this._thread=void 0,this._updateSlot=void 0,this._props=new Proxy({},new R(this)),this._globals=function(e){return new Proxy({},new O(e))}(),this._initialPromise=void 0,this._initialResolve=void 0,this._initialReject=void 0,this._alivePromise=void 0,this._aliveResolve=void 0,this._aliveReject=void 0,this._parentComponent=void 0,this._filters={in:class extends D{},out:class extends U{}},this.initialPromise=new Promise(((e,t)=>{this.initialResolve=e,this.initialReject=t}))},async build(){const{template:t,inputFilters:s,outputFilters:i}=this.constructor;if(void 0!==s)for(const[t,i]of Object.entries(s))t in this.filters.in&&e.raise(`already exists filter ${t}`),this.filters.in[t]=i;if(void 0!==i)for(const[t,s]of Object.entries(i))t in this.filters.out&&e.raise(`already exists filter ${t}`),this.filters.out[t]=s;J.isAttachable(this.tagName.toLowerCase())&&this.withShadowRoot&&this.attachShadow({mode:"open"}),this.thread=new G,await this.viewModel[p.initCallback]();const n=this.updateSlot;n.addProcess(new y((async()=>(this.rootBinding=$e.create(this,t,se.create()),this.viewRootElement.appendChild(this.rootBinding.fragment),this.viewModel[p.connectedCallback]())),this,[])),await n.alive()},async connectedCallback(){try{this.parentComponent&&await this.parentComponent.initialPromise,this.alivePromise=new Promise(((e,t)=>{this.aliveResolve=e,this.aliveReject=t})),await this.build()}finally{this.initialResolve&&this.initialResolve()}},disconnectedCallback(){this.aliveResolve&&this.aliveResolve(this.props[p.toObject]())},applyToNode(e){this.rootBinding?.updateNode(e)}};class Le{static generate(e){const t=Object.assign(new L,e),s=function(e){return class extends HTMLElement{static template=e.template;static ViewModel=e.ViewModel;static inputFilters=e.inputFilters;static outputFilters=e.outputFilters;get[p.isComponent](){return!0}constructor(){super(),this.initialize()}}}(t);if(void 0===t.extendClass&&void 0===t.extendTag);else{const e=t.extendClass??document.createElement(t.extendTag).constructor;s.prototype.__proto__=e.prototype,s.__proto__=e}for(let[e,t]of Object.entries(Object.getOwnPropertyDescriptors(Ie)))Object.defineProperty(s.prototype,e,t);return s}}function je(e){return Le.generate(e)}class _e{static regist(e,t){}}class Fe{static toKebabCase=e=>"string"==typeof e?e.replaceAll(/[\._]/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e}const Ue="kebab",De="snake",He="uppercamel",We="lowercamel",qe="dotted";class Ge{static getNames(e){const t=Fe.toKebabCase(e),s=t.replaceAll("-","_"),i=t.replaceAll("-","."),n=t.split("-").map(((e,t)=>(void 0!==e[0]&&(e=e[0].toUpperCase()+e.slice(1)),e))).join(""),r=n.length>0?n[0].toLowerCase()+n.slice(1):n;return{[Ue]:t,[De]:s,[He]:n,[We]:r,[qe]:i}}}const Ve=We;class ze{defaultNameType=Ve;defaultPath="./";loadNames=[];prefixMap}class Ke{prefix;path;get matchPrefix(){return`${this.prefix}-`}isMatch(e){return e.startsWith(this.matchPrefix)}getNames(e){const{prefix:t,path:s}=this;if(e.startsWith(this.matchPrefix)){return{prefixName:t,subName:e.slice(this.matchPrefix.length),path:s}}}}const Ze=Ge.getNames("prefix-name"),Je=Ge.getNames("sub-name");class Qe{static getPathInfo(e,t,s,i){const[n,r]=e.split("#");let a=n,o=r;const l=Ge.getNames(t),c=Ge.getNames(s);return a=a.replaceAll(`{${Ze[Ue]}}`,l[Ue]),a=a.replaceAll(`{${Ze[De]}}`,l[De]),a=a.replaceAll(`{${Ze[We]}}`,l[We]),a=a.replaceAll(`{${Ze[He]}}`,l[He]),a=a.replaceAll(`{${Ze[qe]}}`,l[qe]),a=a.replaceAll(`{${Je[Ue]}}`,c[Ue]),a=a.replaceAll(`{${Je[De]}}`,c[De]),a=a.replaceAll(`{${Je[We]}}`,c[We]),a=a.replaceAll(`{${Je[He]}}`,c[He]),a=a.replaceAll(`{${Je[qe]}}`,c[qe]),n===a&&".js"!==a.slice(-3)&&(a=a+("/"!==e.slice(-1)?"/":"")+c[i]+".js"),o&&(o=o.replaceAll(`{${Je[Ue]}}`,c[Ue]),o=o.replaceAll(`{${Je[De]}}`,c[De]),o=o.replaceAll(`{${Je[We]}}`,c[We]),o=o.replaceAll(`{${Je[He]}}`,c[He]),o=o.replaceAll(`{${Je[qe]}}`,c[qe])),{filePath:a,exportName:o}}}class Xe{#ne;#N;#re;#ae;#oe;constructor(e){this.#ae=e,this.#oe=window.location,this.setConfig(new ze)}setConfig(e){this.#N=Object.assign(new ze,e),"prefixMap"in e&&void 0!==e.prefixMap&&this.setPrefixMap(e.prefixMap)}getConfig(){return this.#N}setPrefixMap(e){this.#re=new Map(Object.entries(e).map((([e,t])=>[e=Fe.toKebabCase(e),Object.assign(new Ke,{prefix:e,path:t})])))}getPrefixMap(){return this.#re}configFile(e){return this.#ne=e,this}config(e){return this.setConfig(e),this}prefixMap(e){return this.setPrefixMap(e),this}get registrar(){return this.#ae}async loadConfig(e){const t=this.#oe.pathname.split("/");t[t.length-1]=e;const s=this.#oe.origin+t.join("/");try{const e=await fetch(s),t=await e.json();return Object.assign(new ze,t)}catch(e){throw new Error(e)}}async load(...e){if(void 0!==this.#ne){const e=await this.loadConfig(this.#ne);this.setConfig(e)}if(void 0===this.#re)throw new Error("prefixMap is not defined");if(void 0===this.#ae)throw new Error("registrar is not defined");const t=Array.from(this.#re.values()),{defaultNameType:s,defaultPath:i}=this.#N;e=e.length>0?e:this.#N.loadNames;for(let n of e){let e;n=Fe.toKebabCase(n);const r=t.find((e=>e.isMatch(n)));if(void 0!==r){const t=r.getNames(n);e=Qe.getPathInfo(t.path,t.prefixName,t.subName,s)}if(void 0===e&&void 0!==i&&(e=Qe.getPathInfo(i,"",n,s)),void 0===e)throw new Error(`unmatch prefix and no defaultPath (loadName:${n})`);const a=this.#oe.pathname.split("/");a[a.length-1]=e.filePath;const o=this.#oe.origin+a.join("/");let l,c;try{l=await import(o)}catch(e){throw new Error(e)}if(void 0!==e.exportName){if(!(e.exportName in l))throw new Error(`${e.exportName} not found in module (exportName:${e.exportName}, ${e.filePath})`);c=l[e.exportName]}else c=l.default;this.#ae.regist(n,c)}return this}static create(e){return new Xe(e)}}const Ye=Xe.create(class extends _e{static regist(e,t){if(e.startsWith("filter-")){const s=e.slice("filter-".length),{output:i,input:n}=t;H.regist(s,i,n)}else W.registComponentModule(e,t)}});function et(e){W.componentModules(e)}function tt(e){W.config(e)}export{W as default,je as generateComponentClass,Ye as loader,et as registComponentModules,tt as registConfig};
