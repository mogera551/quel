const e={debug:!1,useShadowRoot:!1,useKeyed:!0,useWebComponent:!0,useLocalTagName:!0,useLocalSelector:!0,useOverscrollBehavior:!0};function t(e){return new URL(e.url).search.slice(1)}async function n(e){return await fetch(e.url.replace(".js",".html")).then((e=>e.text()))}async function s(e){return await fetch(e.url.replace(".js",".css")).then((e=>e.text()))}class i{defaultNameType="lowerCamel";defaultPath="./";loadNames=[];prefixMap}class r{prefix;path;get matchPrefix(){return`${this.prefix}-`}constructor(e,t){this.prefix=e,this.path=t}isMatch(e){return e.startsWith(this.matchPrefix)}getNames(e){const{prefix:t,path:n}=this;if(e.startsWith(this.matchPrefix)){return{prefixName:t,subName:e.slice(this.matchPrefix.length),path:n}}}}const o=e=>"string"==typeof e?e.replaceAll(/[\._]/g,"-").replaceAll(/([A-Z])/g,((e,t,n)=>(n>0?"-":"")+t.toLowerCase())):e;function a(e){const t=o(e),n=t.replaceAll("-","_"),s=t.replaceAll("-","."),i=t.split("-").map(((e,t)=>(void 0!==e[0]&&(e=e[0].toUpperCase()+e.slice(1)),e))).join(""),r=i.length>0?i[0].toLowerCase()+i.slice(1):i;return{kebab:t,snake:n,upperCamel:i,lowerCamel:r,dotted:s}}const l=a("prefix-name"),d=a("sub-name");function c(e,t,n,s){const[i,r]=e.split("#");let o=i,c=r;const p=a(t),u=a(n);return o=o.replaceAll(`{${l.kebab}}`,p.kebab),o=o.replaceAll(`{${l.snake}}`,p.snake),o=o.replaceAll(`{${l.lowerCamel}}`,p.lowerCamel),o=o.replaceAll(`{${l.upperCamel}}`,p.upperCamel),o=o.replaceAll(`{${l.dotted}}`,p.dotted),o=o.replaceAll(`{${d.kebab}}`,u.kebab),o=o.replaceAll(`{${d.snake}}`,u.snake),o=o.replaceAll(`{${d.lowerCamel}}`,u.lowerCamel),o=o.replaceAll(`{${d.upperCamel}}`,u.upperCamel),o=o.replaceAll(`{${d.dotted}}`,u.dotted),i===o&&".js"!==o.slice(-3)&&(o=o+("/"!==e.slice(-1)?"/":"")+u[s]+".js"),c&&(c=c.replaceAll(`{${d.kebab}}`,u.kebab),c=c.replaceAll(`{${d.snake}}`,u.snake),c=c.replaceAll(`{${d.lowerCamel}}`,u.lowerCamel),c=c.replaceAll(`{${d.upperCamel}}`,u.upperCamel),c=c.replaceAll(`{${d.dotted}}`,u.dotted)),{filePath:o,exportName:c}}class p{static raise(e){throw new Error(e)}static toKebabCase=e=>"string"==typeof e?e.replaceAll(/_/g,"-").replaceAll(/([A-Z])/g,((e,t,n)=>(n>0?"-":"")+t.toLowerCase())):e;static createUUID(){return window?.crypto?.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=((new Date).getTime()+16*Math.random())%16|0;return("x"==e?t:3&t|8).toString(16)}))}}class u{#e;#t;#n=new Map;#s;#i;constructor(e){this.#s=e,this.#i=window.location,this.#t=Object.assign(new i)}setConfig(e){this.#t=Object.assign(new i,e),"prefixMap"in e&&void 0!==e.prefixMap&&this.setPrefixMap(e.prefixMap)}getConfig(){return this.#t}setPrefixMap(e){this.#n=new Map(Object.entries(e).map((([e,t])=>[o(e),new r(e,t)])))}getPrefixMap(){return this.#n}configFile(e){return this.#e=e,this}config(e){return this.setConfig(e),this}prefixMap(e){return this.setPrefixMap(e),this}get registrar(){return this.#s}async loadConfig(e){const t=this.#i.pathname.split("/");t[t.length-1]=e;const n=this.#i.origin+t.join("/");try{const e=await fetch(n),t=await e.json();return Object.assign(new i,t)}catch(t){throw console.error(`config file load error (configFile:${e}, ${n})`,t),new Error("config file load error")}}async load(...e){if(void 0!==this.#e){const e=await this.loadConfig(this.#e);this.setConfig(e)}if(void 0===this.#n)throw new Error("prefixMap is not defined");if(void 0===this.#s)throw new Error("registrar is not defined");const t=Array.from(this.#n.values()),{defaultNameType:n,defaultPath:s}=this.#t;e=e.length>0?e:this.#t.loadNames;for(let i of e){let e;i=o(i);const r=t.find((e=>e.isMatch(i)));if(void 0!==r){const t=r.getNames(i)??p.raise(`names not found (loadName:${i})`);e=c(t.path,t.prefixName,t.subName,n)}if(void 0===e&&void 0!==s&&(e=c(s,"",i,n)),void 0===e)throw new Error(`unmatch prefix and no defaultPath (loadName:${i})`);const a=this.#i.pathname.split("/");a[a.length-1]=e.filePath;const l=this.#i.origin+a.join("/");let d,u;try{d=await import(l)}catch(e){throw console.error(`import error (loadName:${i}, ${l})`,e),new Error("import error")}if(void 0!==e.exportName){if(void 0!==d.default?e.exportName in d.default&&(u=d.default[e.exportName]):e.exportName in d&&(u=d[e.exportName]),void 0===u)throw new Error(`${e.exportName} not found in module (exportName:${e.exportName}, ${e.filePath})`)}else u=void 0!==d.default?d.default:Object.assign({},d);this.#s(i,u)}return this}static create(e){return new u(e)}}const h="data-bind",m="data-uuid",g=new Map;function f(e){return g.get(e)}function y(e,t,n){const s=document.createElement("template");return s.innerHTML=function(e,t,n){const s=[],i=e.replaceAll(/\{\{([^\}]+)\}\}/g,((e,t)=>{if((t=t.trim()).startsWith("loop:")||t.startsWith("if:"))return s.push(t),`<template data-bind="${t}">`;if(t.startsWith("else:")){const e=s.at(-1);return void 0!==e&&e.startsWith("if:")||p.raise(`Template: endif: is not matched with if:, but {{ ${t} }} `),`</template><template data-bind="${e}|not">`}if(t.startsWith("end:"))return void 0===s.pop()&&p.raise(`Template: end: is not matched with loop: or if:, but {{ ${t} }} `),"</template>";if(t.startsWith("endif:")){const e=s.pop();return void 0!==e&&e.startsWith("if:")||p.raise(`Template: endif: is not matched with if:, but {{ ${e} }} `),"</template>"}if(t.startsWith("endloop:")){const e=s.pop();return void 0!==e&&e.startsWith("loop:")||p.raise(`Template: endloop: is not matched with loop:, but {{ ${e} }} `),"</template>"}return`\x3c!--@@:${t}--\x3e`}));s.length>0&&p.raise(`Template: loop: or if: is not matched with endloop: or endif:, but {{ ${s.at(-1)} }} `);const r=document.createElement("template");r.innerHTML=i;const o=n.map((e=>p.toKebabCase(e))),a=e=>{for(const n of o){const s=Array.from(e.querySelectorAll(n));for(const e of s){const s=document.createElement(`${n}-${t}`);for(let t=0;t<e.attributes.length;t++){const n=e.attributes[t];s.setAttribute(n.name,n.value)}s.setAttribute("data-orig-tag-name",n),e.parentNode?.replaceChild(s,e)}const i=Array.from(e.querySelectorAll(`[is="${n}"]`));for(const e of i){const s=document.createElement(e.tagName,{is:`${n}-${t}`});for(let t=0;t<e.attributes.length;t++){const n=e.attributes[t];"is"!==n.name&&s.setAttribute(n.name,n.value)}s.setAttribute("data-orig-is",n),e.parentNode?.replaceChild(s,e)}}const n=Array.from(e.querySelectorAll("template"));for(const e of n)a(e.content)};o.length>0&&a(r.content);const l=e=>{let t;for(;t=e.querySelector("template");){const e=p.createUUID(),n=document.createComment(`@@|${e}`);if(t.parentNode?.replaceChild(n,t),t.constructor!==HTMLTemplateElement){const e=document.createElement("template");for(let n of Array.from(t.childNodes))e.content.appendChild(n);const n=t.getAttribute(h);n&&e.setAttribute(h,n),t=e}t.setAttribute(m,e),l(t.content),g.set(e,t)}};return l(r.content),r.innerHTML}(e,t,n),s.setAttribute(m,t),g.set(t,s),s}const b=new Map;function x(e,t){const n=b.get(t);if(n)return n;const s=function(e){const t=new CSSStyleSheet;return t.replaceSync(e),t}(e);return b.set(t,s),s}let v=class{#r=p.createUUID();get uuid(){return this.#r}html="";css;get template(){const t=this.config.useLocalTagName??e.useLocalTagName?Object.keys(this.componentModules??{}):[];return y(this.html,this.uuid,t)}get styleSheet(){return this.css?x(this.css,this.uuid):void 0}State=class{};config={};moduleConfig={};options={};filters={};componentModules;get componentModulesForRegister(){if((this.config.useLocalTagName??e.useLocalTagName)&&void 0!==this.componentModules){const e={};for(const[t,n]of Object.entries(this.componentModules))e[`${p.toKebabCase(t)}-${this.uuid}`]=n;return e}return this.componentModules}};const P={objectClass:Object,prefix:"object",prefixShort:"o",prototypeFuncs:new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),staticFuncs:new Set(["create","defineProperties","defineProperty","entries","fromEntries","getOwnPropertyDescriptor","getOwnPropertyDescriptors","getOwnPropertyNames","getOwnPropertySymbols","getPrototypeOf","is","isExtensible","isFrozen","isSealed","keys","preventExtensions","values"])},C={objectClass:Array,prefix:"array",prefixShort:"a",prototypeFuncs:new Set(["at","concat","entries","flat","includes","indexOf","join","keys","lastIndexOf","slice","toLocaleString","toReversed","toSorted","toSpliced","values","with","toString"]),staticFuncs:new Set(["from","isArray","of"])},S={objectClass:Number,prefix:"number",prefixShort:"n",prototypeFuncs:new Set(["toExponential","toFixed","toLocaleString","toPrecision","toString","valueOf"]),staticFuncs:new Set(["isFinite","isInteger","isNaN","isSafeInteger","parseFloat","parseInt"])},w={objectClass:String,prefix:"string",prefixShort:"s",prototypeFuncs:new Set(["at","charAt","charCodeAt","codePointAt","concat","endsWith","includes","indexOf","lastIndexOf","localeCompare","match","normalize","padEnd","padStart","repeat","replace","replaceAll","search","slice","split","startsWith","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim","trimEnd","trimStart","valueOf","toString"]),staticFuncs:new Set(["fromCharCode","fromCodePoint","raw"])},N={objectClass:Date,prefix:"date",prefixShort:"",prototypeFuncs:new Set(["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","toDateString","toISOString","toJSON","toLocaleDateString","toLocaleString","toLocaleTimeString","toTimeString","toUTCString","valueOf","toString"]),staticFuncs:new Set(["now","parse","UTC"])},B={objectClass:Set,prefix:"set",prefixShort:"",prototypeFuncs:new Set(["entries","forEach","has","keys","values"]),staticFuncs:new Set([])},E={objectClass:Map,prefix:"map",prefixShort:"",prototypeFuncs:new Set(["entries","forEach","get","has","keys","values"]),staticFuncs:new Set(["groupBy"])},M={objectClass:JSON,prefix:"json",prefixShort:"",prototypeFuncs:new Set([]),staticFuncs:new Set(["parse","stringify"])},I={objectClass:Math,prefix:"math",prefixShort:"",prototypeFuncs:new Set([]),staticFuncs:new Set(["abs","acos","acosh","asin","asinh","atan","atan2","atanh","cbrt","ceil","clz32","cos","cosh","exp","expm1","floor","fround","hypot","imul","log","log10","log1p","log2","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc"])},T={objectClass:RegExp,prefix:"regexp",prefixShort:"",prototypeFuncs:new Set(["exec","test","toString"]),staticFuncs:new Set([])};class ${static"truthy*"=e=>e=>!!e;static"falsey*"=e=>e=>!e;static"not*"=this["falsey*"];static eq=e=>t=>t==e[0];static ne=e=>t=>t!=e[0];static lt=e=>t=>Number(t)<Number(e[0]);static le=e=>t=>Number(t)<=Number(e[0]);static gt=e=>t=>Number(t)>Number(e[0]);static ge=e=>t=>Number(t)>=Number(e[0]);static oi=e=>t=>Number(e[0])<Number(t)&&Number(t)<Number(e[1]);static ci=e=>t=>Number(e[0])<=Number(t)&&Number(t)<=Number(e[1]);static embed=e=>t=>(e[0]??"").replaceAll("%s",t);static iftext=e=>t=>t?e[0]??null:e[1]??null;static"isnull*"=e=>e=>null==e;static offset=e=>t=>Number(t)+Number(e[0]);static unit=e=>t=>String(t)+String(e[0]);static inc=this.offset;static mul=e=>t=>Number(t)*Number(e[0]);static div=e=>t=>Number(t)/Number(e[0]);static mod=e=>t=>Number(t)%Number(e[0]);static prop=e=>t=>t[e[0]];static prefix=e=>t=>String(e[0])+String(t);static suffix=this.unit;static date=e=>t=>Date.prototype.toLocaleDateString.apply(t,["sv-SE",e[0]?e[0]:{}]);static"isnan*"=e=>e=>isNaN(e)}new Set([]);const R=new Set(["truthy*","falsey*","not*","eq","ne","lt","le","gt","ge","oi","ci","embed","iftext","isnull*","offset","unit","inc","mul","div","mod","prop","prefix","suffix","date","isnan*"]);function A(e,t){if(Reflect.has(e,"prototype")){const n=Reflect.get(e,"prototype");if(Reflect.has(n,t)){const e=Reflect.get(n,t);return t=>n=>e.apply(n,t)}}}function L(e,t){if(Reflect.has(e,t)){const n=Reflect.get(e,t);return e=>t=>n.apply(null,[t,...e])}}const k=[N,B,E,M,T,C,P,S,w,I],F=e=>t=>n=>null==n?n:e(t)(n),V=(e,t)=>t(e),O=e=>e=>e;class D{static create(e,t){const n=[];for(let s=0;s<e.length;s++){const i=e[s],r=t.getFilterFunc(i.name)(i.options);n.push(r)}return n}}class H{ambigousNames=new Set;funcByName=new Map;registerFilter(e,t){const n=e.endsWith("*"),s=n?e.slice(0,-1):e;this.funcByName.has(s)&&p.raise(`${this.constructor.name}: ${s} is already registered`);const i=n?t:F(t);this.funcByName.set(s,i)}getFilterFunc(e){return this.ambigousNames.has(e)&&p.raise(`${this.constructor.name}: ${e} is ambigous`),this.funcByName.get(e)??O}static applyFilter(e,t){return t.reduce(V,e)}}class j extends H{constructor(){super(),this.ambigousNames=new Set(j.#o),this.funcByName=new Map(j.#a)}static#o=new Set;static#a=new Map;static{const e=new Set,t=new Map;for(const n of k){for(const s of n.prototypeFuncs){const i=s.endsWith("*"),r=i?s.slice(0,-1):s,o=A(n.objectClass,r);if(void 0!==o){const s=i?o:F(o);n.prefix&&t.set(`${n.prefix}.${r}`,s),n.prefixShort&&t.set(`${n.prefixShort}.${r}`,s),t.has(r)?e.add(r):t.set(r,s)}}for(const s of n.staticFuncs){const i=s.endsWith("*"),r=i?s.slice(0,-1):s,o=L(n.objectClass,r);if(void 0!==o){const s=i?o:F(o);n.prefix&&t.set(`${n.prefix}.${r}`,s),n.prefixShort&&t.set(`${n.prefixShort}.${r}`,s),t.has(r)?e.add(r):t.set(r,s)}}}for(const e of R){const n=e.endsWith("*"),s=n?e.slice(0,-1):e,i=Reflect.get($,e);void 0===i&&p.raise(`${this.name}: ${e} is not found in defaultFilterGroup`);const r=n?i:F(i);t.set(s,r)}for(const n of e)t.delete(n);this.#o=e,this.#a=t}static registerFilter(e,t){const n=e.endsWith("*"),s=n?e.slice(0,-1):e;this.#a.has(s)&&p.raise(`${this.name}: ${s} is already registered`);const i=n?t:F(t);this.#a.set(s,i)}}class _{static date=e=>e=>""===e?null:new Date(new Date(e).setHours(0));static number=e=>e=>""===e?null:Number(e);static boolean=e=>e=>"false"!==e&&""!==e}class W extends H{constructor(){super(),this.ambigousNames=new Set(W.#o),this.funcByName=new Map(W.#a)}static#o=new Set;static#a=new Map;static{this.#a.set("date",_.date),this.#a.set("number",_.number),this.#a.set("boolean",_.boolean)}static registerFilter(e,t){this.#a.has(e)&&p.raise(`${this.name}: ${e} is already registered`),this.#a.set(e,t)}}class U{static preventDefault=e=>e=>(e.preventDefault(),e);static noStopPropagation=e=>e=>(Reflect.set(e,"noStopPropagation",!0),e);static pd=this.preventDefault;static nsp=this.noStopPropagation}class K extends H{constructor(){super(),this.ambigousNames=new Set(K.#o),this.funcByName=new Map(K.#a)}static#o=new Set;static#a=new Map;static{this.#a.set("preventDefault",U.preventDefault),this.#a.set("noStopPropagation",U.noStopPropagation),this.#a.set("pd",U.preventDefault),this.#a.set("nsp",U.noStopPropagation)}static registerFilter(e,t){this.#a.has(e)&&p.raise(`${this.name}: ${e} is already registered`),this.#a.set(e,t)}}const z="state",q=Symbol.for(`${z}.accessorProperties`),G=Symbol.for(`${z}.dependencies`),Q=Symbol.for(`${z}.connectedEvent`),Z=Symbol.for(`${z}.disconnectedEvent`),J=Symbol.for(`${z}.updatedEvent`),Y=Symbol.for(`${z}.connectedCallback`),X=Symbol.for(`${z}.disconnectedCallback`),ee=Symbol.for(`${z}.updatedCallback`),te=Symbol.for(`${z}.directlyCallApi`),ne=Symbol.for(`${z}.notifyForDependentPropsApi`),se=Symbol.for(`${z}.getDependentPropsApi`),ie=Symbol.for(`${z}.clearCacheApi`),re=Symbol.for(`${z}.createBufferApi`),oe=Symbol.for(`${z}.flushBufferApi`),ae="$dependentProps";function le(e){const t=function(e){const t={};let n=e;for(;n!==Object.prototype;){const e=Object.getOwnPropertyDescriptors(n);console.log("descs",e);for(const[n,s]of Object.entries(e))Reflect.has(t,n)||(t[n]=s);n=Object.getPrototypeOf(n)}return t}(e),n=[];for(const[e,s]of Object.entries(t))(s.get||s.set)&&n.push(e);return n}const de=new Map;const ce="*",pe=".",ue=new RegExp(/^\$([0-9]+)$/);const he={};function me(e){return he[e]??(he[e]=function(e){const t=e.split(pe),n=t.slice(0,-1),s=n.reduce(((e,t)=>(e.push(e.at(-1)?.concat(t)??[t]),e)),[]).map((e=>e.join("."))),i=new Set(s),r=n.join(pe),o=t[t.length-1]??"",a=new RegExp("^"+e.replaceAll(".","\\.").replaceAll("*","([0-9a-zA-Z_]*)")+"$"),l=t.reduce(((e,t)=>e+(t===ce?1:0)),0),d=1===t.length,c=[];for(let e=0;e<t.length;e++)t[e]===ce&&c.push(t.slice(0,e+1).join("."));return{name:e,pathNames:t,parentPathNames:n,parentPaths:s,setOfParentPaths:i,parentPath:r,lastPathName:o,regexp:a,level:l,isPrimitive:d,wildcardNames:c}}(e))}const ge={};function fe(e){return ge[e]??(ge[e]=function(e){const t=[],n=[];let s=!1,i=-1;for(const r of e.split(".")){const e=Number(r);isNaN(e)?(n.push(r),"*"===r&&(t.push(void 0),s=!0,i=t.length-1)):(t.push(e),n.push("*"))}return{name:e,isPrimitive:1===n.length,isDotted:n.length>1,hasWildcard:t.length>0,patternName:n.join("."),isIncomplete:s,indexes:t,lastIncompleteIndex:i}}(e))}let ye=class{#l=new Set;#d=new Map;constructor(e){this.setDependentProps(e)}get propsByRefProp(){return this.#d}hasDefaultProp(e){return this.#l.has(e)}addDefaultProp(e){let t=me(fe(e).patternName);for(;""!==t.parentPath;){const e=me(t.parentPath);this.#l.has(t.name)||(this.#d.get(e.name)?.add(t.name)??this.#d.set(e.name,new Set([t.name])),this.#l.add(t.name)),t=e}}setDependentProps(e){for(const[t,n]of Object.entries(e))for(const e of n)this.#d.get(e)?.add(t)??this.#d.set(e,new Set([t]))}};class be{#c=new Map;get(e,t){return this.#c.get(e)?.get(t)??void 0}has(e,t){return this.#c.get(e)?.has(t)??!1}set(e,t,n){return this.#c.get(e)?.set(t,n)??this.#c.set(e,new Map([[t,n]])),n}clear(){this.#c.clear()}}const xe="do-notation",ve=Symbol.for(`${xe}.getDirect`),Pe=Symbol.for(`${xe}.setDirect`);let Ce=class{patternName;indexes;#p;get patternNameInfo(){return void 0===this.#p&&(this.#p=me(this.patternName)),this.#p}constructor(e,t=[]){this.patternName=e,this.indexes=t}},Se=class{#u=[];get lastIndexes(){return this.#u[this.#u.length-1]??[]}#h=void 0;get lastIndexesString(){return void 0===this.#h&&(void 0===this.lastIndexes&&p.raise("lastIndexes is undefined"),this.#h=this.lastIndexes.join(",")),this.#h}get stackIndexes(){return this.#u}pushIndexes(e,t){this.#h=void 0,this.#u.push(e);try{return t()}finally{this.#u.pop()}}getByPatternNameAndIndexes(e,{patternName:t,indexes:n},s){const i=Reflect.get(e,t,s);if(void 0!==i)return i;const r=me(t);if(r.isPrimitive)return;const o=this.getByPatternNameAndIndexes(e,{patternName:r.parentPath,indexes:n},s);if(void 0===o)return;return o[r.lastPathName===ce?n[r.level-1]:r.lastPathName]}setByPatternNameAndIndexes(e,{patternName:t,indexes:n,value:s},i){const r=me(t);if(Reflect.has(e,t)||r.isPrimitive)return Reflect.set(e,t,s,i);{const t=this.getByPatternNameAndIndexes(e,{patternName:r.parentPath,indexes:n},i);void 0===t&&p.raise(`parent(${r.parentPath}) is undefined`);return t[r.lastPathName===ce?n[r.level-1]:r.lastPathName]=s,!0}}getValuesAndLevelIndex(e,{propertyNameInfo:t,lastIndexes:n},s){-1===t.lastIncompleteIndex&&p.raise(`propertyName(${t.name}) has no wildcard`);let i=-1;const r=t.indexes.map(((e,s)=>s!==t.lastIncompleteIndex?e??n[s]??-1:(i=s,-1)));-1===i&&p.raise("propertyName has no wildcard"),r.filter((e=>-1===e)).length>1&&p.raise(`propertyName(${t.name}) has many wildcards`);const o=me(t.patternName),a=me(o.wildcardNames[i]),l=this.getByPatternNameAndIndexes(e,{patternName:a.parentPath,indexes:r},s);return Array.isArray(l)||p.raise("values is not an array"),{values:l,levelIndex:i,indexes:r}}getExpandLastIndex=(e,t)=>(n,s)=>{const i=fe(n);i.hasWildcard||p.raise(`propertyName(${n}) has no wildcard`);const{values:r,levelIndex:o,indexes:a}=this.getValuesAndLevelIndex(e,{propertyNameInfo:i,lastIndexes:s},t),l=[];for(const n in r)a[o]=Number(n),l.push(this.getByPatternNameAndIndexes(e,{patternName:i.patternName,indexes:a},t));return l};setExpandLastIndex=(e,t)=>(n,s,i)=>{const r=fe(n);r.hasWildcard||p.raise(`propertyName(${n}) has no wildcard`);const{values:o,levelIndex:a,indexes:l}=this.getValuesAndLevelIndex(e,{propertyNameInfo:r,lastIndexes:s},t),d=Array.isArray(i)?i:Array(o.length).fill(i);let c=!0;for(const n in o)l[a]=Number(n),c=c&&this.setByPatternNameAndIndexes(e,{patternName:r.patternName,indexes:l,value:d[n]},t);return c};getDirect=(e,{patternName:t,indexes:n},s)=>this.pushIndexes(n,(()=>this.getByPatternNameAndIndexes(e,{patternName:t,indexes:n},s)));setDirect=(e,{patternName:t,indexes:n,value:s},i)=>this.pushIndexes(n,(()=>this.setByPatternNameAndIndexes(e,{patternName:t,indexes:n,value:s},i)));get(e,t,n){const s="string"==typeof t;do{if(s&&(t.startsWith("@@__")||"constructor"===t))break;if(t===ve){const t=Reflect.get(this,"getDirect",n);return(s,i)=>Reflect.apply(t,e,[e,{patternName:s,indexes:i},n])}if(t===Pe){const t=Reflect.get(this,"setDirect",n);return(s,i,r)=>Reflect.apply(t,e,[e,{patternName:s,indexes:i,value:r},n])}if(!s)break;const i=this.lastIndexes;if("$"===t[0]){const e=ue.exec(t);if(e)return(i??p.raise("lastIndexes is null"))[Number(e[1])-1]}else if("@"===t[0]){const s=t.slice(1);return this.getExpandLastIndex(e,n)(s,i??p.raise("lastIndexes is null"))}const r=fe(t),o=r.indexes.map(((e,t)=>e??(i??p.raise("lastIndexes is null"))[t]));return this.getByPatternNameAndIndexes(e,{patternName:r.patternName,indexes:o},n)}while(0);return Reflect.get(e,t,n)}set(e,t,n,s){const i="string"==typeof t;do{if(i&&t.startsWith("@@__"))break;if(!i)break;const r=this.lastIndexes;if("$"===t[0]){ue.exec(t)&&p.raise(`context index(${t}) is read only`)}else if("@"===t[0]){const i=t.slice(1);return this.setExpandLastIndex(e,s)(i,r??p.raise("lastIndexes is null"),n)}const o=fe(t),a=o.indexes.map(((e,t)=>e??(r??p.raise("lastIndexes is null"))[t]));return this.setByPatternNameAndIndexes(e,{patternName:o.patternName,indexes:a,value:n},s)}while(0);return Reflect.set(e,t,n,s)}};class we extends Se{#m;get accessorProperties(){return this.#m}#g;get dependencies(){return this.#g}#f;get component(){return this.#f}constructor(e,t,n){super(),this.#f=e,this.#m=t,this.#g=n}get(e,t,n){return t===q?this.#m:t===G?this.#g:super.get(e,t,n)}ownKeys(e){return Reflect.ownKeys(e).concat([q,G])}has(e,t){return Reflect.has(e,t)||t===q||t===G}addProcess(e,t,n){this.component.updator.addProcess(e,t,n)}addNotify(e,t,n){this.#f.updator.addUpdatedStateProperty(t)}clearCache(){}directlyCallback(e,t){}static makeNotifyForDependentProps(e,t,n=new Set([])){const{patternNameInfo:s,indexes:i}=t,r=s.name+"\t"+i.toString();if(n.has(r))return[];n.add(r);const o=e[se]().propsByRefProp.get(s.name),a=[];if(void 0===o)return[];for(const t of o){const s=me(t);if(i.length<s.level){const t=we.expandIndexes(e,new Ce(s.name,i));a.push(...t.map((e=>new Ce(s.name,e))))}else{const e=i.slice(0,s.level);a.push(new Ce(s.name,e))}a.push(...this.makeNotifyForDependentProps(e,new Ce(s.name,i),n))}return a}static expandIndexes(e,t){const{patternNameInfo:n,patternName:s,indexes:i}=t;if(n.level===i.length)return[i];if(n.level<i.length)return[i.slice(0,n.level)];{const t=e[ve],s=(e,r,o)=>{const a=""!==e?e+".":e,l=n.pathNames[r];if(n.pathNames.length-1===r){if("*"===l){const n=[],s=t(e,o).length;for(let e=0;e<s;e++)n.push(o.concat(e));return n}return[o]}{const n=a+l;if("*"===l){if(o.length<i.length)return s(n,r+1,i.slice(0,o.length+1));{const i=[],a=t(e,o).length;for(let e=0;e<a;e++)i.push(...s(n,r+1,o.concat(e)));return i}}return s(n,r+1,o)}};return s("",0,[])}}}const Ne={[Q]:(...e)=>{},[Z]:(...e)=>{},[J]:(...e)=>({props:e})},Be={[Q]:"connected",[Z]:"disconnected",[J]:"updated"};const Ee={[Y]:"$connectedCallback",[X]:"$disconnectedCallback",[ee]:"$updatedCallback"},Me=new Set([Y,X,ee]),Ie={[Y]:Q,[X]:Z,[ee]:J};class Te{static get(e,t,n,s){const i=Ee[s]??p.raise(`Unknown callback symbol: ${s.description}`),r=(...r)=>async()=>{i in e&&Reflect.apply(Reflect.get(e,i),t,r),function(e,t,n){const s=Be[t]??p.raise(`Unknown event symbol: ${t.description} `),i=(Ne[t]??p.raise(`Unknown detail function for event symbol: ${t.description}`))(...n),r=new CustomEvent(s,{detail:i});e.dispatchEvent(r)}(n.component,Ie[s],r)};return s===Y?(...e)=>r(...e)():(...e)=>n.addProcess(r(...e),t,[])}static has(e){return"string"!=typeof e&&"number"!=typeof e&&Me.has(e)}static getSupportSymbol(e){if("string"!=typeof e&&"number"!=typeof e)return Me.has(e)?e:void 0}}const $e=new Set([te,ne,se,ie,re,oe]),Re={[te]:({state:e,stateProxy:t,handler:n})=>async(s,i,r)=>n.directlyCallback(i,(async()=>Reflect.apply(Reflect.get(e,s),t,[r,...i?.allIndexes??[]]))),[ne]:({state:e,stateProxy:t,handler:n})=>(s,i)=>n.addNotify(e,new Ce(s,i),t),[se]:({handler:e})=>()=>e.dependencies,[ie]:({handler:e})=>()=>e.clearCache(),[re]:({stateProxy:e})=>t=>e.$createBuffer?.apply(e,[t]),[oe]:({stateProxy:e})=>(t,n)=>e.$flushBuffer?.apply(e,[t,n])};class Ae{static get(e,t,n,s){return Re[s]?.({state:e,stateProxy:t,handler:n})}static has(e){return"string"!=typeof e&&"number"!=typeof e&&$e.has(e)}static getSupportSymbol(e){if("string"!=typeof e&&"number"!=typeof e)return $e.has(e)?e:void 0}}function Le(e,t){return void 0!==e.prototype[t]||e.prototype!==Object.prototype&&Le(Object.getPrototypeOf(e),t)}const ke=new Set(["addProcess","viewRootElement ","queryRoot","asyncShowModal","asyncShow","asyncShowPopover","cancelPopover"]);let Fe=class{get(e,t){return ke.has(t)||Le(e.baseClass,t)?Reflect.get(e,t):void p.raise(`property ${t} is not found in ${e.baseClass.name}`)}};const Ve="$globals",Oe="$dependentProps",De="$component",He=new Set([Ve,Oe,De]),je={[Ve]:({component:e})=>e.globals,[Oe]:({state:e})=>Reflect.get(e,Oe),[De]:({component:e})=>function(e){return new Proxy(e,new Fe)}(e)};class _e{static get(e,t,n){return je[n]?.({component:e,state:t})??p.raise(`SpecialProp: ${n} is not found`)}static has(e){return He.has(e)}}class We extends we{#y=new be;get cache(){return this.#y}clearCache(){this.#y.clear()}getByPatternNameAndIndexes(e,{patternName:t,indexes:n},s){const i=me(t);if(i.isPrimitive||!this.dependencies.hasDefaultProp(t)&&this.dependencies.addDefaultProp(t),_e.has(i.name))return _e.get(this.component,e,t);if(!i.isPrimitive||this.accessorProperties.has(t)){const r=i.level>0?i.level===n.length?n.toString():n.slice(0,i.level).join(","):"",o=this.cache.get(t,r);if(void 0!==o)return o;if(this.cache.has(t,r))return;const a=super.getByPatternNameAndIndexes(e,{patternName:t,indexes:n},s);return this.cache.set(t,r,a),a}return super.getByPatternNameAndIndexes(e,{patternName:t,indexes:n},s)}setByPatternNameAndIndexes(e,{patternName:t,indexes:n,value:s},i){p.raise("StateReadOnlyHandler: State is read only")}get(e,t,n){if("symbol"==typeof t){const s=Te.getSupportSymbol(t);if(void 0!==s)return Te.get(e,n,this,s);const i=Ae.getSupportSymbol(t);if(void 0!==i)return Ae.get(e,n,this,i)}return super.get(e,t,n)}set(e,t,n,s){p.raise("StateReadOnlyHandler: State is read only")}}class Ue{#b;get loopContext(){return this.#b}async callback(e,t){void 0!==this.#b&&p.raise("DirectlyCallContext: already set loopContext"),this.#b=e;try{return await t()}finally{this.#b=void 0}}}class Ke extends we{#x=new Ue;getByPatternNameAndIndexes(e,{patternName:t,indexes:n},s){const i=me(t);return i.isPrimitive||!this.dependencies.hasDefaultProp(i.name)&&this.dependencies.addDefaultProp(i.name),_e.has(t)?_e.get(this.component,e,t):super.getByPatternNameAndIndexes(e,{patternName:t,indexes:n},s)}setByPatternNameAndIndexes(e,{patternName:t,indexes:n,value:s},i){me(t).isPrimitive||!this.dependencies.hasDefaultProp(t)&&this.dependencies.addDefaultProp(t);const r=super.setByPatternNameAndIndexes(e,{patternName:t,indexes:n,value:s},i);return this.addNotify(e,new Ce(t,n),i),r}async directlyCallback(e,t){return this.#x.callback(e,(async()=>{this.stackIndexes.push(void 0);try{return await t()}finally{this.stackIndexes.pop()}}))}#v(e){if(void 0===this.#x.loopContext)return;if("string"!=typeof e||e.startsWith("@@__")||"constructor"===e)return;const t=me(e);if(0===t.level||"@"===e.at(0))return;const n=me(t.wildcardNames[t.wildcardNames.length-1]),s=this.#x.loopContext.find(n.parentPath);return void 0===s&&p.raise(`StateWriteHandler: ${e} is outside loop`),s}get(e,t,n){if("symbol"==typeof t){const s=Te.getSupportSymbol(t);if(void 0!==s)return Te.get(e,n,this,s);const i=Ae.getSupportSymbol(t);if(void 0!==i)return Ae.get(e,n,this,i)}if("string"!=typeof t)return super.get(e,t,n);const s=this.#v(t);return void 0!==s?this.getDirect(e,{patternName:t,indexes:s.allIndexes},n):super.get(e,t,n)}set(e,t,n,s){if("string"!=typeof t)return super.set(e,t,n,s);const i=this.#v(t);return void 0!==i?this.setDirect(e,{patternName:t,indexes:i.allIndexes,value:n},s):super.set(e,t,n,s)}}function ze(e,t){const n=Reflect.construct(t,[]),s=new Set(function(e){let t=de.get(e.constructor);return void 0===t&&(t=le(e),{}.constructor!==e.constructor&&de.set(e.constructor,t)),t}(n)),i=new ye(Reflect.get(n,ae)??{});return{base:n,write:new Proxy(n,new Ke(e,s,i)),readonly:new Proxy(n,new We(e,s,i))}}const qe=new Set(["articles","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]),Ge=e=>-1!==e.indexOf("-");const Qe="--adopted-css",Ze=new Map;function Je(e,t){Array.from(e.cssRules).map((e=>{if("CSSImportRule"===e.constructor.name){const n=e;n.styleSheet?Je(n.styleSheet,t):console.log(`import rule not found: ${n.href}`)}else t.insertRule(e.cssText,t.cssRules.length)}))}function Ye(e){const t=new CSSStyleSheet,n=Array.from(document.styleSheets).filter((t=>t.title===e));if(0!==n.length)return n.forEach((e=>Je(e,t))),Ze.set(e,t),t;console.log(`style sheet not found: ${e}`)}const Xe=e=>e.trim(),et=e=>e.length>0,tt=e=>Ze.get(e)??Ye(e),nt=e=>void 0!==e;let st=class{#P;get bindingManager(){return this.#P}get parentBindingManager(){return this.bindingManager.parentBinding?.bindingManager}get binding(){return this.bindingManager.parentBinding}get nearestBindingManager(){const e=me(this.name);if(e.level<=0)return;const t=me(e.wildcardNames[e.wildcardNames.length-1]),n=me(t.parentPath).name;let s=this.parentBindingManager;for(;void 0!==s;){if(s.loopContext.binding?.stateProperty.name===n)return s;s=s.loopContext.parentBindingManager}}get nearestLoopContext(){return this.nearestBindingManager?.loopContext}#C=-1;#S=-1;get _index(){const e=this.bindingManager.component.contextRevision;return this.#C!==e&&(this.#S=this.binding?.children.indexOf(this.#P)??-1,this.#C=e),this.#S}get index(){if(this.binding?.loopable)return this._index;{const e=this.parentBindingManager?.loopContext;return e?.index??-1}}get name(){if(this.binding?.loopable)return this.binding.stateProperty.name;{const e=this.parentBindingManager?.loopContext;return e?.name??""}}get indexes(){if(this.binding?.loopable)return this.nearestLoopContext?.indexes.concat(this.index)??[this.index];{const e=this.parentBindingManager?.loopContext;return e?.indexes??[]}}get allIndexes(){if(void 0===this.binding)return[];const e=this.binding.loopable?this._index:-1,t=this.parentBindingManager?.loopContext.allIndexes??[];return e>=0?t.concat(e):t}constructor(e){this.#P=e}find(e){let t=this;for(;void 0!==t;){if(t.name===e)return t;t=t.parentBindingManager?.loopContext}}};const it=e=>e,rt={Text:e=>{const t=document.createTextNode("");return e.parentNode?.replaceChild(t,e),t},HTMLElement:it,SVGElement:it,Template:it},ot=e=>{const t=e;return t.removeAttribute("data-bind"),t},at=e=>e,lt={HTMLElement:ot,SVGElement:ot,Text:at,Template:at},dt=e=>!1,ct={HTMLElement:e=>e instanceof HTMLElement&&(e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&"button"!==e.type),SVGElement:dt,Text:dt,Template:dt},pt=e=>e.trim(),ut=e=>e.length>0,ht=new RegExp(/^#(.*)#$/),mt=e=>{const t=ht.exec(e);return t?decodeURIComponent(t[1]):e},gt=e=>{const[t,...n]=e.split(",").map(pt);return{name:t,options:n.map(mt)}},ft=(e,t)=>{const[n,s]=[t].concat(...e.split(":").map(pt)).splice(-2),{stateProperty:i,filters:r}=(e=>{const[t,...n]=e.split("|").map(pt);return{stateProperty:t,filters:n.map(gt)}})(s);return{nodeProperty:n,stateProperty:i,filters:r}},yt={};function bt(e,t){if(""===e.trim())return[];const n=e+"\t"+t;return yt[n]??(yt[n]=((e,t)=>e.split(";").map(pt).filter(ut).map((e=>{let{nodeProperty:n,stateProperty:s,filters:i}=ft(e,"$");return s="@"===s?n:s,n="$"===n?t:n,void 0===n&&p.raise("parseBindText: default property undefined"),{nodeProperty:n,stateProperty:s,filters:i}})))(e,t))}const xt="textContent",vt={radio:"checked",checkbox:"checked",button:"onclick"},Pt={},Ct=e=>{},St={HTMLElement:e=>e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLOptionElement?"value":e instanceof HTMLButtonElement||e instanceof HTMLAnchorElement?"onclick":e instanceof HTMLFormElement?"onsubmit":e instanceof HTMLInputElement?vt[e.type]??"value":xt,SVGElement:Ct,Text:e=>xt,Template:Ct};let wt=class{value;enabled=!1;constructor(e,t){this.value=e,this.enabled=t}},Nt=class{get state(){return this.#w.component.currentState}#N;get name(){return this.#N}#B;get propertyName(){return this.#B}#E;get patternName(){return this.#E}#M;get level(){return this.#M}get indexes(){const e=this.binding.loopContext?.indexes??[];return e.length===this.level?e:e.slice(0,this.level)}get indexesString(){return this.indexes.toString()}get key(){return this.name+"\t"+this.indexesString}#I="";get oldKey(){return this.#I}get isChagedKey(){return this.#I!==this.key}getKey(){return this.#I=this.key,this.key}get value(){return this.state[ve](this.name,this.indexes)}set value(e){const t=e=>{this.state[Pe](this.name,this.indexes,e)};if(e instanceof wt){const n=this.value;if(Array.isArray(n)){const s=new Set(n);e.enabled?s.add(e.value):s.delete(e.value),t(Array.from(s))}else t(e.enabled?e.value:void 0)}else t(e)}#T;get filters(){return this.#T}get filteredValue(){return 0===this.filters.length?this.value:H.applyFilter(this.value,this.filters)}get applicable(){return!0}#w;get binding(){return this.#w}constructor(e,t,n){this.#w=e,this.#N=t,this.#T=D.create(n,e.component.outputFilterManager),this.#B=fe(t),this.#E=me(t),this.#M=this.#E.level}assign(e,t,n){return this.#w=e,this.#N=t,this.#T=D.create(n,e.component.outputFilterManager),this.#B=fe(t),this.#E=me(t),this.#M=this.#E.level,this}initialize(){}getChildValue(e){return this.state[ve](`${this.name}.*`,this.indexes.concat(e))}setChildValue(e,t){return this.state[Pe](`${this.name}.*`,this.indexes.concat(e),t)}dispose(){}},Bt=class{#$;get node(){return this.#$}#N;get name(){return this.#N}#R;get nameElements(){return this.#R}get value(){return Reflect.get(this.node,this.name)}set value(e){Reflect.set(this.node,this.name,e)}#T;get filters(){return this.#T}get filteredValue(){return 0===this.filters.length?this.value:H.applyFilter(this.value,this.filters)}get applicable(){return!0}#w;get binding(){return this.#w}get expandable(){return!1}get isSelectValue(){return!1}get loopable(){return!1}constructor(e,t,n,s){t instanceof Node||p.raise("NodeProperty: not Node"),this.#w=e,this.#$=t,this.#N=n,this.#R=n.split("."),this.#T=D.create(s.toReversed(),e.component.inputFilterManager)}assign(e,t,n,s){this.#w=e,this.#$=t,this.#N=n,this.#R=n.split(".");const i=s.slice(0);return i.reverse(),this.#T=D.create(i,e.component.inputFilterManager),this}initialize(){}postUpdate(e){}isSameValue(e){return this.value===e}applyToChildNodes(e){}dispose(){}};const Et=RegExp(/^\$[0-9]+$/);let Mt=class extends Nt{get index(){return Number(this.name.slice(1))-1}get value(){return this.binding.loopContext.allIndexes[this.index]}get indexes(){return[]}get indexesString(){return""}constructor(e,t,n){Et.test(t)||p.raise(`ContextIndex: invalid name ${t}`),super(e,t,n)}};let It=class e extends Bt{#A;get template(){return void 0===this.#A&&(this.#A=f(this.uuid)??p.raise(`TemplateProperty: invalid uuid ${this.uuid}`)),this.#A}#r;get uuid(){return void 0===this.#r&&(this.#r=e.getUUID(this.node)),this.#r}static getUUID(e){return e.textContent?.slice(3)??p.raise("TemplateProperty: invalid node")}get expandable(){return!0}constructor(e,t,n,s){t instanceof Comment||p.raise("TemplateProperty: not Comment"),super(e,t,n,s)}};const Tt=e=>e.applyToNode();let $t=class extends It{get loopable(){return!0}get value(){return this.binding.children.length}set value(e){if(Array.isArray(e)||p.raise(`Repeat: ${this.binding.component.selectorName}.State['${this.binding.stateProperty.name}'] is not array`),this.value<e.length){this.binding.children.forEach(Tt);for(let t=this.value;t<e.length;t++){const e=vn.create(this.binding.component,this.template,this.uuid,this.binding);this.binding.appendChild(e),e.postCreate()}}else if(this.value>e.length){const t=this.binding.children.splice(e.length);this.binding.children.forEach(Tt),t.forEach((e=>e.dispose()))}else this.binding.children.forEach(Tt)}constructor(e,t,n,s){"loop"!==n&&p.raise(`Repeat: invalid property name '${n}'`),super(e,t,n,s)}isSameValue(e){return!1}},Rt=class extends Bt{get element(){return this.node}constructor(e,t,n,s){t instanceof Element||p.raise("ElementBase: not element"),super(e,t,n,s)}};let At=class extends Rt{get inputElement(){return this.node}_value=new wt(void 0,!1);get value(){return this._value.value=this.inputElement.value,this._value.enabled=this.inputElement.checked,this._value}set value(e){Array.isArray(e)||p.raise(`Checkbox: ${this.binding.component.selectorName}.State['${this.binding.stateProperty.name}'] is not array`);const t=this.filteredValue;this.inputElement.checked=e.some((e=>e===t.value))}_filteredValue=new wt(void 0,!1);get filteredValue(){const e=this.value;return this._filteredValue.value=this.filters.length>0?H.applyFilter(e.value,this.filters):e.value,this._filteredValue.enabled=e.enabled,this._filteredValue}constructor(e,t,n,s){t instanceof HTMLInputElement||p.raise("Checkbox: not htmlInputElement"),"checkbox"!==t.type&&p.raise("Checkbox: not checkbox"),super(e,t,n,s)}isSameValue(e){return!1}},Lt=class extends Rt{get inputElement(){return this.element}_value=new wt(void 0,!1);get value(){return this._value.value=this.inputElement.value,this._value.enabled=this.inputElement.checked,this._value}set value(e){const t=this.filteredValue;this.inputElement.checked=e===t.value}_filteredValue=new wt(void 0,!1);get filteredValue(){const e=this.value;return this._filteredValue.value=this.filters.length>0?H.applyFilter(e.value,this.filters):e.value,this._filteredValue.enabled=e.enabled,this._filteredValue}constructor(e,t,n,s){t instanceof HTMLInputElement||p.raise("Radio: not htmlInputElement");const i=t;"radio"!==i.type&&"checkbox"!==i.type&&p.raise("Radio: not radio or checkbox"),super(e,t,n,s)}isSameValue(e){return!1}};let kt=class extends Rt{get eventType(){return this.name.slice(2)}get applicable(){return!1}#L;get handler(){return void 0===this.#L&&(this.#L=e=>this.eventHandler(e)),this.#L}#k=[];get eventFilters(){return this.#k}constructor(e,t,n,s){n.startsWith("on")||p.raise(`ElementEvent: invalid property name ${n}`),super(e,t,n,s),this.#k=D.create(s,e.component.eventFilterManager)}initialize(){this.element.addEventListener(this.eventType,this.handler)}async directlyCall(e){if(!this.binding.component?.bindingSummary.exists(this.binding))return;const{stateProperty:t,loopContext:n}=this.binding;return t.state[te](t.name,n,e)}eventHandler(e){this.binding.component?.bindingSummary.exists(this.binding)&&(e=this.eventFilters.length>0?H.applyFilter(e,this.eventFilters):e,!Reflect.has(e,"noStopPropagation")&&e.stopPropagation(),this.binding.component.updator.addProcess(this.directlyCall,this,[e]))}};let Ft=class extends Rt{#F;get isSelectValue(){return void 0===this.#F&&(this.#F=this.node.constructor===HTMLSelectElement&&"value"===this.name),this.#F}};const Vt=Symbol.for("component.isComponent"),Ot="props",Dt=Symbol.for(`${Ot}.bindProperty`),Ht=Symbol.for(`${Ot}.setBuffer`),jt=Symbol.for(`${Ot}.getBuffer`),_t=Symbol.for(`${Ot}.clearBuffer`),Wt=Symbol.for(`${Ot}.createBuffer`),Ut=Symbol.for(`${Ot}.flushBuffer`),Kt=Symbol.for(`${Ot}.clear`);let zt=class{#V;get name(){return this.#V.name}get indexes(){return this.#V.indexes}get loopContext(){return this.#V.binding.loopContext}constructor(e){this.#V=e}},qt=class extends Rt{get propertyName(){return this.nameElements[1]}get applicable(){return!0}get thisComponent(){return this.node}constructor(e,t,n,s){!0!==Reflect.get(t,Vt)&&p.raise("ComponentProperty: not Quel Component"),super(e,t,n,s)}get value(){return super.value}set value(e){try{this.thisComponent.currentState[ee]([new Ce(`${this.propertyName}`,[])]),this.thisComponent.currentState[ne](this.propertyName,[])}catch(e){console.log(e)}}initialize(){this.thisComponent.props[Dt](this.propertyName,new zt(this.binding.stateProperty))}postUpdate(e){const t=this.binding.stateProperty.name;for(const[n,s]of e.entries())if(s.patternName===t||s.patternNameInfo.setOfParentPaths.has(t)){const e=s.patternName.slice(t.length);this.thisComponent.currentState[ee]([new Ce(`${this.propertyName}${e}`,s.indexes)]),this.thisComponent.currentState[ne](`${this.propertyName}${e}`,s.indexes)}}isSameValue(e){return!1}};const Gt=new Set(["boolean","number","string"]);let Qt=class extends $t{#O=new Map;#D=new Set;#H=new Set;#j=new Map;get loopable(){return!0}#_=[];get value(){return this.#_}set value(e){Array.isArray(e)||p.raise(`RepeatKeyed: ${this.binding.component.selectorName}.State['${this.binding.stateProperty.name}'] is not array`),this.#O.clear(),this.#D.clear(),this.#H.clear(),this.#j.clear();for(let t=0;t<e.length;t++){const e=this.binding.stateProperty.getChildValue(t),n=this.#_.indexOf(e,this.#O.get(e)??0);-1===n?this.#H.add(t):(this.#O.set(e,n+1),this.#D.add(n),this.#j.set(t,this.binding.children[n]))}for(let e=0;e<this.binding.children.length;e++)this.#D.has(e)||this.binding.children[e].dispose();let t;this.binding.children.slice(0);const n=this.node.parentNode??p.raise("parentNode is null");for(let s=0;s<e.length;s++){const e=s;let i;const r=t?.lastNode??this.node;this.#H.has(e)?(i=vn.create(this.binding.component,this.template,this.uuid,this.binding),e<this.binding.children.length?this.binding.children[e]=i:this.binding.children.push(i),n?.insertBefore(i.fragment,r.nextSibling??null),i.postCreate()):(i=this.#j.get(e)??p.raise("bindingManager is undefined"),i.nodes?.[0]?.previousSibling!==r&&(i.removeNodes(),n.insertBefore(i.fragment,r.nextSibling??null)),e<this.binding.children.length?this.binding.children[e]=i:this.binding.children.push(i),i.applyToNode()),t=i}e.length<this.binding.children.length&&(this.binding.children.length=e.length),this.#_=e.slice()}applyToChildNodes(e){const t=new Map;for(const n of e){const e=this.binding.children[n];if(void 0===e)continue;const s=this.#_[n],i=typeof s;"undefined"!==i&&(Gt.has(i)||(e.removeNodes(),t.set(s,e)))}for(const n of Array.from(e).sort()){const e=this.binding.stateProperty.getChildValue(n),s=typeof e;if("undefined"===s)continue;if(Gt.has(s))continue;let i=t.get(e);void 0===i?(i=vn.create(this.binding.component,this.template,this.uuid,this.binding),this.binding.replaceChild(n,i),i.postCreate()):(this.binding.replaceChild(n,i),i.applyToNode())}this.#_=this.binding.stateProperty.value.slice()}initialize(){this.#_=[]}dispose(){super.dispose(),this.#_=[]}};const Zt=RegExp(/^\$[0-9]+$/),Jt={0:{if:class extends It{get value(){return this.binding.children.length>0}set value(e){if("boolean"!=typeof e&&p.raise(`Branch: ${this.binding.component.selectorName}.State['${this.binding.stateProperty.name}'] is not boolean`),this.value!==e)if(e){const e=vn.create(this.binding.component,this.template,this.uuid,this.binding);this.binding.appendChild(e),e.postCreate()}else{this.binding.children.splice(0,this.binding.children.length).forEach((e=>e.dispose()))}else this.binding.children.forEach((e=>e.applyToNode()))}constructor(e,t,n,s){"if"!==n&&p.raise(`Branch: invalid property name ${n}`),super(e,t,n,s)}isSameValue(e){return!1}}},1:{class:class extends Rt{get value(){return this.element.className.length>0?this.element.className.split(" "):[]}set value(e){Array.isArray(e)||p.raise(`ElementClassName: ${this.binding.component.selectorName}.State['${this.binding.stateProperty.name}'] is not array`),this.element.className=e.join(" ")}constructor(e,t,n,s){"class"!==n&&p.raise(`ElementClassName: invalid property name ${n}`),super(e,t,n,s)}},checkbox:At,radio:Lt}},Yt={class:class extends Rt{get className(){return this.nameElements[1]}get value(){return this.element.classList.contains(this.className)}set value(e){"boolean"!=typeof e&&p.raise(`ElementClass: ${this.binding.component.selectorName}.State['${this.binding.stateProperty.name}'] is not boolean`),e?this.element.classList.add(this.className):this.element.classList.remove(this.className)}constructor(e,t,n,s){n.startsWith("class.")||p.raise(`ElementClass: invalid property name ${n}`),super(e,t,n,s)}},attr:class extends Rt{get attributeName(){return this.nameElements[1]}get value(){return this.element.getAttribute(this.attributeName)}set value(e){this.element.setAttribute(this.attributeName,e)}},style:class extends Rt{get htmlElement(){return this.node}get styleName(){return this.nameElements[1]}get value(){return this.htmlElement.style.getPropertyValue(this.styleName)}set value(e){this.htmlElement.style.setProperty(this.styleName,e)}constructor(e,t,n,s){t instanceof HTMLElement||p.raise("ElementStyle: not htmlElement"),super(e,t,n,s)}},props:qt},Xt=(e,t,n,s)=>{const i=Zt.test(n)?Mt:Nt;let r;do{const n=e instanceof Comment;if(r=Jt[n?0:1][t],void 0!==r)break;if(n&&"loop"===t){r=s?Qt:$t;break}n&&p.raise(`Factory: unknown node property ${t}`);const i=t.split(".");if(r=Yt[i[0]],void 0!==r)break;r=e instanceof Element?t.startsWith("on")?kt:Ft:Bt}while(0);return{nodePropertyCreator:(a=r,(e,t,n,s)=>Reflect.construct(a,[e,t,n,s])),statePropertyCreator:(o=i,(e,t,n)=>Reflect.construct(o,[e,t,n]))};var o,a},en=(e,t)=>(n,s)=>bn.create(n,s,e.nodeProperty,t.nodePropertyCreator,e.stateProperty,t.statePropertyCreator,e.filters),tn=(e,t)=>{for(let n=0;n<t.length;e=e.childNodes[t[n++]]);return e};const nn=()=>{},sn={HTMLElement:function(e,t,n,s){const i=e;let r=!1,o=null,a=null,l=null;for(let e=0;e<n.length;e++){const t=n[e];r||="oninput"===t.nodeProperty.name,a=t.nodeProperty.constructor===Lt?t:a,l=t.nodeProperty.constructor===At?t:l,o=t.nodeProperty.name===s?t:o}if(!r){const e=(e=>t=>e.addEventListener("input",t.defaultEventHandler))(i);a?e(a):l?e(l):o&&t&&e(o)}},SVGElement:nn,Text:nn,Template:nn},rn=e=>(t,n)=>sn[e.nodeType](t,e.isInputable,n,e.defaultProperty);let on=class e{nodeType;nodeRoute;nodeRouteKey;bindTextInfos;isInputable;defaultProperty;initializeNode;constructor(e,t,n,s,i,r,o){this.nodeType=e,this.nodeRoute=t,this.nodeRouteKey=n,this.bindTextInfos=s,this.isInputable=i,this.defaultProperty=r,this.initializeNode=o(this)}static create(t,n,s,i){t=((e,t)=>rt[t](e))(t,n),((e,t)=>{lt[t](e)})(t,n);const r=((e,t)=>ct[t](e))(t,n),o=((e,t)=>{const n=e.constructor.name+"\t"+(e.type??"");return Pt[n]??(Pt[n]=St[t](e))})(t,n)??"",a=bt(s,o),l=[];for(let e=0;e<a.length;e++){const n=a[e],{nodeProperty:s,stateProperty:r}=n,o=Xt(t,s,r,i);l.push({...n,...o,createBinding:en(n,o)})}const d=(e=>{let t=[];for(;null!==e.parentNode;)t=[Array.from(e.parentNode.childNodes).indexOf(e),...t],e=e.parentNode;return t})(t),c=d.join(",");return new e(n,d,c,l,r,o,rn)}};const an="bind",ln={HTMLElement:e=>e.dataset[an]??"",SVGElement:e=>e.dataset[an]??"",Text:e=>e.textContent?.slice(3)??"",Template:e=>f(e.textContent?.slice(3)??"")?.dataset[an]??""},dn=(e,t)=>ln[t](e),cn=e=>Array.from(e.childNodes).flatMap((e=>cn(e).concat((e=>e instanceof Comment&&((e.textContent?.startsWith("@@:")??!1)||(e.textContent?.startsWith("@@|")??!1)))(e)?e:[]))),pn={},un=(e,t=(e=>e.constructor.name+"\t"+(e instanceof Comment?e.textContent?.[2]??"":""))(e))=>pn[t]??(pn[t]=(e=>e instanceof Comment&&":"===e.textContent?.[2]?"Text":e instanceof HTMLElement?"HTMLElement":e instanceof Comment&&"|"===e.textContent?.[2]?"Template":e instanceof SVGElement?"SVGElement":p.raise(`Unknown NodeType: ${e.nodeType}`))(e));const hn={};let mn=class e{template;uuid;nodeInfos;constructor(e,t,n){this.template=e,this.uuid=t,this.nodeInfos=function(e,t){const n=[],s=e.content,i=Array.from(s.querySelectorAll("[data-bind]")).concat(cn(s));n.length=0;for(let e=0;e<i.length;e++){const s=i[e],r=un(s),o=dn(s,r);""!==o.trim()&&(n[n.length]=on.create(i[e],r,o,t))}return n}(this.template,n)}createBindings(e,t){return function(e,t,n){const s=[];for(let i=0;i<n.length;i++){const r=n[i],o=tn(e,r.nodeRoute),a=[];for(let e=0;e<r.bindTextInfos.length;e++)a[a.length]=r.bindTextInfos[e].createBinding(t,o);r.initializeNode(o,a),s.push(...a)}return s}(e,t,this.nodeInfos)}static create(t,n){const s=t.dataset.uuid??"";return hn[s]??(hn[s]=new e(t,s,n))}};const gn=new Map;class fn{static initialize(e){let t=this.buttonsByFragment.get(e.fragment);if(void 0===t&&(t=Array.from(e.fragment.querySelectorAll("[popovertarget]")),this.buttonsByFragment.set(e.fragment,t)),0!==t.length)for(const n of t){const t=n.getAttribute("popovertarget")??p.raise("popovertarget attribute not found");let s=gn.get(e)?.get(t);if(void 0===s){const n=(e,t)=>()=>e.component.popoverContextIndexesById.set(t,e.loopContext.indexes);s=n(e,t),gn.get(e)?.set(t,s)??gn.set(e,new Map([[t,s]]))}n.removeEventListener("click",s),n.addEventListener("click",s)}}static dispose(e){gn.delete(e)}static buttonsByFragment=new Map}let yn=0,bn=class e{#W=-1;get id(){return this.#W}#P;get bindingManager(){return this.#P}#U;get nodeProperty(){return this.#U}#V;get stateProperty(){return this.#V}get component(){return this.#P.component}get loopContext(){return this.#P.loopContext}#K=[];get children(){return this.#K}get expandable(){return this.nodeProperty.expandable}get loopable(){return this.nodeProperty.loopable}#F;get isSelectValue(){return void 0===this.#F&&(this.#F=this.nodeProperty.isSelectValue),this.#F}constructor(e,t,n,s,i,r,o){this.#W=++yn,this.#P=e,this.#U=s(this,t,n,o),this.#V=r(this,i,o)}assign(e,t,n,s,i,r,o){return this.#W=++yn,this.#P=e,this.#U=s(this,t,n,o),this.#V=r(this,i,o),this}applyToNode(){const{component:e,nodeProperty:t,stateProperty:n}=this;e.updator.applyNodeUpdatesByBinding(this,(()=>{if(!t.applicable)return;const e=n.filteredValue??"";t.isSameValue(e)||(t.value=e)}))}applyToChildNodes(e){const{component:t}=this;t.updator.applyNodeUpdatesByBinding(this,(()=>{this.nodeProperty.applyToChildNodes(e)}))}applyToState(){const{stateProperty:e,nodeProperty:t}=this;e.applicable&&(e.value=t.filteredValue)}execDefaultEventHandler(e){this.component?.bindingSummary.exists(this)&&(e.stopPropagation(),this.component.updator.addProcess(this.applyToState,this,[]))}#z=void 0;get defaultEventHandler(){var e;return void 0===this.#z&&(this.#z=(e=this,t=>e.execDefaultEventHandler(t))),this.#z}initialize(){this.nodeProperty.initialize(),this.stateProperty.initialize()}appendChild(e){this.expandable||p.raise("Binding.appendChild: not expandable");const t=this.children[this.children.length-1];this.children.push(e);const n=this.nodeProperty.node.parentNode,s=t?.lastNode??this.nodeProperty.node;n?.insertBefore(e.fragment,s.nextSibling??null)}replaceChild(e,t){this.expandable||p.raise("Binding.replaceChild: not expandable");const n=this.children[e-1];this.children[e]=t;const s=this.nodeProperty.node.parentNode,i=n?.lastNode??this.nodeProperty.node;s?.insertBefore(t.fragment,i.nextSibling??null)}dispose(){for(let e=0;e<this.children.length;e++)this.children[e].dispose();this.children.length=0,this.nodeProperty.dispose(),this.stateProperty.dispose(),this.component.bindingSummary.delete(this)}static create(t,n,s,i,r,o,a){const l=Reflect.construct(e,[t,n,s,i,r,o,a]);return l.initialize(),l}};const xn=e=>e.nodeType===Node.ELEMENT_NODE;class vn{#f;get component(){return this.#f}#q=[];get bindings(){return this.#q}#G=[];get nodes(){return this.#G??[]}get elements(){return this.nodes.filter(xn)}get lastNode(){return this.nodes[this.nodes.length-1]}#Q=document.createDocumentFragment();get fragment(){return this.#Q}set fragment(e){this.#Q=e}#b;get loopContext(){return this.#b}#A;get template(){return this.#A}#Z;get parentBinding(){return this.#Z}set parentBinding(e){this.#Z=e}#J;#r;get uuid(){return this.#r}constructor(e,t,n,s){return this.#Z=s,this.#f=e,this.#A=t,this.#b=new st(this),this.#J=e.bindingSummary,this.#r=n,this}assign(e,t,n,s){return this.#Z=s,this.#f=e,this.#A=t,this.#b=new st(this),this.#J=e.bindingSummary,this.#r=n,this}initialize(){const e=mn.create(this.#A,this.#f.useKeyed);this.#Q=document.importNode(this.#A.content,!0),this.#q=e.createBindings(this.#Q,this),this.#G=Array.from(this.#Q.childNodes)}registerBindingsToSummary(){for(let e=0;e<this.#q.length;e++)this.#J.add(this.#q[e])}postCreate(){this.registerBindingsToSummary(),this.applyToNode()}applyToNode(){const e=[];for(let t=0;t<this.#q.length;t++){const n=this.#q[t];n.isSelectValue?e.push(n):n.applyToNode()}for(let t=0;t<e.length;t++)e[t].applyToNode()}applyToState(){for(let e=0;e<this.#q.length;e++)this.#q[e].applyToState()}removeNodes(){for(let e=0;e<this.#G.length;e++)this.#Q?.appendChild(this.#G[e])}dispose(){this.removeNodes();for(let e=0;e<this.bindings.length;e++)this.bindings[e].dispose();const e=this.#r;this.#Z=void 0,this.#f=void 0,this.#J=void 0,vn._cache[e]?.push(this)??(vn._cache[e]=[this])}static _cache={};static create(e,t,n,s){let i=this._cache[n]?.pop()?.assign(e,t,n,s);return void 0===i&&(i=new vn(e,t,n,s),i.initialize()),fn.initialize(i),i}}const Pn=e=>e.stateProperty.key,Cn=e=>e.nodeProperty.expandable,Sn=e=>e.nodeProperty.constructor===qt;let wn=class{#Y=!1;get updated(){return this.#Y}set updated(e){this.#Y=e}#X=!1;#ee=0;get updateRevision(){return this.#ee}#te=new Map;get bindingsByKey(){return this.#X&&p.raise("BindingSummary.bindingsByKey can only be called after BindingSummary.update()"),this.#te}#ne=new Set;get expandableBindings(){return this.#X&&p.raise("BindingSummary.expandableBindings can only be called after BindingSummary.update()"),this.#ne}#se=new Set;get componentBindings(){return this.#X&&p.raise("BindingSummary.componentBindings can only be called after BindingSummary.update()"),this.#se}#ie=new Set;get allBindings(){return this.#ie}add(e){this.#X||p.raise("BindingSummary.add() can only be called in BindingSummary.update()"),this.#Y=!0,this.#ie.add(e)}delete(e){this.#X||p.raise("BindingSummary.delete() can only be called in BindingSummary.update()"),this.#Y=!0,this.#ie.delete(e)}exists(e){return this.#ie.has(e)}flush(){e.debug&&performance.mark("BindingSummary.flush:start");try{this.rebuild(this.#ie)}finally{e.debug&&(performance.mark("BindingSummary.flush:end"),performance.measure("BindingSummary.flush","BindingSummary.flush:start","BindingSummary.flush:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures("BindingSummary.flush"),performance.clearMarks("BindingSummary.flush:start"),performance.clearMarks("BindingSummary.flush:end"))}}update(e){this.#X=!0,this.#Y=!1,this.#ee++;try{e(this)}finally{this.#Y&&this.flush(),this.#X=!1}}rebuild(e){this.#ie=e;const t=Array.from(e);this.#te=Map.groupBy(t,Pn),this.#ne=new Set(t.filter(Cn)),this.#se=new Set(t.filter(Sn))}};const Nn=e=>e.patternName+"\t"+e.indexes.toString(),Bn=e=>async()=>Reflect.apply(e.target,e.thisArgument,e.argumentList),En=(e,t)=>e.stateProperty.patternName.level-t.stateProperty.patternName.level;let Mn=class{component;processQueue=[];updatedStateProperties=[];expandedStateProperties=[];updatedBindings=new Set;executing=!1;constructor(e){this.component=e}addProcess(e,t,n){this.processQueue.push({target:e,thisArgument:t,argumentList:n}),this.executing||this.exec()}getProcessQueue(){return this.processQueue}addUpdatedStateProperty(e){this.updatedStateProperties.push(e)}async process(){const e=[];for(;this.processQueue.length>0;){const t=this.processQueue.slice(0);this.processQueue.length=0;for(let e=0;e<t.length;e++)await this.component.stateWritable(Bn(t[e]));this.updatedStateProperties.length>0&&(this.component.writableState[ee](this.updatedStateProperties),e.push(...this.updatedStateProperties),this.updatedStateProperties.length=0)}return this.component.readonlyState[ie](),e}expandStateProperties(e){const t=e.slice(0);for(let n=0;n<e.length;n++)t.push(...we.makeNotifyForDependentProps(this.component.readonlyState,e[n]));return t}rebuildBinding(e){const t=this.component.bindingSummary,n=Array.from(t.expandableBindings).toSorted(En);t.update((t=>{for(let s=0;s<n.length;s++){const i=n[s];t.exists(i)&&(e.has(i.stateProperty.key)&&i.applyToNode())}}))}updateChildNodes(e){const t=this.component.bindingSummary,n=new Map;for(const t of e){if("*"!==t.patternNameInfo.lastPathName)continue;const e=t.indexes?.at(-1);if(void 0===e)continue;const s=t.patternNameInfo.parentPath+"\t"+t.indexes.slice(0,-1);n.get(s)?.add(e)??n.set(s,new Set([e]))}for(const[e,s]of n.entries()){const n=t.bindingsByKey.get(e);if(void 0!==n)for(const e of n)e.applyToChildNodes(s)}}updateNode(e){const t=this.component.bindingSummary,n=[];for(const s of e.keys()){const e=t.bindingsByKey.get(s);if(void 0!==e)for(let t=0;t<e.length;t++){const s=e[t];s.isSelectValue?n.push(s):s.applyToNode()}}for(let e=0;e<n.length;e++)n[e].applyToNode();for(const n of t.componentBindings)n.nodeProperty.postUpdate(e)}async execCallback(t){this.executing=!0,e.debug&&performance.mark("Updator.exec:start");try{await t()}finally{e.debug&&(performance.mark("Updator.exec:end"),performance.measure("Updator.exec","Updator.exec:start","Updator.exec:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures("Updator.exec"),performance.clearMarks("Updator.exec:start"),performance.clearMarks("Updator.exec:end")),this.executing=!1}}async exec(){await this.execCallback((async()=>{for(;this.getProcessQueue().length>0;){this.updatedBindings.clear(),this.component.contextRevision++;const e=await this.process(),t=this.expandStateProperties(e),n=new Map(t.map((e=>[Nn(e),e])));this.rebuildBinding(n),this.updateChildNodes(t),this.updateNode(n)}}))}applyNodeUpdatesByBinding(e,t){if(!this.updatedBindings.has(e))try{t(this)}finally{this.updatedBindings.add(e)}}};const In=e=>{const t=e.id;return e.parentComponent?.popoverContextIndexesById?.get(t)},Tn=(e,t)=>{let n;const s=me(t.name);return s.level>0&&0===t.indexes.length&&e.component.hasAttribute("popover")&&(n=In(e.component)?.slice(0,s.level)),n??t.indexes};let $n=class{constructor(e){this.#f=e}#f;get component(){return this.#f}#re;get buffer(){return this.#re}#oe=[];get binds(){return this.#oe}#ae={};#le(e,t){this.#ae[e]=Object.getOwnPropertyDescriptor(this.#f.baseState,e)??{value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(this.#f.baseState,e,{get:((e,t,n)=>function(){if(void 0!==e.buffer)return e.buffer[t];{void 0===n&&p.raise("PropertyAccess is required");const t=ue.exec(n.name);if(t){const s=Number(t[1])-1;let i=n.loopContext.indexes;return 0===i.length&&e.component.hasAttribute("popover")&&(i=In(e.component)??[]),i[s]}{const t=Tn(e,n);return e.component.parentComponent.readonlyState[ve](n.name,t)}}})(this,e,t),set:((e,t,n)=>function(s){if(void 0!==e.buffer)e.buffer[t]=s;else{void 0===n&&p.raise("PropertyAccess is required");const t=Tn(e,n);e.component.parentComponent.writableState[Pe](n.name,t,s)}return!0})(this,e,t),configurable:!0,enumerable:!0}),void 0!==t&&this.#oe.push({prop:e,propAccess:t})}#de(e){this.#re=e;for(const t in e)this.#le(t),this.#f.currentState[ne](t,[])}#ce(){return this.#re}#pe(){this.#re=void 0}#ue(){let e;return e=this.#f.parentComponent.readonlyState[re](this.#f),void 0!==e||(e={},this.#oe.forEach((({prop:t,propAccess:n})=>{const s=Tn(this,n);e[t]=this.#f.parentComponent.readonlyState[ve](n.name,s)}))),e}#he(){if(void 0!==this.#re){const e=this.#re;!0!==this.#f.parentComponent.writableState[oe](e,this.#f)&&this.#oe.forEach((({prop:t,propAccess:n})=>{const s=Tn(this,n);this.#f.parentComponent.writableState[Pe](n.name,s,e[t])}))}}#me(){this.#re=void 0,this.#oe=[];for(const[e,t]of Object.entries(this.#ae))Object.defineProperty(this.#f.baseState,e,t);this.#ae={}}get(e,t,n){return t===Dt?(e,t)=>this.#le(e,t):t===Ht?e=>this.#de(e):t===jt?()=>this.#ce():t===_t?()=>this.#pe():t===Wt?()=>this.#ue():t===Ut?()=>this.#he():t===Kt?()=>this.#me():this.#f.currentState[t]}set(e,t,n,s){return this.#f.writableState[t]=n,!0}ownKeys(e){return void 0!==this.buffer?Reflect.ownKeys(this.buffer):this.#oe.map((({prop:e})=>e))}getOwnPropertyDescriptor(e,t){return{enumerable:!0,configurable:!0}}};const Rn=Symbol.for("globalData.boundByComponent");let An=class extends Se{#ge=new Map;get(e,t,n){return t===Rn?(e,t)=>{let n=this.#ge.get(t);void 0===n?this.#ge.set(t,new Set([e])):n.add(e)}:super.get(e,t,n)}set(e,t,n,s){if("string"!=typeof t)return Reflect.set(e,t,n,s);const{name:i,indexes:r}=fe(t),o=s[Pe](i,r,n);let a=this.#ge.get(i);if(a)for(const e of a)e.currentState[ne]("$globals."+i,r);return o}},Ln=class{static create(e={}){return new Proxy(e,new An)}static#fe=this.create();static get data(){return this.#fe}static set data(e){this.#fe=this.create(e)}},kn=class extends Se{#f;setOfProps=new Set;constructor(e){super(),this.#f=e}bindProperty(e){Ln.data[Rn](this.#f,e),this.setOfProps.add(e)}directGet=(e,t)=>(this.setOfProps.has(e)||this.bindProperty(e),Ln.data[ve](e,t));directSet=(e,t,n)=>(this.setOfProps.has(e)||this.bindProperty(e),Ln.data[Pe](e,t,n));get(e,t,n){if(t===ve)return this.directGet;if(t===Pe)return this.directSet;if("string"!=typeof t)return Reflect.get(e,t,n);const{patternName:s,indexes:i}=fe(t);return this.directGet(s,i)}set(e,t,n,s){if("string"!=typeof t)return Reflect.set(e,t,n,s);const{patternName:i,indexes:r}=fe(t);return this.directSet(i,r,n)}};const Fn=new Map,Vn=new Map;function On(e){return class extends e{constructor(...e){super();const t=this.component;this.#ye=ze(t,t.State),this.#J=new wn,this.#be=Promise.withResolvers(),this.#xe=new Mn(t),this.#ve=function(e){return new Proxy({},new $n(e))}(t),this.#Pe=function(e){return new Proxy({},new kn(e))}(t)}#ye;get states(){return this.#ye}get component(){return this}#Ce;get parentComponent(){return void 0===this.#Ce&&(this.#Ce=(e=>{let t=e;for(;;){if(t=t.parentNode,null==t)return;if(Reflect.get(t,"isQuelComponent"))return t;if(t instanceof ShadowRoot){if(Reflect.get(t.host,"isQuelComponent"))return t.host;t=t.host}const e=Fn.get(t);if(void 0!==e)return e}})(this.component)),this.#Ce}#be;get initialPromises(){return this.#be}#Se;get alivePromises(){return this.#Se??p.raise("alivePromises is undefined")}set alivePromises(e){this.#Se=e}get baseState(){return this.#ye.base}get writableState(){return this.#ye.write}get readonlyState(){return this.#ye.readonly}get currentState(){return this.isWritable?this.writableState:this.readonlyState}#we;get rootBindingManager(){return this.#we??p.raise("rootBindingManager is undefined")}set rootBindingManager(e){this.#we=e}get viewRootElement(){const e=this.component;return e.useWebComponent?e.shadowRoot??e:e.pseudoParentNode}get queryRoot(){return this.viewRootElement}#Ne;get pseudoParentNode(){return this.component.useWebComponent?p.raise("mixInComponent: useWebComponent must be false"):this.#Ne??p.raise("pseudoParentNode is undefined")}set pseudoParentNode(e){this.#Ne=e}#Be;get pseudoNode(){return this.#Be??p.raise("pseudoNode is undefined")}set pseudoNode(e){this.#Be=e}#Ee=!1;get isWritable(){return this.#Ee}async stateWritable(e){this.#Ee=!0;try{await e()}finally{this.#Ee=!1}}get shadowRootOrDocument(){let e=this.component.parentNode;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}return document}#Me=0;get contextRevision(){return this.#Me}set contextRevision(e){this.#Me=e}useContextRevision(e){this.#Me++,e(this.#Me)}#J;get bindingSummary(){return this.#J}#xe;get updator(){return this.#xe}#ve;get props(){return this.#ve}#Pe;get globals(){return this.#Pe}async build(){const e=this.component;if(t=e.tagName.toLowerCase(),(Ge(t)||qe.has(t))&&e.useShadowRoot&&e.useWebComponent){const t=e.attachShadow({mode:"open"}),n=function(e){return getComputedStyle(e)?.getPropertyValue(Qe)?.split(" ").map(Xe).filter(et)??[]}(e),s=function(e){return e.map(tt).filter(nt)}(n);void 0!==e.styleSheet&&s.push(e.styleSheet),t.adoptedStyleSheets=s}else if(void 0!==e.styleSheet){let t=e.styleSheet;if(e.useLocalSelector){const n=Vn.get(e.tagName);void 0!==n?t=n:(t=function(e,t){for(let n=0;n<e.cssRules.length;n++){const s=e.cssRules[n];if(s instanceof CSSStyleRule){const e=s.selectorText.split(",").map((e=>e.trim().startsWith(":host")?e.replace(":host",t):`${t} ${e}`)).join(",");s.selectorText=e}}return e}(e.styleSheet,e.selectorName),Vn.set(e.tagName,t))}const n=e.shadowRootOrDocument,s=Array.from(n.adoptedStyleSheets);s.includes(t)||(n.adoptedStyleSheets=[...s,t])}var t;e.useOverscrollBehavior&&("DIALOG"===e.tagName||e.hasAttribute("popover"))&&(e.style.overscrollBehavior="contain"),e.stateWritable((async()=>{await e.currentState[Y]()})),e.bindingSummary.update((t=>{const n=e.template.dataset.uuid??p.raise("uuid is undefined");e.rootBindingManager=vn.create(e,e.template,n),e.rootBindingManager.postCreate()})),e.useWebComponent?e.viewRootElement.appendChild(e.rootBindingManager.fragment):(e.viewRootElement.insertBefore(e.rootBindingManager.fragment,e.pseudoNode.nextSibling),e.rootBindingManager.nodes.forEach((t=>Fn.set(t,e))))}async connectedCallback(){const e=this.component;try{if(this.parentComponent&&await this.parentComponent.initialPromises.promise,!e.useWebComponent){const t=document.createComment(`@@/${e.tagName}`);e.pseudoParentNode=e.parentNode??p.raise("parentNode is undefined"),e.pseudoNode=t,e.pseudoParentNode.replaceChild(t,e)}e.alivePromises=Promise.withResolvers(),await this.build()}finally{this.initialPromises?.resolve&&this.initialPromises.resolve()}}async disconnectedCallback(){}}}const Dn=new Map,Hn=new Map,jn=new Map,_n=t=>{const n=Object.assign(new v,t);n.filters=Object.assign({},t.filters),n.config=Object.assign({},t.moduleConfig),n.options=Object.assign({},t.options);const s=n.config?.extends??n.options?.extends,i=function(t,n){const s=class extends n{#Ie;get module(){return void 0===this.#Ie&&(this.#Ie=Dn.get(this.thisClass)??p.raise(`module is not found for ${this.constructor.name}`)),this.#Ie}get isQuelComponent(){return!0}#Te;get customElementInfo(){return void 0===this.#Te&&(this.#Te=Hn.get(this.tagName)??p.raise(`customElementInfo is not found for ${this.tagName}`)),this.#Te}#$e(){if(void 0===Hn.get(this.tagName)){const e=this.tagName.toLowerCase(),t=e.includes("-"),n=this.getAttribute("is"),s=!!n,i=t?e:`${e}[is="${n}"]`;Hn.set(this.tagName,{selectorName:i,lowerTagName:e,isAutonomousCustomElement:t,isCostomizedBuiltInElement:s})}}get template(){return this.module.template}get styleSheet(){return this.module.styleSheet}get State(){return this.module.State}get inputFilters(){return this.module.filters.input??{}}get outputFilters(){return this.module.filters.output??{}}get eventFilters(){return this.module.filters.event??{}}get useShadowRoot(){return this.module.moduleConfig.useShadowRoot??e.useShadowRoot}get useWebComponent(){return this.module.moduleConfig.useWebComponent??e.useWebComponent}get useLocalTagName(){return this.module.moduleConfig.useLocalTagName??e.useLocalTagName}get useKeyed(){return this.module.moduleConfig.useKeyed??e.useKeyed}get useLocalSelector(){return this.module.moduleConfig.useLocalSelector??e.useLocalSelector}get useOverscrollBehavior(){return this.module.moduleConfig.useOverscrollBehavior??e.useOverscrollBehavior}get lowerTagName(){return this.customElementInfo.lowerTagName}get selectorName(){return this.customElementInfo.selectorName}get isAutonomousCustomElement(){return this.customElementInfo.isAutonomousCustomElement}get isCostomizedBuiltInElement(){return this.customElementInfo.isCostomizedBuiltInElement}#Re;get filterManagers(){return void 0===this.#Re&&(this.#Re=jn.get(this.tagName)??p.raise(`filterManagers is not found for ${this.tagName}`)),this.#Re}#Ae(){if(void 0===jn.get(this.tagName)){const e={inputFilterManager:new W,outputFilterManager:new j,eventFilterManager:new K};for(const[t,n]of Object.entries(this.inputFilters))e.inputFilterManager.registerFilter(t,n);for(const[t,n]of Object.entries(this.outputFilters))e.outputFilterManager.registerFilter(t,n);for(const[t,n]of Object.entries(this.eventFilters))e.eventFilterManager.registerFilter(t,n);jn.set(this.tagName,e)}}get inputFilterManager(){return this.filterManagers.inputFilterManager}get outputFilterManager(){return this.filterManagers.outputFilterManager}get eventFilterManager(){return this.filterManagers.eventFilterManager}constructor(){super(),this.#$e(),this.#Ae()}static baseClass=n;get baseClass(){return Reflect.get(this.constructor,"baseClass")}static thisClass;get thisClass(){return Reflect.get(this.constructor,"thisClass")}};return s.thisClass=s,Dn.set(s,t),s}(n,s?document.createElement(s).constructor:HTMLElement),r=function(e){return class extends e{#Le=!1;get canceled(){return this.#Le}set canceled(e){this.#Le=e}#ke;get popoverPromises(){return this.#ke}set popoverPromises(e){this.#ke=e}#Fe;get popoverContextIndexesById(){return void 0===this.#Fe&&(this.#Fe=new Map),this.#Fe}get#f(){return this}constructor(...e){super();const t=this.#f;t.addEventListener("hidden",(()=>{if(void 0!==t.popoverPromises){if(t.canceled)t.popoverPromises.reject();else{const e=t.props[jt]();t.props[_t](),t.popoverPromises.resolve(e)}t.popoverPromises=void 0}t.useBufferedBind&&void 0!==t.parentComponent&&(t.canceled||t.props[Ut]()),t.canceled=!0;const e=t.id;void 0!==e&&t.popoverContextIndexesById.delete(e)})),t.addEventListener("shown",(()=>{if(t.canceled=!0,t.useBufferedBind&&void 0!==t.parentComponent){const e=t.props[Wt]();t.props[Ht](e)}for(const e in t.props)t.currentState[ne](e,[])})),t.addEventListener("toggle",(e=>{const n=e;if("closed"===n.newState){const e=new CustomEvent("hidden");t.dispatchEvent(e)}else if("open"===n.newState){const e=new CustomEvent("shown");t.dispatchEvent(e)}}))}async asyncShowPopover(e){const t=this.#f;return t.popoverPromises=Promise.withResolvers(),t.props[Ht](e),HTMLElement.prototype.showPopover.apply(t),t.popoverPromises.promise}hidePopover(){const e=this.#f;e.canceled=!1,HTMLElement.prototype.hidePopover.apply(e)}cancelPopover(){const e=this.#f;HTMLElement.prototype.hidePopover.apply(e)}}}((o=On(i),class extends o{#Ve;get dialogPromises(){return this.#Ve}set dialogPromises(e){this.#Ve=e}#Oe="";get returnValue(){return this.#Oe}set returnValue(e){this.#Oe=e}get useBufferedBind(){return this.#f.hasAttribute("buffered-bind")}get#f(){return this}constructor(...e){super();const t=this.#f;t.addEventListener("closed",(()=>{if(void 0!==t.dialogPromises){if(""===t.returnValue)t.dialogPromises.reject();else{const e=t.props[jt]();t.props[_t](),t.dialogPromises.resolve(e)}t.dialogPromises=void 0}t.useBufferedBind&&void 0!==t.parentComponent&&""!==t.returnValue&&t.props[Ut]()})),t.addEventListener("close",(()=>{const e=new CustomEvent("closed");t.dispatchEvent(e)}))}async#De(e,t=!0){const n=this.#f;return n.returnValue="",n.dialogPromises=Promise.withResolvers(),n.props[Ht](e),t?HTMLDialogElement.prototype.showModal.apply(n):HTMLDialogElement.prototype.show.apply(n),n.dialogPromises.promise}async asyncShowModal(e){return this instanceof HTMLDialogElement||p.raise("DialogComponent: asyncShowModal is only for HTMLDialogElement"),this.#De(e,!0)}async asyncShow(e){return this instanceof HTMLDialogElement||p.raise("DialogComponent: asyncShow is only for HTMLDialogElement"),this.#De(e,!1)}showModal(){this instanceof HTMLDialogElement||p.raise("DialogComponent: showModal is only for HTMLDialogElement");const e=this.#f;if(e.useBufferedBind&&void 0!==e.parentComponent){e.returnValue="";const t=e.props[Wt]();e.props[Ht](t)}return HTMLDialogElement.prototype.showModal.apply(e)}show(){this instanceof HTMLDialogElement||p.raise("DialogComponent: show is only for HTMLDialogElement");const e=this.#f;if(e.useBufferedBind&&void 0!==e.parentComponent){e.returnValue="";const t=e.props[Wt]();e.props[Ht](t)}return HTMLDialogElement.prototype.show.apply(e)}close(e=""){this instanceof HTMLDialogElement||p.raise("DialogComponent: close is only for HTMLDialogElement");const t=this.#f;return HTMLDialogElement.prototype.close.apply(t,[e])}}));var o;return function(e){for(const[t,n]of Object.entries(e))Wn(t,n)}(n.componentModulesForRegister??{}),r};function Wn(e,t){const n=p.toKebabCase(e),s=_n(t),i=t.moduleConfig?.extends??t.options?.extends;void 0===i?customElements.define(n,s):customElements.define(n,s,{extends:i})}const Un="*filter-";const Kn=u.create(((e,t)=>{if(e.startsWith(Un)){const n=e.slice(8),{output:s,input:i,event:r}=t;s&&j.registerFilter(n,s),i&&W.registerFilter(n,i),r&&K.registerFilter(n,r)}else!function(e,t){if("function"!=typeof e)return!1;let n=e;for(;n;){if(n===t)return!0;n=Object.getPrototypeOf(n)}return!1}(t,HTMLElement)?"State"in t&&"html"in t&&Wn(e,t):customElements.define(e,t)}));async function zn(t,n){const s=await fetch(t.resolve(n??"./quel.config.json")),i=await s.json();for(let[t,n]of Object.entries(e))e[t]=void 0!==i[t]?i[t]:n;await Kn.config(i).load()}const qn="data-bind",Gn="data-uuid",Qn={};function Zn(e,t,n){const s=document.createElement("template");return s.innerHTML=function(e,t,n){const s=[],i=e.replaceAll(/\{\{([^\}]+)\}\}/g,((e,t)=>{if((t=t.trim()).startsWith("loop:")||t.startsWith("if:"))return s.push(t),`<template data-bind="${t}">`;if(t.startsWith("else:")){const e=s.at(-1);return void 0!==e&&e.startsWith("if:")||p.raise(`Template: endif: is not matched with if:, but {{ ${t} }} `),`</template><template data-bind="${e}|not">`}if(t.startsWith("end:"))return void 0===s.pop()&&p.raise(`Template: end: is not matched with loop: or if:, but {{ ${t} }} `),"</template>";if(t.startsWith("endif:")){const e=s.pop();return void 0!==e&&e.startsWith("if:")||p.raise(`Template: endif: is not matched with if:, but {{ ${e} }} `),"</template>"}if(t.startsWith("endloop:")){const e=s.pop();return void 0!==e&&e.startsWith("loop:")||p.raise(`Template: endloop: is not matched with loop:, but {{ ${e} }} `),"</template>"}return`\x3c!--@@:${t}--\x3e`}));s.length>0&&p.raise(`Template: loop: or if: is not matched with endloop: or endif:, but {{ ${s.at(-1)} }} `);const r=document.createElement("template");r.innerHTML=i;const o=n.map((e=>p.toKebabCase(e))),a=e=>{for(const n of o){const s=Array.from(e.querySelectorAll(n));for(const e of s){const s=document.createElement(`${n}-${t}`);for(let t=0;t<e.attributes.length;t++){const n=e.attributes[t];s.setAttribute(n.name,n.value)}s.setAttribute("data-orig-tag-name",n),e.parentNode?.replaceChild(s,e)}const i=Array.from(e.querySelectorAll(`[is="${n}"]`));for(const e of i){const s=document.createElement(e.tagName,{is:`${n}-${t}`});for(let t=0;t<e.attributes.length;t++){const n=e.attributes[t];"is"!==n.name&&s.setAttribute(n.name,n.value)}s.setAttribute("data-orig-is",n),e.parentNode?.replaceChild(s,e)}}const n=Array.from(e.querySelectorAll("template"));for(const e of n)a(e.content)};o.length>0&&a(r.content);const l=e=>{let t;for(;t=e.querySelector("template");){const e=p.createUUID(),n=document.createComment(`@@|${e}`);if(t.parentNode?.replaceChild(n,t),t.constructor!==HTMLTemplateElement){const e=document.createElement("template");for(let n of Array.from(t.childNodes))e.content.appendChild(n);const n=t.getAttribute(qn);n&&e.setAttribute(qn,n),t=e}t.setAttribute(Gn,e),l(t.content),Qn[e]=t}};return l(r.content),r.innerHTML}(e,t,n),s.setAttribute(Gn,t),Qn[t]=s,s}const Jn=new Map;function Yn(e,t){const n=Jn.get(t);if(n)return n;const s=function(e){const t=new CSSStyleSheet;return t.replaceSync(e),t}(e);return Jn.set(t,s),s}class Xn{#r=p.createUUID();get uuid(){return this.#r}html="";css;get template(){const t=this.config.useLocalTagName??e.useLocalTagName?Object.keys(this.componentModules??{}):[];return Zn(this.html,this.uuid,t)}get styleSheet(){return this.css?Yn(this.css,this.uuid):void 0}State=class{};config={};moduleConfig={};options={};filters={};componentModules;get componentModulesForRegister(){if((this.config.useLocalTagName??e.useLocalTagName)&&void 0!==this.componentModules){const e={};for(const[t,n]of Object.entries(this.componentModules))e[`${p.toKebabCase(t)}-${this.uuid}`]=n;return e}return this.componentModules}}const es=new Set(["articles","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]),ts=e=>-1!==e.indexOf("-");const ns="--adopted-css",ss=new Map;function is(e,t){Array.from(e.cssRules).map((e=>{if("CSSImportRule"===e.constructor.name){const n=e;n.styleSheet?is(n.styleSheet,t):console.log(`import rule not found: ${n.href}`)}else t.insertRule(e.cssText,t.cssRules.length)}))}function rs(e){const t=new CSSStyleSheet,n=Array.from(document.styleSheets).filter((t=>t.title===e));if(0!==n.length)return n.forEach((e=>is(e,t))),ss.set(e,t),t;console.log(`style sheet not found: ${e}`)}const os=e=>e.trim(),as=e=>e.length>0,ls=e=>ss.get(e)??rs(e),ds=e=>void 0!==e;const cs=new Map,ps=new Map;function us(e){if(ps.has(e))return ps.get(e);const t=function(e){const t=e.split("."),n=[],s=[];for(let e=0;e<t.length;e++)"*"===t[e]&&s.push(t.slice(0,e+1).join(".")),n.push(t.slice(0,e+1).join("."));return{patternElements:t,patternPaths:n,wildcardPaths:s}}(e);return ps.set(e,t),t}function hs(e){if(cs.has(e))return cs.get(e);const t=function(e){const t=e.split("."),n=t.slice(0),s=[],i=[];let r=-1;for(let e=0;e<t.length;e++){const o=t[e];if("*"===o)s.push(void 0),n[e]="*",r=s.length-1;else{const t=Number(o);Number.isNaN(t)||(s.push(t),n[e]="*")}i.push(t.slice(0,e+1).join("."))}const o=n.join("."),a=s.length;return Object.assign({name:e,pattern:o,elements:t,patternElements:n,paths:i,wildcardCount:a,wildcardIndexes:s,lastIncompleteWildcardIndex:r},us(o))}(e);return cs.set(e,t),t}class ms{#He;#je;#_e;get pattern(){return this.#He}get indexes(){return this.#je}get propInfo(){return void 0===this.#_e&&(this.#_e=hs(this.pattern)),this.#_e}constructor(e,t=[]){this.#He=e,this.#je=t}}function gs(e,t,n=new Set([])){const{propInfo:s,indexes:i}=t,r=s.pattern+"\t"+i.toString();if(n.has(r))return[];n.add(r);const o=e[se]().propsByRefProp.get(s.pattern),a=[];if(void 0===o)return[];for(const t of o){const s=us(t);if(i.length<s.wildcardPaths.length){const n=fs(e,new ms(t,i));a.push(...n.map((e=>new ms(t,e))))}else{const e=i.slice(0,s.wildcardPaths.length);a.push(new ms(t,e))}a.push(...gs(e,new ms(t,i),n))}return a}function fs(e,t){const{propInfo:n,pattern:s,indexes:i}=t;if(n.wildcardCount===i.length)return[i];if(n.wildcardCount<i.length)return[i.slice(0,n.wildcardCount)];{const t=e[ve],s=(e,r,o)=>{const a=""!==e?e+".":e,l=n.elements[r];if(n.elements.length-1===r){if("*"===l){const n=[],s=t(e,o).length;for(let e=0;e<s;e++)n.push(o.concat(e));return n}return[o]}{const n=a+l;if("*"===l){if(o.length<i.length)return s(n,r+1,i.slice(0,o.length+1));{const i=[],a=t(e,o).length;for(let e=0;e<a;e++)i.push(...s(n,r+1,o.concat(e)));return i}}return s(n,r+1,o)}};return s("",0,[])}}const ys=e=>e.pattern+"\t"+e.indexes.toString(),bs=e=>async()=>Reflect.apply(e.target,e.thisArgument,e.argumentList),xs=(e,t)=>e.stateProperty.propInfo.wildcardCount-t.stateProperty.propInfo.wildcardCount;class vs{#f;processQueue=[];updatedStateProperties=[];expandedStateProperties=[];updatedBindings=new Set;executing=!1;get states(){return this.#f.states}get bindingSummary(){return this.#f.bindingSummary}get component(){return this.#f}constructor(e){this.#f=e}addProcess(e,t,n){this.processQueue.push({target:e,thisArgument:t,argumentList:n}),this.executing||this.exec()}getProcessQueue(){return this.processQueue}addUpdatedStateProperty(e){this.updatedStateProperties.push(e)}async process(){const e=[];for(;this.processQueue.length>0;){const t=this.processQueue.slice(0);this.processQueue.length=0;for(let e=0;e<t.length;e++)await this.states.writable(bs(t[e]));this.updatedStateProperties.length>0&&await this.states.writable((async()=>{this.states.current[ee](this.updatedStateProperties),e.push(...this.updatedStateProperties),this.updatedStateProperties.length=0}))}return e}expandStateProperties(e){const t=e.slice(0);for(let n=0;n<e.length;n++)t.push(...gs(this.states.current,e[n]));return t}rebuildBinding(e){const t=this.bindingSummary,n=Array.from(t.expandableBindings).toSorted(xs);t.update((t=>{for(let s=0;s<n.length;s++){const i=n[s];t.exists(i)&&(e.has(i.stateProperty.key)&&i.applyToNode())}}))}updateChildNodes(e){const t=this.bindingSummary,n=new Map;for(const t of e){if("*"!==t.propInfo.patternElements.at(-1))continue;const e=t.indexes?.at(-1);if(void 0===e)continue;const s=t.propInfo.patternPaths.at(-2)+"\t"+t.indexes.slice(0,-1);n.get(s)?.add(e)??n.set(s,new Set([e]))}for(const[e,s]of n.entries()){const n=t.bindingsByKey.get(e);if(void 0!==n)for(const e of n)e.applyToChildNodes(s)}}updateNode(e){const t=this.bindingSummary,n=[];for(const s of e.keys()){const e=t.bindingsByKey.get(s);if(void 0!==e)for(let t=0;t<e.length;t++){const s=e[t];s.nodeProperty.isSelectValue?n.push(s):s.applyToNode()}}for(let e=0;e<n.length;e++)n[e].applyToNode();for(const n of t.componentBindings)n.nodeProperty.postUpdate(e)}async execCallback(t){this.executing=!0,e.debug&&performance.mark("Updator.exec:start");try{await t()}finally{e.debug&&(performance.mark("Updator.exec:end"),performance.measure("Updator.exec","Updator.exec:start","Updator.exec:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures("Updator.exec"),performance.clearMarks("Updator.exec:start"),performance.clearMarks("Updator.exec:end")),this.executing=!1}}async exec(){await this.execCallback((async()=>{for(;this.getProcessQueue().length>0;){this.updatedBindings.clear(),this.component.contextRevision++;const e=await this.process(),t=this.expandStateProperties(e),n=new Map(t.map((e=>[ys(e),e])));this.rebuildBinding(n),this.updateChildNodes(t),this.updateNode(n)}}))}applyNodeUpdatesByBinding(e,t){if(!this.updatedBindings.has(e))try{t(this)}finally{this.updatedBindings.add(e)}}}const Ps=new RegExp(/^\$([0-9]+)$/);function Cs(e){return e.parentComponent?.popoverContextIndexesById?.get(e.id)}const Ss=(e,t)=>{let n;const s=us(t.name);return s.wildcardPaths.length>0&&0===t.indexes.length&&e.component.hasAttribute("popover")&&(n=Cs(e.component)?.slice(0,s.wildcardPaths.length)),n??t.indexes};let ws=class{constructor(e){this.#f=e}#f;get component(){return this.#f}#re;get buffer(){return this.#re}#oe=[];get binds(){return this.#oe}#ae={};#le(e,t){this.#ae[e]=Object.getOwnPropertyDescriptor(this.#f.states.base,e)??{value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(this.#f.states.base,e,{get:((e,t,n)=>function(){if(void 0!==e.buffer)return e.buffer[t];{void 0===n&&p.raise("PropertyAccess is required");const t=Ps.exec(n.name);if(t){const s=Number(t[1])-1;let i=n.loopContext?.indexes??[];return 0===i.length&&e.component.hasAttribute("popover")&&(i=Cs(e.component)??[]),i[s]}{const t=Ss(e,n);return e.component.parentComponent?.states.current[ve](n.name,t)??p.raise(`Property ${n.name} is not found`)}}})(this,e,t),set:((e,t,n)=>function(s){if(void 0!==e.buffer)e.buffer[t]=s;else{void 0===n&&p.raise("PropertyAccess is required");const t=Ss(e,n);e.component.parentComponent?.states.writable((async()=>{e.component.parentComponent?.states.current[Pe](n.name,t,s)??p.raise(`Property ${n.name} is not found`)}))}return!0})(this,e,t),configurable:!0,enumerable:!0}),void 0!==t&&this.#oe.push({prop:e,propAccess:t})}#de(e){this.#re=e;for(const t in e)this.#le(t),this.#f.states.current[ne](t,[])}#ce(){return this.#re}#pe(){this.#re=void 0}#ue(){let e;return e=this.#f.parentComponent?.states.current[re](this.#f)??p.raise("CreateBufferApiSymbol is not found"),void 0!==e||(e={},this.#oe.forEach((({prop:t,propAccess:n})=>{const s=Ss(this,n);e[t]=this.#f.parentComponent?.states.current[ve](n.name,s)??p.raise(`Property ${n.name} is not found`)}))),e}#he(){if(void 0!==this.#re){const e=this.#re;this.#f.parentComponent?.states.writable((async()=>{!0!==(this.#f.parentComponent?.states.current[oe](e,this.#f)??p.raise("FlushBufferApiSymbol is not found"))&&this.#oe.forEach((({prop:t,propAccess:n})=>{const s=Ss(this,n);this.#f.parentComponent?.states.current[Pe](n.name,s,e[t])??p.raise(`Property ${n.name} is not found`)}))}))}}#me(){this.#re=void 0,this.#oe=[];for(const[e,t]of Object.entries(this.#ae))Object.defineProperty(this.#f.states.base,e,t);this.#ae={}}get(e,t,n){return t===Dt?(e,t)=>this.#le(e,t):t===Ht?e=>this.#de(e):t===jt?()=>this.#ce():t===_t?()=>this.#pe():t===Wt?()=>this.#ue():t===Ut?()=>this.#he():t===Kt?()=>this.#me():this.#f.states.current[t]}set(e,t,n,s){return this.#f.states.writable((async()=>{this.#f.states.current[t]=n})),!0}ownKeys(e){return void 0!==this.buffer?Reflect.ownKeys(this.buffer):this.#oe.map((({prop:e})=>e))}getOwnPropertyDescriptor(e,t){return{enumerable:!0,configurable:!0}}};class Ns{#We;#je;get indexes(){return void 0===this.#je&&(this.#je=this.#We.slice(0,this.wildcardCount)),this.#je}wildcardCount;pattern;constructor(e,t,n){this.pattern=e,this.wildcardCount=t,this.#We=n,this.#je=t===n.length?n:void 0}}let Bs=class{_stackIndexes=[];_stackNamedWildcardIndexes=[];get lastStackIndexes(){return this._stackIndexes[this._stackIndexes.length-1]}getLastIndexes(e){return this._stackNamedWildcardIndexes.at(-1)?.[e]?.indexes}withIndexes(e,t,n){const s={};for(let n=0;n<e.wildcardPaths.length;n++){const i=e.wildcardPaths[n];s[i]=new Ns(i,n+1,t)}this._stackNamedWildcardIndexes.push(s),this._stackIndexes.push(t);try{return n()}finally{this._stackNamedWildcardIndexes.pop(),this._stackIndexes.pop()}}_getPropertyValue(e,t,n){return Reflect.get(e,t,n)}_getValue(e,t,n,s,i,r,o){const a=t[i];if(a in e)return this._getPropertyValue(e,a,o);if(0===i)return;const l=n[i],d="*"===l;return this._getValue(e,t,n,s,i-1,r-(d?1:0),o)[d?s[r]??p.raise("wildcard is undefined"):l]}__get(e,t,n,s){return this.withIndexes(t,n,(()=>this._getValue(e,t.patternPaths,t.patternElements,n,t.paths.length-1,t.wildcardCount-1,s)))}_get(e,t,n){const s=hs(t),i=this.getLastIndexes(s.wildcardPaths.at(-1)??"")??[],r=s.wildcardIndexes.map(((e,t)=>e??i[t]));return this.__get(e,s,r,n)}__set(e,t,n,s,i){return 1===t.paths.length?Reflect.set(e,t.paths[0],s,i):(this.withIndexes(t,n,(()=>{const r=t.patternElements[t.patternElements.length-1],o=t.elements[t.elements.length-1],a=this._getValue(e,t.patternPaths,t.patternElements,n,t.paths.length-2,t.wildcardCount-("*"===r?1:0)-1,i);"*"===r?a[n[n.length-1]??p.raise("wildcard is undefined")]=s:a[o]=s})),!0)}_set(e,t,n,s){const i=hs(t),r=this.getLastIndexes(i.wildcardPaths.at(-1)??"")??[],o=i.wildcardIndexes.map(((e,t)=>e??r[t]));return this.__set(e,i,o,n,s)}_getExpand(e,t,n){const s=hs(t),i=this.getLastIndexes(s.wildcardPaths.at(-1)??"")??[],r=s.wildcardIndexes.map(((e,t)=>t===s.lastIncompleteWildcardIndex?void 0:e??i[t])),o=r.findIndex((e=>void 0===e)),a=hs(s.wildcardPaths.at(o)??p.raise("wildcard path is undefined")),l=hs(a.paths.at(-2)??p.raise("wildcard parent path is undefined"));return this.withIndexes(s,r,(()=>{const t=this._getValue(e,l.patternPaths,l.patternElements,r,l.paths.length-1,l.wildcardCount-1,n);Array.isArray(t)||p.raise("parent value is not array");const i=[];for(let a=0;a<t.length;a++)r[o]=a,i.push(this.withIndexes(s,r,(()=>this._get(e,s.pattern,n))));return i}))}_setExpand(e,t,n,s){const i=hs(t),r=this.getLastIndexes(i.wildcardPaths.at(-1)??"")??[],o=i.wildcardIndexes.map(((e,t)=>t===i.lastIncompleteWildcardIndex?void 0:e??r[t])),a=o.findIndex((e=>void 0===e)),l=hs(i.wildcardPaths.at(a)??p.raise("wildcard path is undefined")),d=hs(l.paths.at(-2)??p.raise("wildcard parent path is undefined"));this.withIndexes(i,o,(()=>{const t=this._getValue(e,d.patternPaths,d.patternElements,o,d.paths.length-1,d.wildcardCount-1,s);Array.isArray(t)||p.raise("parent value is not array");for(let r=0;r<t.length;r++)o[a]=r,this.withIndexes(i,o,Array.isArray(n)?()=>this._set(e,i.pattern,n[r],s):()=>this._set(e,i.pattern,n,s))}))}_getDirect=(e,t,n,s)=>{"string"!=typeof t&&p.raise("prop is not string");const i=hs("@"===t[0]?t.slice(1):t);return this.withIndexes(i,n,(()=>this.get(e,t,s)))};_setDirect=(e,t,n,s,i)=>{"string"!=typeof t&&p.raise("prop is not string");const r=hs("@"===t[0]?t.slice(1):t);return this.withIndexes(r,n,(()=>this.set(e,t,s,i)))};get(e,t,n){const s="string"==typeof t;do{if(s&&(t.startsWith("@@__")||"constructor"===t))break;if(t===ve)return(t,s)=>this._getDirect.apply(this,[e,t,s,n]);if(t===Pe)return(t,s,i)=>this._setDirect.apply(this,[e,t,s,i,n]);if(!s)break;if("$"===t[0]){const e=Number(t.slice(1));if(isNaN(e))break;return(this.lastStackIndexes??[])[e-1]}if("@"===t[0]){const s=t.slice(1);return this._getExpand(e,s,n)}return this._get(e,t,n)}while(0);return Reflect.get(e,t,n)}set(e,t,n,s){const i="string"==typeof t;do{if(i&&t.startsWith("@@__"))break;if(!i)break;if("$"===t[0]){const e=Number(t.slice(1));if(isNaN(e))break;p.raise(`context index(${t}) is read only`)}else if("@"===t[0]){const i=t.slice(1);return this._setExpand(e,i,n,s),!0}return this._set(e,t,n,s)}while(0);return Reflect.set(e,t,n,s)}};class Es extends Bs{#ge=new Map;get(e,t,n){return t===Rn?(e,t)=>{let n=this.#ge.get(t);void 0===n?this.#ge.set(t,new Set([e])):n.add(e)}:super.get(e,t,n)}set(e,t,n,s){if("string"!=typeof t)return Reflect.set(e,t,n,s);const{pattern:i,wildcardIndexes:r}=hs(t),o=s[Pe](i,r,n);let a=this.#ge.get(i);if(a)for(const e of a)e.states.current[ne]("$globals."+i,r);return o}}class Ms{static create(e={}){return new Proxy(e,new Es)}static#fe=this.create();static get data(){return this.#fe}static set data(e){this.#fe=this.create(e)}}class Is extends Bs{#f;setOfProps=new Set;constructor(e){super(),this.#f=e}bindProperty(e){Ms.data[Rn](this.#f,e),this.setOfProps.add(e)}directGet=(e,t)=>(this.setOfProps.has(e)||this.bindProperty(e),Ms.data[ve](e,t));directSet=(e,t,n)=>(this.setOfProps.has(e)||this.bindProperty(e),Ms.data[Pe](e,t,n));get(e,t,n){if(t===ve)return this.directGet;if(t===Pe)return this.directSet;if("string"!=typeof t)return Reflect.get(e,t,n);const{pattern:s,wildcardIndexes:i}=hs(t);return this.directGet(s,i)}set(e,t,n,s){if("string"!=typeof t)return Reflect.set(e,t,n,s);const{pattern:i,wildcardIndexes:r}=hs(t);return this.directSet(i,r,n)}}const Ts=e=>e,$s={Text:e=>{const t=document.createTextNode("");return e.parentNode?.replaceChild(t,e),t},HTMLElement:Ts,SVGElement:Ts,Template:Ts},Rs=e=>{const t=e;return t.removeAttribute("data-bind"),t},As=e=>e,Ls={HTMLElement:Rs,SVGElement:Rs,Text:As,Template:As},ks=e=>!1,Fs={HTMLElement:e=>e instanceof HTMLElement&&(e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&"button"!==e.type),SVGElement:ks,Text:ks,Template:ks},Vs=e=>e.trim(),Os=e=>e.length>0,Ds=new RegExp(/^#(.*)#$/),Hs=e=>{const t=Ds.exec(e);return t?decodeURIComponent(t[1]):e},js=e=>{const[t,...n]=e.split(",").map(Vs);return{name:t,options:n.map(Hs)}},_s=e=>{const[t,...n]=e.split("|").map(Vs);return{property:t,filters:n.map(js)}},Ws=(e,t)=>e.split(";").map(Vs).filter(Os).map((e=>{let{nodeProperty:n,stateProperty:s,inputFilters:i,outputFilters:r}=((e,t)=>{const[n,s]=[t].concat(...e.split(":").map(Vs)).splice(-2),{property:i,filters:r}=_s(n),{property:o,filters:a}=_s(s);return{nodeProperty:i,stateProperty:o,inputFilters:r,outputFilters:a}})(e,"$");return s="@"===s?n:s,n="$"===n?t:n,void 0===n&&p.raise("parseBindText: default property undefined"),{nodeProperty:n,stateProperty:s,inputFilters:i,outputFilters:r}})),Us={};const Ks="textContent",zs={radio:"checked",checkbox:"checked",button:"onclick"},qs={},Gs=e=>{},Qs={HTMLElement:e=>e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLOptionElement?"value":e instanceof HTMLButtonElement||e instanceof HTMLAnchorElement?"onclick":e instanceof HTMLFormElement?"onsubmit":e instanceof HTMLInputElement?zs[e.type]??"value":Ks,SVGElement:Gs,Text:e=>Ks,Template:Gs};class Zs{#$;get node(){return this.#$}#N;get name(){return this.#N}#R;get nameElements(){return this.#R}get value(){return Reflect.get(this.node,this.name)}set value(e){Reflect.set(this.node,this.name,e)}#T;get filters(){return this.#T}get filteredValue(){return 0===this.filters.length?this.value:H.applyFilter(this.value,this.filters)}get applicable(){return!0}#w;get binding(){return this.#w}get expandable(){return!1}get isSelectValue(){return!1}get loopable(){return!1}constructor(e,t,n,s){t instanceof Node||p.raise("NodeProperty: not Node"),this.#w=e,this.#$=t,this.#N=n,this.#R=n.split("."),this.#T=D.create(s,this.binding.inputFilterManager)}initialize(){}postUpdate(e){}equals(e){return this.value===e}applyToChildNodes(e){}dispose(){}}class Js extends Zs{#A;get template(){var e;return void 0===this.#A&&(this.#A=(e=this.uuid,Qn[e]??p.raise(`TemplateProperty: invalid uuid ${this.uuid}`))),this.#A}#r;get uuid(){var e;return void 0===this.#r&&(this.#r=(e=this.node,e.textContent?.slice(3)??p.raise("TemplateProperty: invalid node"))),this.#r}get expandable(){return!0}constructor(e,t,n,s){t instanceof Comment||p.raise("TemplateProperty: not Comment"),super(e,t,n,s)}}const Ys=e=>e.applyToNode();class Xs extends Js{get loopable(){return!0}get value(){return this.binding.childrenContentBindings.length}set value(e){if(Array.isArray(e)||p.raise(`Repeat: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not array`),this.value<e.length){this.binding.childrenContentBindings.forEach(Ys);for(let t=this.value;t<e.length;t++){const e=Oi(this.template,this.binding);this.binding.appendChildContentBindings(e),e.postCreate()}}else if(this.value>e.length){const t=this.binding.childrenContentBindings.splice(e.length);this.binding.childrenContentBindings.forEach(Ys),t.forEach((e=>e.dispose()))}else this.binding.childrenContentBindings.forEach(Ys)}constructor(e,t,n,s){"loop"!==n&&p.raise(`Repeat: invalid property name '${n}'`),super(e,t,n,s)}equals(e){return!1}}class ei extends Zs{get element(){return this.node}constructor(e,t,n,s){t instanceof Element||p.raise("ElementBase: not element"),super(e,t,n,s)}}class ti{value;enabled=!1;constructor(e,t){this.value=e,this.enabled=t}}class ni extends ei{get eventType(){return this.name.slice(2)}get applicable(){return!1}#L;get handler(){return void 0===this.#L&&(this.#L=e=>this.eventHandler(e)),this.#L}#k=[];get eventFilters(){return this.#k}constructor(e,t,n,s){n.startsWith("on")||p.raise(`ElementEvent: invalid property name ${n}`),super(e,t,n,s),this.#k=D.create(s,e.eventFilterManager)}initialize(){this.element.addEventListener(this.eventType,this.handler)}async directlyCall(e){if(this.binding.bindingSummary.exists(this.binding))return this.binding.stateProperty.state[te](this.binding.stateProperty.name,this.binding.parentContentBindings.currentLoopContext,e)}eventHandler(e){this.binding.bindingSummary.exists(this.binding)&&(e=this.eventFilters.length>0?H.applyFilter(e,this.eventFilters):e,!1===(Reflect.get(e,"noStopPropagation")??!1)&&e.stopPropagation(),this.binding.updator.addProcess(this.directlyCall,this,[e]))}}class si extends ei{#F;get isSelectValue(){return void 0===this.#F&&(this.#F=this.node.constructor===HTMLSelectElement&&"value"===this.name),this.#F}}class ii{#V;get name(){return this.#V.name}get indexes(){return this.#V.indexes}get loopContext(){return this.#V.binding.parentContentBindings.currentLoopContext}constructor(e){this.#V=e}}class ri extends ei{get propertyName(){return this.nameElements[1]}get applicable(){return!0}get thisComponent(){return this.node}constructor(e,t,n,s){!0!==Reflect.get(t,Vt)&&p.raise("ComponentProperty: not Quel Component"),super(e,t,n,s)}get value(){return super.value}set value(e){try{this.thisComponent.states.current[ne](this.propertyName,[])}catch(e){console.log(e)}}initialize(){this.thisComponent.props[Dt](this.propertyName,new ii(this.binding.stateProperty))}postUpdate(e){const t=this.binding.stateProperty.name;for(const[n,s]of e.entries())if(s.pattern===t||s.propInfo.patternPaths.includes(t)){const e=s.pattern.slice(t.length);this.thisComponent.states.current[ee]([new ms(`${this.propertyName}${e}`,s.indexes)]),this.thisComponent.states.current[ne](`${this.propertyName}${e}`,s.indexes)}}equals(e){return!1}}const oi=new Set(["boolean","number","string"]);class ai extends Xs{#O=new Map;#D=new Set;#H=new Set;#j=new Map;get loopable(){return!0}#_=[];get value(){return this.#_}set value(e){Array.isArray(e)||p.raise(`RepeatKeyed: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not array`),this.#O.clear(),this.#D.clear(),this.#H.clear(),this.#j.clear();for(let t=0;t<e.length;t++){const e=this.binding.stateProperty.getChildValue(t),n=this.#_.indexOf(e,this.#O.get(e)??0);-1===n?this.#H.add(t):(this.#O.set(e,n+1),this.#D.add(n),this.#j.set(t,this.binding.childrenContentBindings[n]))}for(let e=0;e<this.binding.childrenContentBindings.length;e++)this.#D.has(e)||this.binding.childrenContentBindings[e].dispose();let t;this.binding.childrenContentBindings.slice(0);const n=this.node.parentNode??p.raise("parentNode is null");for(let s=0;s<e.length;s++){const e=s;let i;const r=t?.lastChildNode??this.node;this.#H.has(e)?(i=Oi(this.template,this.binding),e<this.binding.childrenContentBindings.length?this.binding.childrenContentBindings[e]=i:this.binding.childrenContentBindings.push(i),n.insertBefore(i.fragment,r.nextSibling??null),i.postCreate()):(i=this.#j.get(e)??p.raise("contentBindings is undefined"),i.childNodes[0]?.previousSibling!==r&&(i.removeChildNodes(),n.insertBefore(i.fragment,r.nextSibling??null)),e<this.binding.childrenContentBindings.length?this.binding.childrenContentBindings[e]=i:this.binding.childrenContentBindings.push(i),i.applyToNode()),t=i}e.length<this.binding.childrenContentBindings.length&&(this.binding.childrenContentBindings.length=e.length),this.#_=e.slice()}applyToChildNodes(e){const t=new Map;for(const n of e){const e=this.binding.childrenContentBindings[n];if(void 0===e)continue;const s=this.#_[n],i=typeof s;"undefined"!==i&&(oi.has(i)||(e.removeChildNodes(),t.set(s,e)))}for(const n of Array.from(e).sort()){const e=this.binding.stateProperty.getChildValue(n),s=typeof e;if("undefined"===s)continue;if(oi.has(s))continue;let i=t.get(e);void 0===i?(i=Oi(this.template,this.binding),this.binding.replaceChildContentBindings(i,n)):(this.binding.replaceChildContentBindings(i,n),i.applyToNode())}this.#_=this.binding.stateProperty.value.slice()}initialize(){this.#_=[]}dispose(){super.dispose(),this.#_=[]}}const li={0:{if:class extends Js{get value(){return this.binding.childrenContentBindings.length>0}set value(e){if("boolean"!=typeof e&&p.raise(`Branch: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not boolean`),this.value!==e)if(e){const e=Oi(this.template,this.binding);this.binding.appendChildContentBindings(e),e.postCreate()}else{this.binding.removeAllChildrenContentBindings().forEach((e=>e.dispose()))}else this.binding.childrenContentBindings.forEach((e=>e.applyToNode()))}constructor(e,t,n,s){"if"!==n&&p.raise(`Branch: invalid property name ${n}`),super(e,t,n,s)}equals(e){return!1}}},1:{class:class extends ei{get value(){return this.element.className.length>0?this.element.className.split(" "):[]}set value(e){Array.isArray(e)||p.raise(`ElementClassName: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not array`),this.element.className=e.join(" ")}constructor(e,t,n,s){"class"!==n&&p.raise(`ElementClassName: invalid property name ${n}`),super(e,t,n,s)}},checkbox:class extends ei{get inputElement(){return this.node}_value=new ti(void 0,!1);get value(){return this._value.value=this.inputElement.value,this._value.enabled=this.inputElement.checked,this._value}set value(e){Array.isArray(e)||p.raise(`Checkbox: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not array`);const t=this.filteredValue;this.inputElement.checked=e.some((e=>e===t.value))}_filteredValue=new ti(void 0,!1);get filteredValue(){const e=this.value;return this._filteredValue.value=this.filters.length>0?H.applyFilter(e.value,this.filters):e.value,this._filteredValue.enabled=e.enabled,this._filteredValue}constructor(e,t,n,s){t instanceof HTMLInputElement||p.raise("Checkbox: not htmlInputElement"),"checkbox"!==t.type&&p.raise("Checkbox: not checkbox"),super(e,t,n,s)}equals(e){return!1}},radio:class extends ei{get inputElement(){return this.element}_value=new ti(void 0,!1);get value(){return this._value.value=this.inputElement.value,this._value.enabled=this.inputElement.checked,this._value}set value(e){const t=this.filteredValue;this.inputElement.checked=e===t.value}_filteredValue=new ti(void 0,!1);get filteredValue(){const e=this.value;return this._filteredValue.value=this.filters.length>0?H.applyFilter(e.value,this.filters):e.value,this._filteredValue.enabled=e.enabled,this._filteredValue}constructor(e,t,n,s){t instanceof HTMLInputElement||p.raise("Radio: not htmlInputElement");const i=t;"radio"!==i.type&&"checkbox"!==i.type&&p.raise("Radio: not radio or checkbox"),super(e,t,n,s)}equals(e){return!1}}}},di=e=>(t,n,s,i)=>Reflect.construct(e,[t,n,s,i]),ci={class:class extends ei{get className(){return this.nameElements[1]}get value(){return this.element.classList.contains(this.className)}set value(e){"boolean"!=typeof e&&p.raise(`ElementClass: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not boolean`),e?this.element.classList.add(this.className):this.element.classList.remove(this.className)}constructor(e,t,n,s){n.startsWith("class.")||p.raise(`ElementClass: invalid property name ${n}`),super(e,t,n,s)}},attr:class extends ei{get attributeName(){return this.nameElements[1]}get value(){return this.element.getAttribute(this.attributeName)}set value(e){this.element.setAttribute(this.attributeName,e)}},style:class extends ei{get htmlElement(){return this.node}get styleName(){return this.nameElements[1]}get value(){return this.htmlElement.style.getPropertyValue(this.styleName)}set value(e){this.htmlElement.style.setProperty(this.styleName,e)}constructor(e,t,n,s){t instanceof HTMLElement||p.raise("ElementStyle: not htmlElement"),super(e,t,n,s)}},props:ri};function pi(e,t,n){let s;do{const i=e instanceof Comment;if(s=li[i?0:1][t],void 0!==s)break;if(i&&"loop"===t){s=n?ai:Xs;break}i&&p.raise(`NodePropertyCreateor: unknown node property ${t}`);const r=t.split(".");if(s=ci[r[0]],void 0!==s)break;s=e instanceof Element?t.startsWith("on")?ni:si:Zs}while(0);return di(s)}class ui{get state(){return this.#w.state}#N;get name(){return this.#N}#_e;get propInfo(){return this.#_e}#M;get level(){return this.#M}get indexes(){const e=this.binding.parentContentBindings?.currentLoopContext?.indexes??[];return e.length===this.level?e:e.slice(0,this.level)}get indexesString(){return this.indexes.toString()}get key(){return this.name+"\t"+this.indexesString}#I="";get oldKey(){return this.#I}get isChagedKey(){return this.#I!==this.key}getKey(){return this.#I=this.key,this.key}get value(){return this.state[ve](this.name,this.indexes)}set value(e){const t=e=>{this.state[Pe](this.name,this.indexes,e)};if(e instanceof ti){const n=this.value;if(Array.isArray(n)){const s=new Set(n);e.enabled?s.add(e.value):s.delete(e.value),t(Array.from(s))}else t(e.enabled?e.value:void 0)}else t(e)}#T;get filters(){return this.#T}get filteredValue(){return 0===this.filters.length?this.value:H.applyFilter(this.value,this.filters)}get applicable(){return!0}#w;get binding(){return this.#w}constructor(e,t,n){this.#w=e,this.#N=t,this.#T=D.create(n,e.outputFilterManager),this.#_e=hs(t),this.#M=this.#_e.wildcardCount}initialize(){}getChildValue(e){return this.state[ve](`${this.name}.*`,this.indexes.concat(e))}setChildValue(e,t){return this.state[Pe](`${this.name}.*`,this.indexes.concat(e),t)}dispose(){}}const hi=RegExp(/^\$[0-9]+$/);class mi extends ui{#S;get index(){return this.#S}get value(){return this.binding.parentContentBindings?.currentLoopContext?.indexes[this.index]??p.raise(`ContextIndex: invalid index ${this.name}`)}get indexes(){return[]}get indexesString(){return""}constructor(e,t,n){hi.test(t)||p.raise(`ContextIndex: invalid name ${t}`),super(e,t,n),this.#S=Number(t.slice(1))-1}}const gi=RegExp(/^\$[0-9]+$/),fi=e=>(t,n,s)=>Reflect.construct(e,[t,n,s]);function yi(e){const t=gi.test(e)?mi:ui;return fi(t)}function bi(e,t,n,s){return{nodePropertyCreator:pi(e,t,s),statePropertyCreator:yi(n)}}let xi=1;class vi{#W;#U;#V;childrenContentBindings=[];#Ue;get id(){return this.#W.toString()}get nodeProperty(){return this.#U}get stateProperty(){return this.#V}get statePropertyName(){return this.#V.name}get parentContentBindings(){return this.#Ue}get loopable(){return this.#U.loopable}get expandable(){return this.#U.expandable}get component(){return this.#Ue.component}get updator(){return this.component.updator}get bindingSummary(){return this.component.bindingSummary}get state(){return this.component.states.current}get selectorName(){return this.component.selectorName}get eventFilterManager(){return this.component.eventFilterManager}get inputFilterManager(){return this.component.inputFilterManager}get outputFilterManager(){return this.component.outputFilterManager}constructor(e,t,n,s,i,r,o,a){this.#W=++xi,this.#Ue=e,this.#U=s(this,t,n,i),this.#V=o(this,r,a)}applyToNode(){const{updator:e,nodeProperty:t,stateProperty:n}=this;e.applyNodeUpdatesByBinding(this,(()=>{if(!t.applicable)return;const e=n.filteredValue??"";t.equals(e)||(t.value=e)}))}applyToChildNodes(e){const{updator:t}=this;t.applyNodeUpdatesByBinding(this,(()=>{this.nodeProperty.applyToChildNodes(e)}))}applyToState(){const{stateProperty:e,nodeProperty:t}=this;e.applicable&&(e.value=t.filteredValue)}execDefaultEventHandler(e){this.bindingSummary.exists(this)&&(e.stopPropagation(),this.updator.addProcess(this.applyToState,this,[]))}#z=void 0;get defaultEventHandler(){var e;return void 0===this.#z&&(this.#z=(e=this,t=>e.execDefaultEventHandler(t))),this.#z}initialize(){this.nodeProperty.initialize(),this.stateProperty.initialize()}appendChildContentBindings(e){this.expandable||p.raise("Binding.appendChild: not expandable"),this.childrenContentBindings.push(e);const t=this.childrenContentBindings[this.childrenContentBindings.length-1],n=this.nodeProperty.node.parentNode,s=t?.lastChildNode??this.nodeProperty.node;n?.insertBefore(e.fragment,s.nextSibling??null)}replaceChildContentBindings(e,t){this.expandable||p.raise("Binding.replaceChild: not expandable"),this.childrenContentBindings[t]=e;const n=this.childrenContentBindings[t-1],s=this.nodeProperty.node.parentNode,i=n?.lastChildNode??this.nodeProperty.node;s?.insertBefore(e.fragment,i.nextSibling??null)}removeAllChildrenContentBindings(){const e=this.childrenContentBindings;this.childrenContentBindings=[];for(let t=0;t<e.length;t++)e[t].dispose();return e}dispose(){this.childrenContentBindings.forEach((e=>e.dispose())),this.childrenContentBindings=[]}}const Pi=(e,t)=>(n,s)=>function(e,t,n,s,i,r,o,a){const l=new vi(e,t,n,s,i,r,o,a);return l.initialize(),l}(n,s,e.nodeProperty,t.nodePropertyCreator,e.inputFilters,e.stateProperty,t.statePropertyCreator,e.outputFilters),Ci=(e,t)=>{for(let n=0;n<t.length;e=e.childNodes[t[n++]]);return e};const Si=()=>{},wi={HTMLElement:function(e,t,n,s){const i=e;let r=!1,o=null,a=null,l=null;for(let e=0;e<n.length;e++){const t=n[e];r||="oninput"===t.nodeProperty.name,a=t.nodeProperty.constructor===Lt?t:a,l=t.nodeProperty.constructor===At?t:l,o=t.nodeProperty.name===s?t:o}if(!r){const e=(e=>t=>e.addEventListener("input",t.defaultEventHandler))(i);a?e(a):l?e(l):o&&t&&e(o)}},SVGElement:Si,Text:Si,Template:Si},Ni=e=>(t,n)=>wi[e.nodeType](t,e.isInputable,n,e.defaultProperty);class Bi{nodeType;nodeRoute;nodeRouteKey;bindTextInfos;isInputable;defaultProperty;initializeNode;constructor(e,t,n,s,i,r,o){this.nodeType=e,this.nodeRoute=t,this.nodeRouteKey=n,this.bindTextInfos=s,this.isInputable=i,this.defaultProperty=r,this.initializeNode=o(this)}static create(e,t,n,s){e=((e,t)=>$s[t](e))(e,t),((e,t)=>{Ls[t](e)})(e,t);const i=((e,t)=>Fs[t](e))(e,t),r=((e,t)=>{const n=e.constructor.name+"\t"+(e.type??"");return qs[n]??(qs[n]=Qs[t](e))})(e,t)??"",o=function(e,t){if(""===e.trim())return[];const n=e+"\t"+t;return Us[n]??(Us[n]=Ws(e,t))}(n,r),a=[];for(let t=0;t<o.length;t++){const n=o[t],{nodeProperty:i,stateProperty:r}=n,l=bi(e,i,r,s);a.push({...n,...l,createBinding:Pi(n,l)})}const l=(e=>{let t=[];for(;null!==e.parentNode;)t=[Array.from(e.parentNode.childNodes).indexOf(e),...t],e=e.parentNode;return t})(e),d=l.join(",");return new Bi(t,l,d,a,i,r,Ni)}}const Ei="bind",Mi={HTMLElement:e=>e.dataset[Ei]??"",SVGElement:e=>e.dataset[Ei]??"",Text:e=>e.textContent?.slice(3)??"",Template:e=>f(e.textContent?.slice(3)??"")?.dataset[Ei]??""},Ii=(e,t)=>Mi[t](e),Ti=e=>Array.from(e.childNodes).flatMap((e=>Ti(e).concat((e=>e instanceof Comment&&((e.textContent?.startsWith("@@:")??!1)||(e.textContent?.startsWith("@@|")??!1)))(e)?e:[]))),$i={},Ri=(e,t=(e=>e.constructor.name+"\t"+(e instanceof Comment?e.textContent?.[2]??"":""))(e))=>$i[t]??($i[t]=(e=>e instanceof Comment&&":"===e.textContent?.[2]?"Text":e instanceof HTMLElement?"HTMLElement":e instanceof Comment&&"|"===e.textContent?.[2]?"Template":e instanceof SVGElement?"SVGElement":p.raise(`Unknown NodeType: ${e.nodeType}`))(e));const Ai={};class Li{#A;#Ke;constructor(e,t){this.#A=e,this.#Ke=function(e,t){const n=[],s=e.content,i=Array.from(s.querySelectorAll("[data-bind]")).concat(Ti(s));n.length=0;for(let e=0;e<i.length;e++){const s=i[e],r=Ri(s),o=Ii(s,r);""!==o.trim()&&(n[n.length]=Bi.create(i[e],r,o,t))}return n}(this.#A,t)}createBindings(e,t){return function(e,t,n){const s=[];for(let i=0;i<n.length;i++){const r=n[i],o=Ci(e,r.nodeRoute),a=[];for(let e=0;e<r.bindTextInfos.length;e++)a[a.length]=r.bindTextInfos[e].createBinding(t,o);r.initializeNode(o,a),s.push(...a)}return s}(e,t,this.#Ke)}}class ki{#ze;#S;#qe;#Ge=!1;#Qe;#Ze;constructor(e){!0===e.parentBinding?.loopable||p.raise("parentBinding is not loopable"),this.#Qe=e.parentBinding?.statePropertyName??p.raise("statePropertyName is undefined"),this.#ze=e,this.#Ze=us(this.#Qe+".*")}get patternName(){return this.#Ze.wildcardPaths.at(-1)??p.raise("patternName is undefined")}get parentLoopContext(){if(!this.#Ge){const e=this.#Ze.wildcardPaths.at(-2);let t;if(void 0!==e){for(t=this.#ze.parentBinding?.parentContentBindings;void 0!==t&&(void 0===t.loopContext||t.loopContext.patternName!==e);)t=t.parentBinding?.parentContentBindings;void 0===t&&p.raise("parentLoopContext is undefined")}this.#qe=t?.loopContext,this.#Ge=!0}return this.#qe}get index(){return void 0===this.#S&&(this.#S=this.#ze.parentBinding?.childrenContentBindings.indexOf(this.#ze)??p.raise("parentBinding is undefined")),this.#S}get indexes(){return void 0===this.parentLoopContext?[this.index]:[...this.parentLoopContext.indexes,this.index]}clearIndex(){this.#Ge=!1,this.#S=void 0}find(e){let t=this.#ze;for(;void 0!==t&&(void 0===t.loopContext||t.loopContext.patternName!==e);)t=t.parentBinding?.parentContentBindings;return t?.loopContext}}class Fi{#f;template;#Je;#Z;#b;#Ye;#Q;get component(){return void 0===this.#f&&p.raise("component is undefined"),this.#f}get childrenBinding(){return void 0===this.#Je&&p.raise("childrenBinding is undefined"),this.#Je}get parentBinding(){return this.#Z}set parentBinding(e){this.#Z=e,this.#b=!0===e?.loopable?new ki(this):void 0,this.#f=e?.component??this.#f}get loopContext(){return this.#b}get childNodes(){return void 0===this.#Ye&&p.raise("childNodes is undefined"),this.#Ye}get lastChildNode(){return this.childNodes[this.childNodes.length-1]}get currentLoopContext(){return void 0===this.#b?this.parentContentBindings?.loopContext:this.#b}get parentContentBindings(){return this.parentBinding?.parentContentBindings}get fragment(){return void 0===this.#Q&&p.raise("fragment is undefined"),this.#Q}constructor(e,t,n){void 0===n&&void 0===t&&p.raise("component and parentBinding are undefined"),void 0!==n&&void 0!==t&&p.raise("component and parentBinding are both defined"),this.#f=t?.component??n??p.raise("component is undefined"),this.parentBinding=t,this.template=e}initialize(){const e=function(e,t){const n=e.dataset.uuid??"";return Ai[n]??(Ai[n]=new Li(e,t))}(this.template,this.component.useKeyed);this.#Q=document.importNode(this.template.content,!0),this.#Je=e.createBindings(this.#Q,this),this.#Ye=Array.from(this.#Q.childNodes)}removeChildNodes(){this.fragment.append(...this.childNodes)}applyToNode(){const e=[];for(let t=0;t<this.childrenBinding.length;t++){const n=this.childrenBinding[t];n.nodeProperty.isSelectValue?e.push(n):n.applyToNode()}for(let t=0;t<e.length;t++)e[t].applyToNode()}applyToState(){for(let e=0;e<this.childrenBinding.length;e++)this.childrenBinding[e].applyToState()}registerBindingsToSummary(){for(let e=0;e<this.childrenBinding.length;e++)this.component.bindingSummary.add(this.childrenBinding[e])}postCreate(){this.registerBindingsToSummary(),this.applyToNode()}dispose(){this.childrenBinding.forEach((e=>e.dispose())),this.#Z=void 0,this.#b=void 0,this.#f=void 0,this.removeChildNodes();const e=this.template.dataset.uuid??p.raise("uuid is undefined");Vi.get(e)?.push(this)??Vi.set(e,[this])}}const Vi=new Map;function Oi(e,t,n){const s=e.dataset.uuid??p.raise("uuid is undefined"),i=Vi.get(s)?.pop();if(void 0!==i)return i.parentBinding=t,i;{const s=new Fi(e,t,n);return s.initialize(),s}}const Di=e=>e.stateProperty.key,Hi=e=>e.nodeProperty.expandable,ji=e=>e.nodeProperty.constructor===ri;class _i{#Y=!1;get updated(){return this.#Y}set updated(e){this.#Y=e}#X=!1;#ee=0;get updateRevision(){return this.#ee}#te=new Map;get bindingsByKey(){return this.#X&&p.raise("BindingSummary.bindingsByKey can only be called after BindingSummary.update()"),this.#te}#ne=new Set;get expandableBindings(){return this.#X&&p.raise("BindingSummary.expandableBindings can only be called after BindingSummary.update()"),this.#ne}#se=new Set;get componentBindings(){return this.#X&&p.raise("BindingSummary.componentBindings can only be called after BindingSummary.update()"),this.#se}#ie=new Set;get allBindings(){return this.#ie}add(e){this.#X||p.raise("BindingSummary.add() can only be called in BindingSummary.update()"),this.#Y=!0,this.#ie.add(e)}delete(e){this.#X||p.raise("BindingSummary.delete() can only be called in BindingSummary.update()"),this.#Y=!0,this.#ie.delete(e)}exists(e){return this.#ie.has(e)}flush(){e.debug&&performance.mark("BindingSummary.flush:start");try{this.rebuild(this.#ie)}finally{e.debug&&(performance.mark("BindingSummary.flush:end"),performance.measure("BindingSummary.flush","BindingSummary.flush:start","BindingSummary.flush:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures("BindingSummary.flush"),performance.clearMarks("BindingSummary.flush:start"),performance.clearMarks("BindingSummary.flush:end"))}}update(e){this.#X=!0,this.#Y=!1,this.#ee++;try{e(this)}finally{this.#Y&&this.flush(),this.#X=!1}}rebuild(e){this.#ie=e;const t=Array.from(e);this.#te=Map.groupBy(t,Di),this.#ne=new Set(t.filter(Hi)),this.#se=new Set(t.filter(ji))}}const Wi={[te]:({state:e,stateProxy:t,handler:n})=>async(s,i,r)=>n.directlyCallback(i,(async()=>Reflect.apply(Reflect.get(e,s),t,[r,...i?.indexes??[]]))),[ne]:({handler:e})=>(t,n)=>e.updator.addUpdatedStateProperty(new ms(t,n)),[se]:({handler:e})=>()=>e.dependentProps,[ie]:({handler:e})=>()=>e.clearCache(),[re]:({stateProxy:e})=>t=>e.$createBuffer?.apply(e,[t]),[oe]:({stateProxy:e})=>(t,n)=>e.$flushBuffer?.apply(e,[t,n])};const Ui={[Q]:(...e)=>{},[Z]:(...e)=>{},[J]:(...e)=>({props:e})},Ki={[Q]:"connected",[Z]:"disconnected",[J]:"updated"};const zi={[Y]:"$connectedCallback",[X]:"$disconnectedCallback",[ee]:"$updatedCallback"},qi=new Set([Y,X,ee]),Gi={[Y]:Q,[X]:Z,[ee]:J},Qi=(e,t,n,s)=>(...i)=>async()=>{e[zi[s]]?.apply(t,i),function(e,t,n){const s=Ki[t]??p.raise(`Unknown event symbol: ${t.description} `),i=(Ui[t]??p.raise(`Unknown detail function for event symbol: ${t.description}`))(...n),r=new CustomEvent(s,{detail:i});e.dispatchEvent(r)}(n.element,Gi[s],i)};function Zi(e,t){return void 0!==e.prototype[t]||e.prototype!==Object.prototype&&Zi(Object.getPrototypeOf(e),t)}const Ji=new Set(["addProcess","viewRootElement ","queryRoot","asyncShowModal","asyncShow","asyncShowPopover","cancelPopover"]);class Yi{get(e,t){return Ji.has(t)||Zi(e.baseClass,t)?Reflect.get(e,t):void p.raise(`property ${t} is not found in ${e.baseClass.name}`)}}const Xi="$globals",er="$dependentProps",tr="$component",nr="$addProcess",sr={[Xi]:({handler:e})=>e.element.globals,[er]:({state:e})=>Reflect.get(e,er),[tr]:({handler:e})=>{return t=e.element,new Proxy(t,new Yi);var t},[nr]:({handler:e,stateProxy:t})=>n=>e.updator.addProcess(n,t,[])};function ir(e){const t=function(e){const t={};let n=e;for(;n!==Object.prototype;){const e=Object.getOwnPropertyDescriptors(n);for(const[n,s]of Object.entries(e))Reflect.has(t,n)||(t[n]=s);n=Object.getPrototypeOf(n)}return t}(e),n=[];for(const[e,s]of Object.entries(t))(s.get||s.set)&&n.push(e);return n}const rr=new Map;function or(e){let t=rr.get(e.constructor);return void 0===t&&(t=ir(e),{}.constructor!==e.constructor&&rr.set(e.constructor,t)),t}class ar{#l=new Set;#d=new Map;constructor(e){this.setDependentProps(e)}get propsByRefProp(){return this.#d}hasDefaultProp(e){return this.#l.has(e)}addDefaultProp(e){const t=hs(e);for(let e=t.patternPaths.length-1;e>=1;e--){const n=t.patternPaths[e-1],s=t.patternPaths[e];this.#d.get(n)?.add(s)??this.#d.set(n,new Set([s])),this.#l.add(s)}}setDependentProps(e){for(const[t,n]of Object.entries(e))for(const e of n)this.#d.get(e)?.add(t)??this.#d.set(e,new Set([t]))}}class lr extends Bs{#f;#m;#Xe;#et;get accessorProperties(){return this.#m}get dependentProps(){return this.#Xe}get element(){return this.#f}get component(){return this.#f}get updator(){return this.component.updator}constructor(e,t){super(),this.#f=e;const{accessorProperties:n,dependentProps:s}=(i=t,{accessorProperties:new Set(or(i)),dependentProps:new ar(i.$dependentProps??{})});var i;this.#m=n,this.#Xe=s,this.#et={[q]:this.#m,[G]:this.#Xe},this.#tt.symbol=(e,t,n)=>this.#nt.apply(this,[e,t,n]),this.#tt.string=(e,t,n)=>this.#st.apply(this,[e,t,n])}_getValue(e,t,n,s,i,r,o){if(t.length>1){const e=t[i];!this.dependentProps.hasDefaultProp(e)&&this.dependentProps.addDefaultProp(e)}return super._getValue(e,t,n,s,i,r,o)}#nt(e,t,n){return this.#et[t]??function(e,t,n,s){return qi.has(s)?s===Y?(...i)=>Qi(e,t,n,s)(...i)():(...i)=>n.updator.addProcess(Qi(e,t,n,s)(...i),t,[]):void 0}(e,n,this,t)??function(e,t,n,s){return Wi[s]?.({state:e,stateProxy:t,handler:n})}(e,n,this,t)??void 0}#st(e,t,n){return function(e,t,n,s){return sr[s]?.({state:e,stateProxy:t,handler:n,prop:s})}(e,n,this,t)??void 0}#tt={};get(e,t,n){return this.#tt[typeof t]?.(e,t,n)??super.get(e,t,n)}clearCache(){}async directlyCallback(e,t){}}class dr extends lr{#y=new Map;_getValue(e,t,n,s,i,r,o){const a=t[i];if(t.length>1||this.accessorProperties.has(a)){const l=`${a}:${s.slice(0,r+1).toString()}`;let d=this.#y.get(l);if(void 0!==d)return d;if(this.#y.has(l))return;return d=super._getValue(e,t,n,s,i,r,o),this.#y.set(l,d),d}return super._getValue(e,t,n,s,i,r,o)}clearCache(){this.#y.clear()}set(e,t,n,s){p.raise("ReadonlyHandler: set is not allowed")}}class cr extends lr{#b;async withLoopContext(e,t){void 0!==this.#b&&p.raise("Writable: already set loopContext"),this.#b=e;try{return await t()}finally{this.#b=void 0}}async directlyCallback(e,t){return this.withLoopContext(e,(async()=>(void 0!==this.lastStackIndexes&&p.raise("Writable: already set stackIndexes"),await t())))}getLastIndexes(e){return this._stackNamedWildcardIndexes.at(-1)?.[e]?.indexes??this.#b?.find(e)?.indexes}__set(e,t,n,s,i){try{return super.__set(e,t,n,s,i)}finally{this.updator.addUpdatedStateProperty(new ms(t.pattern,n))}}}class pr{#it;#rt;#ot;#at=!1;constructor(e,t){this.#it=t,this.#rt=new Proxy(t,new dr(e,t)),this.#ot=new Proxy(t,new cr(e,t))}get base(){return this.#it}get#lt(){return this.#at}set#lt(e){this.#at=e,!1===e&&this.#rt[ie]()}get current(){return this.#lt?this.#ot:this.#rt}async writable(e){this.#lt=!0;try{return await e()}finally{this.#lt=!1}}}const ur=new Map,hr=new Map;function mr(e){return class extends e{constructor(...e){var t,n;super(),this.#ye=(t=this,n=Reflect.construct(this.State,[]),new pr(t,n)),this.#J=new _i,this.#be=Promise.withResolvers(),this.#xe=function(e){return new vs(e)}(this),this.#ve=function(e){return new Proxy({},new ws(e))}(this),this.#Pe=function(e){return new Proxy({},new Is(e))}(this)}get component(){return this}#Ce;get parentComponent(){return void 0===this.#Ce&&(this.#Ce=(e=>{let t=e;for(;;){if(t=t.parentNode,null==t)return;if(!0===Reflect.get(t,"isQuelComponent"))return t;if(t instanceof ShadowRoot){if(!0===Reflect.get(t.host,"isQuelComponent"))return t.host;t=t.host}const e=ur.get(t);if(void 0!==e)return e}})(this)),this.#Ce}#be;get initialPromises(){return this.#be}#Se;get alivePromises(){return this.#Se??p.raise("alivePromises is undefined")}set alivePromises(e){this.#Se=e}#ye;get states(){return this.#ye}#we;get rootBindingManager(){return this.#we??p.raise("rootBindingManager is undefined")}set rootBindingManager(e){this.#we=e}get viewRootElement(){return this.useWebComponent?this.shadowRoot??this:this.pseudoParentNode}get queryRoot(){return this.viewRootElement}#Ne;get pseudoParentNode(){return this.useWebComponent?p.raise("mixInComponent: useWebComponent must be false"):this.#Ne??p.raise("pseudoParentNode is undefined")}set pseudoParentNode(e){this.#Ne=e}#Be;get pseudoNode(){return this.#Be??p.raise("pseudoNode is undefined")}set pseudoNode(e){this.#Be=e}get shadowRootOrDocument(){let e=this.parentNode;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}return document}#Me=0;get contextRevision(){return this.#Me}set contextRevision(e){this.#Me=e}useContextRevision(e){this.#Me++,e(this.#Me)}#J;get bindingSummary(){return this.#J}#xe;get updator(){return this.#xe}#ve;get props(){return this.#ve}#Pe;get globals(){return this.#Pe}async build(){if(t=this.tagName.toLowerCase(),(ts(t)||es.has(t))&&this.useShadowRoot&&this.useWebComponent){const t=this.attachShadow({mode:"open"}),n=function(e){return e.map(ls).filter(ds)}((e=this,getComputedStyle(e)?.getPropertyValue(ns)?.split(" ").map(os).filter(as)??[]));void 0!==this.styleSheet&&n.push(this.styleSheet),t.adoptedStyleSheets=n}else if(void 0!==this.styleSheet){let e=this.styleSheet;if(this.useLocalSelector){const t=hr.get(this.tagName);void 0!==t?e=t:(e=function(e,t){for(let n=0;n<e.cssRules.length;n++){const s=e.cssRules[n];if(s instanceof CSSStyleRule){const e=s.selectorText.split(",").map((e=>e.trim().startsWith(":host")?e.replace(":host",t):`${t} ${e}`)).join(",");s.selectorText=e}}return e}(this.styleSheet,this.selectorName),hr.set(this.tagName,e))}const t=this.shadowRootOrDocument,n=Array.from(t.adoptedStyleSheets);n.includes(e)||(t.adoptedStyleSheets=[...n,e])}var e,t;this.useOverscrollBehavior&&("DIALOG"===this.tagName||this.hasAttribute("popover"))&&(this.style.overscrollBehavior="contain"),this.states.writable((async()=>{await this.states.current[Y]()})),this.bindingSummary.update((e=>{this.template.dataset.uuid??p.raise("uuid is undefined"),this.rootBindingManager=Oi(this.template,void 0,this),this.rootBindingManager.postCreate()})),this.useWebComponent?this.viewRootElement.appendChild(this.rootBindingManager.fragment):(this.viewRootElement.insertBefore(this.rootBindingManager.fragment,this.pseudoNode?.nextSibling??null),this.rootBindingManager.childNodes.forEach((e=>ur.set(e,this))))}async connectedCallback(){try{if(this.parentComponent&&await this.parentComponent.initialPromises.promise,!this.useWebComponent){const e=document.createComment(`@@/${this.tagName}`);this.pseudoParentNode=this.parentNode??p.raise("parentNode is undefined"),this.pseudoNode=e,this.pseudoParentNode.replaceChild(e,this)}this.alivePromises=Promise.withResolvers(),await this.build()}finally{this.initialPromises?.resolve&&this.initialPromises.resolve()}}async disconnectedCallback(){}}}const gr=new Map,fr=new Map,yr=new Map,br=t=>{const n=Object.assign(new Xn,t);n.filters=Object.assign({},t.filters),n.config=Object.assign({},t.moduleConfig),n.options=Object.assign({},t.options);const s=n.config?.extends??n.options?.extends,i=function(t,n){const s=class extends n{#Ie;get module(){return void 0===this.#Ie&&(this.#Ie=gr.get(this.thisClass)??p.raise(`module is not found for ${this.constructor.name}`)),this.#Ie}get isQuelComponent(){return!0}#Te;get customElementInfo(){return void 0===this.#Te&&(this.#Te=fr.get(this.tagName)??p.raise(`customElementInfo is not found for ${this.tagName}`)),this.#Te}#$e(){if(void 0===fr.get(this.tagName)){const e=this.tagName.toLowerCase(),t=e.includes("-"),n=this.getAttribute("is"),s=!!n,i=t?e:`${e}[is="${n}"]`;fr.set(this.tagName,{selectorName:i,lowerTagName:e,isAutonomousCustomElement:t,isCostomizedBuiltInElement:s})}}get template(){return this.module.template}get styleSheet(){return this.module.styleSheet}get State(){return this.module.State}get inputFilters(){return this.module.filters.input??{}}get outputFilters(){return this.module.filters.output??{}}get eventFilters(){return this.module.filters.event??{}}get useShadowRoot(){return this.module.moduleConfig.useShadowRoot??e.useShadowRoot}get useWebComponent(){return this.module.moduleConfig.useWebComponent??e.useWebComponent}get useLocalTagName(){return this.module.moduleConfig.useLocalTagName??e.useLocalTagName}get useKeyed(){return this.module.moduleConfig.useKeyed??e.useKeyed}get useLocalSelector(){return this.module.moduleConfig.useLocalSelector??e.useLocalSelector}get useOverscrollBehavior(){return this.module.moduleConfig.useOverscrollBehavior??e.useOverscrollBehavior}get lowerTagName(){return this.customElementInfo.lowerTagName}get selectorName(){return this.customElementInfo.selectorName}get isAutonomousCustomElement(){return this.customElementInfo.isAutonomousCustomElement}get isCostomizedBuiltInElement(){return this.customElementInfo.isCostomizedBuiltInElement}#Re;get filterManagers(){return void 0===this.#Re&&(this.#Re=yr.get(this.tagName)??p.raise(`filterManagers is not found for ${this.tagName}`)),this.#Re}#Ae(){if(void 0===yr.get(this.tagName)){const e={inputFilterManager:new W,outputFilterManager:new j,eventFilterManager:new K};for(const[t,n]of Object.entries(this.inputFilters))e.inputFilterManager.registerFilter(t,n);for(const[t,n]of Object.entries(this.outputFilters))e.outputFilterManager.registerFilter(t,n);for(const[t,n]of Object.entries(this.eventFilters))e.eventFilterManager.registerFilter(t,n);yr.set(this.tagName,e)}}get inputFilterManager(){return this.filterManagers.inputFilterManager}get outputFilterManager(){return this.filterManagers.outputFilterManager}get eventFilterManager(){return this.filterManagers.eventFilterManager}constructor(){super(),this.#$e(),this.#Ae()}static baseClass=n;get baseClass(){return Reflect.get(this.constructor,"baseClass")}static thisClass;get thisClass(){return Reflect.get(this.constructor,"thisClass")}};return s.thisClass=s,gr.set(s,t),s}(n,s?document.createElement(s).constructor:HTMLElement),r=function(e){return class extends e{#Le=!1;get canceled(){return this.#Le}set canceled(e){this.#Le=e}#ke;get popoverPromises(){return this.#ke}set popoverPromises(e){this.#ke=e}#Fe;get popoverContextIndexesById(){return void 0===this.#Fe&&(this.#Fe=new Map),this.#Fe}constructor(...e){super(),this.addEventListener("hidden",(()=>{if(void 0!==this.popoverPromises){if(this.canceled)this.popoverPromises.reject();else{const e=this.props[jt]();this.props[_t](),this.popoverPromises.resolve(e)}this.popoverPromises=void 0}this.useBufferedBind&&void 0!==this.parentComponent&&(this.canceled||this.props[Ut]()),this.canceled=!0;const e=this.id;void 0!==e&&this.popoverContextIndexesById.delete(e)})),this.addEventListener("shown",(()=>{if(this.canceled=!0,this.useBufferedBind&&void 0!==this.parentComponent){const e=this.props[Wt]();this.props[Ht](e)}for(const e in this.props)this.states.current[ne](e,[])})),this.addEventListener("toggle",(e=>{const t=e;if("closed"===t.newState){const e=new CustomEvent("hidden");this.dispatchEvent(e)}else if("open"===t.newState){const e=new CustomEvent("shown");this.dispatchEvent(e)}}))}async asyncShowPopover(e){return this.popoverPromises=Promise.withResolvers(),this.props[Ht](e),HTMLElement.prototype.showPopover.apply(this),this.popoverPromises.promise}hidePopover(){this.canceled=!1,HTMLElement.prototype.hidePopover.apply(this)}cancelPopover(){HTMLElement.prototype.hidePopover.apply(this)}}}((o=mr(i),class extends o{#Ve;get dialogPromises(){return this.#Ve}set dialogPromises(e){this.#Ve=e}#Oe="";get returnValue(){return this.#Oe}set returnValue(e){this.#Oe=e}get useBufferedBind(){return this.hasAttribute("buffered-bind")}constructor(...e){super(),this.addEventListener("closed",(()=>{if(void 0!==this.dialogPromises){if(""===this.returnValue)this.dialogPromises.reject();else{const e=this.props[jt]();this.props[_t](),this.dialogPromises.resolve(e)}this.dialogPromises=void 0}this.useBufferedBind&&void 0!==this.parentComponent&&""!==this.returnValue&&this.props[Ut]()})),this.addEventListener("close",(()=>{const e=new CustomEvent("closed");this.dispatchEvent(e)}))}async#De(e,t=!0){return this.returnValue="",this.dialogPromises=Promise.withResolvers(),this.props[Ht](e),t?HTMLDialogElement.prototype.showModal.apply(this):HTMLDialogElement.prototype.show.apply(this),this.dialogPromises.promise}async asyncShowModal(e){return this instanceof HTMLDialogElement||p.raise("DialogComponent: asyncShowModal is only for HTMLDialogElement"),this.#De(e,!0)}async asyncShow(e){return this instanceof HTMLDialogElement||p.raise("DialogComponent: asyncShow is only for HTMLDialogElement"),this.#De(e,!1)}showModal(){if(this instanceof HTMLDialogElement||p.raise("DialogComponent: showModal is only for HTMLDialogElement"),this.useBufferedBind&&void 0!==this.parentComponent){this.returnValue="";const e=this.props[Wt]();this.props[Ht](e)}return HTMLDialogElement.prototype.showModal.apply(this)}show(){if(this instanceof HTMLDialogElement||p.raise("DialogComponent: show is only for HTMLDialogElement"),this.useBufferedBind&&void 0!==this.parentComponent){this.returnValue="";const e=this.props[Wt]();this.props[Ht](e)}return HTMLDialogElement.prototype.show.apply(this)}close(e=""){return this instanceof HTMLDialogElement||p.raise("DialogComponent: close is only for HTMLDialogElement"),HTMLDialogElement.prototype.close.apply(this,[e])}}));var o;return vr(n.componentModulesForRegister??{}),r};function xr(e,t){const n=p.toKebabCase(e),s=br(t),i=t.moduleConfig?.extends??t.options?.extends;void 0===i?customElements.define(n,s):customElements.define(n,s,{extends:i})}function vr(e){for(const[t,n]of Object.entries(e))xr(t,n)}function Pr(e){return e.replaceAll(/<!--\{\{([^\}]+)\}\}-->/g,((e,t)=>`{{${t}}}`))}async function Cr(e){const t=document.createElement("template"),n=await fetch(function(e,t){return e.resolve(t)}(import.meta,e));let s;t.innerHTML=(await n.text()).replaceAll(/\{\{([^\}]+)\}\}/g,((e,t)=>`\x3c!--{{${t}}}--\x3e`));const i=t.content.querySelector("script");let r;i?(s=await import("data:text/javascript;charset=utf-8,"+i.text),i.remove()):s={State:class{}};const o=t.content.querySelector("style");o?(r={css:o.textContent},o.remove()):r={};const a={html:Pr(t.innerHTML).trim()};return Object.assign({},s,a,r)}async function Sr(e,t){xr(e,await Cr(t))}async function wr(e){for(const[t,n]of Object.entries(e??{}))Sr(t,n)}function Nr(e){Object.entries(e).forEach((([e,t])=>{const{input:n,output:s,event:i}=t;n&&W.registerFilter(e,n),s&&j.registerFilter(e,s),i&&K.registerFilter(e,i)}))}function Br(e){Object.assign(Ln.data,e)}void 0===Map.groupBy&&(Map.groupBy=function(e,t){return e.reduce(((e,n,s)=>{const i=t(n,s);return e.has(i)||e.set(i,[]),e.get(i).push(n),e}),new Map)}),void 0===Object.groupBy&&(Object.groupBy=function(e,t){return e.reduce((function(e,n){return(e[n[t]]=e[n[t]]||[]).push(n),e}),{})}),void 0===Promise.withResolvers&&(Promise.withResolvers=function(){let e,t;return{promise:new Promise(((n,s)=>{e=n,t=s})),resolve:e,reject:t}}),void 0===Array.prototype.toSorted&&(Array.prototype.toSorted=function(e){return this.slice().sort(e)}),void 0===Array.prototype.toReversed&&(Array.prototype.toReversed=function(){return this.slice().reverse()});export{zn as bootFromImportMeta,e as config,br as generateComponentClass,t as getCustomTagFromImportMeta,s as importCssFromImportMeta,n as importHtmlFromImportMeta,Cr as loadSingleFileComponent,Kn as loader,vr as registerComponentModules,Nr as registerFilters,Br as registerGlobal,wr as registerSingleFileComponents};
