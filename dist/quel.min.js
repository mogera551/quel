(()=>{"use strict";const e=class{static raise(e){throw e}static isFunction=e=>{const t=Object.prototype.toString.call(e).slice(8,-1).toLowerCase();return"function"===t||"asyncfunction"===t};static isInputableElement(e){return e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&"button"!==e.type}};class t{html;css;ViewModel;#e;get template(){if(void 0===this.#e){const e=this.html?this.html.replaceAll(/\{([^\}]+)\}/g,((e,t)=>`\x3c!--@@${t}--\x3e`)):"";this.#e=document.createElement("template"),this.#e.innerHTML=(this.css?`<style>\n${this.css}\n</style>`:"")+e}return this.#e}set template(e){this.#e=e}}class s{static localeString=(e,t)=>{const s=parseFloat(e);return isNaN(s)?"":s.toLocaleString()};static fixed=(e,t)=>{const s=parseFloat(e);return isNaN(s)?"":s.toFixed(t[0]??0)};static styleDisplay=(e,t)=>e?t[0]??"":"none";static truthy=(e,t)=>!!e;static falsey=(e,t)=>!e;static not=this.falsey;static upperCase=(e,t)=>e?.toUpperCase?e.toUpperCase():"";static lowerCase=(e,t)=>e?.toLowerCase?e.toLowerCase():"";static eq=(e,t)=>e==t[0];static ne=(e,t)=>e!=t[0];static lt=(e,t)=>Number(e)<Number(t[0]);static le=(e,t)=>Number(e)<=Number(t[0]);static gt=(e,t)=>Number(e)>Number(t[0]);static ge=(e,t)=>Number(e)>=Number(t[0]);static embed=(e,t)=>decodeURI((t[0]??"").replaceAll("%s",e));static ifText=(e,t)=>e?t[0]??"":t[1]??"";static null=(e,t)=>null==e}class n{static number=(e,t)=>Number(e);static boolean=(e,t)=>Boolean(e)}class i{name;options;static applyForInput(e,t){return t.reduceRight(((e,t)=>t.name in n?n[t.name](e,t.options):e),e)}static applyForOutput(e,t){return t.reduce(((e,t)=>t.name in s?s[t.name](e,t.options):e),e)}}class o{node;get element(){return this.node instanceof HTMLElement?this.node:e.raise("not HTMLElement")}nodeProperty;#t;get nodePropertyElements(){return this.#t}set nodePropertyElements(e){this.#t=e}viewModel;viewModelProperty;filters;#s;#n;get indexes(){return this.#s}set indexes(e){this.#s=e,this.#n=e.toString(),this.#i=`${this.viewModelProperty}\t${this.#n}`}get indexesString(){return this.#n}#i;get viewModelPropertyKey(){return this.#i}lastNodeValue;lastViewModelValue;updateNode(){}updateViewModel(){}changeIndexes(e,t){const s=this.indexes.slice();s[e]=(parseInt(s[e])+t).toString(),this.indexes=s}}const r=e=>Array.from(e.childNodes).flatMap((e=>r(e).concat((e=>e instanceof Comment&&"@"===e.textContent[0]&&"@"===e.textContent[1]&&"@"!==e.textContent[2])(e)?e:null))).filter((e=>e)),a=class{static listOfRouteIndexesByTemplate=new Map;static getTargetNodes(e,t){let s;return this.listOfRouteIndexesByTemplate.has(e)?s=this.listOfRouteIndexesByTemplate.get(e).map((e=>e.reduce(((e,t)=>e.childNodes[t]),t))):(s=Array.from(t.querySelectorAll("[data-bind]")).concat(r(t)),this.listOfRouteIndexesByTemplate.set(e,s.map((e=>(e=>{let t=[];for(;null!=e.parentNode;)t=[Array.from(e.parentNode.childNodes).indexOf(e)].concat(t),e=e.parentNode;return t})(e))))),s}},l=class{static bind(e,t,s){console.error("need to override")}},d="quel",p=Symbol.for(`${d}:viewModel.indexes`),c=Symbol.for(`${d}:viewModel.target`),h=Symbol.for(`${d}:viewModel.directGet`),u=Symbol.for(`${d}:viewModel.directSet`),m=Symbol.for(`${d}:viewModel.directCall`),y=Symbol.for(`${d}:viewModel.init`),f=Symbol.for(`${d}:viewModel.write`),w=Symbol.for(`${d}:viewModel.clearCache`);class g{binds;childNodes;removeFromParent(){this.childNodes.forEach((e=>e.parentNode.removeChild(e)))}expand(){this.binds.forEach((e=>{e instanceof P&&e.expand()}))}changeIndex(e,t){this.binds.forEach((s=>s.changeIndexes(e,t)))}static create(e,t){const{template:s,viewModel:n}=e,i=document.importNode(s.content,!0),o=W.bind(s,i,n,t),r=Array.from(i.childNodes);return Object.assign(new g,{binds:o,childNodes:r})}}class P extends o{templateChildren=[];get template(){return this.node instanceof HTMLTemplateElement?this.node:utils.raise("not HTMLTemplateElement")}updateNode(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:n,indexes:o,filters:r}=this,a=i.applyForOutput(s[h](n,o),r);"loop"===this.nodeProperty?this.lastViewModelValue=(a??[]).slice():this.lastViewModelValue=a}removeFromParent(){const e=this.templateChildren.flatMap((e=>e.childNodes));if(e.length>0){const t=e[0].parentNode,s=t.cloneNode(!1);t.parentNode.replaceChild(s,t),e.forEach((e=>e.parentNode.removeChild(e))),s.parentNode.replaceChild(t,s)}}appendToParent(){const e=document.createDocumentFragment();this.templateChildren.flatMap((e=>e.childNodes)).forEach((t=>e.appendChild(t))),this.template.after(e)}expand(){"loop"===this.nodeProperty?this.expandLoop():this.expandIf()}expandIf(){this.removeFromParent(),this.templateChildren=U.expand(bind),this.appendToParent()}expandLoop(){const{viewModel:e,viewModelProperty:t,indexes:s,filters:n}=this,o=this.lastViewModelValue,r=i.applyForOutput(e[h](t,s),n),a=new Set(o.values()),l=new Map(Array.from(a).map((e=>[e,[]])));o.forEach(((e,t)=>l.get(e).push(t)));const d=new Map,p=r.map(((e,t)=>{const n=l.get(e)??[];if(0===n.length)return d.set(t,-1),g.create(this,s.concat(t));{const e=parseInt(n.shift());d.set(t,e);const i=this.templateChildren[e];return i.changeIndex(s.length,t-e),i}}));Array.from(l.values()).flatMap((e=>e)).forEach((e=>{this.templateChildren[e].removeFromParent()})),p.forEach(((e,t)=>{const s=d.get(t-1),n=d.get(t);if(void 0!==s&&s+1===n)return;const i=p[t-1];let o=i?.childNodes[i.childNodes.length-1]??this.template;e.childNodes.forEach((e=>{o.after(e),o=e}))})),this.templateChildren=p,this.templateChildren.forEach((e=>e.expand()))}changeIndexes(e,t){this.indexes[e]=(parseInt(this.indexes[e])+t).toString(),this.templateChildren.forEach((s=>{s.binds.forEach((s=>s.changeIndexes(e,t)))}))}}class v{nodeProperty;viewModelProperty;filters}const x=e=>e.trim(),M=e=>e.length>0,b=(e,t)=>e.split(";").map(x).filter(M).map((e=>{let{nodeProperty:s,viewModelProperty:n,filters:o}=((e,t)=>{const[s,n]=["$"].concat(...e.split(":").map(x)).splice(-2),{viewModelProperty:o,filters:r}=(e=>{const[t,...s]=e.split("|").map(x);return{viewModelProperty:t,filters:s.map((e=>(e=>{const[t,...s]=e.split(",").map(x);return Object.assign(new i,{name:t,options:s})})(e)))}})(n);return{nodeProperty:s,viewModelProperty:o,filters:r}})(e);return n="@"===n?prop:n,s="$"===s?t:s,{nodeProperty:s,viewModelProperty:n,filters:o}})),E=class{static bindTextsByKey=new Map;static parse(e,t){const s=`${e}\t${t}`;let n=this.bindTextsByKey.get(s);return void 0===n&&(n=b(e,t).map((e=>Object.assign(new v,e))),this.bindTextsByKey.set(s,n)),n}},N=class{static getInfo(t,s){const n={type:null,nodePropertyElements:[],eventType:null};return t instanceof HTMLTemplateElement?(n.type=90,n):(n.nodePropertyElements=s.split("."),1===n.nodePropertyElements.length?n.nodePropertyElements[0].startsWith("on")?(n.type=91,n.eventType=n.nodePropertyElements[0].slice("on".length)):"radio"===n.nodePropertyElements[0]?n.type=20:"checkbox"===n.nodePropertyElements[1]?n.type=30:n.type=1:2===n.nodePropertyElements.length?"className"===n.nodePropertyElements[0]?n.type=10:n.type=2:3===n.nodePropertyElements.length?n.type=3:e.raise(`unknown property ${s}`),n)}};class I{node;property;updateFunc;constructor(e,t,s){this.node=e,this.property=t,this.updateFunc=s}}class T{component;name;#s;get indexes(){return this.#s}set indexes(e){this.#s=e,this.#n=e.toString()}#n;get indexesString(){return this.#n}constructor(e,t,s){this.component=e,this.name=t,this.indexes=s}}class V{target;thisArgument;argumentsList;constructor(e,t,s){this.target=e,this.thisArgument=t,this.argumentsList=s}}class L{processor;notifier;nodeUpdator;constructor(){this.processor=new class{queue=[];async exec(){for(;this.queue.length>0;){const e=this.queue.shift();await Reflect.apply(e.target,e.thisArgument,e.argumentsList)}}get isEmpty(){return 0===this.queue.length}},this.notifier=new class{queue=[];async exec(){for(;this.queue.length>0;){const e=this.queue.splice(0).reduce(((e,t)=>(e.get(t.component)?.push(t)??e.set(t.component,[t]),e)),new Map);for(const[t,s]of e.entries()){const e=new Set(s.map((e=>`${e.name}\t${e.indexes}`)));t.notify(e)}}}get isEmpty(){return 0===this.queue.length}},this.nodeUpdator=new class{queue=[];reorder(e){e.sort(((e,t)=>t.node instanceof HTMLTemplateElement||e.node instanceof HTMLSelectElement&&"value"===e.property?1:-1))}async exec(){for(;this.queue.length>0;){const e=this.queue.splice(0);this.reorder(e),e.forEach((e=>Reflect.apply(e.updateFunc,e,[])))}}get isEmpty(){return 0===this.queue.length}}}async exec(){do{await this.processor.exec(),await this.notifier.exec(),await this.nodeUpdator.exec()}while(!this.processor.isEmpty||!this.notifier.isEmpty||!this.nodeUpdator.isEmpty)}}class O{#o;#r;#a;constructor(){this.main()}async sleep(){return new Promise(((e,t)=>{this.#o=e,this.#r=t}))}stop(){this.#r()}wakeup(e){this.#a=e,this.#o()}async main(){for(;;)try{await this.sleep(),ie.getDebug()&&performance.mark("slot-exec:start");try{await this.#a.exec()}finally{this.#a=void 0,ie.getDebug()&&(performance.mark("slot-exec:end"),performance.measure("slot-exec","slot-exec:start","slot-exec:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures(),performance.clearMarks())}}catch(e){if(void 0!==e&&(console.error(e),!confirm("致命的なエラーが発生しました。続行しますか？")))break}}addProcess(e){const t=this.#a??new L;t.processor.queue.push(e),this.#a||this.wakeup(t)}addNotify(e){const t=this.#a??new L;t.notifier.queue.push(e),this.#a||this.wakeup(t)}addNodeUpdate(e){const t=this.#a??new L;t.nodeUpdator.queue.push(e),this.#a||this.wakeup(t)}static stack=[];static start(){this.stack.push(new O)}static get current(){return this.stack.at(-1)}static suspend(){this.stack.push(new O)}static resume(){this.stack.pop().stop()}}O.start();class B extends o{updateNode(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:n,indexes:o,filters:r}=this,a=i.applyForOutput(s[h](n,o),r);this.lastViewModelValue!==a&&(O.current.addNodeUpdate(new I(e,t,(()=>{e[t]=a}))),this.lastViewModelValue=a)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:n,indexes:o,filters:r}=this,a=i.applyForInput(e[t],r);s[u](n,o,a),this.lastViewModelValue=a}}class C extends o{get nodeProperty1(){return this.nodePropertyElements[0]}get nodeProperty2(){return this.nodePropertyElements[1]}updateNode(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:n,indexes:o,filters:r}=this,{nodeProperty1:a,nodeProperty2:l}=this,d=i.applyForOutput(s[h](n,o),r);this.lastViewModelValue!==d&&(O.current.addNodeUpdate(new I(e,t,(()=>{e[a][l]=d}))),this.lastViewModelValue=d)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:n,indexes:o,filters:r}=this,{nodeProperty1:a,nodeProperty2:l}=this,d=i.applyForInput(e[a][l],r);s[u](n,o,d),this.lastViewModelValue=d}}class S extends o{get nodeProperty1(){return this.nodePropertyElements[0]}get nodeProperty2(){return this.nodePropertyElements[1]}get nodeProperty3(){return this.nodePropertyElements[2]}updateNode(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:n,indexes:o,filters:r}=this,{nodeProperty1:a,nodeProperty2:l,nodeProperty3:d}=this,p=i.applyForOutput(s[h](n,o),r);this.lastViewModelValue!==p&&(O.current.addNodeUpdate(new I(e,t,(()=>{e[a][l][d]=p}))),this.lastViewModelValue=p)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:n,indexes:o,filters:r}=this,{nodeProperty1:a,nodeProperty2:l,nodeProperty3:d}=this,p=i.applyForInput(e[a][l][d],r);s[u](n,o,p),this.lastViewModelValue=p}}const k=e=>e instanceof HTMLElement?e:utils.raise("not HTMLElement");class j extends o{get className(){return this.nodePropertyElements[1]}updateNode(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:n,indexes:o,filters:r,className:a}=this,l=k(e),d=i.applyForOutput(s[h](n,o),r);this.lastViewModelValue!==d&&(O.current.addNodeUpdate(new I(e,t,(()=>{d?l.classList.add(a):l.classList.remove(a)}))),this.lastViewModelValue=d)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:n,indexes:o,filters:r,className:a}=this,l=k(e),d=i.applyForInput(l.classList.contains(a),r);s[u](n,o,d),this.lastViewModelValue=d}}const R=t=>t instanceof HTMLInputElement?t:e.raise();class $ extends o{updateNode(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:n,indexes:o,filters:r}=this,a=R(e),l=i.applyForOutput(s[h](n,o),r);this.lastViewModelValue!==l&&(O.current.addNodeUpdate(new I(e,t,(()=>{a.checked=l===a.value}))),this.lastViewModelValue=l)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:n,indexes:o,filters:r}=this,a=R(e),l=i.applyForInput(a.value,r);a.checked&&(s[u](n,o,l),this.lastViewModelValue=l)}}const F=t=>t instanceof HTMLInputElement?t:e.raise();class H extends o{updateNode(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:n,indexes:o,filters:r}=this,a=F(e),l=i.applyForOutput(s[h](n,o),r);this.lastViewModelValue!==l&&(Thread.current.addNodeUpdate(new NodeUpdateData(e,t,(()=>{a.checked=l.find((e=>e===a.value))}))),this.lastViewModelValue=l)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:n,indexes:o,filters:r}=bind,a=F(e),l=i.applyForInput(a.value,r),d=new Set(s[h](n,o));a.checked?d.add(l):d.delete(l);const p=Array.from(d);s[u](n,o,p),this.lastViewModelValue=p}}class A extends o{#l;get eventType(){return this.#l}set eventType(e){this.#l=e}addEventListener(){const{element:e,eventType:t,viewModel:s,viewModelProperty:n}=this;e.addEventListener(t,(e=>{const t=this.indexes,i=new V(s[m],s,[n,t,e]);O.current.addProcess(i)}))}}const D=new Map;D.set(1,((e,t)=>Object.assign(new B,e,t))),D.set(2,((e,t)=>Object.assign(new C,e,t))),D.set(3,((e,t)=>Object.assign(new S,e,t))),D.set(10,((e,t)=>Object.assign(new j,e,t))),D.set(20,((e,t)=>Object.assign(new $,e,t))),D.set(30,((e,t)=>Object.assign(new H,e,t))),D.set(90,((e,t)=>Object.assign(new P,e,t))),D.set(91,((e,t)=>Object.assign(new A,e,t)));class q{static create({node:e,nodeProperty:t,viewModel:s,viewModelProperty:n,filters:i,indexes:o}){const r={node:e,nodeProperty:t,viewModel:s,viewModelProperty:n,filters:i,indexes:o},a=N.getInfo(e,t);return D.get(a.type)(r,a)}}const U=class extends l{static bind(t,s,n){const i=(t=>t instanceof HTMLTemplateElement?t:e.raise("not HTMLTemplateElement"))(t),o=i.dataset.bind,r=E.parse(o,"").map((e=>{const i=q.create(Object.assign(e,{node:t,viewModel:s,indexes:n}));return i.updateNode(),i}));if(0===r.length)return[];const a=r[0];return"if"!==a.nodeProperty&&"loop"!==a.nodeProperty&&e.raise(`unknown node property ${a.nodeProperty}`),a.templateChildren=this.expand(a),a.appendToParent(),[a]}static expand(e){const{nodeProperty:t,viewModel:s,viewModelProperty:n,filters:o,indexes:r}=e,a=i.applyForOutput(s[h](n,r),o);if("if"===t){if(a)return[g.create(e,r)]}else if("loop"===t)return Array.from(Object.keys(a)).map((t=>g.create(e,r.concat(t))));return[]}},K="oninput",G=K.slice(2),_=class extends l{static bind(t,s,n){const i=(t=>t instanceof HTMLElement?t:e.raise("not HTMLElement"))(t),o=i.dataset.bind,r=(e=>e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLOptionElement?"value":e instanceof HTMLInputElement?"radio"===e.type||"checkbox"===e.type?"checked":"value":"textContent")(i),a=E.parse(o,r).map((e=>{const i=q.create(Object.assign(e,{node:t,viewModel:s,indexes:n}));return i.updateNode(),i}));let l=!1,d=null;return a.forEach((e=>{l||=e.nodeProperty===K,d=e.nodeProperty===r?e:d;const t=(e=>e instanceof A?e:void 0)(e);t&&t.addEventListener()})),d&&!l&&i.addEventListener(G,(e=>{const t=new V(d.updateViewModel,d,[]);O.current.addProcess(t)})),a}},z=class extends l{static bind(t,s,n){const i=(t=>t instanceof Comment?t:e.raise("not Comment"))(t),o=i.textContent.slice(2),r=document.createTextNode("");return i.parentNode.replaceChild(r,i),E.parse(o,"textContent").map((e=>{const t=q.create(Object.assign(e,{node:r,viewModel:s,indexes:n}));return t.updateNode(),t}))}},W=class{static bind(t,s,n,i=[]){return a.getTargetNodes(t,s).flatMap((t=>t instanceof HTMLTemplateElement?U.bind(t,n,i):t instanceof HTMLElement?_.bind(t,n,i):t instanceof Comment?z.bind(t,n,i):e.raise("unknown node type")))}},J=e=>e instanceof P?e:void 0;class Q{template;rootElement;constructor(e,t){this.template=e,this.rootElement=t}render(e){const t=document.importNode(this.template.content,!0),s=new class{binds;bindsByKey=new Map;constructor(e){this.binds=e,this.buildMap()}buildMap(){const e=t=>{t.forEach((t=>{this.bindsByKey.get(t.viewModelPropertyKey)?.push(t)??this.bindsByKey.set(t.viewModelPropertyKey,[t]),(J(t)?.templateChildren??[]).forEach((t=>e(t.binds)))}))};this.bindsByKey.clear(),e(this.binds)}getTemplateBinds(e){const t=[],s=[{binds:this.binds,children:null,index:-1}];for(;s.length>0;){const n=s[s.length-1];if(n.index++,n.binds)if(n.index<n.binds.length){const i=J(n.binds[n.index]);i&&(e.has(i.viewModelPropertyKey)?t.push(i):i.templateChildren.length>0&&s.push({binds:null,children:i.templateChildren,index:-1}))}else s.pop();else if(n.index<n.children.length){const e=n.children[n.index];e.binds.length>0&&s.push({binds:e.binds,children:null,index:-1})}else s.pop()}return t}updateViewModel(e){const t=this.getTemplateBinds(e);t.length>0&&(t.forEach((e=>e.expand())),this.buildMap());const s=t=>{t.forEach((t=>{e.has(t.viewModelPropertyKey)&&t.updateNode();const n=J(t);n&&n.templateChildren.forEach((e=>s(e.binds)))}))};s(this.binds)}}(W.bind(this.template,t,e));return this.rootElement.appendChild(t),s}}class X{name;elements;loopLevel;parentName;lastElement;regexp;isPrimitive;privateName;isObject;isLoop;isNotPrimitive;constructor(e){this.name=e,this.elements=e.split("."),this.loopLevel=this.elements.reduce(((e,t)=>e+("*"===t)?1:0),0),this.parentName=this.elements.slice(0,-1).join("."),this.lastElement=this.elements.at(-1)??null,this.regexp=this.loopLevel>0?new RegExp("^"+e.replaceAll("*","(\\w+)").replaceAll(".","\\.")+"$"):null,this.isPrimitive=1===this.elements.length&&0===this.loopLevel,this.privateName=this.isPrimitive?`_${e}`:null,this.isObject=this.elements.length>1&&0===this.loopLevel,this.isLoop=this.elements.length>1&&this.loopLevel>0,this.isNotPrimitive=!this.isPrimitive}primitiveGetter(e){return e[this.privateName]}primitiveSetter(e,t){return e[this.privateName]=t,!0}nonPrimitiveGetter(e){const{parentName:t,loopLevel:s,lastElement:n}=this,i="*"===n?e[p][s-1]:n;return e[t][i]}nonPrimitiveSetter(e,t){const{parentName:s,loopLevel:n,lastElement:i}=this,o="*"===i?e[p][n-1]:i;return e[s][o]=t,!0}createPropertyDescriptor(e){return{get:this.isPrimitive?()=>Reflect.apply(this.primitiveGetter,this,[e.viewModel]):()=>Reflect.apply(this.nonPrimitiveGetter,this,[e.viewModel]),set:this.isPrimitive?t=>Reflect.apply(this.primitiveSetter,this,[e.viewModel,t]):t=>Reflect.apply(this.nonPrimitiveSetter,this,[e.viewModel,t]),enumerable:!0,configurable:!0}}expand(e,t){if(this.loopLevel===t.length)return[t];if(this.loopLevel<t.length)return[t.slice(0,this.loopLevel)];{const s=(n,i,o)=>{const r=""!==n?n+".":n,a=this.elements[i],l=this.elements.length-1===i;return"*"===a?o.length<t.length?l?[t.slice(0,o.length+1)]:s(r+a,i+1,t.slice(0,o.length+1)):Array.from(Object.keys(e[h](n,o)??[])).map((e=>l?[o.concat(e)]:s(r+a,i+1,o.concat(e)))):l?[o]:s(r+a,i+1,o)};return s("",0,[])}}static#d=new Map;static create(e){let t=this.#d.get(e);return void 0===t&&(t=new X(e),this.#d.set(e,t)),t}}const Y=e=>"_"!==e[0],Z="$dependencyProps",ee=class{static convert(t,s){let n=new Map;if(Z in s){const e=Object.getOwnPropertyDescriptor(s,Z);e.enumerable=!1,Object.defineProperty(s,Z,e),n=function(e){const t=new Map;return e.forEach((([e,s])=>{s.forEach((s=>{t.get(s)?.push(e)??t.set(s,[e])}))})),t}(e.value)}for(const[e,t]of Object.entries(Object.getOwnPropertyDescriptors(s)))Y(e)||(t.enumerable=!1,Object.defineProperty(s,e,t));Object.keys(s).filter(Y).map((e=>X.create(e))).forEach((e=>{const n=s[e.name];delete s[e.name];const i=e.createPropertyDescriptor(t);if(Object.defineProperty(s,e.name,i),!(e.privateName in s)){const t={value:n,writable:!0,enumerable:!1,configurable:!0};Object.defineProperty(s,e.privateName,t)}}));for(const[t,n]of Object.entries(Object.getOwnPropertyDescriptors(Object.getPrototypeOf(s))))"constructor"!==t&&(e.isFunction(n.value)||(n.enumerable=!0,Object.defineProperty(s,t,n)));const i=Object.keys(s).map((e=>X.create(e)));return i.forEach((e=>{if(e.isPrimitive)return;if("*"===e.lastElement)return;const t=n.get(e.parentName)?.concat(e.name)??[e.name];n.set(e.parentName,t)})),{viewModel:s,definedProperties:i,dependentMap:n}}},te=new Set([...Array(8)].map(((e,t)=>`$${t+1}`)));class se{cache=new class{valueByIndexesByProp=new Map;get(e,t){return this.valueByIndexesByProp.get(e)?.get(t.toString())}set(e,t,s){let n=this.valueByIndexesByProp.get(e);void 0===n&&(n=new Map,this.valueByIndexesByProp.set(e,n)),n.set(t.toString(),s)}has(e,t){return this.valueByIndexesByProp.get(e)?.has(t.toString())??!1}delete(e,t){const s=t.toString();let n=this.valueByIndexesByProp.get(e);n&&(n.delete(s),0===n.size&&this.valueByIndexesByProp.delete(e));const i=s+",",o=Array.from(this.valueByIndexesByProp.keys()),r=e=>o.filter((t=>!t.isPrimitive&&t.parentName===e.name)).flatMap((e=>[e].concat(r(e))));r(e).forEach((e=>{const t=this.valueByIndexesByProp.get(e);for(const e of t.keys())(""===s||e===s||e.startsWith(i))&&t.delete(e);0===t.size&&this.valueByIndexesByProp.delete(e)}))}clear(){this.valueByIndexesByProp.clear()}};propertyInfoIndexesByProp=new Map;stackIndexes=[];component;definedPropertyByProp=new Map;loopProperties=[];dependentMap;constructor(e,t,s){this.component=e,this.definedPropertyByProp=new Map(t.map((e=>[e.name,e]))),this.loopProperties=t.filter((e=>e.isLoop)),this.dependentMap=s}get lastIndexes(){return this.stackIndexes[this.stackIndexes.length-1]??[]}async[y](e,t){if("$oninit"in e)return await Reflect.apply(e.$oninit,t,[])}[f](e,t,s,n){if("$onwrite"in s){const i=new V(s.$onwrite,n,[e,t]);O.current.addProcess(i)}}#p(e,t,s){const{lastIndexes:n,cache:i}=this,o=n.slice(0,t.loopLevel),r=i.get(t,o);if(void 0!==r)return r;const a=Reflect.get(e,t.name,s);return i.set(t,o,a),a}[h](e,t,s,n){let i;this.stackIndexes.push(t);try{i=n[e]}finally{this.stackIndexes.pop()}return i}#c(e,t,s,n){const{lastIndexes:i,cache:o}=this,r=i.slice(0,t.loopLevel);if(Reflect.set(e,t.name,s,n),o.delete(t,r),o.set(t,r,s),O.current.addNotify(new T(this.component,t.name,r)),this.dependentMap.has(t.name)){const e=t=>(this.dependentMap.get(t)??[]).flatMap((t=>[t].concat(e(t))));new Set(e(t.name)).forEach((e=>{const t=this.definedPropertyByProp.get(e);if(r.length<t.loopLevel)t.expand(n,r).forEach((e=>{o.delete(t,e),O.current.addNotify(new T(this.component,t.name,e))}));else{const e=r.slice(0,t.loopLevel);o.delete(t,e),O.current.addNotify(new T(this.component,t.name,e))}}))}return this[f](t.name,i,e,n),!0}[u](e,t,s,n,i){this.stackIndexes.push(t);try{i[e]=s}finally{this.stackIndexes.pop()}return!0}async[m](e,t,s,n,i){this.stackIndexes.push(t);try{await Reflect.apply(n[e],i,[s,...t])}finally{this.stackIndexes.pop()}}[w](e,t){this.cache.clear()}get(e,t,s){const n=this.lastIndexes;if("symbol"==typeof t)switch(t){case h:return(t,n)=>Reflect.apply(this[h],this,[t,n,e,s]);case u:return(t,n,i)=>Reflect.apply(this[u],this,[t,n,i,e,s]);case p:return n;case m:return(t,n,i)=>Reflect.apply(this[m],this,[t,n,i,e,s]);case y:return()=>Reflect.apply(this[y],this,[e,s]);case f:return(t,n)=>Reflect.apply(this[f],this,[t,n,e,s]);case w:return()=>Reflect.apply(this[w],this,[e,s]);case c:return e}if(te.has(t))return n[parseInt(t.slice(1))-1];const i=this.definedPropertyByProp.get(t);if(i)return this.#p(e,i,s);if("_"!==t[0]){let{loopProperty:n,indexes:i}=this.propertyInfoIndexesByProp.get(t)??{};if(null==n){let e;n=this.loopProperties.find((s=>e=s.regexp.exec(t))),i=e.slice(1),this.propertyInfoIndexesByProp.set(t,{loopProperty:n,indexes:i})}if(n&&i)return this[h](n.name,i,e,s)}return Reflect.get(e,t,s)}set(e,t,s,n){const i=this.definedPropertyByProp.get(t);if(i)return this.#c(e,i,s,n);if("_"!==t[0]){let{loopProperty:i,indexes:o}=this.propertyInfoIndexesByProp.get(t)??{};if(null==i){let e;i=this.loopProperties.find((s=>e=s.regexp.exec(t))),o=e.slice(1),this.propertyInfoIndexesByProp.set(t,{loopProperty:i,indexes:o})}if(i&&o)return this[u](i.name,o,s,e,n),!0}return Reflect.set(e,t,s,n),!0}}class ne extends HTMLElement{viewModel;view;binds;constructor(){super(),this.noShadowRoot||this.attachShadow({mode:"open"}),this.#h=new Promise(((e,t)=>{this.#u=e,this.#m=t}))}static get observedAttributes(){return[]}get noShadowRoot(){return this.hasAttribute("no-shadow-root")}get viewRootElement(){return this.shadowRoot??this}async build(){const t=ne.componentDataByName.get(this.tagName);t||e.raise(`unknown tag name ${this.tagName}`),this.view=new Q(t.template,this.viewRootElement);const s=Reflect.construct(t.ViewModel,[]);this.viewModel=function(e,t){const{viewModel:s,definedProperties:n,dependentMap:i}=ee.convert(e,t);return new Proxy(s,new se(e,n,i))}(this,s),await this.viewModel[y](),O.current.addProcess(new V((()=>{this.binds=this.view.render(this.viewModel)}),this,[]))}#h;#u;#m;get initialPromise(){return this.#h}#y;get parentComponent(){return void 0===this.#y&&(this.#y=(e=>{for(;;){if(null==(e=e.parentNode))return null;if(e instanceof ShadowRoot)return e.host;if(e instanceof ne)return e}})(this)),this.#y}async connectedCallback(){try{this.parentComponent&&await this.parentComponent.initialPromise,await this.build()}finally{this.#u&&this.#u()}}disconnectedCallback(){}adoptedCallback(){}attributeChangedCallback(e,t,s){}notify(e){this.binds.updateViewModel(e)}static componentDataByName=new Map;static regist(e,s){const n=e.toUpperCase();this.componentDataByName.set(n,Object.assign(new t,s)),customElements.define(e,class extends ne{})}}const ie=class{static#f;static#w=!0;static components(e){const t=this.#f;return Object.entries(e).forEach((([e,s])=>{const n=t?`${t}-${e}`:e;ne.regist(n,s)})),this}static prefix(e){return this.#f=e,this}static setDebug(e){return this.#w=e,this}static getDebug(){return this.#w}};window[d]=ie})();