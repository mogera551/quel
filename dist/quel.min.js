class e{static raise(e){throw e}static isFunction=e=>{const t=Object.prototype.toString.call(e).slice(8,-1).toLowerCase();return"function"===t||"asyncfunction"===t};static isInputableElement(e){return e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&"button"!==e.type}static toKebabCase=e=>"string"==typeof e?e.replaceAll(/_/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e}class t{static localeString=(e,t)=>null!=e?Number(e).toLocaleString():null;static fixed=(e,t)=>null!=e?Number(e).toFixed(t[0]??0):null;static styleDisplay=(e,t)=>e?t[0]??"":"none";static truthy=(e,t)=>!!e;static falsey=(e,t)=>!e;static not=this.falsey;static upperCase=(e,t)=>null!=e?String(e).toUpperCase():null;static lowerCase=(e,t)=>null!=e?String(e).toLowerCase():null;static eq=(e,t)=>e==t[0];static ne=(e,t)=>e!=t[0];static lt=(e,t)=>Number(e)<Number(t[0]);static le=(e,t)=>Number(e)<=Number(t[0]);static gt=(e,t)=>Number(e)>Number(t[0]);static ge=(e,t)=>Number(e)>=Number(t[0]);static embed=(e,t)=>null!=e?decodeURIComponent((t[0]??"").replaceAll("%s",e)):null;static ifText=(e,t)=>e?t[0]??null:t[1]??null;static null=(e,t)=>null==e}class s{static number=(e,t)=>""===e?null:Number(e);static boolean=(e,t)=>""===e?null:Boolean(e)}class n{name;options;static applyForInput(e,t){return t.reduceRight(((e,t)=>t.name in s?s[t.name](e,t.options):e),e)}static applyForOutput(e,s){return s.reduce(((e,s)=>s.name in t?t[s.name](e,s.options):e),e)}static regist(n,o,i){n in t&&e.raise(`regist filter error duplicate name (${n})`),n in s&&e.raise(`regist filter error duplicate name (${n})`),o&&(t[n]=o),i&&(s[n]=i)}}class o{#e;get node(){return this.#e}set node(e){this.#e=e}get element(){return this.node instanceof HTMLElement?this.node:e.raise("not HTMLElement")}#t;get nodeProperty(){return this.#t}set nodeProperty(e){this.#t=e}#s;get nodePropertyElements(){return this.#s}set nodePropertyElements(e){this.#s=e}component;viewModel;#n;get viewModelProperty(){return this.#n}set viewModelProperty(e){this.#n=e}filters;#o;get indexes(){return this.#o}set indexes(e){this.#o=e,this.#i=e.toString(),this.#r=this.viewModelProperty+"\t"+this.#i}#i;get indexesString(){return this.#i}#r;get viewModelPropertyKey(){return this.#r}contextIndexes;lastNodeValue;lastViewModelValue;updateNode(){}updateViewModel(){}changeIndexes(e,t){const{indexes:s,contextIndexes:n}=this;s[e]=s[e]+t,n[e]=n[e]+t,this.indexes=s}removeFromParent(){}}const i=e=>Array.from(e.childNodes).flatMap((e=>i(e).concat((e=>e instanceof Comment&&"@"===e.textContent[0]&&"@"===e.textContent[1]&&"@"!==e.textContent[2])(e)?e:null))).filter((e=>e));class r{static listOfRouteIndexesByTemplate=new Map;static getTargetNodes(e,t){let s;if(this.listOfRouteIndexesByTemplate.has(e)){s=this.listOfRouteIndexesByTemplate.get(e).map((e=>e.reduce(((e,t)=>e.childNodes[t]),t)))}else s=Array.from(t.querySelectorAll("[data-bind]")).concat(i(t)),this.listOfRouteIndexesByTemplate.set(e,s.map((e=>(e=>{let t=[];for(;null!=e.parentNode;)t=[Array.from(e.parentNode.childNodes).indexOf(e)].concat(t),e=e.parentNode;return t})(e))));return s}}class a{static bind(e,t,s){}}const l="quel",c=Symbol.for(`${l}:viewModel.indexes`),d=Symbol.for(`${l}:viewModel.target`),p=Symbol.for(`${l}:viewModel.dependentMap`),h=Symbol.for(`${l}:viewModel.directGet`),u=Symbol.for(`${l}:viewModel.directSet`),m=Symbol.for(`${l}:viewModel.directCall`),f=Symbol.for(`${l}:viewModel.init`),y=Symbol.for(`${l}:viewModel.connect`),g=Symbol.for(`${l}:viewModel.write`),P=Symbol.for(`${l}:viewModel.clearCache`),w=Symbol.for(`${l}:viewModel.notifyForDependentProps`),b=Symbol.for(`${l}:arrayHandler.isProxy`),v=Symbol.for(`${l}:arrayHandler.raw`),x=Symbol.for(`${l}:componentData.bindData`),M=Symbol.for(`${l}:componentData.bindProperty`);class N{binds;childNodes;fragment;get lastNode(){return this.childNodes[this.childNodes.length-1]}get nodesForAppend(){return this.fragment.childNodes.length>0?[this.fragment]:this.childNodes}get setOfNodes(){return new Set(this.childNodes)}removeFromParent(){this.childNodes.forEach((e=>e.parentNode?.removeChild(e))),this.binds.forEach((e=>e.removeFromParent()))}updateNode(){this.binds.forEach((e=>{e.updateNode()}))}changeIndex(e,t){this.binds.forEach((s=>s.changeIndexes(e,t)))}static create(e,t){const{component:s,template:n}=e,o=document.importNode(n.content,!0),i=Be.bind(n,o,s,t),r=Array.from(o.childNodes);return Object.assign(new N,{binds:i,childNodes:r,fragment:o})}}class C extends o{get node(){return super.node}set node(e){const t=(e=>e instanceof HTMLTemplateElement?e:utils.raise("not HTMLTemplateElement"))(e),s=document.createComment(`template ${t.dataset.bind}`);t.parentNode.replaceChild(s,t),super.node=s,this.template=t}templateChildren=[];#a;get template(){return this.#a}set template(e){this.#a=e}updateNode(){const e="loop"===this.nodeProperty?this.expandLoop():this.expandIf();this.lastViewModelValue=e instanceof Array?e.slice():e}removeFromParent(){this.templateChildren.forEach((e=>e.removeFromParent()))}appendToParent(){const e=document.createDocumentFragment();this.templateChildren.forEach((t=>e.appendChild(...t.nodesForAppend))),this.node.after(e)}expandIf(){const{viewModel:e,viewModelProperty:t,indexes:s,contextIndexes:o,filters:i}=this,r=this.lastViewModelValue,a=n.applyForOutput(e[h](t,s,o),i);return r!==a&&(this.removeFromParent(),a?(this.templateChildren=[N.create(this,o)],this.appendToParent()):this.templateChildren=[]),this.templateChildren.forEach((e=>e.updateNode())),a}expandLoop(){const{viewModel:e,viewModelProperty:t,indexes:s,contextIndexes:o,filters:i}=this,r=this.lastViewModelValue??[],a=n.applyForOutput(e[h](t,s,o),i)??[],l=r.reduce(((e,t,s)=>(e.get(t)?.push(s)??e.set(t,[s]),e)),new Map),c=new Map,d=[],p=a.map(((e,t)=>{const n=l.get(e);if(void 0===n)return c.set(t,void 0),d.push(t),N.create(this,s.concat(t));{const e=n.shift();c.set(t,e);const o=this.templateChildren[e];t!==e&&o.changeIndex(s.length,t-e);const i=c.get(t-1);return(void 0===i||i>e)&&d.push(t),o}}));for(const e of l.values())for(const t of e)this.templateChildren[t].removeFromParent();return d.forEach((e=>{const t=p[e];(p[e-1]?.lastNode??this.node).after(...t.nodesForAppend)})),p.forEach((e=>e.updateNode())),this.templateChildren=p,a}changeIndexes(e,t){this.indexes[e]=this.indexes[e]+t,this.templateChildren.forEach((s=>s.changeIndex(e,t)))}}class E{nodeProperty;viewModelProperty;filters}const S=e=>e.trim(),I=e=>e.length>0,T=e=>{const[t,...s]=e.split("|").map(S);return{viewModelProperty:t,filters:s.map((e=>(e=>{const[t,...s]=e.split(",").map(S);return Object.assign(new n,{name:t,options:s})})(e)))}},B=(e,t)=>e.split(";").map(S).filter(I).map((e=>{let{nodeProperty:s,viewModelProperty:n,filters:o}=((e,t)=>{const[s,n]=[t].concat(...e.split(":").map(S)).splice(-2),{viewModelProperty:o,filters:i}=T(n);return{nodeProperty:s,viewModelProperty:o,filters:i}})(e,"$");return n="@"===n?prop:n,s="$"===s?t:s,{nodeProperty:s,viewModelProperty:n,filters:o}}));class O{static bindTextsByKey=new Map;static parse(e,t){const s=e+"\t"+t;let n=this.bindTextsByKey.get(s);return void 0===n&&(n=B(e,t).map((e=>Object.assign(new E,e))),this.bindTextsByKey.set(s,n)),n}}const k=1,j=2,V=3,L=10,$=20,F=30,A=90,R=91,D=92;class H{static getInfo(t,s){const n={type:null,nodePropertyElements:[],eventType:null};return t instanceof HTMLTemplateElement?(n.type=A,n):(n.nodePropertyElements=s.split("."),t instanceof tt?(n.type=D,n):(1===n.nodePropertyElements.length?n.nodePropertyElements[0].startsWith("on")?(n.type=R,n.eventType=n.nodePropertyElements[0].slice("on".length)):"radio"===n.nodePropertyElements[0]?n.type=$:"checkbox"===n.nodePropertyElements[1]?n.type=F:n.type=k:2===n.nodePropertyElements.length?"className"===n.nodePropertyElements[0]?n.type=L:n.type=j:3===n.nodePropertyElements.length?n.type=V:e.raise(`unknown property ${s}`),n))}}class U{static binds=[];static globalBinds=[];static boundFromComponent(e){e.data[x](this.data)}static boundPropertyFromComponent(e,t,s){this.binds.push({globalProperty:e,component:t,componentProperty:s}),t.data[M](s,e)}static globalBoundFromComponent(e,t){this.globalBinds.push({component:e,globalProperty:t})}static create(){return new Proxy({},new class{set(e,t,s,n){return Reflect.set(e,t,s,n),U.binds.filter((e=>t===e.globalProperty)).forEach((e=>{const[t,s]=e.componentProperty.split(".");e.component.viewModel?.[w](`$data.${s}`,[])})),U.globalBinds.filter((e=>t===e.globalProperty)).forEach((e=>{e.component.viewModel?.[w](`$globals.${t}`,[])})),!0}})}static data=this.create()}const K={kebab:1,snake:2,upperCamel:3,lowerCamel:4},q={kebab:K.kebab,snake:K.snake,uppercamel:K.upperCamel,lowercamel:K.lowerCamel};class W{static getNames(t){const s=e.toKebabCase(t),n=s.replaceAll("-","_"),o=s.split("-").map(((e,t)=>(void 0!==e[0]&&(e=e[0].toUpperCase()+e.slice(1)),e))).join(""),i=o[0].toLowerCase()+o.slice(1);return{[K.kebab]:s,[K.snake]:n,[K.upperCamel]:o,[K.lowerCamel]:i}}}const _=0,G=1;class z{static replaceNames=W.getNames("component-name");static async load(t,s,n,o){const{replaceNames:i}=this,r="@"===t[0]?G:_,a="@"===t[0]?t.slice(1):t,l=e.toKebabCase(a),c=Object.entries(s).map((([e,t])=>({prefix:e,path:t}))).find((({prefix:e,path:t})=>a.startsWith(e+"-"))),d=c?l.slice(c.prefix.length+1):l,p=W.getNames(d),h=c?.path??o;let u=h;for(let e of Object.values(K))u=u.replaceAll(`{${i[e]}}`,p[e]);u===h&&(u+=("/"!==u.at(-1)?"/":"")+p[n]+".js");const m=location.pathname.split("/");m[m.length-1]=u;const f=location.origin+m.join("/");try{const e=await import(f);r===_?customElements.define(l,e.default):r===G&&tt.regist(l,e.default)}catch(e){console.log(`can't load component { registTagName:${l}, fullPath:${f} }`),console.error(e)}}}class Z{static async load(e,t){let s=t;s+=("/"!==s.at(-1)?"/":"")+e+".js";const o=location.pathname.split("/");o[o.length-1]=s;const i=location.origin+o.join("/");try{const t=await import(i),{output:s,input:o}=t.default;n.regist(e,s,o)}catch(t){console.log(`can't load filter { filterName:${e}, fullPath:${i} }`),console.error(t)}}}const J="./",Q="lowercamel";class X{static#l={debug:!1,loadComponent:!1,defaultComponentNameType:Q,defaultComponentPath:J,customTag:[],customTagPrefix:{},loadCustomFilter:!1,customFilterPath:J,customFilter:[]};static components(t){return Object.entries(t).forEach((([t,s])=>{const n=e.toKebabCase(t);customElements.define(n,s)})),this}static componentsData(t){return Object.entries(t).forEach((([t,s])=>{const n=e.toKebabCase(t),o=tt.getClass(s);customElements.define(n,o)})),this}static filters(e){return Object.entries(e).forEach((([e,t])=>{const{input:s,output:o}=t;n.regist(e,o,s)})),this}static async load(...e){const{loadComponent:t,defaultComponentNameType:s,defaultComponentPath:n,customTag:o,customTagPrefix:i}=this.#l;if(t){const t=q[s.toLowerCase()];for(const s of e)await z.load(s,i,t,n)}return this}static globals(e){Object.assign(U.data,e)}static config({debug:e=!1,loadComponent:t=!1,defaultComponentNameType:s=Q,defaultComponentPath:n=J,customTag:o=[],customTagPrefix:i={},loadCustomFilter:r=!1,customFilterPath:a=J,customFilter:l=[]}){return this.#l=Object.assign(this.#l,{debug:e}),r&&(this.#l=Object.assign(this.#l,{loadCustomFilter:r,customFilterPath:a,customFilter:l})),t&&(this.#l=Object.assign(this.#l,{loadComponent:t,defaultComponentNameType:s,defaultComponentPath:n,customTag:o,customTagPrefix:i})),this}static async boot(){const{loadComponent:e,defaultComponentNameType:t,defaultComponentPath:s,customTag:n,customTagPrefix:o,loadCustomFilter:i,customFilterPath:r,customFilter:a}=this.#l;if(i)for(let e of a)await Z.load(e,r);if(e){const e=q[t.toLowerCase()];for(let t of n)await z.load(t,o,e,s)}}static get debug(){return this.#l.debug}}var Y=X;class ee{component;name;#o;get indexes(){return this.#o}set indexes(e){this.#o=e,this.#i=e.toString(),this.#c=this.name+"\t"+this.#i}#i;get indexesString(){return this.#i}#c;get key(){return this.#c}constructor(e,t,s){this.component=e,this.name=t,this.indexes=s}}const te=e=>e.key;class se{queue=[];#d;constructor(e){this.#d=e}async exec(){this.#d&&this.#d(ie.beginNotify);try{for(;this.queue.length>0;){const e=this.queue.splice(0).reduce(((e,t)=>(e.get(t.component)?.push(t)??e.set(t.component,[t]),e)),new Map);for(const[t,s]of e.entries()){const e=new Set(s.map(te));t.notify(e)}}}finally{this.#d&&this.#d(ie.endNotify)}}get isEmpty(){return 0===this.queue.length}}class ne{target;thisArgument;argumentsList;constructor(e,t,s){this.target=e,this.thisArgument=t,this.argumentsList=s}}class oe{queue=[];#d;constructor(e){this.#d=e}async exec(){this.#d&&this.#d(ie.beginProcess);try{for(;this.queue.length>0;){const e=this.queue.splice(0);for(const t of e)await Reflect.apply(t.target,t.thisArgument,t.argumentsList)}}finally{this.#d&&this.#d(ie.endProcess)}}get isEmpty(){return 0===this.queue.length}}const ie={beginProcess:1,endProcess:2,beginNotify:3,endNotify:4,beginNodeUpdate:5,endNodeUpdate:6};class re{#p;#h;#u;#m;#f;#y;#g;constructor(e=null,t=null){this.#p=new oe(t),this.#h=new se(t),this.#u=new ce(t),this.#m=e,this.#f=new Promise(((e,t)=>{this.#y=e,this.#g=t}))}resolve(){this.#y&&this.#y(),this.#y=null}reject(){this.#g&&this.#g(),this.#g=null}async waiting(){return this.#f}async exec(){do{await this.#p.exec(),await this.#h.exec(),await this.#u.exec()}while(!this.#p.isEmpty||!this.#h.isEmpty||!this.#u.isEmpty)}addProcess(e){this.#p.queue.push(e),this.resolve()}addNotify(e){this.#h.queue.push(e),this.resolve()}addNodeUpdate(e){this.#u.add(e),this.resolve()}callback(){this.#m&&this.#m()}static create(e,t){return new re(e,t)}}class ae{#y;#g;constructor(){this.main()}async#P(){return new Promise(((e,t)=>{this.#y=e,this.#g=t}))}stop(){this.#g()}wakeup(e){this.#y(e)}async main(){for(;;)try{const e=await this.#P();await e.waiting(),Y.debug&&performance.mark("slot-exec:start");try{await e.exec(),Y.debug&&(performance.mark("slot-exec:end"),performance.measure("slot-exec","slot-exec:start","slot-exec:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures(),performance.clearMarks())}finally{e.callback()}}catch(e){if(void 0!==e&&(console.error(e),!confirm("致命的なエラーが発生しました。続行しますか？")))break}}}class le{node;property;viewModelProperty;value;updateFunc;constructor(e,t,s,n,o){this.node=e,this.property=t,this.viewModelProperty=s,this.value=n,this.updateFunc=o}}class ce{queue=[];#d;constructor(e){this.#d=e}nodeUpdateDataByPropertyByNode=new Map;add(e){let t=this.nodeUpdateDataByPropertyByNode.get(e.node);null==t&&(t=new Map,this.nodeUpdateDataByPropertyByNode.set(e.node,t)),t.set(e.property,e)}reorder(e){return e.sort(((e,t)=>t.node instanceof HTMLTemplateElement||e.node instanceof HTMLSelectElement&&"value"===e.property?1:-1)),e}async exec(){this.#d&&this.#d(ie.beginNodeUpdate);try{for(;this.nodeUpdateDataByPropertyByNode.size>0;){const e=Array.from(this.nodeUpdateDataByPropertyByNode.entries()).flatMap((([e,t])=>Array.from(t.entries()).map((([e,t])=>t))));this.nodeUpdateDataByPropertyByNode.clear();this.reorder(e.splice(0)).forEach((e=>Reflect.apply(e.updateFunc,e,[])))}}finally{this.#d&&this.#d(ie.endNodeUpdate)}}get isEmpty(){return 0===this.queue.length}}class de extends o{updateNode(){const{component:e,node:t,nodeProperty:s,viewModel:o,viewModelProperty:i,indexes:r,contextIndexes:a,filters:l}=this,c=n.applyForOutput(o[h](i,r,a),l);this.lastViewModelValue!==c&&(e.updateSlot.addNodeUpdate(new le(t,s,i,c,(()=>{t[s]=c??""}))),this.lastViewModelValue=c)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:o,indexes:i,filters:r}=this,a=n.applyForInput(e[t],r);s[u](o,i,a),this.lastViewModelValue=a}}class pe extends o{get nodeProperty1(){return this.nodePropertyElements[0]}get nodeProperty2(){return this.nodePropertyElements[1]}updateNode(){const{component:e,node:t,nodeProperty:s,viewModel:o,viewModelProperty:i,indexes:r,contextIndexes:a,filters:l}=this,{nodeProperty1:c,nodeProperty2:d}=this,p=n.applyForOutput(o[h](i,r,a),l);this.lastViewModelValue!==p&&(e.updateSlot.addNodeUpdate(new le(t,s,i,p,(()=>{t[c][d]=p??""}))),this.lastViewModelValue=p)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:o,indexes:i,filters:r}=this,{nodeProperty1:a,nodeProperty2:l}=this,c=n.applyForInput(e[a][l],r);s[u](o,i,c),this.lastViewModelValue=c}}class he extends o{get nodeProperty1(){return this.nodePropertyElements[0]}get nodeProperty2(){return this.nodePropertyElements[1]}get nodeProperty3(){return this.nodePropertyElements[2]}updateNode(){const{component:e,node:t,nodeProperty:s,viewModel:o,viewModelProperty:i,indexes:r,contextIndexes:a,filters:l}=this,{nodeProperty1:c,nodeProperty2:d,nodeProperty3:p}=this,u=n.applyForOutput(o[h](i,r,a),l);this.lastViewModelValue!==u&&(e.updateSlot.addNodeUpdate(new le(t,s,i,u,(()=>{t[c][d][p]=u??""}))),this.lastViewModelValue=u)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:o,indexes:i,filters:r}=this,{nodeProperty1:a,nodeProperty2:l,nodeProperty3:c}=this,d=n.applyForInput(e[a][l][c],r);s[u](o,i,d),this.lastViewModelValue=d}}const ue=e=>e instanceof HTMLElement?e:utils.raise("not HTMLElement");class me extends o{get className(){return this.nodePropertyElements[1]}updateNode(){const{component:e,node:t,nodeProperty:s,viewModel:o,viewModelProperty:i,indexes:r,contextIndexes:a,filters:l,className:c}=this,d=ue(t),p=n.applyForOutput(o[h](i,r,a),l);this.lastViewModelValue!==p&&(e.updateSlot.addNodeUpdate(new le(t,s,i,p,(()=>{p?d.classList.add(c):d.classList.remove(c)}))),this.lastViewModelValue=p)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:o,indexes:i,filters:r,className:a}=this,l=ue(e),c=n.applyForInput(l.classList.contains(a),r);s[u](o,i,c),this.lastViewModelValue=c}}const fe=t=>t instanceof HTMLInputElement?t:e.raise();class ye extends o{updateNode(){const{component:e,node:t,nodeProperty:s,viewModel:o,viewModelProperty:i,indexes:r,contextIndexes:a,filters:l}=this,c=fe(t),d=n.applyForOutput(o[h](i,a,r),l);this.lastViewModelValue!==d&&(e.updateSlot.addNodeUpdate(new le(t,s,i,d,(()=>{c.checked=d===c.value}))),this.lastViewModelValue=d)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:o,indexes:i,filters:r}=this,a=fe(e),l=n.applyForInput(a.value,r);a.checked&&(s[u](o,i,l),this.lastViewModelValue=l)}}const ge=t=>t instanceof HTMLInputElement?t:e.raise();class Pe extends o{updateNode(){const{component:e,node:t,nodeProperty:s,viewModel:o,viewModelProperty:i,indexes:r,contextIndexes:a,filters:l}=this,c=ge(t),d=n.applyForOutput(o[h](i,r,a),l);this.lastViewModelValue!==d&&(e.updateSlot.addNodeUpdate(new le(t,s,i,d,(()=>{c.checked=d.find((e=>e===c.value))}))),this.lastViewModelValue=d)}updateViewModel(){const{node:e,nodeProperty:t,viewModel:s,viewModelProperty:o,indexes:i,contextIndexes:r,filters:a}=bind,l=ge(e),c=n.applyForInput(l.value,a),d=new Set(s[h](o,i,r));l.checked?d.add(c):d.delete(c);const p=Array.from(d);s[u](o,i,p),this.lastViewModelValue=p}}class we extends o{#w;get eventType(){return this.#w}set eventType(e){this.#w=e}addEventListener(){const{component:e,element:t,eventType:s,viewModel:n,viewModelProperty:o}=this;t.addEventListener(s,(t=>{t.stopPropagation();const s=this.contextIndexes,i=new ne(n[m],n,[o,s,t]);e.updateSlot.addProcess(i)}))}}class be{name;elements;loopLevel;parentName;lastElement;regexp;isPrimitive;privateName;isObject;isLoop;isNotPrimitive;constructor(e){this.name=e,this.elements=e.split("."),this.loopLevel=this.elements.reduce(((e,t)=>e+("*"===t?1:0)),0),this.parentName=this.elements.slice(0,-1).join("."),this.lastElement=this.elements.at(-1)??null,this.regexp=this.loopLevel>0?new RegExp("^"+e.replaceAll("*","(\\w+)").replaceAll(".","\\.")+"$"):null,this.isPrimitive=1===this.elements.length&&0===this.loopLevel,this.privateName=this.isPrimitive?"_"+e:null,this.isObject=this.elements.length>1&&0===this.loopLevel,this.isLoop=this.elements.length>1&&this.loopLevel>0,this.isNotPrimitive=!this.isPrimitive}get parentProperty(){return be.create(this.parentName)}primitiveGetter(e){return e[this.privateName]}primitiveSetter(e,t){return e[this.privateName]=t,!0}nonPrimitiveGetter(e){const{parentName:t,loopLevel:s,lastElement:n}=this,o="*"===n?e[c][s-1]:n;return e[t][o]}nonPrimitiveSetter(e,t){const{parentName:s,loopLevel:n,lastElement:o}=this,i="*"===o?e[c][n-1]:o;return e[s][i]=t,!0}createPropertyDescriptor(e){return{get:this.isPrimitive?()=>Reflect.apply(this.primitiveGetter,this,[e.viewModel]):()=>Reflect.apply(this.nonPrimitiveGetter,this,[e.viewModel]),set:this.isPrimitive?t=>Reflect.apply(this.primitiveSetter,this,[e.viewModel,t]):t=>Reflect.apply(this.nonPrimitiveSetter,this,[e.viewModel,t]),enumerable:!0,configurable:!0}}expand(e,t){if(this.loopLevel===t.length)return[t];if(this.loopLevel<t.length)return[t.slice(0,this.loopLevel)];{const s=(n,o,i)=>{const r=""!==n?n+".":n,a=this.elements[o],l=this.elements.length-1===o;let c;return c="*"===a?i.length<t.length?l?[t.slice(0,i.length+1)]:s(r+a,o+1,t.slice(0,i.length+1)):(e[h](n,i,void 0)??[]).flatMap(((e,t)=>l?[i.concat(t)]:s(r+a,o+1,i.concat(t)))):l?[i]:s(r+a,o+1,i),c};return s("",0,[])}}static#b=new Map;static create(e){if(""===e)return;let t=this.#b.get(e);return void 0===t&&(t=new be(e),this.#b.set(e,t)),t}}const ve=e=>e instanceof tt?e:void 0;class xe extends o{get node(){return super.node}set node(e){super.node=e,this.bindData()}get viewModelProperty(){return super.viewModelProperty}set viewModelProperty(e){super.viewModelProperty=e,this.viewModelProperty&&this.nodePropertyElements&&this.bindProperty()}get nodePropertyElements(){return super.nodePropertyElements}set nodePropertyElements(e){super.nodePropertyElements=e,this.viewModelProperty&&this.nodePropertyElements&&this.bindProperty()}get dataNameProperty(){return this.nodePropertyElements[0]}get dataProperty(){return this.nodePropertyElements[1]}bindData(){const e=ve(this.node);e?.data[x](e)}bindProperty(){const e=ve(this.node);e?.data[M](this.dataProperty,this.viewModelProperty,this.indexes)}updateNode(){const{node:e,dataProperty:t}=this,s=ve(e);s.viewModel?.[w](`$data.${t}`,[])}updateViewModel(){}}const Me=new Map;Me.set(k,((e,t)=>Object.assign(new de,e,t))),Me.set(j,((e,t)=>Object.assign(new pe,e,t))),Me.set(V,((e,t)=>Object.assign(new he,e,t))),Me.set(L,((e,t)=>Object.assign(new me,e,t))),Me.set($,((e,t)=>Object.assign(new ye,e,t))),Me.set(F,((e,t)=>Object.assign(new Pe,e,t))),Me.set(A,((e,t)=>Object.assign(new C,e,t))),Me.set(R,((e,t)=>Object.assign(new we,e,t))),Me.set(D,((e,t)=>Object.assign(new xe,e,t)));class Ne{static create({component:e,node:t,nodeProperty:s,viewModel:n,viewModelProperty:o,filters:i,indexes:r}){const a={component:e,node:t,nodeProperty:s,viewModel:n,viewModelProperty:o,filters:i},l=be.create(o);a.indexes=r.slice(0,l.loopLevel),a.contextIndexes=r;const c=H.getInfo(t,s);return Me.get(c.type)(a,c)}}class Ce extends a{static bind(t,s,n){const o=s.viewModel,i=(t=>t instanceof HTMLTemplateElement?t:e.raise("not HTMLTemplateElement"))(t),r=i.dataset.bind,a=O.parse(r,"").map((e=>Ne.create(Object.assign(e,{node:t,component:s,viewModel:o,indexes:n.slice()}))));if(0===a.length)return[];const l=(e=>e instanceof C?e:void 0)(a[0]);if(l)return"if"!==l.nodeProperty&&"loop"!==l.nodeProperty&&e.raise(`unknown node property ${l.nodeProperty}`),l.updateNode(),[l];e.raise("not template bind")}}const Ee="oninput",Se=Ee.slice(2);class Ie extends a{static bind(t,s,n){const o=s.viewModel,i=(t=>t instanceof HTMLElement?t:e.raise("not HTMLElement"))(t),r=i.dataset.bind,a=(e=>e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLOptionElement?"value":e instanceof HTMLInputElement?"radio"===e.type||"checkbox"===e.type?"checked":"value":"textContent")(i),l=O.parse(r,a).map((e=>{const i=Ne.create(Object.assign(e,{node:t,component:s,viewModel:o,indexes:n.slice()}));return i.updateNode(),i}));let c=!1,d=null;return l.forEach((e=>{c||=e.nodeProperty===Ee,d=e.nodeProperty===a?e:d;const t=(e=>e instanceof we?e:void 0)(e);t&&t.addEventListener()})),d&&!c&&i.addEventListener(Se,(e=>{e.stopPropagation();const t=new ne(d.updateViewModel,d,[]);s.updateSlot.addProcess(t)})),l}}class Te extends a{static bind(t,s,n){const o=s.viewModel,i=(t=>t instanceof Comment?t:e.raise("not Comment"))(t),r=i.textContent.slice(2),a=document.createTextNode("");i.parentNode.replaceChild(a,i);return O.parse(r,"textContent").map((e=>{const t=Ne.create(Object.assign(e,{node:a,component:s,viewModel:o,indexes:n.slice()}));return t.updateNode(),t}))}}class Be{static bind(t,s,n,o=[]){return r.getTargetNodes(t,s).flatMap((t=>t instanceof HTMLTemplateElement?Ce.bind(t,n,o):t instanceof HTMLElement?Ie.bind(t,n,o):t instanceof Comment?Te.bind(t,n,o):e.raise("unknown node type")))}}const Oe=e=>e instanceof C?e:void 0;class ke{#v;#x=new Map;constructor(e){this.#v=e,this.buildMap()}buildMap(){const e=t=>{t.forEach((t=>{this.#x.get(t.viewModelPropertyKey)?.push(t)??this.#x.set(t.viewModelPropertyKey,[t]),(Oe(t)?.templateChildren??[]).forEach((t=>e(t.binds)))}))};this.#x.clear(),e(this.#v)}getTemplateBinds(e){const t=[],s=[{binds:this.#v,children:null,index:-1}];for(;s.length>0;){const n=s[s.length-1];if(n.index++,n.binds)if(n.index<n.binds.length){const o=Oe(n.binds[n.index]);o&&(e.has(o.viewModelPropertyKey)?t.push(o):o.templateChildren.length>0&&s.push({binds:null,children:o.templateChildren,index:-1}))}else s.pop();else if(n.index<n.children.length){const e=n.children[n.index];e.binds.length>0&&s.push({binds:e.binds,children:null,index:-1})}else s.pop()}return t}updateViewModel(e){const t=new Set(this.getTemplateBinds(e));if(t.size>0){for(const e of t)e.updateNode();this.buildMap()}const s=n=>{n.forEach((n=>{!t.has(n)&&e.has(n.viewModelPropertyKey)&&n.updateNode(),Oe(n)?.templateChildren.forEach((e=>s(e.binds)))}))};s(this.#v)}}class je{template;rootElement;constructor(e,t){this.template=e,this.rootElement=t}render(e){const t=document.importNode(this.template.content,!0),s=new ke(Be.bind(this.template,t,e));return this.rootElement.appendChild(t),s}}const Ve=e=>"_"!==e[0],Le="$dependentProps";class $e{static convert(t,s){let n=new Map;if(Le in s){const e=Object.getOwnPropertyDescriptor(s,Le);e.enumerable=!1,Object.defineProperty(s,Le,e),n=function(e){const t=new Map;return Object.entries(e).forEach((([e,s])=>{s.forEach((s=>{t.get(s)?.push(e)??t.set(s,[e])}))})),t}(e.value)}for(const[e,t]of Object.entries(Object.getOwnPropertyDescriptors(s)))Ve(e)||(t.enumerable=!1,Object.defineProperty(s,e,t));Object.keys(s).filter(Ve).map((e=>be.create(e))).forEach((e=>{const n=s[e.name];delete s[e.name];const o=e.createPropertyDescriptor(t);if(Object.defineProperty(s,e.name,o),!(e.privateName in s)){const t={value:n,writable:!0,enumerable:!1,configurable:!0};Object.defineProperty(s,e.privateName,t)}}));const o=[];for(const[t,n]of Object.entries(Object.getOwnPropertyDescriptors(Object.getPrototypeOf(s))))"constructor"!==t&&(e.isFunction(n.value)||(n.enumerable=!0,Object.defineProperty(s,t,n),o.push(t)));const i=Object.keys(s).map((e=>be.create(e)));return i.forEach((e=>{if(e.isPrimitive)return;const t=n.get(e.parentName)?.concat(e.name)??[e.name];n.set(e.parentName,t)})),{viewModel:s,definedProperties:i,dependentMap:n,cachablePropertyNames:o}}}class Fe{dirty=!1;value;constructor(e){this.value=e}}class Ae{#M=new Map;#N;#C;#E;constructor(e){this.#N=e,this.#C=e.filter((e=>""!==e.parentName)).reduce(((e,t)=>(e.get(t.parentName)?.push(t)??e.set(t.parentName,[t]),e)),new Map);const t=(e,s)=>((this.#C.get(s)??[]).forEach((s=>{e.push(s),t(e,s.name)})),e);this.#E=new Map(e.map((e=>[e.name,t(new Array,e.name)])))}get(e,t){const s=this.#M.get(e)?.get(t.toString());return s?s.dirty?void 0:s.value:void 0}set(e,t,s){let n=this.#M.get(e);void 0===n&&(n=new Map,this.#M.set(e,n)),n.set(t.toString(),new Fe(s))}has(e,t){const s=this.#M.get(e)?.get(t.toString());return!!s&&!s.dirty}delete(e,t){const s=t.slice(0,e.loopLevel).toString(),n=s+",";let o=this.#M.get(e);if(o)for(const e of o.keys())(""===s||e===s||e.startsWith(n))&&(o.get(e).dirty=!0);(this.#E.get(e.name)??[]).forEach((e=>{const t=this.#M.get(e);if(void 0!==t)for(const e of t.keys())(""===s||e===s||e.startsWith(n))&&(t.get(e).dirty=!0)}))}clear(){this.#M.clear()}}class Re{#S;#I;#o;constructor(e,t,s){this.#S=e,this.#I=t,this.#o=s}get(e,t,s){return t===b||(t===v?e:Reflect.get(e,t,s))}set(e,t,s,n){if(Reflect.set(e,t,s,n),"length"===t){const t=this.#S,s=t.viewModel,n=this.#I.name;t.updateSlot.addProcess(new ne((()=>{s[n]=e}),s,[]))}return!0}}class De{static create(e){return new Proxy(U.data,new class{component;constructor(e){this.component=e}setOfBindParams=new Set;boundFromComponent(e){U.globalBoundFromComponent(this.component,e),this.setOfBindParams.add(e)}get(e,t,s){return this.setOfBindParams.has(t)||this.boundFromComponent(t),Reflect.get(e,t,e)}set(e,t,s,n){return this.setOfBindParams.has(t)||this.boundFromComponent(t),Reflect.set(e,t,s,e),!0}}(e))}}const He=[...Array(8)].map(((e,t)=>"$"+(t+1))),Ue=new Set(He),Ke="$component",qe="$data",We="$openDialog",_e="$closeDialog",Ge="$notify",ze="$globals",Ze=[Ke,qe,We,_e,Ge,ze],Je=new Set(He.concat(Ze)),Qe=(e,t,s,n)=>(n=n?.[b]?n[v]:n)instanceof Array?function(e,t,s,n){return new Proxy(e,new Re(t,s,n))}(n,e,t,s):n;let Xe=class{cache;propertyInfoAndIndexesByProp=new Map;stackIndexes=[];component;definedPropertyByProp=new Map;loopProperties=[];dependentMap;setOfDependentPropNamesByPropName=new Map;cachablePropertyNames=[];setOfCachablePropertyNames=new Set;globals;constructor(e,t,s,n){this.component=e,this.definedPropertyByProp=new Map(t.map((e=>[e.name,e]))),this.loopProperties=t.filter((e=>e.isLoop)),this.dependentMap=s,this.cachablePropertyNames=n,this.setOfCachablePropertyNames=new Set(n),this.cache=new Ae(t);const o=(e,t)=>((s.get(t)??[]).forEach((t=>{e.has(t)||(e.add(t),o(e,t))})),e);this.setOfDependentPropNamesByPropName=new Map(Array.from(s.keys()).map((e=>[e,o(new Set,e)]))),this.globals=De.create(e)}get lastIndexes(){return this.stackIndexes[this.stackIndexes.length-1]??[]}async[f](e,t){if("$oninit"in e)return await Reflect.apply(e.$oninit,t,[])}async[y](e,t){if("$onconnect"in e)return await Reflect.apply(e.$onconnect,t,[])}[g](e,t,s,n){if("$onwrite"in s){const{component:o}=this,i=new ne(s.$onwrite,n,[e,t]);o.updateSlot.addProcess(i)}}#T(e,t,s){const{component:n,lastIndexes:o,cache:i,setOfCachablePropertyNames:r}=this,a=o.slice(0,t.loopLevel);let l;if(r.has(t.name)){const n=i.get(t,a);void 0===n?(l=Reflect.get(e,t.name,s),i.set(t,a,l)):l=n}else l=Reflect.get(e,t.name,s);return Qe(n,t,a,l)}[h](e,t,s,n,o){let i;if(Ue.has(e))return s[Number(e.slice(1))-1];this.stackIndexes.push(t);try{i=o[e]}finally{this.stackIndexes.pop()}return i}[w](e,t,s,n){const{dependentMap:o,setOfDependentPropNamesByPropName:i,component:r}=this;if(o.has(e)){(i.get(e)??new Set).forEach((e=>{if(e.startsWith("$data"))r.updateSlot.addNotify(new ee(r,e,[]));else{const s=be.create(e);if(t.length<s.loopLevel){s.expand(n,t).forEach((e=>{r.updateSlot.addNotify(new ee(r,s.name,e))}))}else{const e=t.slice(0,s.loopLevel);r.updateSlot.addNotify(new ee(r,s.name,e))}}}))}}#B(e,t,s,n){const{component:o,lastIndexes:i,cache:r}=this;s=s?.[b]?s[v]:s;const a=i.slice(0,t.loopLevel);return Reflect.set(e,t.name,s,n),o.updateSlot.addNotify(new ee(o,t.name,a)),this[w](t.name,a,e,n),this[g](t.name,i,e,n),!0}[u](e,t,s,n,o){this.stackIndexes.push(t);try{o[e]=s}finally{this.stackIndexes.pop()}return!0}async[m](e,t,s,n,o){this.stackIndexes.push(t);try{await Reflect.apply(n[e],o,[s,...t])}finally{this.stackIndexes.pop()}}[P](e,t){this.cache.clear()}#O(e){let{loopProperty:t,indexes:s}=this.propertyInfoAndIndexesByProp.get(e)??{};if(void 0===t)for(const n of this.loopProperties){const o=n.regexp.exec(e);if(o){s=o.slice(1).map(Number),t=n,this.propertyInfoAndIndexesByProp.set(e,{loopProperty:t,indexes:s});break}}return{loopProperty:t,indexes:s}}get(t,s,n){if("symbol"==typeof s){const{lastIndexes:e,dependentMap:o}=this;switch(s){case h:return(e,s,o)=>Reflect.apply(this[h],this,[e,s,o,t,n]);case u:return(e,s,o)=>Reflect.apply(this[u],this,[e,s,o,t,n]);case c:return e;case m:return(e,s,o)=>Reflect.apply(this[m],this,[e,s,o,t,n]);case f:return()=>Reflect.apply(this[f],this,[t,n]);case g:return(e,s)=>Reflect.apply(this[g],this,[e,s,t,n]);case y:return()=>Reflect.apply(this[y],this,[t,n]);case P:return()=>Reflect.apply(this[P],this,[t,n]);case w:return(e,s)=>Reflect.apply(this[w],this,[e,s,t,n]);case d:return t;case p:return o}}if(Je.has(s)){const{lastIndexes:t,component:n}=this;if(Ue.has(s))return t[Number(s.slice(1))-1];switch(s){case Ke:return n;case qe:return n.data;case We:return async(t,s,n)=>{const o=e.toKebabCase(t),i=document.createElement(o);return Object.entries(n??{}).forEach((([e,t])=>{i.setAttribute(e,t)})),i.data[x](s??{}),document.body.appendChild(i),i.alivePromise};case _e:return e=>{Object.assign(n.data,e),n.parentNode.removeChild(n)};case Ge:return(e,t)=>{n.updateSlot.addNotify(new ee(n,e,t))};case ze:return this.globals}}const o=this.definedPropertyByProp.get(s);if(o)return this.#T(t,o,n);if("@"===s[0]){const e=s.slice(1),o=this.definedPropertyByProp.get(e);if(o)return o.expand(n,[]).map((s=>[this[h](e,s,void 0,t,n),s]))}if("_"!==s[0]){const{loopProperty:e,indexes:o}=this.#O(s);if(e&&o)return this[h](e.name,o,void 0,t,n)}return Reflect.get(t,s,n)}set(e,t,s,n){const o=this.definedPropertyByProp.get(t);if(o)return this.#B(e,o,s,n);if("@"===t[0]){const o=t.slice(1),i=this.definedPropertyByProp.get(o);if(i)return i.expand(n,[]).forEach((t=>{this[u](o,t,s,e,n)})),!0}if("_"!==t[0]){const{loopProperty:o,indexes:i}=this.#O(t);if(o&&i)return this[u](o.name,i,s,e,n),!0}return Reflect.set(e,t,s,n),!0}};function Ye(e,t){let s=0;return e.replaceAll("*",(()=>t[s++]??"*"))}class et{#k={};#S;#j=new Map;get data(){return(this.#S?this.#S?.parentComponent?.viewModel:this.#k)??{}}[x](e){e instanceof tt?this.#S=e:this.#k=e}[M](e,t,s){this.#j.set(e,{bindProp:t,bindIndexes:s})}get(e,t,s){if(t===x)return e=>Reflect.apply(this[x],this,[e]);if(t===M)return(e,t,s)=>Reflect.apply(this[M],this,[e,t,s]);const{data:n}=this,{bindProp:o,bindIndexes:i}=this.#j.get(t)??{bindProp:t,bindIndexes:[]},r=Ye(o,i);return Reflect.get(n,r,n)}set(e,t,s,n){const{data:o}=this,{bindProp:i,bindIndexes:r}=this.#j.get(t)??{bindProp:t,bindIndexes:[]},a=Ye(i,r);return Reflect.set(o,a,s,o)}}class tt extends HTMLElement{static html;static template;static ViewModel;viewModel;#V;#v;#L;#$;get updateSlot(){return void 0===this.#$&&(this.#$=re.create((()=>{this.#$=void 0}),(e=>{e===ie.beginProcess&&this.viewModel[P](),e===ie.beginNotify&&this.viewModel[P]()})),this.#L.wakeup(this.#$)),this.#$}#k=function(){return new Proxy({},new et)}();get data(){return this.#k}constructor(){super(),this.#F=new Promise(((e,t)=>{this.#A=e,this.#R=t}))}static get observedAttributes(){return[]}get noShadowRoot(){return this.hasAttribute("no-shadow-root")}get viewRootElement(){return this.shadowRoot??this}async build(){const{template:e,ViewModel:t}=this.constructor;this.noShadowRoot||this.attachShadow({mode:"open"}),this.#L=new ae,this.#V=new je(e,this.viewRootElement);const s=Reflect.construct(t,[]);this.viewModel=function(e,t){const{viewModel:s,definedProperties:n,dependentMap:o,cachablePropertyNames:i}=$e.convert(e,t);return new Proxy(s,new Xe(e,n,o,i))}(this,s),await this.viewModel[f](),this.updateSlot.addProcess(new ne((async()=>{this.#v=this.#V.render(this),await this.viewModel[y]()}),this,[]))}#F;#A;#R;get initialPromise(){return this.#F}#D;#H;#U;get alivePromise(){return this.#D}#K;get parentComponent(){return void 0===this.#K&&(this.#K=(e=>{for(;;){if(null==(e=e.parentNode))return null;if(e instanceof tt)return e;if(e instanceof ShadowRoot){if(e.host instanceof tt)return e.host;e=e.host}}})(this)),this.#K}bindGlobalData(e){const t=O.parse(e,"");t.length>0&&(U.boundFromComponent(this),t.forEach((({nodeProperty:e,viewModelProperty:t})=>{U.boundPropertyFromComponent(t,this,e)})))}async connectedCallback(){try{this.parentComponent?await this.parentComponent.initialPromise:this.bindGlobalData(this.dataset.bind??""),this.#D=new Promise(((e,t)=>{this.#H=e,this.#U=t})),await this.build()}finally{this.#A&&this.#A()}}disconnectedCallback(){this.#H&&this.#H(this.data)}adoptedCallback(){}attributeChangedCallback(e,t,s){}notify(e){this.#v?.updateViewModel(e)}static getClass(e){const t=((e,t)=>{const s=document.createElement("template");return s.innerHTML=(t?`<style>\n${t}\n</style>`:"")+(e?(e=>{const t=[];return e.replaceAll(/\{\{([^\}]+)\}\}/g,((e,s)=>(s=s.trim()).startsWith("loop:")||s.startsWith("if:")?(t.push(s),`<template data-bind="${s}">`):s.startsWith("else:")?`</template><template data-bind="${t.at(-1)}|not">`:s.startsWith("end:")?(t.pop(),"</template>"):`\x3c!--@@${s}--\x3e`))})(e):""),s})(e.html,e.css);return class extends tt{static template=t;static ViewModel=e.ViewModel}}}function st(e){return tt.getClass(e)}class nt{static regist(e,t){}}class ot{static toKebabCase=e=>"string"==typeof e?e.replaceAll(/[\._]/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e}const it="kebab",rt="snake",at="uppercamel",lt="lowercamel";class ct{static getNames(e){const t=ot.toKebabCase(e),s=t.replaceAll("-","_"),n=t.split("-").map(((e,t)=>(void 0!==e[0]&&(e=e[0].toUpperCase()+e.slice(1)),e))).join(""),o=n.length>0?n[0].toLowerCase()+n.slice(1):n;return{[it]:t,[rt]:s,[at]:n,[lt]:o}}}const dt=lt;class pt{defaultNameType=dt;defaultPath="./";loadNames=[];prefixMap}const ht=ct.getNames("prefix-name"),ut=ct.getNames("sub-name");class mt{static getPathInfo(e,t,s,n){const[o,i]=e.split("#");let r=o,a=i;const l=ct.getNames(t),c=ct.getNames(s);return r=r.replaceAll(`{${ht[it]}}`,l[it]),r=r.replaceAll(`{${ht[rt]}}`,l[rt]),r=r.replaceAll(`{${ht[lt]}}`,l[lt]),r=r.replaceAll(`{${ht[at]}}`,l[at]),r=r.replaceAll(`{${ut[it]}}`,c[it]),r=r.replaceAll(`{${ut[rt]}}`,c[rt]),r=r.replaceAll(`{${ut[lt]}}`,c[lt]),r=r.replaceAll(`{${ut[at]}}`,c[at]),o===r&&".js"!==r.slice(-3)&&(r=r+("/"!==e.slice(-1)?"/":"")+c[n]+".js"),a&&(a=a.replaceAll(`{${ut[it]}}`,c[it]),a=a.replaceAll(`{${ut[rt]}}`,c[rt]),a=a.replaceAll(`{${ut[lt]}}`,c[lt]),a=a.replaceAll(`{${ut[at]}}`,c[at])),{filePath:r,exportName:a}}}class ft{prefix;path;get matchPrefix(){return`${this.prefix}-`}isMatch(e){return e.startsWith(this.matchPrefix)}getNames(e){const{prefix:t,path:s}=this;if(e.startsWith(this.matchPrefix)){return{prefixName:t,subName:e.slice(this.matchPrefix.length),path:s}}}}class yt{#q;#l;#W;#_;#G;constructor(e){this.#_=e,this.#G=window.location,this.setConfig(new pt)}setConfig(e){this.#l=Object.assign(new pt,e),"prefixMap"in e&&void 0!==e.prefixMap&&this.setPrefixMap(e.prefixMap)}getConfig(){return this.#l}setPrefixMap(e){this.#W=new Map(Object.entries(e).map((([e,t])=>[e=ot.toKebabCase(e),Object.assign(new ft,{prefix:e,path:t})])))}getPrefixMap(){return this.#W}configFile(e){return this.#q=e,this}config(e){return this.setConfig(e),this}prefixMap(e){return this.setPrefixMap(e),this}get registrar(){return this.#_}async loadConfig(e){const t=this.#G.pathname.split("/");t[t.length-1]=e;const s=this.#G.origin+t.join("/");try{const e=await fetch(s),t=await e.json();return Object.assign(new pt,t)}catch(e){throw new Error(e)}}async load(...e){if(void 0!==this.#q){const e=await this.loadConfig(this.#q);this.setConfig(e)}if(void 0===this.#W)throw new Error("prefixMap is not defined");if(void 0===this.#_)throw new Error("registrar is not defined");const t=Array.from(this.#W.values()),{defaultNameType:s,defaultPath:n}=this.#l;e=e.length>0?e:this.#l.loadNames;for(let o of e){let e;o=ot.toKebabCase(o);const i=t.find((e=>e.isMatch(o)));if(void 0!==i){const t=i.getNames(o);e=mt.getPathInfo(t.path,t.prefixName,t.subName,s)}if(void 0===e&&void 0!==n&&(e=mt.getPathInfo(n,"",o,s)),void 0===e)throw new Error(`unmatch prefix and no defaultPath (loadName:${o})`);const r=this.#G.pathname.split("/");r[r.length-1]=e.filePath;const a=this.#G.origin+r.join("/");let l,c;try{l=await import(a)}catch(e){throw new Error(e)}if(void 0!==e.exportName){if(!(e.exportName in l))throw new Error(`${e.exportName} not found in module (exportName:${e.exportName}, ${e.filePath})`);c=l[e.exportName]}else c=l.default;this.#_.regist(o,c)}return this}static create(e){return new yt(e)}}const gt=yt.create(class extends nt{static regist(e,t){if(e.startsWith("filter-")){const s=e.slice("filter-".length),{output:o,input:i}=t;n.regist(s,o,i)}else{const s=e;t instanceof HTMLElement?window.customElements.define(s,t):window.customElements.define(s,tt.getClass(t))}}});export{st as createComponentClass,X as default,gt as loader};
