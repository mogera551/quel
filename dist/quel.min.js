const e="quel",t="*",s="dot-notation",n={directlyGet:Symbol.for(s+".direct_get"),directlySet:Symbol.for(s+".direct_set"),isSupportDotNotation:Symbol.for(s+".is_support_dot_notation")},i=new RegExp(/^\$([0-9]+)$/);class r{#e;get name(){return this.#e}#t;get pathNames(){return this.#t}#s;get parentPathNames(){return this.#s}#n;get parentPath(){return this.#n}#i;get parentPaths(){return this.#i}#r;get setOfParentPaths(){return this.#r}#o;get lastPathName(){return this.#o}#a;get regexp(){return this.#a}#l;get level(){return this.#l}#c;get isPrimitive(){return this.#c}#d;get nearestWildcardName(){return this.#d}#p;get nearestWildcardParentName(){return this.#p}constructor(e){if(this.#e=e,this.#t=e.split("."),this.#s=this.#t.slice(0,-1),this.#i=this.#s.reduce(((e,t)=>(e.push(e.at(-1)?.concat(t)??[t]),e)),[]).map((e=>e.join("."))),this.#r=new Set(this.#i),this.#n=this.#s.join("."),this.#o=this.#t.at(-1),this.#a=new RegExp("^"+e.replaceAll(".","\\.").replaceAll("*","([0-9a-zA-Z_]*)")+"$"),this.#l=this.#t.reduce(((e,s)=>e+(s===t?1:0)),0),this.#c=1===this.#t.length,this.#d=void 0,this.#p=void 0,this.#l>0)for(let e=this.#t.length-1;e>=0;e--)if(this.#t[e]===t){this.#d=this.#t.slice(0,e+1).join("."),this.#p=this.#t.slice(0,e).join(".");break}}static create(e){const t=this.#h.get(e);if(void 0!==t)return t;const s=new r(e);return this.#h.set(e,s),s}static#h=new Map;static get propertyNameByName(){return this.#h}static parse(e){const t=[],s=[];for(const n of e.split(".")){const e=Number(n);isNaN(e)?s.push(n):(t.push(e),s.push("*"))}return{propName:r.create(s.join(".")),indexes:t}}}const o={[n.directlyGet]:(e,t,s)=>(n,i)=>Reflect.apply(e.directlyGet,e,[t,{prop:n,indexes:i},s]),[n.directlySet]:(e,t,s)=>(n,i,r)=>Reflect.apply(e.directlySet,e,[t,{prop:n,indexes:i,value:r},s]),[n.isSupportDotNotation]:(e,t,s)=>!0};let a=class{#u=[];#m=new Map;get lastIndexes(){return this.#u[this.#u.length-1]}get stackIndexes(){return this.#u}get matchByName(){return this.#m}getByPropertyName(e,{propName:s},n){const i=Reflect.get(e,s.name,n);if(void 0!==i)return i;if(""!==s.parentPath){const i=r.create(s.parentPath),o=this.getByPropertyName(e,{propName:i},n);if(void 0!==o){return o[s.lastPathName===t?this.lastIndexes[s.level-1]:s.lastPathName]}}}setByPropertyName(e,{propName:s,value:n},i){let o=!1;if(Reflect.has(e,s.name)||s.isPrimitive)o=Reflect.set(e,s.name,n,i);else{const a=r.create(s.parentPath),l=this.getByPropertyName(e,{propName:a},i);if(void 0!==l){l[s.lastPathName===t?this.lastIndexes[s.level-1]:s.lastPathName]=n,o=!0}}return o}#f(e,t){this.#u.push(e);try{return Reflect.apply(t,this,[])}finally{this.#u.pop()}}#g=(e,t)=>({propName:s,indexes:n})=>this.#f(n,(()=>this.getByPropertyName(e,{propName:s},t)));#y=(e,t)=>({propName:s,indexes:n},i)=>this.#f(n,(()=>this.setByPropertyName(e,{propName:s,value:i},t)));#b(e,{propName:t,indexes:s},n){const i=this.#g(e,n);if(void 0===t.nearestWildcardName)throw new Error(`not found wildcard path of '${t.name}'`);const o=r.create(t.nearestWildcardParentName);return i({propName:o,indexes:s}).map(((e,n)=>i({propName:t,indexes:s.concat(n)})))}#v(e,{propName:t,indexes:s,values:n},i){const o=this.#g(e,i),a=this.#y(e,i);if(void 0===t.nearestWildcardName)throw new Error(`not found wildcard path of '${t.name}'`);const l=r.create(t.nearestWildcardParentName),c=o({propName:l,indexes:s}),d=Array.isArray(n)?n:[...Array(c.length)].map((e=>n));if(t.nearestWildcardName===t.name)a({propName:l,indexes:s},d);else{if(d.length!==c.length)throw new Error(`not match array count '${t.name}'`);for(let e in c)a({propName:t,indexes:s.concat(Number(e))},d[e])}return!0}directlyGet(e,{prop:t,indexes:s},n){const i=r.create(t);return this.#f(s,(()=>this.getByPropertyName(e,{propName:i},n)))}directlySet(e,{prop:t,indexes:s,value:n},i){const o=r.create(t);return this.#f(s,(()=>this.setByPropertyName(e,{propName:o,value:n},i)))}get(e,t,s){const n="string"==typeof t;if(n&&(t.startsWith("@@__")||"constructor"===t))return Reflect.get(e,t,s);const a=o[t];if(void 0!==a)return a(this,e,s);const l=this.#g(e,s),c=this.lastIndexes;let d;if(n){if("$"===t[0]&&(d=i.exec(t)))return c?.[Number(d[1])-1]??void 0;if("@"===t[0]){const n=t.slice(1),i=r.create(n);if((c?.length??0)+1<i.level)throw new Error("array level not match");const o=c?.slice(0,i.level-1)??[];return this.#b(e,{propName:i,indexes:o},s)}if(void 0!==this.#m.get(t))return l(this.#m.get(t));{const e=r.parse(t);return e.propName.level===e.indexes.length?(this.#m.set(t,e),l(e)):l({propName:e.propName,indexes:e.indexes.concat(c?.slice(e.indexes.length)??[])})}}return Reflect.get(e,t,s)}set(e,t,s,n){if("string"==typeof t){if(t.startsWith("@@__")||"constructor"===t)return Reflect.set(e,t,s,n);const i=this.#y(e,n),o=this.lastIndexes;if("@"===t.at(0)){const i=t.slice(1),o=r.create(i);if((this.lastIndexes?.length??0)+1<o.level)throw new Error("array level not match");const a=this.lastIndexes?.slice(0,o.level-1)??[];return this.#v(e,{propName:o,indexes:a,values:s},n)}if(this.#m.has(t))return i(this.#m.get(t),s);const a=r.parse(t);return a.propName.level===a.indexes.length?(this.#m.set(t,a),i(a,s)):i({propName:a.propName,indexes:a.indexes.concat(o?.slice(a.indexes.length)??[])},s)}return Reflect.set(e,t,s,n)}};const l=Object.assign({connectedCallback:Symbol.for(`${e}:viewModel.connectedCallback`),disconnectedCallback:Symbol.for(`${e}:viewModel.disconnectedCallback`),writeCallback:Symbol.for(`${e}:viewModel.writeCallback`),updatedCallback:Symbol.for(`${e}:viewModel.updatedCallback`),getDependentProps:Symbol.for(`${e}:viewModel.getDependentProps`),clearCache:Symbol.for(`${e}:viewModel.clearCache`),directlyCall:Symbol.for(`${e}:viewModel.directCall`),notifyForDependentProps:Symbol.for(`${e}:viewModel.notifyForDependentProps`),createBuffer:Symbol.for(`${e}:viewModel.createBuffer`),flushBuffer:Symbol.for(`${e}:viewModel.flushBuffer`),boundByComponent:Symbol.for(`${e}:globalData.boundByComponent`),bindTo:Symbol.for(`${e}:componentModule.bindTo`),bindProperty:Symbol.for(`${e}:props.bindProperty`),setBuffer:Symbol.for(`${e}:props.setBuffer`),getBuffer:Symbol.for(`${e}:props.getBuffer`),clearBuffer:Symbol.for(`${e}:props.clearBuffer`),createBuffer:Symbol.for(`${e}:props.createBuffer`),flushBuffer:Symbol.for(`${e}:props.flushBuffer`),toObject:Symbol.for(`${e}:props.toObject`),propInitialize:Symbol.for(`${e}:props.initialize`),isComponent:Symbol.for(`${e}:component.isComponent`),nullSafe:Symbol.for(`${e}:filter.nullSafe`),noNullSafe:Symbol.for(`${e}:filter.noNullSafe`)},n),c={debug:!1,useShadowRoot:!1,useKeyed:!0,useWebComponent:!0,useLocalTagName:!0,useLocalSelector:!0,useOverscrollBehavior:!0};class d{static raise(e){throw new Error(e)}static toKebabCase=e=>"string"==typeof e?e.replaceAll(/_/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e;static createUUID(){return window?.crypto?.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=((new Date).getTime()+16*Math.random())%16|0;return("x"==e?t:3&t|8).toString(16)}))}}const p="data-bind",h="data-uuid",u=new Map;function m(e){return u.get(e)}function f(e,t,s){const n=document.createElement("template");return n.innerHTML=e?function(e,t,s){const n=[],i=e.replaceAll(/\{\{([^\}]+)\}\}/g,((e,t)=>{if((t=t.trim()).startsWith("loop:")||t.startsWith("if:"))return n.push(t),`<template data-bind="${t}">`;if(t.startsWith("else:")){const e=n.at(-1);return void 0!==e&&e.startsWith("if:")||d.raise(`Template: endif: is not matched with if:, but {{ ${t} }} `),`</template><template data-bind="${e}|not">`}if(t.startsWith("end:"))return void 0===n.pop()&&d.raise(`Template: end: is not matched with loop: or if:, but {{ ${t} }} `),"</template>";if(t.startsWith("endif:")){const e=n.pop();return void 0!==e&&e.startsWith("if:")||d.raise(`Template: endif: is not matched with if:, but {{ ${e} }} `),"</template>"}if(t.startsWith("endloop:")){const e=n.pop();return void 0!==e&&e.startsWith("loop:")||d.raise(`Template: endloop: is not matched with loop:, but {{ ${e} }} `),"</template>"}return`\x3c!--@@:${t}--\x3e`}));n.length>0&&d.raise(`Template: loop: or if: is not matched with endloop: or endif:, but {{ ${n.at(-1)} }} `);const r=document.createElement("template");r.innerHTML=i;const o=s.map((e=>d.toKebabCase(e))),a=e=>{for(const s of o){const n=Array.from(e.querySelectorAll(s));for(const e of n){const n=document.createElement(`${s}-${t}`);if(e.hasAttributes){for(const t of e.attributes)n.setAttribute(t.name,t.value);n.setAttribute("data-orig-tag-name",s)}e.parentNode.replaceChild(n,e)}const i=Array.from(e.querySelectorAll(`[is="${s}"]`));for(const e of i){const n=document.createElement(e.tagName,{is:`${s}-${t}`});if(e.hasAttributes){for(const t of e.attributes)"is"!==t.name&&n.setAttribute(t.name,t.value);n.setAttribute("data-orig-is",s)}e.parentNode.replaceChild(n,e)}}const s=Array.from(e.querySelectorAll("template"));for(const e of s)a(e.content)};o.length>0&&a(r.content);const l=e=>{let t;for(;t=e.querySelector("template");){const e=d.createUUID(),s=document.createComment(`@@|${e}`);if(t.parentNode.replaceChild(s,t),t.constructor!==HTMLTemplateElement){const e=document.createElement("template");for(let s of Array.from(t.childNodes))e.content.appendChild(s);e.setAttribute(p,t.getAttribute(p)),t=e}t.setAttribute(h,e),l(t.content),u.set(e,t)}};return l(r.content),r.innerHTML}(e,t,s):"",n}const g=new Map;function y(e,t){const s=g.get(t);if(s)return s;const n=function(e){const t=new CSSStyleSheet;return t.replaceSync(e),t}(e);return g.set(t,n),n}class b{#w=d.createUUID();get uuid(){return this.#w}html="";css;get template(){const e=this.config.useLocalTagName??c.useLocalTagName?Object.keys(this.componentModules??{}):[];return f(this.html,this.uuid,e)}get styleSheet(){return this.css?y(this.css,this.uuid):void 0}ViewModel=class{};config={};moduleConfig={};options={};filters={};componentModules;get componentModulesForRegister(){if((this.config.useLocalTagName??c.useLocalTagName)&&void 0!==this.componentModules){const e={};for(const[t,s]of Object.entries(this.componentModules))e[`${d.toKebabCase(t)}-${this.uuid}`]=s;return e}return this.componentModules}}const v=e=>{const t=e.id;return e.parentComponent?.popoverContextIndexesById?.get(t)},w=(e,t)=>{let s;const n=new r(t.name);return n.level>0&&0===t.indexes.length&&e.component.hasAttribute("popover")&&(s=v(e.component)?.slice(0,n.level)),s??t.indexes};let x=class{#x;#N;#P=[];constructor(e){this.#x=e}get component(){return this.#x}get buffer(){return this.#N}get binds(){return this.#P}#S(e,t){Object.defineProperty(this.#x.baseViewModel,e,{get:((e,t,s)=>function(){if(void 0!==e.buffer)return e.buffer[t];if(0===e.binds.length)return e.component.getAttribute(`props:${t}`);{const t=i.exec(s.name);if(t){const n=Number(t[1])-1;let i=s.loopContext.indexes;return 0===i.length&&e.component.hasAttribute("popover")&&(i=v(e.component)??[]),i[n]}{const t=w(e,s);return e.component.parentComponent.readOnlyViewModel[l.directlyGet](s.name,t)}}})(this,e,t),set:((e,t,s)=>function(n){if(void 0!==e.buffer){e.buffer[t]=n;const s=new CustomEvent("changeprops");s.propName=t,s.propValue=n,e.component.dispatchEvent(s)}else if(0===e.binds.length)e.component.setAttribute(`props:${t}`,n);else{const t=w(e,s);e.component.parentComponent.writableViewModel[l.directlySet](s.name,t,n)}return!0})(this,e,t),configurable:!0,enumerable:!0}),void 0!==t&&this.#P.push({prop:e,propAccess:t})}#B(e){this.#N=e;for(const t in e)this.#S(t),this.#x.viewModel[l.notifyForDependentProps](t,[])}#C(){return this.#N}#M(){this.#N=void 0}#E(){let e;return e=this.#x.parentComponent.readOnlyViewModel[l.createBuffer](this.#x),void 0!==e||(e={},this.#P.forEach((({prop:t,propAccess:s})=>{const n=w(this,s);e[t]=this.#x.parentComponent.readOnlyViewModel[l.directlyGet](s.name,n)}))),e}#O(){if(void 0!==this.#N){!0!==this.#x.parentComponent.writableViewModel[l.flushBuffer](this.#N,this.#x)&&this.#P.forEach((({prop:e,propAccess:t})=>{const s=w(this,t);this.#x.parentComponent.writableViewModel[l.directlySet](t.name,s,this.#N[e])}))}}get(e,t,s){return t===l.bindProperty?(e,t)=>this.#S(e,t):t===l.setBuffer?e=>this.#B(e):t===l.getBuffer?()=>this.#C():t===l.clearBuffer?()=>this.#M():t===l.createBuffer?()=>this.#E():t===l.flushBuffer?()=>this.#O():this.#x.viewModel[t]}set(e,t,s,n){return this.#x.viewModel[t]=s,!0}ownKeys(e,t){return void 0!==this.buffer?Reflect.ownKeys(this.buffer):0===this.binds.length?Array.from(this.component.attributes).filter((e=>e.name.startsWith("props:"))).map((e=>e.name.slice(6))):this.#P.map((({prop:e})=>e))}getOwnPropertyDescriptor(e,t,s){return{enumerable:!0,configurable:!0}}};class N extends a{#$=new Map;get(e,t,s){return t===l.boundByComponent?(e,t)=>{let s=this.#$.get(t);null==s?this.#$.set(t,new Set([e])):s.add(e)}:super.get(e,t,s)}set(e,t,s,n){const{propName:i,indexes:o}=r.parse(t),a=n[l.directlySet](i.name,o,s);let c=this.#$.get(i.name);if(c)for(const e of c)e.viewModel[l.notifyForDependentProps]("$globals."+i.name,o);return a}}class P{static create(){return new Proxy({},new N)}static data=this.create()}class S{#x;setOfProps=new Set;constructor(e){this.#x=e}bindProperty(e){P.data[l.boundByComponent](this.#x,e),this.setOfProps.add(e)}directGet=(e,t)=>(this.setOfProps.has(e)||this.bindProperty(e),P.data[l.directlyGet](e,t));directSet=(e,t,s)=>(this.setOfProps.has(e)||this.bindProperty(e),P.data[l.directlySet](e,t,s));get(e,t,s){if(t===l.directlyGet)return this.directGet;if(t===l.directlySet)return this.directSet;if(t===l.isSupportDotNotation)return!0;const{propName:n,indexes:i}=r.parse(t);return this.directGet(n.name,i)}set(e,t,s,n){const{propName:i,indexes:o}=r.parse(t);return this.directSet(i.name,o,s)}}class B extends Error{}class C{#T;#A=!0;get alive(){return this.#A}constructor(){this.main()}async#_(){return this.#T=Promise.withResolvers(),this.#T.promise}stop(){this.#T.reject(new B("stop"))}wakeup(e){this.#T.resolve(e)}async main(){for(;;)try{const e=await this.#_();await e.waitPromises.promise,c.debug&&performance.mark("slot-exec:start");try{await e.exec(),c.debug&&(performance.mark("slot-exec:end"),performance.measure("slot-exec","slot-exec:start","slot-exec:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures(),performance.clearMarks())}finally{e.callback()}}catch(e){if(e instanceof B)break;if(console.error(e),!confirm("致命的なエラーが発生しました。続行しますか？"))break}this.#A=!1}}class M{target;thisArgument;argumentsList;constructor(e,t,s){this.target=e,this.thisArgument=t,this.argumentsList=s}}class E{queue=[];updatedProps=[];#x;constructor(e){this.#x=e}async exec(){for(;this.queue.length>0;){const e=this.queue;this.queue=[];for(const t of e)await Reflect.apply(t.target,t.thisArgument,t.argumentsList)}for(;this.updatedProps.length>0;){const e=this.updatedProps;this.updatedProps=[];const t=e.map((e=>[e.propName.name,e.indexes]));this.#x.writableViewModel[l.updatedCallback](t)}}get isEmpty(){return 0===this.queue.length}}class O extends a{#x;get component(){return this.#x}#k;get dependentProps(){return this.#k}#I;get setOfAccessorProperties(){return this.#I}constructor(e,t,s){super(),this.#x=e,this.#I=t,this.#k=s}addProcess(e,t,s){this.#x.updateSlot?.addProcess(new M(e,t,s))}addNotify(e,t,s){this.#x.updateSlot?.addNotify(t),this.#x.updateSlot?.addUpdatedProps(Object.assign({},t))}static makeNotifyForDependentProps(e,t,s=new Set([])){const{propName:n,indexes:i}=t,o=n.name+"\t"+i.toString();if(s.has(o))return[];s.add(o);const a=e[l.getDependentProps]().setOfPropsByRefProp.get(n.name),c=[];if(void 0===a)return[];for(const t of a){const n=r.create(t);if(i.length<n.level){const t=O.expandIndexes(e,{propName:n,indexes:i});c.push(...t.map((e=>({propName:n,indexes:e}))))}else{const e=i.slice(0,n.level);c.push({propName:n,indexes:e})}c.push(...this.makeNotifyForDependentProps(e,{propName:n,indexes:i},s))}return c}static expandIndexes(e,t){const{propName:s,indexes:n}=t;if(s.level===n.length)return[n];if(s.level<n.length)return[n.slice(0,s.level)];{const t=(i,r,o)=>{const a=""!==i?i+".":i,c=s.pathNames[r],d=s.pathNames.length-1===r,p=a+c;let h;return h=d?"*"===c?e[l.directlyGet](i,o).flatMap(((e,t)=>[o.concat(t)])):[o]:"*"===c?o.length<n.length?t(p,r+1,n.slice(0,o.length+1)):e[l.directlyGet](i,o).flatMap(((e,s)=>t(p,r+1,o.concat(s)))):t(p,r+1,o),h};return t("",0,[])}}}function $(){return this.propName.name+"\t"+this.indexes.toString()}class T{queue=[];#x;constructor(e){this.#x=e}async exec(){for(;this.queue.length>0;){const e=this.queue;this.queue=[];const t=[];for(const s of e)t.push(...O.makeNotifyForDependentProps(this.#x.viewModel,s));const s=new Map(e.concat(t).map((e=>[$.apply(e),e])));this.#x.updateNode(s)}}get isEmpty(){return 0===this.queue.length}}const A=0,_=1,k=2,I=100;class L{#L;get viewModelUpdator(){return this.#L}#F;get nodeUpdator(){return this.#F}#D;#R;get waitPromises(){return this.#R}#V;get alivePromises(){return this.#V}#j;#W=A;get phase(){return this.#W}set phase(e){const t=this.#W;this.#W=e,void 0!==this.#j&&this.#j(e,t)}constructor(e,t=null,s=null){this.#L=new E(e),this.#F=new T(e),this.#D=t,this.#j=s,this.#R=Promise.withResolvers(),this.#V=Promise.withResolvers()}get isEmpty(){return this.#L.isEmpty&&this.#F.isEmpty}async exec(){do{this.phase=_,await this.#L.exec(),this.phase=k,await this.#F.exec()}while(!this.#L.isEmpty||!this.#F.isEmpty);this.phase=I,this.#V.resolve()}addProcess(e){this.#L.queue.push(e),this.#R.resolve(!0)}addNotify(e){this.#F.queue.push(e),this.#R.resolve(!0)}callback(){this.#D&&this.#D()}static create(e,t,s){return new L(e,t,s)}addUpdatedProps(e){this.#L.updatedProps.push(e)}}const F=new Set(["articles","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]);const D="Selector",R=(e,t)=>e.childNodes[t],V=e=>t=>t.reduce(R,e),j=e=>Array.from(e.childNodes).flatMap((e=>j(e).concat((e=>e instanceof Comment&&(e.textContent.startsWith("@@:")||e.textContent.startsWith("@@|")))(e)?e:null))).filter((e=>e)),W=new Map;function H(e,t){void 0===e&&d.raise(`${D}: template is undefined`),void 0===t&&d.raise(`${D}: rootElement is undefined`);const s=W.get(e);if(void 0!==s){const n=((e,t)=>s=>({template:t,routeIndexes:s,node:V(e)(s)}))(t,e);return s.map(n)}{const s=Array.from(t.querySelectorAll("[data-bind]")).concat(j(t)),{selectedNodes:n,listOfRouteIndexes:i}=s.reduce((({selectedNodes:t,listOfRouteIndexes:s},n)=>{const i=(e=>{let t=[];for(;null!==e.parentNode;)t=[Array.from(e.parentNode.childNodes).indexOf(e)].concat(t),e=e.parentNode;return t})(n);return t.push({node:n,routeIndexes:i,template:e}),s.push(i),{selectedNodes:t,listOfRouteIndexes:s}}),{selectedNodes:[],listOfRouteIndexes:[]});return W.set(e,i),n}}const U={ObjectClass:Object,prefix:"object",prefixShort:"o",prototypeFuncs:new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),staticFuncs:new Set(["create","defineProperties","defineProperty","entries","fromEntries","getOwnPropertyDescriptor","getOwnPropertyDescriptors","getOwnPropertyNames","getOwnPropertySymbols","getPrototypeOf","is","isExtensible","isFrozen","isSealed","keys","preventExtensions","values"])},K={ObjectClass:Array,prefix:"array",prefixShort:"a",prototypeFuncs:new Set(["at","concat","entries","flat","includes","indexOf","join","keys","lastIndexOf","slice","toLocaleString","toReversed","toSorted","toSpliced","values","with","toString"]),staticFuncs:new Set(["from","isArray","of"])},z={ObjectClass:Number,prefix:"number",prefixShort:"n",prototypeFuncs:new Set(["toExponential","toFixed","toLocaleString","toPrecision","toString","valueOf"]),staticFuncs:new Set(["isFinite","isInteger","isNaN","isSafeInteger","parseFloat","parseInt"])},q={ObjectClass:String,prefix:"string",prefixShort:"s",prototypeFuncs:new Set(["at","charAt","charCodeAt","codePointAt","concat","endsWith","includes","indexOf","lastIndexOf","localeCompare","match","normalize","padEnd","padStart","repeat","replace","replaceAll","search","slice","split","startsWith","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim","trimEnd","trimStart","valueOf","toString"]),staticFuncs:new Set(["fromCharCode","fromCodePoint","raw"])},G={ObjectClass:Date,prefix:"date",prefixShort:"",prototypeFuncs:new Set(["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","toDateString","toISOString","toJSON","toLocaleDateString","toLocaleString","toLocaleTimeString","toTimeString","toUTCString","valueOf","toString"]),staticFuncs:new Set(["now","parse","UTC"])},Z={ObjectClass:Set,prefix:"set",prefixShort:"",prototypeFuncs:new Set(["entries","forEach","has","keys","values"]),staticFuncs:new Set([])},J={ObjectClass:Map,prefix:"map",prefixShort:"",prototypeFuncs:new Set(["entries","forEach","get","has","keys","values"]),staticFuncs:new Set(["groupBy"])},Y={ObjectClass:JSON,prefix:"json",prefixShort:"",prototypeFuncs:new Set([]),staticFuncs:new Set(["parse","stringify"])},Q={ObjectClass:Math,prefix:"math",prefixShort:"",prototypeFuncs:new Set([]),staticFuncs:new Set(["abs","acos","acosh","asin","asinh","atan","atan2","atanh","cbrt","ceil","clz32","cos","cosh","exp","expm1","floor","fround","hypot","imul","log","log10","log1p","log2","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc"])},X={ObjectClass:RegExp,prefix:"regexp",prefixShort:"",prototypeFuncs:new Set(["exec","test","toString"]),staticFuncs:new Set([])};class ee{static"truthy*"=e=>e=>!!e;static"falsey*"=e=>e=>!e;static"not*"=this["falsey*"];static eq=e=>t=>t==e[0];static ne=e=>t=>t!=e[0];static lt=e=>t=>Number(t)<Number(e[0]);static le=e=>t=>Number(t)<=Number(e[0]);static gt=e=>t=>Number(t)>Number(e[0]);static ge=e=>t=>Number(t)>=Number(e[0]);static oi=e=>t=>Number(e[0])<Number(t)&&Number(t)<Number(e[1]);static ci=e=>t=>Number(e[0])<=Number(t)&&Number(t)<=Number(e[1]);static embed=e=>t=>(e[0]??"").replaceAll("%s",t);static iftext=e=>t=>t?e[0]??null:e[1]??null;static"isnull*"=e=>e=>null==e;static offset=e=>t=>Number(t)+Number(e[0]);static unit=e=>t=>String(t)+String(e[0]);static inc=this.offset;static mul=e=>t=>Number(t)*Number(e[0]);static div=e=>t=>Number(t)/Number(e[0]);static mod=e=>t=>Number(t)%Number(e[0]);static prop=e=>t=>t[e[0]];static prefix=e=>t=>String(e[0])+String(t);static suffix=this.unit;static date=e=>t=>Date.prototype.toLocaleDateString.apply(t,["sv-SE",e[0]?e[0]:{}]);static"isnan*"=e=>e=>isNaN(e);static nullsafe=e=>e=>l.nullSafe;static nonullsafe=e=>e=>l.noNullSafe}new Set([]);const te=new Set(["truthy*","falsey*","not*","eq","ne","lt","le","gt","ge","oi","ci","embed","iftext","isnull*","offset","unit","inc","mul","div","mod","prop","prefix","suffix","date","isnan*"]);function se(e,t){const s=e.prototype[t];return e=>t=>s.apply(t,e)}function ne(e,t){const s=e[t];return e=>t=>s.apply(null,[t,...e])}const ie=[G,Z,J,Y,X,K,U,z,q,Q],re=e=>t=>s=>null==s?s:e(t)(s),oe=(e,t)=>t(e);class ae{static create(e,t){return Array.from(e).map((e=>t.getFilterFunc(e.name)(e.options)))}}class le{ambigousNames;funcByName;registerFilter(e,t){const s=e.endsWith("*"),n=s?e.slice(0,-1):e;this.funcByName.has(n)&&d.raise(`${this.constructor.name}: ${n} is already registered`);const i=s?t:re(t);this.funcByName.set(n,i)}getFilterFunc(e){return this.ambigousNames.has(e)&&d.raise(`${this.constructor.name}: ${e} is ambigous`),this.funcByName.get(e)??(e=>e=>e)}static applyFilter(e,t){return t.reduce(oe,e)}}class ce extends le{constructor(){super(),this.ambigousNames=new Set(ce.#H),this.funcByName=new Map(ce.#U)}static#H=new Set;static#U=new Map;static{const e=new Set,t=new Map;for(const s of ie){for(const n of s.prototypeFuncs){const i=n.endsWith("*"),r=i?n.slice(0,-1):n,o=se(s.ObjectClass,r),a=i?o:re(o);s.prefix&&t.set(`${s.prefix}.${r}`,a),s.prefixShort&&t.set(`${s.prefixShort}.${r}`,a),t.has(r)?e.add(r):t.set(r,a)}for(const n of s.staticFuncs){const i=n.endsWith("*"),r=i?n.slice(0,-1):n,o=ne(s.ObjectClass,r),a=i?o:re(o);s.prefix&&t.set(`${s.prefix}.${r}`,a),s.prefixShort&&t.set(`${s.prefixShort}.${r}`,a),t.has(r)?e.add(r):t.set(r,a)}}for(const e of te){const s=e.endsWith("*"),n=s?e.slice(0,-1):e,i=ee[e];void 0===i&&d.raise(`${this.name}: ${e} is not found in defaultFilterGroup`);const r=s?i:re(i);t.set(n,r)}for(const s of e)t.delete(s);this.#H=e,this.#U=t}static registerFilter(e,t){const s=e.endsWith("*"),n=s?e.slice(0,-1):e;this.#U.has(n)&&d.raise(`${this.name}: ${n} is already registered`);const i=s?t:re(t);this.#U.set(n,i)}}class de{static date=e=>e=>""===e?null:new Date(new Date(e).setHours(0));static number=e=>e=>""===e?null:Number(e);static boolean=e=>e=>"false"!==e&&""!==e}class pe extends le{constructor(){super(),this.ambigousNames=new Set(pe.#H),this.funcByName=new Map(pe.#U)}static#H=new Set;static#U=new Map;static{this.#U.set("date",de.date),this.#U.set("number",de.number),this.#U.set("boolean",de.boolean)}static registerFilter(e,t){this.#U.has(e)&&d.raise(`${this.name}: ${e} is already registered`),this.#U.set(e,t)}}class he{static preventDefault=e=>e=>(e.preventDefault(),e);static noStopPropagation=e=>e=>(e.noStopPropagation=!0,e);static pd=this.preventDefault;static nsp=this.noStopPropagation}class ue extends le{constructor(){super(),this.ambigousNames=new Set(ue.#H),this.funcByName=new Map(ue.#U)}static#H=new Set;static#U=new Map;static{this.#U.set("preventDefault",he.preventDefault),this.#U.set("noStopPropagation",he.noStopPropagation),this.#U.set("pd",he.preventDefault),this.#U.set("nsp",he.noStopPropagation)}static registerFilter(e,t){this.#U.has(e)&&d.raise(`${this.name}: ${e} is already registered`),this.#U.set(e,t)}}class me{#K;get node(){return this.#K}#e;get name(){return this.#e}#z=[];get nameElements(){return this.#z}get value(){return this.node[this.name]}set value(e){this.node[this.name]=e}#q;get filters(){return this.#q}get filteredValue(){return 0===this.filters.length?this.value:le.applyFilter(this.value,this.filters)}get applicable(){return!0}#G;get binding(){return this.#G}get expandable(){return!1}get isSelectValue(){return!1}get loopable(){return!1}constructor(e,t,s,n){t instanceof Node||d.raise("NodeProperty: not Node");const i=e.component.filters.in;this.#G=e,this.#K=t,this.#e=s,this.#z=s.split("."),this.#q=ae.create(n.toReversed(),i)}initialize(){}postUpdate(e){}isSameValue(e){return this.value===e}applyToChildNodes(e){}clearValue(){}}class fe extends me{#Z;get template(){return void 0===this.#Z&&(this.#Z=m(this.uuid)??d.raise(`TemplateProperty: invalid uuid ${this.uuid}`)),this.#Z}#w;get uuid(){return void 0===this.#w&&(this.#w=fe.getUUID(this.node)),this.#w}static getUUID(e){return e.textContent.slice(3)}get expandable(){return!0}constructor(e,t,s,n){t instanceof Comment||d.raise("TemplateProperty: not Comment"),super(e,t,s,n)}}const ge=e=>e.applyToNode();class ye extends fe{get loopable(){return!0}get value(){return this.binding.children.length}set value(e){if(Array.isArray(e)||d.raise(`Repeat: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not array`),this.value<e.length){this.binding.children.forEach(ge);for(let t=this.value;t<e.length;t++){const e=Ct.create(this.binding.component,this.template,this.binding);this.binding.appendChild(e),e.registerBindingsToSummary(),e.applyToNode()}}else if(this.value>e.length){const t=this.binding.children.splice(e.length);this.binding.children.forEach(ge),t.forEach((e=>e.dispose()))}else this.binding.children.forEach(ge)}constructor(e,t,s,n){"loop"!==s&&d.raise(`Repeat: invalid property name '${s}'`),super(e,t,s,n)}isSameValue(e){return!1}}class be extends fe{get value(){return this.binding.children.length>0}set value(e){if("boolean"!=typeof e&&d.raise(`Branch: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not boolean`),this.value!==e)if(e){const e=Ct.create(this.binding.component,this.template,this.binding);this.binding.appendChild(e),e.registerBindingsToSummary()}else{this.binding.children.splice(0,this.binding.children.length).forEach((e=>e.dispose()))}this.binding.children.forEach((e=>e.applyToNode()))}constructor(e,t,s,n){"if"!==s&&d.raise(`Branch: invalid property name ${s}`),super(e,t,s,n)}isSameValue(e){return!1}}class ve{#J;get value(){return this.#J}#Y;get enabled(){return this.#Y}constructor(e,t){this.#J=e,this.#Y=t}}class we{get viewModel(){return this.#G.component.viewModel}#e;get name(){return this.#e}#Q;get propertyName(){return this.#Q}#l;get level(){return this.#l}get indexes(){return this.binding.loopContext?.indexes.slice(0,this.level)??[]}get indexesString(){return this.indexes.toString()}get key(){return this.name+"\t"+this.indexesString}#X;get oldKey(){return this.#X}get isChagedKey(){return this.#X!==this.key}getKey(){return this.#X=this.key,this.key}get value(){return this.viewModel[l.directlyGet](this.name,this.indexes)}set value(e){const t=e=>{this.viewModel[l.directlySet](this.name,this.indexes,e)};if(e instanceof ve){const s=this.value;if(Array.isArray(s)){const n=new Set(s);e.enabled?n.add(e.value):n.delete(e.value),t(Array.from(n))}else t(e.enabled?e.value:void 0)}else t(e)}#q;get filters(){return this.#q}get filteredValue(){return 0===this.filters.length?this.value:le.applyFilter(this.value,this.filters)}get applicable(){return!0}#G;get binding(){return this.#G}constructor(e,t,s){const n=e.component.filters.out;this.#G=e,this.#e=t,this.#q=ae.create(s,n),this.#Q=r.create(this.name),this.#l=this.#Q.level}initialize(){}getChildValue(e){return this.viewModel[l.directlyGet](`${this.name}.*`,this.indexes.concat(e))}setChildValue(e,t){return this.viewModel[l.directlySet](`${this.name}.*`,this.indexes.concat(e),t)}}const xe=RegExp(/^\$[0-9]+$/);class Ne extends we{get index(){return Number(this.name.slice(1))-1}get value(){return this.binding.loopContext.allIndexes[this.index]}get indexes(){return[]}get indexesString(){return""}constructor(e,t,s){xe.test(t)||d.raise(`ContextIndex: invalid name ${t}`),super(e,t,s)}}class Pe extends me{get element(){return this.node}constructor(e,t,s,n){t instanceof Element||d.raise("ElementBase: not element"),super(e,t,s,n)}}class Se extends Pe{get value(){return this.element.className.length>0?this.element.className.split(" "):[]}set value(e){Array.isArray(e)||d.raise(`ElementClassName: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not array`),this.element.className=e.join(" ")}constructor(e,t,s,n){"class"!==s&&d.raise(`ElementClassName: invalid property name ${s}`),super(e,t,s,n)}}class Be extends Pe{get inputElement(){return this.node}get value(){return new ve(this.inputElement.value,this.inputElement.checked)}set value(e){Array.isArray(e)||d.raise(`Checkbox: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not array`);const t=this.filteredValue;this.inputElement.checked=e.some((e=>e===t.value))}get filteredValue(){const e=this.value;return new ve(this.filters.length>0?le.applyFilter(e.value,this.filters):e.value,e.enabled)}constructor(e,t,s,n){t instanceof HTMLInputElement||d.raise("Checkbox: not htmlInputElement"),"checkbox"!==t.type&&d.raise("Checkbox: not checkbox"),super(e,t,s,n)}isSameValue(e){return!1}}class Ce extends Pe{get inputElement(){return this.element}get value(){return new ve(this.inputElement.value,this.inputElement.checked)}set value(e){const t=this.filteredValue;this.inputElement.checked=e===t.value}get filteredValue(){const e=this.value;return new ve(this.filters.length>0?le.applyFilter(e.value,this.filters):e.value,e.enabled)}constructor(e,t,s,n){t instanceof HTMLInputElement||d.raise("Radio: not htmlInputElement"),"radio"!==t.type&&"checkbox"!==t.type&&d.raise("Radio: not radio or checkbox"),super(e,t,s,n)}isSameValue(e){return!1}}class Me extends Pe{get eventType(){return this.name.slice(2)}get applicable(){return!1}#ee;get handler(){return void 0===this.#ee&&(this.#ee=e=>this.eventHandler(e)),this.#ee}#te=[];get eventFilters(){return this.#te}constructor(e,t,s,n){s.startsWith("on")||d.raise(`ElementEvent: invalid property name ${s}`),super(e,t,s,n);const i=e.component.filters.event;this.#te=ae.create(n,i)}initialize(){this.element.addEventListener(this.eventType,this.handler)}async directlyCall(e){const{viewModelProperty:t,loopContext:s}=this.binding;return t.viewModel[l.directlyCall](t.name,s,e)}createProcessData(e){return new M(this.directlyCall,this,[e])}eventHandler(e){if(!this.binding.component.bindingSummary.allBindings.has(this.binding))return;e=this.eventFilters.length>0?le.applyFilter(e,this.eventFilters):e,!e?.noStopPropagation&&e.stopPropagation();const t=this.createProcessData(e);this.binding.component.updateSlot.addProcess(t)}}class Ee extends Pe{get className(){return this.nameElements[1]}get value(){return this.element.classList.contains(this.className)}set value(e){"boolean"!=typeof e&&d.raise(`ElementClass: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not boolean`),e?this.element.classList.add(this.className):this.element.classList.remove(this.className)}constructor(e,t,s,n){s.startsWith("class.")||d.raise(`ElementClass: invalid property name ${s}`),super(e,t,s,n)}}class Oe extends Pe{get attributeName(){return this.nameElements[1]}get value(){return this.element.getAttribute(this.attributeName)}set value(e){this.element.setAttribute(this.attributeName,e)}}class $e extends Pe{get htmlElement(){return this.node}get styleName(){return this.nameElements[1]}get value(){return this.htmlElement.style[this.styleName]}set value(e){this.htmlElement.style[this.styleName]=e}constructor(e,t,s,n){t instanceof HTMLElement||d.raise("ElementStyle: not htmlElement"),super(e,t,s,n)}}class Te extends Pe{#se;get isSelectValue(){return void 0===this.#se&&(this.#se=this.node.constructor===HTMLSelectElement&&"value"===this.name),this.#se}}class Ae{#ne;get name(){return this.#ne.name}get indexes(){return this.#ne.indexes}get loopContext(){return this.#ne.binding.loopContext}constructor(e){this.#ne=e}}class _e extends Pe{get propName(){return this.nameElements[1]}get applicable(){return!1}get thisComponent(){return this.node}constructor(e,t,s,n){t.constructor[l.isComponent]||d.raise("ComponentProperty: not Component"),super(e,t,s,n)}initialize(){this.thisComponent.props[l.bindProperty](this.propName,new Ae(this.binding.viewModelProperty))}postUpdate(e){const t=this.binding.viewModelProperty.name,s=this.propName;for(const[n,i]of e.entries())if(i.propName.name===t||i.propName.setOfParentPaths.has(t)){const e=i.propName.name.slice(t.length);this.thisComponent.viewModel?.[l.writeCallback](`${s}${e}`,i.indexes),this.thisComponent.viewModel?.[l.notifyForDependentProps](`${s}${e}`,i.indexes)}}isSameValue(e){return!1}}const ke=new Set(["boolean","number","string"]);class Ie extends ye{get loopable(){return!0}#ie=[];get value(){return this.#ie}set value(e){Array.isArray(e)||d.raise(`RepeatKeyed: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not array`);const t=new Map,s=new Set;let n;const i=new Set,r=new Map;for(let n=0;n<e.length;n++){const e=this.binding.viewModelProperty.getChildValue(n),o=this.#ie.indexOf(e,t.get(e)??0);-1===o||!1===o?i.add(n):(t.set(e,o+1),s.add(o),r.set(n,o))}for(let e=0;e<this.binding.children.length;e++)s.has(e)||this.binding.children[e].dispose();const o=e.map(((e,t)=>{let s;const o=n?.lastNode??this.node,a=this.node.parentNode;if(i.has(t))s=Ct.create(this.binding.component,this.template,this.binding),a.insertBefore(s.fragment,o.nextSibling??null);else{const e=r.get(t);s=this.binding.children[e],s.nodes&&s.nodes[0].previousSibling!==o&&(s.removeNodes(),a.insertBefore(s.fragment,o.nextSibling??null))}return n=s,s}));this.binding.children.splice(0,this.binding.children.length,...o),o.forEach((e=>{e.registerBindingsToSummary(),e.applyToNode()})),this.#ie=e.slice()}applyToChildNodes(e){const t=new Map;for(const s of e){const e=this.binding.children[s];if(void 0===e)continue;const n=this.#ie[s],i=typeof n;"undefined"!==i&&(ke.has(i)||(e.removeNodes(),t.set(n,e)))}for(const s of Array.from(e).sort()){const e=this.binding.viewModelProperty.getChildValue(s),n=typeof e;if("undefined"===n)continue;if(ke.has(n))continue;let i=t.get(e);void 0===i&&(i=Ct.create(this.binding.component,this.template,this.binding)),this.binding.replaceChild(s,i),i.registerBindingsToSummary(),i.applyToNode()}}clearValue(){this.#ie=[]}}const Le=RegExp(/^\$[0-9]+$/),Fe=new Map;class De{static#re;static get#oe(){return void 0===this.#re&&(this.#re={true:{if:be},false:{class:Se,checkbox:Be,radio:Ce}}),this.#re}static#ae;static get#le(){return void 0===this.#ae&&(this.#ae={class:Ee,attr:Oe,style:$e,props:_e}),this.#ae}static create(e,t,s,n,i,r){let o,a;const l=t.node,c=Fe.get(t.template)?.get(t.routeIndexes.join(","));if(void 0!==c)a=c.classOfNodeProperty,o=c.classOfViewModelProperty;else{o=Le.test(i)?Ne:we;do{const t=l instanceof Comment;if(a=this.#oe[t][s],void 0!==a)break;if(t&&"loop"===s){a=e.component.useKeyed?Ie:ye;break}t&&d.raise(`Factory: unknown node property ${s}`);const n=s.split(".");if(a=this.#le[n[0]],void 0!==a)break;a=l instanceof Element?s.startsWith("on")?Me:Te:me}while(0);const n=t.routeIndexes.join(",");Fe.get(t.template)?.set(n,{classOfNodeProperty:a,classOfViewModelProperty:o})??Fe.set(t.template,new Map([[n,{classOfNodeProperty:a,classOfViewModelProperty:o}]]))}return xt.create(e,l,s,a,i,o,r)}}class Re{nodeProperty;viewModelProperty;filters}const Ve=e=>e.trim(),je=e=>e.length>0,We=new RegExp(/^#(.*)#$/),He=e=>{const t=We.exec(e);return t?decodeURIComponent(t[1]):e},Ue=e=>{const[t,...s]=e.split(",").map(Ve);return{name:t,options:s.map(He)}},Ke=(e,t)=>{const[s,n]=[t].concat(...e.split(":").map(Ve)).splice(-2),{viewModelProperty:i,filters:r}=(e=>{const[t,...s]=e.split("|").map(Ve);return{viewModelProperty:t,filters:s.map(Ue)}})(n);return{nodeProperty:s,viewModelProperty:i,filters:r}},ze=(e,t)=>e.split(";").map(Ve).filter(je).map((e=>{let{nodeProperty:s,viewModelProperty:n,filters:i}=Ke(e,"$");return n="@"===n?s:n,s="$"===s?t:s,void 0===s&&d.raise("parseBindText: default property undefined"),{nodeProperty:s,viewModelProperty:n,filters:i}})),qe=new Map;function Ge(e,t,s,n,i){return void 0===n&&d.raise("BindToDom: text is undefined"),""===n.trim()?[]:function(e,t){if(void 0===e&&d.raise("Parser: text is undefined"),""===e.trim())return[];const s=e+"\t"+t,n=qe.get(s);if(void 0!==n)return n;const i=ze(e,t).map((e=>Object.assign(new Re,e)));return qe.set(s,i),i}(n,i).map((n=>De.create(e,t,n.nodeProperty,s,n.viewModelProperty,n.filters)))}const Ze="BindToHTMLElement",Je="data-bind",Ye="oninput",Qe=Ye.slice(2),Xe=e=>e instanceof HTMLElement?e:d.raise(`${Ze}: not HTMLElement`),et={radio:"checked",checkbox:"checked",button:"onclick"},tt=new Map,st=e=>{const t=e.constructor.name+"\t"+(e.type??""),s=tt.get(t);if(void 0!==s)return s;const n=(e=>e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLOptionElement?"value":e instanceof HTMLButtonElement||e instanceof HTMLAnchorElement?"onclick":e instanceof HTMLFormElement?"onsubmit":e instanceof HTMLInputElement?et[e.type]??"value":"textContent")(e);return tt.set(t,n),n},nt=e=>e instanceof HTMLElement&&(e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&"button"!==e.type),it=e=>t=>e.addEventListener(Qe,t.defaultEventHandler);const rt="BindToSVGElement",ot="data-bind",at=e=>e instanceof SVGElement?e:d.raise(`${rt}: not SVGElement`);const lt="BindToText",ct="textContent",dt=e=>e instanceof Comment?e:d.raise(`${lt}: not Comment`);const pt="BindToTemplate",ht="data-bind",ut=e=>e instanceof Comment?e:d.raise(`${pt}: not Comment`);function mt(e,t){return t.flatMap((t=>t.node instanceof Comment&&":"==t.node.textContent[2]?function(e,t){const s=t.node,n=e.component.viewModel,i=dt(s),r=i.parentNode??void 0;void 0===r&&d.raise(`${lt}: no parent`);const o=i.textContent.slice(3);if(""===o.trim())return[];const a=document.createTextNode("");return r.replaceChild(a,i),Ge(e,{node:a,routeIndexes:t.routeIndexes,template:t.template},n,o,ct)}(e,t):t.node instanceof HTMLElement?function(e,t){const s=t.node,n=e.component.viewModel,i=Xe(s),r=i.getAttribute(Je)??void 0;void 0===r&&d.raise(`${Ze}: data-bind is not defined`),i.removeAttribute(Je);const o=st(i),a=Ge(e,t,n,r,o);let l=!1,c=null,p=null,h=null;if(a.forEach((e=>{l||=e.nodeProperty.name===Ye,p=e.nodeProperty.constructor===Ce?e:p,h=e.nodeProperty.constructor===Be?e:h,c=e.nodeProperty.name===o?e:c})),!l){const e=it(i);p?e(p):h?e(h):c&&nt(s)&&e(c)}return a}(e,t):t.node instanceof Comment&&"|"==t.node.textContent[2]?function(e,t){const s=t.node,n=e.component.viewModel,i=m(ut(s).textContent.slice(3));void 0===i&&d.raise(`${pt}: template not found`);const r=i.getAttribute(ht)??void 0;return void 0===r&&d.raise(`${pt}: data-bind is not defined`),Ge(e,t,n,r,void 0)}(e,t):t.node instanceof SVGElement?function(e,t){const s=t.node,n=e.component.viewModel,i=at(s),r=i.getAttribute(ot)??void 0;return void 0===r&&d.raise(`${rt}: data-bind is not defined`),i.removeAttribute(ot),Ge(e,t,n,r,void 0)}(e,t):d.raise("Binder: unknown node type")))}const ft=new Map;class gt{static initialize(e){const t=Array.from(e.fragment.querySelectorAll("[popovertarget]"));0!==t.length&&t.forEach((t=>{const s=t.getAttribute("popovertarget");let n=ft.get(e)?.get(s);void 0===n&&(n=()=>e.component.popoverContextIndexesById.set(s,e.loopContext.indexes),ft.get(e)?.set(s,n)??ft.set(e,new Map([[s,n]]))),t.removeEventListener("click",n),t.addEventListener("click",n)}))}static dispose(e){ft.delete(e)}}const yt=new Map;class bt{static dispose(e){e.removeNodes(),e.parentBinding=void 0,e.bindings.forEach((t=>{t.nodeProperty.clearValue(),e.component.bindingSummary.delete(t);t.children.splice(0).forEach((e=>e.dispose()))})),e.component.useKeyed||(yt.get(e.template)?.push(e)??yt.set(e.template,[e])),gt.dispose(e)}static create(e,t,s){let n=yt.get(t)?.pop();return"object"!=typeof n?(n=new Ct(e,t,s),n.initialize()):n.parentBinding=s,gt.initialize(n),n}}class vt{#ce;get bindingManager(){return this.#ce}get parentBindingManager(){return this.bindingManager.parentBinding?.bindingManager}get binding(){return this.bindingManager.parentBinding}get nearestBindingManager(){const e=r.create(this.name);if(e.level<=0)return;const t=r.create(e.nearestWildcardParentName).name;let s=this.parentBindingManager;for(;void 0!==s;){if(s.loopContext.binding.viewModelProperty.name===t)return s;s=s.loopContext.parentBindingManager}}get nearestLoopContext(){return this.nearestBindingManager?.loopContext}#de;#pe;get _index(){const e=this.bindingManager.component.contextRevision;return this.#de!==e&&(this.#pe=this.binding.children.indexOf(this.#ce),this.#de=e),this.#pe}get index(){if(this.binding?.loopable)return this._index;{const e=this.parentBindingManager?.loopContext;return e?.index??-1}}get name(){if(this.binding?.loopable)return this.binding.viewModelProperty.name;{const e=this.parentBindingManager?.loopContext;return e?.name??""}}get indexes(){if(this.binding?.loopable)return this.nearestLoopContext?.indexes.concat(this.index)??[this.index];{const e=this.parentBindingManager?.loopContext;return e?.indexes??[]}}get allIndexes(){if(void 0===this.binding)return[];const e=this.binding.loopable?this._index:-1,t=this.parentBindingManager.loopContext.allIndexes;return e>=0?t.concat(e):t}constructor(e){this.#ce=e}find(e){let t=this;for(;void 0!==t;){if(t.name===e)return t;t=t.parentBindingManager.loopContext}}}let wt=0;class xt{#he;get id(){return this.#he}#ce;get bindingManager(){return this.#ce}#ue;get nodeProperty(){return this.#ue}#ne;get viewModelProperty(){return this.#ne}get component(){return this.#ce.component}get loopContext(){return this.#ce.loopContext}#me=[];get children(){return this.#me}get expandable(){return this.nodeProperty.expandable}get loopable(){return this.nodeProperty.loopable}#se;get isSelectValue(){return void 0===this.#se&&(this.#se=this.nodeProperty.isSelectValue),this.#se}constructor(e,t,s,n,i,r,o){this.#he=++wt,this.#ce=e,this.#ue=new n(this,t,s,o),this.#ne=new r(this,i,o)}applyToNode(){if(this.component.bindingSummary.updatedBindings.has(this))return;const{component:e,nodeProperty:t,viewModelProperty:s}=this;try{if(!t.applicable)return;const e=s.filteredValue??"";if(t.isSameValue(e))return;t.value=e}finally{e.bindingSummary.updatedBindings.add(this)}}applyToChildNodes(e){this.nodeProperty.applyToChildNodes(e)}applyToViewModel(){const{viewModelProperty:e,nodeProperty:t}=this;e.applicable&&(e.value=t.filteredValue)}execDefaultEventHandler(e){if(!this.component.bindingSummary.allBindings.has(this))return;e.stopPropagation();const t=new M(this.applyToViewModel,this,[]);this.component.updateSlot.addProcess(t)}#fe;get defaultEventHandler(){var e;return void 0===this.#fe&&(this.#fe=(e=this,t=>e.execDefaultEventHandler(t))),this.#fe}initialize(){this.nodeProperty.initialize(),this.viewModelProperty.initialize()}appendChild(e){this.expandable||d.raise("Binding.appendChild: not expandable");const t=this.children[this.children.length-1];this.children.push(e);const s=this.nodeProperty.node.parentNode,n=t?.lastNode??this.nodeProperty.node;s.insertBefore(e.fragment,n.nextSibling??null)}replaceChild(e,t){this.expandable||d.raise("Binding.replaceChild: not expandable");const s=this.children[e-1];this.children[e]=t;const n=this.nodeProperty.node.parentNode,i=s?.lastNode??this.nodeProperty.node;n.insertBefore(t.fragment,i.nextSibling??null)}static create(e,t,s,n,i,r,o){const a=new xt(e,t,s,n,i,r,o);return a.initialize(),a}}const Nt=e=>e.applyToViewModel(),Pt=e=>e.applyToNode(),St=(e,t)=>(t.isSelectValue?e.push(t):Pt(t),e),Bt=e=>e.nodeType===Node.ELEMENT_NODE;class Ct{#x;get component(){return this.#x}#ge=[];get bindings(){return this.#ge}#ye=[];get nodes(){return this.#ye}get elements(){return this.#ye.filter(Bt)}get lastNode(){return this.#ye[this.#ye.length-1]}#be;get fragment(){return this.#be}#ve;get loopContext(){return this.#ve}#Z;get template(){return this.#Z}#we;get parentBinding(){return this.#we}set parentBinding(e){this.#we=e}#xe;constructor(e,t,s){this.#we=s,this.#x=e,this.#Z=t,this.#ve=new vt(this),this.#xe=e.bindingSummary}initialize(){const e=document.importNode(this.#Z.content,!0),t=H(this.#Z,e);this.#ge=mt(this,t),this.#ye=Array.from(e.childNodes),this.#be=e}registerBindingsToSummary(){const e=(t=this.#xe,e=>t.add(e));var t;this.#ge.forEach(e)}applyToNode(){this.#ge.reduce(St,[]).forEach(Pt)}applyToViewModel(){this.#ge.forEach(Nt)}removeNodes(){const e=(t=this.#be,e=>t.appendChild(e));var t;this.#ye.forEach(e)}dispose(){bt.dispose(this)}static updateNode(e,t){const{bindingSummary:s}=e.component;(()=>{s.initUpdate();const e=Array.from(s.expandableBindings);e.sort(((e,t)=>{const s=e.viewModelProperty.propertyName.level-t.viewModelProperty.propertyName.level;if(0!==s)return s;return e.viewModelProperty.propertyName.pathNames.length-t.viewModelProperty.propertyName.pathNames.length}));for(const s of e)t.has(s.viewModelProperty.key)&&s.applyToNode();s.flush()})();(()=>{const n=new Map;for(const e of t.values()){if("*"!==e.propName.lastPathName)continue;const t=e.indexes?.at(-1);if(void 0===t)continue;const s=e.propName.parentPath+"\t"+e.indexes.slice(0,e.indexes.length-1);n.get(s)?.add(t)??n.set(s,new Set([t]))}for(const[e,t]of n.entries()){const n=s.bindingsByKey.get(e)??new Set;for(const e of n)s.updatedBindings.has(e)||e.expandable&&e.applyToChildNodes(t)}e.component.contextRevision++})();(()=>{const e=new Set;for(const n of t.keys())for(const t of s.bindingsByKey.get(n)??new Set)t.expandable||(t.isSelectValue?e.add(t):t.applyToNode());for(const t of e)t.applyToNode();for(const e of s.componentBindings)e.nodeProperty.postUpdate(t)})()}static create(e,t,s){return bt.create(e,t,s)}}class Mt{#Ne=new Set;#Pe=new Map;get setOfPropsByRefProp(){return this.#Pe}hasDefaultProp(e){return this.#Ne.has(e)}addDefaultProp(e){let t=r.create(e);for(;""!==t.parentPath;){const e=r.create(t.parentPath);this.#Ne.has(t.name)||(this.#Pe.get(e.name)?.add(t.name)??this.#Pe.set(e.name,new Set([t.name])),this.#Ne.add(t.name)),t=e}}setDependentProps(e){for(const[t,s]of Object.entries(e))for(const e of s)this.#Pe.get(e)?.add(t)??this.#Pe.set(e,new Set([t]))}}const Et={[l.connectedCallback]:"$connectedCallback",[l.disconnectedCallback]:"$disconnectedCallback",[l.writeCallback]:"$writeCallback",[l.updatedCallback]:"$updatedCallback"},Ot=new Set([l.connectedCallback,l.disconnectedCallback,l.writeCallback,l.updatedCallback]);class $t{static get(e,t,s,n){const i=Et[n],r=(...s)=>async()=>Reflect.apply(e[i],t,s);return n===l.connectedCallback?i in e?(...e)=>r(...e)():()=>{}:i in e?(...e)=>s.addProcess(r(...e),t,[]):()=>{}}static has(e){return Ot.has(e)}}const Tt=new Set([l.directlyCall,l.getDependentProps,l.notifyForDependentProps,l.clearCache,l.createBuffer,l.flushBuffer]),At={[l.directlyCall]:({viewModel:e,viewModelProxy:t,handler:s})=>async(n,i,r)=>s.directlyCallback(i,(async()=>Reflect.apply(e[n],t,[r,...i?.allIndexes??[]]))),[l.notifyForDependentProps]:({viewModel:e,viewModelProxy:t,handler:s})=>(n,i)=>s.addNotify(e,{propName:r.create(n),indexes:i},t),[l.getDependentProps]:({handler:e})=>()=>e.dependentProps,[l.clearCache]:({handler:e})=>()=>e.cache.clear(),[l.createBuffer]:({viewModelProxy:e})=>t=>e.$createBuffer?.apply(e,[t]),[l.flushBuffer]:({viewModelProxy:e})=>(t,s)=>e.$flushBuffer?.apply(e,[t,s])};class _t{static get(e,t,s,n){return At[n]?.({viewModel:e,viewModelProxy:t,handler:s})}static has(e){return Tt.has(e)}}const kt="$globals",It="$dependentProps",Lt="$component",Ft=new Set([kt,It,Lt]),Dt={[kt]:({component:e})=>e.globals,[It]:({viewModel:e})=>e[It],[Lt]:({component:e})=>e};class Rt{static get(e,t,s){return Dt[s]?.({component:e,viewModel:t})}static has(e){return Ft.has(e)}}class Vt{#Se=new Map;get(e,t){return this.#Se.get(e)?.get(t.toString())??void 0}set(e,t,s){return this.#Se.get(e)?.set(t.toString(),s)??this.#Se.set(e,new Map([[t.toString(),s]])),s}clear(){this.#Se.clear()}}class jt extends O{#Be=new Vt;get cache(){return this.#Be}getByPropertyName(e,{propName:t},s){if(t.isPrimitive||!this.dependentProps.hasDefaultProp(t.name)&&this.dependentProps.addDefaultProp(t.name),Rt.has(t.name))return Rt.get(this.component,e,t.name);if(!t.isPrimitive||this.setOfAccessorProperties.has(t.name)){const n=t.level>0?this.lastIndexes.slice(0,t.level):[];let i=this.#Be.get(t,n);return void 0===i&&(i=super.getByPropertyName(e,{propName:t},s),this.#Be.set(t,n,i)),i}return super.getByPropertyName(e,{propName:t},s)}setByPropertyName(e,{propName:t,value:s},n){d.raise("ReadOnlyViewModelHandler: viewModel is read only")}get(e,t,s){return $t.has(t)?$t.get(e,s,this,t):_t.has(t)?_t.get(e,s,this,t):super.get(e,t,s)}set(e,t,s,n){d.raise("ReadOnlyViewModelHandler: viewModel is read only")}}const Wt=new Map;function Ht(e){let t=Wt.get(e.constructor);if(!t){const s=function(e){const t=new Map;let s=e;for(;s!==Object.prototype;){const e=Object.getOwnPropertyDescriptors(s);for(const[s,n]of Object.entries(e))t.has(s)||t.set(s,n);s=Object.getPrototypeOf(s)}return t}(e),n=Array.from(s.entries()),i=[],o=[],a=[],l=[],c=function(e,t){return e.filter((([e,s])=>s.value!==t&&"function"==typeof s.value))}(n,e.constructor).map((([e,t])=>e));(function(e,t){return e.filter((([e,s])=>s.value!==t&&"function"!=typeof s.value))})(n,e.constructor).forEach((([e,t])=>{o.push(e);r.create(e).isPrimitive?a.push(e):"value"in t&&void 0===t.value&&i.push(e),"get"in t&&void 0!==t.get&&l.push(e)})),t={removeProps:i,definedProps:o,primitiveProps:a,methods:c,accessorProps:l},Wt.set(e.constructor,t)}return t.removeProps.forEach((t=>Reflect.deleteProperty(e,t))),{definedProps:t.definedProps,primitiveProps:t.primitiveProps,methods:t.methods,accessorProps:t.accessorProps,viewModel:e}}class Ut{#ve;get loopContext(){return this.#ve}async callback(e,t){void 0!==this.#ve&&d.raise("DirectlyCallContext: already set loopContext"),this.#ve=e;try{return await t()}finally{this.#ve=void 0}}}class Kt extends O{#Ce=new Ut;getByPropertyName(e,{propName:t},s){return t.isPrimitive||!this.dependentProps.hasDefaultProp(t.name)&&this.dependentProps.addDefaultProp(t.name),Rt.has(t.name)?Rt.get(this.component,e,t.name):super.getByPropertyName(e,{propName:t},s)}setByPropertyName(e,{propName:t,value:s},n){t.isPrimitive||!this.dependentProps.hasDefaultProp(t.name)&&this.dependentProps.addDefaultProp(t.name);const i=super.setByPropertyName(e,{propName:t,value:s},n),r=this.lastIndexes;return n[l.writeCallback](t.name,r),this.addNotify(e,{propName:t,indexes:r},n),i}async directlyCallback(e,t){return this.#Ce.callback(e,(async()=>{this.stackIndexes.push(void 0);try{return await t()}finally{this.stackIndexes.pop()}}))}#Me(e){if(void 0===this.#Ce.loopContext)return;if("string"!=typeof e||e.startsWith("@@__")||"constructor"===e)return;const t=r.create(e);if(0===t.level||"@"===e.at(0))return;const s=this.#Ce.loopContext.find(t.nearestWildcardParentName);return void 0===s&&d.raise(`WritableViewModelHandler: ${e} is outside loop`),s}get(e,t,s){if($t.has(t))return $t.get(e,s,this,t);if(_t.has(t))return _t.get(e,s,this,t);{const n=this.#Me(t);return void 0!==n?this.directlyGet(e,{prop:t,indexes:n.allIndexes},s):super.get(e,t,s)}}set(e,t,s,n){const i=this.#Me(t);return void 0!==i?this.directlySet(e,{prop:t,indexes:i.allIndexes,value:s},n):super.set(e,t,s,n)}}const zt=e=>e.viewModelProperty.key,qt=e=>e.nodeProperty.expandable,Gt=e=>e.nodeProperty.constructor===_e;class Zt{#Ee=!1;get updated(){return this.#Ee}set updated(e){this.#Ee=e}#Oe=0;get updateRevision(){return this.#Oe}#$e=new Map;get bindingsByKey(){return this.#$e}#Te=new Set;get expandableBindings(){return this.#Te}#Ae=new Set;get componentBindings(){return this.#Ae}#_e=new Set;#ke=new Set;get allBindings(){return this.#ke}#Ie=new Set;get updatedBindings(){return this.#Ie}initUpdate(){this.#Ee=!1,this.#Oe++,this.#Ie=new Set}add(e){this.#Ee=!0,this.#_e.has(e)?this.#_e.delete(e):this.#ke.add(e)}delete(e){this.#Ee=!0,this.#_e.add(e)}flush(){c.debug&&performance.mark("BindingSummary.flush:start");try{if(!this.#Ee)return;const e=Array.from(this.#ke).filter((e=>!this.#_e.has(e)));this.rebuild(e)}finally{c.debug&&(performance.mark("BindingSummary.flush:end"),performance.measure("BindingSummary.flush","BindingSummary.flush:start","BindingSummary.flush:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures("BindingSummary.flush"),performance.clearMarks("BindingSummary.flush:start"),performance.clearMarks("BindingSummary.flush:end"))}}rebuild(e){this.#ke=new Set(e),this.#$e=Map.groupBy(e,zt),this.#Te=new Set(e.filter(qt)),this.#Ae=new Set(e.filter(Gt)),this.#_e=new Set}}const Jt=new Map;function Yt(e,t){Array.from(e.cssRules).map((e=>{"CSSImportRule"===e.constructor.name?Yt(e.styleSheet,t):t.insertRule(e.cssText,t.cssRules.length)}))}function Qt(e){const t=new CSSStyleSheet,s=Array.from(document.styleSheets).filter((t=>t.title===e));if(0!==s.length)return s.forEach((e=>Yt(e,t))),Jt.set(e,t),t}const Xt=e=>e.trim(),es=e=>e.length>0,ts=e=>Jt.get(e)??Qt(e),ss=e=>e;const ns=new WeakMap;class is{get baseViewModel(){return this._viewModels.base}get writableViewModel(){return this._viewModels.writable}get readOnlyViewModel(){return this._viewModels.readonly}get viewModel(){return this.cachableInBuilding?this.readOnlyViewModel:void 0===this.updateSlot||this.updateSlot.phase!==k?this.writableViewModel:this.readOnlyViewModel}get rootBinding(){return this._rootBinding}set rootBinding(e){this._rootBinding=e}get thread(){return this._thread}set thread(e){this._thread=e}get updateSlot(){if(void 0!==this._thread)return void 0===this._updateSlot&&(this._updateSlot=L.create(this,(()=>{this._updateSlot=void 0}),(e=>{e===k&&this.viewModel[l.clearCache]()})),this.thread.wakeup(this._updateSlot)),this._updateSlot}set updateSlot(e){this._updateSlot=e}get props(){return this._props}set props(e){this._props[l.setBuffer](e)}get globals(){return this._globals}get initialPromises(){return this._initialPromises}get alivePromises(){return this._alivePromises}set alivePromises(e){this._alivePromises=e}get parentComponent(){return void 0===this._parentComponent&&(this._parentComponent=(e=>{for(;;){if(null==(e=e.parentNode))return null;if(e.constructor[l.isComponent])return e;if(e instanceof ShadowRoot){if(e.host.constructor[l.isComponent])return e.host;e=e.host}const t=ns.get(e);if(void 0!==t)return t}})(this)),this._parentComponent}get useShadowRoot(){return this._useShadowRoot}get useWebComponent(){return this._useWebComponent}get useLocalTagName(){return this._useLocalTagName}get useKeyed(){return this._useKeyed}get useLocalSelector(){return this._useLocalSelector}get useOverscrollBehavior(){return this._useOverscrollBehavior}get useBufferedBind(){return this.hasAttribute("buffered-bind")}get viewRootElement(){return this.useWebComponent?this.shadowRoot??this:this.pseudoParentNode}get queryRoot(){return this.viewRootElement}get pseudoParentNode(){return this.useWebComponent?d.raise("mixInComponent: useWebComponent must be false"):this._pseudoParentNode}get pseudoNode(){return this._pseudoNode}get filters(){return this._filters}get bindingSummary(){return this._bindingSummary}get shadowRootOrDocument(){let e=this.parentNode;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}return document}get contextRevision(){return this._contextRevision}set contextRevision(e){this._contextRevision=e}get cachableInBuilding(){return this._cachableInBuilding}set cachableInBuilding(e){this._cachableInBuilding=e}initializeCallback(){const e=this.constructor;this._viewModels=function(e,t){const s=Ht(Reflect.construct(t,[])),{viewModel:n,accessorProps:i}=s,r=new Set(i),o=new Mt;return o.setDependentProps(n.$dependentProps??{}),{readonly:new Proxy(n,new jt(e,r,o)),writable:new Proxy(n,new Kt(e,r,o)),base:n}}(this,e.ViewModel),this._rootBinding=void 0,this._thread=void 0,this._updateSlot=void 0,this._props=new Proxy({},new x(this)),this._globals=function(e){return new Proxy({},new S(e))}(),this._initialPromises=void 0,this._alivePromises=void 0,this._parentComponent=void 0,this._useShadowRoot=e.useShadowRoot,this._useWebComponent=e.useWebComponent,this._useLocalTagName=e.useLocalTagName,this._useKeyed=e.useKeyed,this._useLocalSelector=e.useLocalSelector,this._useOverscrollBehavior=e.useOverscrollBehavior,this._pseudoParentNode=void 0,this._pseudoNode=void 0,this._filters={in:new pe,out:new ce,event:new ue},this._bindingSummary=new Zt,this._initialPromises=Promise.withResolvers(),this._setOfObservedAttributes=new Set,this._contextRevision=0,this._cachableInBuilding=!1}async build(){this.cachableInBuilding=!1;const{template:e,styleSheet:t,inputFilters:s,outputFilters:n,eventFilters:i}=this.constructor;for(const[e,t]of Object.entries(s))this.filters.in.registerFilter(e,t);for(const[e,t]of Object.entries(n))this.filters.out.registerFilter(e,t);for(const[e,t]of Object.entries(i))this.filters.event.registerFilter(e,t);if(((e=>-1!==e.indexOf("-"))(o=this.tagName.toLowerCase())||F.has(o))&&this.useShadowRoot&&this.useWebComponent){this.attachShadow({mode:"open"});const e=function(e){return e.map(ts).filter(ss)}((r=this,getComputedStyle(r)?.getPropertyValue("--adopted-css")?.split(" ").map(Xt).filter(es)??[]));void 0!==t&&e.push(t),this.shadowRoot.adoptedStyleSheets=e}else if(void 0!==t){let e=t;this.useLocalSelector&&(e=void 0!==this.constructor.localStyleSheet?this.constructor.localStyleSheet:this.constructor.localStyleSheet=function(e,t){for(let s of e.cssRules)if(s instanceof CSSStyleRule){const e=s.selectorText.split(",").map((e=>e.trim().startsWith(":host")?e.replace(":host",t):`${t} ${e}`)).join(",");s.selectorText=e}return e}(t,this.selectorName));const s=this.shadowRootOrDocument,n=Array.from(s.adoptedStyleSheets);n.includes(e)||(s.adoptedStyleSheets=[...n,e])}var r,o;if(this.useOverscrollBehavior&&("DIALOG"===this.tagName||this.hasAttribute("popover"))&&(this.style.overscrollBehavior="contain"),this.useWebComponent)for(let e=0;e<this.attributes.length;e++){const t=this.attributes[e],[s,n]=t.name.split(":");"props"===s&&(this.props[l.bindProperty](n),this._setOfObservedAttributes.add(t.name))}this.thread=new C,await this.viewModel[l.connectedCallback](),this.cachableInBuilding=!0,this.rootBinding=Ct.create(this,e),this.rootBinding.registerBindingsToSummary(),this.rootBinding.applyToNode(),this.bindingSummary.flush(),this.useWebComponent?this.viewRootElement.appendChild(this.rootBinding.fragment):(this.viewRootElement.insertBefore(this.rootBinding.fragment,this.pseudoNode.nextSibling),this.rootBinding.nodes.forEach((e=>ns.set(e,this)))),this.updateSlot.isEmpty&&this.updateSlot.waitPromises.resolve(!0),await this.updateSlot.alivePromises.promise,this.cachableInBuilding=!1}async connectedCallback(){try{if(this.parentComponent&&await this.parentComponent.initialPromises.promise,!this.useWebComponent){const e=document.createComment(`@@/${this.tagName}`);this._pseudoParentNode=this.parentNode,this._pseudoNode=e,this.pseudoParentNode.replaceChild(e,this)}this.alivePromises=Promise.withResolvers(),await this.build()}finally{this.initialPromises?.resolve&&this.initialPromises.resolve()}}disconnectedCallback(){this.alivePromises?.resolve&&this.alivePromises.resolve(this.props)}updateNode(e){this.rootBinding&&Ct.updateNode(this.rootBinding,e)}static get observedAttributes(){const e=Ht(Reflect.construct(this.ViewModel,[]));return this._propByObservedAttribute=new Map(e.primitiveProps.filter((e=>!e.startsWith("_"))).map((e=>[`props:${d.toKebabCase(e)}`,e]))),Array.from(this._propByObservedAttribute.keys())}static get propByObservedAttribute(){return this._propByObservedAttribute}attributeChangedCallback(e,t,s){if(!this._setOfObservedAttributes.has(e))return;if(void 0===this.constructor.propByObservedAttribute.get(e))return;if(void 0===this.updateSlot)return;const n=new CustomEvent("changeprops");n.propName=e,n.propValue=s,this.dispatchEvent(n),this.updateSlot.phase!==_&&this.viewModel[l.notifyForDependentProps](e,[])}addProcess(e,t,s){const n=new M(e,t,s??[]);this.updateSlot.addProcess(n)}}class rs{get dialogPromises(){return this._dialogPromises}set dialogPromises(e){this._dialogPromises=e}initializeCallback(){this.addEventListener("closed",(()=>{if(void 0!==this.dialogPromises){if(""===this.returnValue)this.dialogPromises.reject();else{const e=this.props[l.getBuffer]();this.props[l.clearBuffer](),this.dialogPromises.resolve(e)}this.dialogPromises=void 0}this.useBufferedBind&&void 0!==this.parentComponent&&""!==this.returnValue&&this.props[l.flushBuffer]()})),this.addEventListener("close",(()=>{const e=new CustomEvent("closed");this.dispatchEvent(e)}))}async _show(e,t=!0){return this.returnValue="",this.dialogPromises=Promise.withResolvers(),this.props[l.setBuffer](e),t?HTMLDialogElement.prototype.showModal.apply(this):HTMLDialogElement.prototype.show.apply(this),this.dialogPromises.promise}async asyncShowModal(e){return this instanceof HTMLDialogElement||d.raise("mixInDialog: asyncShowModal is only for HTMLDialogElement"),this._show(e,!0)}async asyncShow(e){return this instanceof HTMLDialogElement||d.raise("mixInDialog: asyncShow is only for HTMLDialogElement"),this._show(e,!1)}showModal(){if(this instanceof HTMLDialogElement||d.raise("mixInDialog: showModal is only for HTMLDialogElement"),this.useBufferedBind&&void 0!==this.parentComponent){this.returnValue="";const e=this.props[l.createBuffer]();this.props[l.setBuffer](e)}return HTMLDialogElement.prototype.showModal.apply(this)}show(){if(this instanceof HTMLDialogElement||d.raise("mixInDialog: show is only for HTMLDialogElement"),this.useBufferedBind&&void 0!==this.parentComponent){this.returnValue="";const e=this.props[l.createBuffer]();this.props[l.setBuffer](e)}return HTMLDialogElement.prototype.show.apply(this)}close(e=""){return this instanceof HTMLDialogElement||d.raise("mixInDialog: close is only for HTMLDialogElement"),HTMLDialogElement.prototype.close.apply(this,[e])}}class os{get canceled(){return this._canceled??!1}set canceled(e){this._canceled=e}get popoverPromises(){return this._popoverPromises}set popoverPromises(e){this._popoverPromises=e}initializeCallback(){this.addEventListener("hidden",(()=>{if(void 0!==this.popoverPromises){if(this.canceled)this.popoverPromises.reject();else{const e=this.props[l.getBuffer]();this.props[l.clearBuffer](),this.popoverPromises.resolve(e)}this.popoverPromises=void 0}this.useBufferedBind&&void 0!==this.parentComponent&&(this.canceled||this.props[l.flushBuffer]()),this.canceled=!0;const e=this.id;void 0!==e&&this.popoverContextIndexesById.delete(e)})),this.addEventListener("shown",(()=>{if(this.canceled=!0,this.useBufferedBind&&void 0!==this.parentComponent){const e=this.props[l.createBuffer]();this.props[l.setBuffer](e)}for(const e in this.props)this.viewModel[l.notifyForDependentProps](e,[])})),this.addEventListener("toggle",(e=>{if("closed"===e.newState){const e=new CustomEvent("hidden");this.dispatchEvent(e)}else if("open"===e.newState){const e=new CustomEvent("shown");this.dispatchEvent(e)}}))}async asyncShowPopover(e){return this.popoverPromises=Promise.withResolvers(),this.props[l.setBuffer](e),HTMLElement.prototype.showPopover.apply(this),this.popoverPromises.promise}hidePopover(){this.canceled=!1,HTMLElement.prototype.hidePopover.apply(this)}cancelPopover(){HTMLElement.prototype.hidePopover.apply(this)}get popoverContextIndexesById(){return void 0===this._popoverContextIndexesById&&(this._popoverContextIndexesById=new Map),this._popoverContextIndexesById}}function as(e){const t=Object.assign(new b,e);t.filters=Object.assign({},e.filters),t.config=Object.assign({},e.moduleConfig??e.config),t.options=Object.assign({},e.options);const s=function(e){return class extends HTMLElement{static template=e.template;static styleSheet=e.styleSheet;static localStyleSheet;static ViewModel=e.ViewModel;static inputFilters=e.filters?.input??{};static outputFilters=e.filters?.output??{};static eventFilters=e.filters?.event??{};static useShadowRoot=e.config?.useShadowRoot??c.useShadowRoot;static useWebComponent=e.config?.useWebComponent??c.useWebComponent;static useLocalTagName=e.config?.useLocalTagName??c.useLocalTagName;static useKeyed=e.config?.useKeyed??c.useKeyed;static useLocalSelector=e.config?.useLocalSelector??c.useLocalSelector;static useOverscrollBehavior=e.config?.useOverscrollBehavior??c.useOverscrollBehavior;static get[l.isComponent](){return!0}static initializeCallbacks=[];static lowerTagName;get lowerTagName(){return this.constructor.lowerTagName}static selectorName;get selectorName(){return this.constructor.selectorName}static isAutonomousCustomElement;get isAutonomousCustomElement(){return this.constructor.isAutonomousCustomElement}static isCostomizedBuiltInElement;get isCostomizedBuiltInElement(){return this.constructor.isCostomizedBuiltInElement}constructor(){if(super(),void 0===this.constructor.lowerTagName){const e=this.tagName.toLowerCase(),t=e.includes("-"),s=this.hasAttribute("is");if(t)this.constructor.selectorName=e;else{const t=this.getAttribute("is");this.constructor.selectorName=`${e}[is="${t}"]`}this.constructor.lowerTagName=e,this.constructor.isAutonomousCustomElement=t,this.constructor.isCostomizedBuiltInElement=s}this.initialize()}initialize(){this.constructor.initializeCallbacks.forEach((e=>e.apply(this,[])))}}}(t),n=t.config?.extends??t.options?.extends;if(void 0===n);else{const e=document.createElement(n).constructor;s.prototype.__proto__=e.prototype,s.__proto__=e}const i=e=>{for(let[t,n]of Object.entries(Object.getOwnPropertyDescriptors(e)))(n.enumerable||void 0!==n.get)&&Object.defineProperty(s,t,n);for(let[t,n]of Object.entries(Object.getOwnPropertyDescriptors(e.prototype)))"constructor"!==t&&("initializeCallback"===t?s.initializeCallbacks.push(n.value):Object.defineProperty(s.prototype,t,n))};return i(is),i(rs),i(os),cs(t.componentModulesForRegister),s}function ls(e,t){const s=d.toKebabCase(e),n=as(t),i=t.moduleConfig?.extends??t.options?.extends;void 0===i?customElements.define(s,n):customElements.define(s,n,{extends:i})}function cs(e){for(const[t,s]of Object.entries(e??{}))ls(t,s)}class ds{static register(e,t){}}class ps{static toKebabCase=e=>"string"==typeof e?e.replaceAll(/[\._]/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e}const hs="kebab",us="snake",ms="uppercamel",fs="lowercamel",gs="dotted";class ys{static getNames(e){const t=ps.toKebabCase(e),s=t.replaceAll("-","_"),n=t.replaceAll("-","."),i=t.split("-").map(((e,t)=>(void 0!==e[0]&&(e=e[0].toUpperCase()+e.slice(1)),e))).join(""),r=i.length>0?i[0].toLowerCase()+i.slice(1):i;return{[hs]:t,[us]:s,[ms]:i,[fs]:r,[gs]:n}}}const bs=fs;class vs{defaultNameType=bs;defaultPath="./";loadNames=[];prefixMap}class ws{prefix;path;get matchPrefix(){return`${this.prefix}-`}isMatch(e){return e.startsWith(this.matchPrefix)}getNames(e){const{prefix:t,path:s}=this;if(e.startsWith(this.matchPrefix)){return{prefixName:t,subName:e.slice(this.matchPrefix.length),path:s}}}}const xs=ys.getNames("prefix-name"),Ns=ys.getNames("sub-name");class Ps{static getPathInfo(e,t,s,n){const[i,r]=e.split("#");let o=i,a=r;const l=ys.getNames(t),c=ys.getNames(s);return o=o.replaceAll(`{${xs[hs]}}`,l[hs]),o=o.replaceAll(`{${xs[us]}}`,l[us]),o=o.replaceAll(`{${xs[fs]}}`,l[fs]),o=o.replaceAll(`{${xs[ms]}}`,l[ms]),o=o.replaceAll(`{${xs[gs]}}`,l[gs]),o=o.replaceAll(`{${Ns[hs]}}`,c[hs]),o=o.replaceAll(`{${Ns[us]}}`,c[us]),o=o.replaceAll(`{${Ns[fs]}}`,c[fs]),o=o.replaceAll(`{${Ns[ms]}}`,c[ms]),o=o.replaceAll(`{${Ns[gs]}}`,c[gs]),i===o&&".js"!==o.slice(-3)&&(o=o+("/"!==e.slice(-1)?"/":"")+c[n]+".js"),a&&(a=a.replaceAll(`{${Ns[hs]}}`,c[hs]),a=a.replaceAll(`{${Ns[us]}}`,c[us]),a=a.replaceAll(`{${Ns[fs]}}`,c[fs]),a=a.replaceAll(`{${Ns[ms]}}`,c[ms]),a=a.replaceAll(`{${Ns[gs]}}`,c[gs])),{filePath:o,exportName:a}}}class Ss{#Le;#Fe;#De;#Re;#Ve;constructor(e){this.#Re=e,this.#Ve=window.location,this.setConfig(new vs)}setConfig(e){this.#Fe=Object.assign(new vs,e),"prefixMap"in e&&void 0!==e.prefixMap&&this.setPrefixMap(e.prefixMap)}getConfig(){return this.#Fe}setPrefixMap(e){this.#De=new Map(Object.entries(e).map((([e,t])=>[e=ps.toKebabCase(e),Object.assign(new ws,{prefix:e,path:t})])))}getPrefixMap(){return this.#De}configFile(e){return this.#Le=e,this}config(e){return this.setConfig(e),this}prefixMap(e){return this.setPrefixMap(e),this}get registrar(){return this.#Re}async loadConfig(e){const t=this.#Ve.pathname.split("/");t[t.length-1]=e;const s=this.#Ve.origin+t.join("/");try{const e=await fetch(s),t=await e.json();return Object.assign(new vs,t)}catch(e){throw new Error(e)}}async load(...e){if(void 0!==this.#Le){const e=await this.loadConfig(this.#Le);this.setConfig(e)}if(void 0===this.#De)throw new Error("prefixMap is not defined");if(void 0===this.#Re)throw new Error("registrar is not defined");const t=Array.from(this.#De.values()),{defaultNameType:s,defaultPath:n}=this.#Fe;e=e.length>0?e:this.#Fe.loadNames;for(let i of e){let e;i=ps.toKebabCase(i);const r=t.find((e=>e.isMatch(i)));if(void 0!==r){const t=r.getNames(i);e=Ps.getPathInfo(t.path,t.prefixName,t.subName,s)}if(void 0===e&&void 0!==n&&(e=Ps.getPathInfo(n,"",i,s)),void 0===e)throw new Error(`unmatch prefix and no defaultPath (loadName:${i})`);const o=this.#Ve.pathname.split("/");o[o.length-1]=e.filePath;const a=this.#Ve.origin+o.join("/");let l,c;try{l=await import(a)}catch(e){throw new Error(e)}if(void 0!==e.exportName){if(void 0!==l.default?e.exportName in l.default&&(c=l.default[e.exportName]):e.exportName in l&&(c=l[e.exportName]),void 0===c)throw new Error(`${e.exportName} not found in module (exportName:${e.exportName}, ${e.filePath})`)}else c=void 0!==l.default?l.default:Object.assign({},l);this.#Re.register(i,c)}return this}static create(e){return new Ss(e)}}const Bs="*filter-";const Cs=Ss.create(class extends ds{static register(e,t){if(e.startsWith(Bs)){const s=e.slice(8),{output:n,input:i,event:r}=t;n&&ce.registerFilter(s,n),i&&pe.registerFilter(s,i),r&&ue.registerFilter(s,r)}else!function(e,t){if("function"!=typeof e)return!1;let s=e;for(;s;){if(s===t)return!0;s=Object.getPrototypeOf(s)}return!1}(t,HTMLElement)?"ViewModel"in t&&"html"in t&&ls(e,t):customElements.define(e,t)}});function Ms(e){return new URL(e.url).search.slice(1)}async function Es(e){return await fetch(e.url.replace(".js",".html")).then((e=>e.text()))}async function Os(e){return await fetch(e.url.replace(".js",".css")).then((e=>e.text()))}async function $s(e,t){const s=await fetch(e.resolve(t??"./quel.config.json")),n=await s.json();for(let[e,t]of Object.entries(c))c[e]=void 0!==n[e]?n[e]:t;await Cs.config(n).load()}function Ts(e){Object.entries(e).forEach((([e,t])=>{const{input:s,output:n,event:i}=t;s&&pe.registerFilter(e,s),n&&ce.registerFilter(e,n),i&&ue.registerFilter(e,i)}))}function As(e){Object.assign(P.data,e)}export{$s as bootFromImportMeta,c as config,as as generateComponentClass,Ms as getCustomTagFromImportMeta,Os as importCssFromImportMeta,Es as importHtmlFromImportMeta,Cs as loader,cs as registerComponentModules,Ts as registerFilters,As as registerGlobal};
