const e="quel",t="*",s="dot-notation",i={directlyGet:Symbol.for(s+".direct_get"),directlySet:Symbol.for(s+".direct_set"),isSupportDotNotation:Symbol.for(s+".is_support_dot_notation")},n=new RegExp(/^\$([0-9]+)$/);class r{#e;get name(){return this.#e}#t;get pathNames(){return this.#t}#s;get parentPathNames(){return this.#s}#i;get parentPath(){return this.#i}#n;get parentPaths(){return this.#n}#r;get setOfParentPaths(){return this.#r}#o;get lastPathName(){return this.#o}#a;get regexp(){return this.#a}#l;get level(){return this.#l}#c;get isPrimitive(){return this.#c}#d;get nearestWildcardName(){return this.#d}#p;get nearestWildcardParentName(){return this.#p}constructor(e){if(this.#e=e,this.#t=e.split("."),this.#s=this.#t.slice(0,-1),this.#n=this.#s.reduce(((e,t)=>(e.push(e.at(-1)?.concat(t)??[t]),e)),[]).map((e=>e.join("."))),this.#r=new Set(this.#n),this.#i=this.#s.join("."),this.#o=this.#t.at(-1),this.#a=new RegExp("^"+e.replaceAll(".","\\.").replaceAll("*","([0-9a-zA-Z_]*)")+"$"),this.#l=this.#t.reduce(((e,s)=>e+(s===t?1:0)),0),this.#c=1===this.#t.length,this.#d=void 0,this.#p=void 0,this.#l>0)for(let e=this.#t.length-1;e>=0;e--)if(this.#t[e]===t){this.#d=this.#t.slice(0,e+1).join("."),this.#p=this.#t.slice(0,e).join(".");break}}static create(e){const t=this.propertyNameByName.get(e);if(void 0!==t)return t;const s=new r(e);return this.propertyNameByName.set(e,s),s}static propertyNameByName=new Map;static parse(e){const t=[],s=[];for(const i of e.split(".")){const e=Number(i);isNaN(e)?s.push(i):(t.push(e),s.push("*"))}return{propName:r.create(s.join(".")),indexes:t}}}let o=class{#h=[];#u=new Map;get lastIndexes(){return this.#h[this.#h.length-1]}get stackIndexes(){return this.#h}get matchByName(){return this.#u}getByPropertyName(e,{propName:s},i){let n;if(Reflect.has(e,s.name))n=Reflect.get(e,s.name,i);else if(""!==s.parentPath){const o=r.create(s.parentPath),a=this.getByPropertyName(e,{propName:o},i);if(void 0!==a){n=a[s.lastPathName===t?this.lastIndexes[s.level-1]:s.lastPathName]}}return n}setByPropertyName(e,{propName:s,value:i},n){let o=!1;if(Reflect.has(e,s.name)||s.isPrimitive)o=Reflect.set(e,s.name,i,n);else{const a=r.create(s.parentPath),l=this.getByPropertyName(e,{propName:a},n);if(void 0!==l){l[s.lastPathName===t?this.lastIndexes[s.level-1]:s.lastPathName]=i,o=!0}}return o}pushIndexes(e,t){this.#h.push(e);try{return Reflect.apply(t,this,[])}finally{this.#h.pop()}}getFunc=(e,t)=>({propName:s,indexes:i})=>this.pushIndexes(i,(()=>this.getByPropertyName(e,{propName:s},t)));setFunc=(e,t)=>({propName:s,indexes:i},n)=>this.pushIndexes(i,(()=>this.setByPropertyName(e,{propName:s,value:n},t)));getExpandLastLevel(e,{propName:t,indexes:s},i){const n=this.getFunc(e,i);if(void 0===t.nearestWildcardName)throw new Error(`not found wildcard path of '${t.name}'`);const o=r.create(t.nearestWildcardParentName);return n({propName:o,indexes:s}).map(((e,i)=>n({propName:t,indexes:s.concat(i)})))}setExpandLastLevel(e,{propName:t,indexes:s,values:i},n){const o=this.getFunc(e,n),a=this.setFunc(e,n);if(void 0===t.nearestWildcardName)throw new Error(`not found wildcard path of '${t.name}'`);const l=r.create(t.nearestWildcardParentName),c=o({propName:l,indexes:s}),d=Array.isArray(i)?i:[...Array(c.length)].map((e=>i));if(t.nearestWildcardName===t.name)a({propName:l,indexes:s},d);else{if(d.length!==c.length)throw new Error(`not match array count '${t.name}'`);for(let e in c)a({propName:t,indexes:s.concat(Number(e))},d[e])}return!0}directlyGet(e,{prop:t,indexes:s},i){const n=r.create(t);return this.pushIndexes(s,(()=>this.getByPropertyName(e,{propName:n},i)))}directlySet(e,{prop:t,indexes:s,value:i},n){const o=r.create(t);return this.pushIndexes(s,(()=>this.setByPropertyName(e,{propName:o,value:i},n)))}get(e,t,s){const o="string"==typeof t;if(o&&(t.startsWith("@@__")||"constructor"===t))return Reflect.get(e,t,s);const a=this.getFunc(e,s),l=this.lastIndexes;let c;if(t===i.directlyGet)return(t,i)=>Reflect.apply(this.directlyGet,this,[e,{prop:t,indexes:i},s]);if(t===i.directlySet)return(t,i,n)=>Reflect.apply(this.directlySet,this,[e,{prop:t,indexes:i,value:n},s]);if(t===i.isSupportDotNotation)return!0;if(o){if(c=n.exec(t))return l?.[Number(c[1])-1]??void 0;if("@"===t.at(0)){const i=t.slice(1),n=r.create(i);if((l?.length??0)+1<n.level)throw new Error("array level not match");const o=l?.slice(0,n.level-1)??[];return this.getExpandLastLevel(e,{propName:n,indexes:o},s)}if(this.#u.has(t))return a(this.#u.get(t));const i=r.parse(t);return i.propName.level===i.indexes.length?(this.#u.set(t,i),a(i)):a({propName:i.propName,indexes:i.indexes.concat(l?.slice(i.indexes.length)??[])})}return Reflect.get(e,t,s)}set(e,t,s,i){if("string"==typeof t){if(t.startsWith("@@__")||"constructor"===t)return Reflect.set(e,t,s,i);const n=this.setFunc(e,i),o=this.lastIndexes;if("@"===t.at(0)){const n=t.slice(1),o=r.create(n);if((this.lastIndexes?.length??0)+1<o.level)throw new Error("array level not match");const a=this.lastIndexes?.slice(0,o.level-1)??[];return this.setExpandLastLevel(e,{propName:o,indexes:a,values:s},i)}if(this.#u.has(t))return n(this.#u.get(t),s);const a=r.parse(t);return a.propName.level===a.indexes.length?(this.#u.set(t,a),n(a,s)):n({propName:a.propName,indexes:a.indexes.concat(o?.slice(a.indexes.length)??[])},s)}return Reflect.set(e,t,s,i)}};const a=Object.assign({connectedCallback:Symbol.for(`${e}:viewModel.connectedCallback`),disconnectedCallback:Symbol.for(`${e}:viewModel.disconnectedCallback`),writeCallback:Symbol.for(`${e}:viewModel.writeCallback`),updatedCallback:Symbol.for(`${e}:viewModel.updatedCallback`),getDependentProps:Symbol.for(`${e}:viewModel.getDependentProps`),clearCache:Symbol.for(`${e}:viewModel.clearCache`),directlyCall:Symbol.for(`${e}:viewModel.directCall`),notifyForDependentProps:Symbol.for(`${e}:viewModel.notifyForDependentProps`),createBuffer:Symbol.for(`${e}:viewModel.createBuffer`),flushBuffer:Symbol.for(`${e}:viewModel.flushBuffer`),boundByComponent:Symbol.for(`${e}:globalData.boundByComponent`),bindTo:Symbol.for(`${e}:componentModule.bindTo`),bindProperty:Symbol.for(`${e}:props.bindProperty`),setBuffer:Symbol.for(`${e}:props.setBuffer`),getBuffer:Symbol.for(`${e}:props.getBuffer`),clearBuffer:Symbol.for(`${e}:props.clearBuffer`),createBuffer:Symbol.for(`${e}:props.createBuffer`),flushBuffer:Symbol.for(`${e}:props.flushBuffer`),toObject:Symbol.for(`${e}:props.toObject`),propInitialize:Symbol.for(`${e}:props.initialize`),isComponent:Symbol.for(`${e}:component.isComponent`)},i),l={debug:!1,useShadowRoot:!1,useKeyed:!0,useWebComponent:!0,useLocalTagName:!0,useLocalSelector:!0,useOverscrollBehavior:!0};class c{static raise(e){throw new Error(e)}static toKebabCase=e=>"string"==typeof e?e.replaceAll(/_/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e;static createUUID(){return window?.crypto?.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=((new Date).getTime()+16*Math.random())%16|0;return("x"==e?t:3&t|8).toString(16)}))}}const d="data-bind",p="data-uuid",h=new Map;function u(e){return h.get(e)}function m(e,t,s){const i=document.createElement("template");return i.innerHTML=e?function(e,t,s){const i=[],n=e.replaceAll(/\{\{([^\}]+)\}\}/g,((e,t)=>{if((t=t.trim()).startsWith("loop:")||t.startsWith("if:"))return i.push(t),`<template data-bind="${t}">`;if(t.startsWith("else:")){const e=i.at(-1);return void 0!==e&&e.startsWith("if:")||c.raise(`Template: endif: is not matched with if:, but {{ ${t} }} `),`</template><template data-bind="${e}|not">`}if(t.startsWith("end:"))return void 0===i.pop()&&c.raise(`Template: end: is not matched with loop: or if:, but {{ ${t} }} `),"</template>";if(t.startsWith("endif:")){const e=i.pop();return void 0!==e&&e.startsWith("if:")||c.raise(`Template: endif: is not matched with if:, but {{ ${e} }} `),"</template>"}if(t.startsWith("endloop:")){const e=i.pop();return void 0!==e&&e.startsWith("loop:")||c.raise(`Template: endloop: is not matched with loop:, but {{ ${e} }} `),"</template>"}return`\x3c!--@@:${t}--\x3e`}));i.length>0&&c.raise(`Template: loop: or if: is not matched with endloop: or endif:, but {{ ${i.at(-1)} }} `);const r=document.createElement("template");r.innerHTML=n;const o=s.map((e=>c.toKebabCase(e))),a=e=>{for(const s of o){const i=Array.from(e.querySelectorAll(s));for(const e of i){const i=document.createElement(`${s}-${t}`);if(e.hasAttributes){for(const t of e.attributes)i.setAttribute(t.name,t.value);i.setAttribute("data-orig-tag-name",s)}e.parentNode.replaceChild(i,e)}const n=Array.from(e.querySelectorAll(`[is="${s}"]`));for(const e of n){const i=document.createElement(e.tagName,{is:`${s}-${t}`});if(e.hasAttributes){for(const t of e.attributes)"is"!==t.name&&i.setAttribute(t.name,t.value);i.setAttribute("data-orig-is",s)}e.parentNode.replaceChild(i,e)}}const s=Array.from(e.querySelectorAll("template"));for(const e of s)a(e.content)};o.length>0&&a(r.content);const l=e=>{let t;for(;t=e.querySelector("template");){const e=c.createUUID(),s=document.createComment(`@@|${e}`);if(t.parentNode.replaceChild(s,t),t.constructor!==HTMLTemplateElement){const e=document.createElement("template");for(let s of Array.from(t.childNodes))e.content.appendChild(s);e.setAttribute(d,t.getAttribute(d)),t=e}t.setAttribute(p,e),l(t.content),h.set(e,t)}};return l(r.content),r.innerHTML}(e,t,s):"",i}const g=new Map;function f(e,t){const s=g.get(t);if(s)return s;const i=function(e){const t=new CSSStyleSheet;return t.replaceSync(e),t}(e);return g.set(t,i),i}class y{#m=c.createUUID();get uuid(){return this.#m}html="";css;get template(){const e=this.config.useLocalTagName??l.useLocalTagName?Object.keys(this.componentModules??{}):[];return m(this.html,this.uuid,e)}get styleSheet(){return this.css?f(this.css,this.uuid):void 0}ViewModel=class{};config={};options={};filters={};componentModules;get componentModulesForRegister(){if((this.config.useLocalTagName??l.useLocalTagName)&&void 0!==this.componentModules){const e={};for(const[t,s]of Object.entries(this.componentModules))e[`${c.toKebabCase(t)}-${this.uuid}`]=s;return e}return this.componentModules}}const v=e=>{const t=e.id;return e.parentComponent?.popoverContextIndexesById?.get(t)},b=(e,t)=>{let s;const i=new r(t.name);return i.level>0&&0===t.indexes.length&&e.component.hasAttribute("popover")&&(s=v(e.component)?.slice(0,i.level)),s??t.indexes};let w=class{#g;#f;#y=[];constructor(e){this.#g=e}get component(){return this.#g}get buffer(){return this.#f}get binds(){return this.#y}#v(e,t){Object.defineProperty(this.#g.baseViewModel,e,{get:((e,t,s)=>function(){if(void 0!==e.buffer)return e.buffer[t];if(0===e.binds.length)return e.component.getAttribute(`props:${t}`);{const t=n.exec(s.name);if(t){const i=Number(t[1])-1;let n=s.loopContext.indexes;return 0===n.length&&e.component.hasAttribute("popover")&&(n=v(e.component)??[]),n[i]}{const t=b(e,s);return e.component.parentComponent.writableViewModel[a.directlyGet](s.name,t)}}})(this,e,t),set:((e,t,s)=>function(i){if(void 0!==e.buffer){e.buffer[t]=i;const s=new CustomEvent("changeprops");s.propName=t,s.propValue=i,e.component.dispatchEvent(s)}else if(0===e.binds.length)e.component.setAttribute(`props:${t}`,i);else{const t=b(e,s);e.component.parentComponent.writableViewModel[a.directlySet](s.name,t,i)}return!0})(this,e,t),configurable:!0,enumerable:!0}),void 0!==t&&this.#y.push({prop:e,propAccess:t})}#b(e){this.#f=e;for(const t in e)this.#v(t),this.#g.viewModel[a.notifyForDependentProps](t,[])}#w(){return this.#f}#P(){this.#f=void 0}#x(){let e;return e=this.#g.parentComponent.writableViewModel[a.createBuffer](this.#g),void 0!==e||(e={},this.#y.forEach((({prop:t,propAccess:s})=>{const i=b(this,s);e[t]=this.#g.parentComponent.writableViewModel[a.directlyGet](s.name,i)}))),e}#N(){if(void 0!==this.#f){!0!==this.#g.parentComponent.writableViewModel[a.flushBuffer](this.#f,this.#g)&&this.#y.forEach((({prop:e,propAccess:t})=>{const s=b(this,t);this.#g.parentComponent.writableViewModel[a.directlySet](t.name,s,this.#f[e])}))}}get(e,t,s){return t===a.bindProperty?(e,t)=>this.#v(e,t):t===a.setBuffer?e=>this.#b(e):t===a.getBuffer?()=>this.#w():t===a.clearBuffer?()=>this.#P():t===a.createBuffer?()=>this.#x():t===a.flushBuffer?()=>this.#N():this.#g.viewModel[t]}set(e,t,s,i){return this.#g.viewModel[t]=s,!0}ownKeys(e,t){return void 0!==this.buffer?Reflect.ownKeys(this.buffer):0===this.binds.length?Array.from(this.component.attributes).filter((e=>e.name.startsWith("props:"))).map((e=>e.name.slice(6))):this.#y.map((({prop:e})=>e))}getOwnPropertyDescriptor(e,t,s){return{enumerable:!0,configurable:!0}}};class P extends o{#C=new Map;get(e,t,s){return t===a.boundByComponent?(e,t)=>{let s=this.#C.get(t);null==s?this.#C.set(t,new Set([e])):s.add(e)}:super.get(e,t,s)}set(e,t,s,i){const{propName:n,indexes:o}=r.parse(t),l=i[a.directlySet](n.name,o,s);let c=this.#C.get(n.name);if(c)for(const e of c)e.viewModel[a.notifyForDependentProps]("$globals."+n.name,o);return l}}class x{static create(){return new Proxy({},new P)}static data=this.create()}class N{#g;setOfProps=new Set;constructor(e){this.#g=e}bindProperty(e){x.data[a.boundByComponent](this.#g,e),this.setOfProps.add(e)}directGet=(e,t)=>(this.setOfProps.has(e)||this.bindProperty(e),x.data[a.directlyGet](e,t));directSet=(e,t,s)=>(this.setOfProps.has(e)||this.bindProperty(e),x.data[a.directlySet](e,t,s));get(e,t,s){if(t===a.directlyGet)return this.directGet;if(t===a.directlySet)return this.directSet;if(t===a.isSupportDotNotation)return!0;const{propName:i,indexes:n}=r.parse(t);return this.directGet(i.name,n)}set(e,t,s,i){const{propName:n,indexes:o}=r.parse(t);return this.directSet(n.name,o,s)}}class C extends Error{}class S{#S;#M=!0;get alive(){return this.#M}constructor(){this.main()}async#B(){return this.#S=Promise.withResolvers(),this.#S.promise}stop(){this.#S.reject(new C("stop"))}wakeup(e){this.#S.resolve(e)}async main(){for(;;)try{const e=await this.#B();await e.waitPromises.promise,l.debug&&performance.mark("slot-exec:start");try{await e.exec(),l.debug&&(performance.mark("slot-exec:end"),performance.measure("slot-exec","slot-exec:start","slot-exec:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures(),performance.clearMarks())}finally{e.callback()}}catch(e){if(e instanceof C)break;if(console.error(e),!confirm("致命的なエラーが発生しました。続行しますか？"))break}this.#M=!1}}class M{target;thisArgument;argumentsList;constructor(e,t,s){this.target=e,this.thisArgument=t,this.argumentsList=s}}class B{queue=[];updatedProps=[];#g;constructor(e){this.#g=e}async exec(){for(;this.queue.length>0;){const e=this.queue;this.queue=[];for(const t of e)await Reflect.apply(t.target,t.thisArgument,t.argumentsList)}for(;this.updatedProps.length>0;){const e=this.updatedProps;this.updatedProps=[];const t=e.map((e=>[e.propName.name,e.indexes]));this.#g.writableViewModel[a.updatedCallback](t)}}get isEmpty(){return 0===this.queue.length}}class _ extends o{#g;get component(){return this.#g}#_;get dependentProps(){return this.#_}#E;get setOfAccessorProperties(){return this.#E}constructor(e,t,s){super(),this.#g=e,this.#E=t,this.#_=s}addProcess(e,t,s){this.#g.updateSlot?.addProcess(new M(e,t,s))}addNotify(e,t,s){this.#g.updateSlot?.addNotify(t),this.#g.updateSlot?.addUpdatedProps(Object.assign({},t))}static makeNotifyForDependentProps(e,t,s=new Set([])){const{propName:i,indexes:n}=t,o=i.name+"\t"+n.toString();if(s.has(o))return[];s.add(o);const l=e[a.getDependentProps]().setOfPropsByRefProp.get(i.name),c=[];if(void 0===l)return[];for(const t of l){const i=r.create(t);if(n.length<i.level){const t=_.expandIndexes(e,{propName:i,indexes:n});c.push(...t.map((e=>({propName:i,indexes:e}))))}else{const e=n.slice(0,i.level);c.push({propName:i,indexes:e})}c.push(...this.makeNotifyForDependentProps(e,{propName:i,indexes:n},s))}return c}static expandIndexes(e,t){const{propName:s,indexes:i}=t;if(s.level===i.length)return[i];if(s.level<i.length)return[i.slice(0,s.level)];{const t=(n,r,o)=>{const l=""!==n?n+".":n,c=s.pathNames[r],d=s.pathNames.length-1===r,p=l+c;let h;return h=d?"*"===c?e[a.directlyGet](n,o).flatMap(((e,t)=>[o.concat(t)])):[o]:"*"===c?o.length<i.length?t(p,r+1,i.slice(0,o.length+1)):e[a.directlyGet](n,o).flatMap(((e,s)=>t(p,r+1,o.concat(s)))):t(p,r+1,o),h};return t("",0,[])}}}function E(){return this.propName.name+"\t"+this.indexes.toString()}class T{queue=[];#g;constructor(e){this.#g=e}async exec(){for(;this.queue.length>0;){const e=this.queue;this.queue=[];const t=[];for(const s of e)t.push(..._.makeNotifyForDependentProps(this.#g.viewModel,s));const s=new Map(e.concat(t).map((e=>[E.apply(e),e])));this.#g.updateNode(s)}}get isEmpty(){return 0===this.queue.length}}const A=0,O=1,L=2,$=100;class k{#T;get viewModelUpdator(){return this.#T}#A;get nodeUpdator(){return this.#A}#O;#L;get waitPromises(){return this.#L}#$;get alivePromises(){return this.#$}#k;#D=A;get phase(){return this.#D}set phase(e){const t=this.#D;this.#D=e,void 0!==this.#k&&this.#k(e,t)}constructor(e,t=null,s=null){this.#T=new B(e),this.#A=new T(e),this.#O=t,this.#k=s,this.#L=Promise.withResolvers(),this.#$=Promise.withResolvers()}get isEmpty(){return this.#T.isEmpty&&this.#A.isEmpty}async exec(){do{this.phase=O,await this.#T.exec(),this.phase=L,await this.#A.exec()}while(!this.#T.isEmpty||!this.#A.isEmpty);this.phase=$,this.#$.resolve()}addProcess(e){this.#T.queue.push(e),this.#L.resolve(!0)}addNotify(e){this.#A.queue.push(e),this.#L.resolve(!0)}callback(){this.#O&&this.#O()}static create(e,t,s){return new k(e,t,s)}addUpdatedProps(e){this.#T.updatedProps.push(e)}}const D=new Set(["articles","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]);const I=(e,t,s)=>{if(null==e)return e;const i=Number(e);return isNaN(i)?e:s(i,t)},U=(e,t,s)=>null==e?e:s(String(e),t),R=(e,t,s)=>Array.isArray(e)?s(e,t):e,V=(e,t,s)=>e instanceof Date?s(e,t):e;class F{static styleDisplay=e=>t=>t?e[0]??"":"none";static truthy=e=>e=>!!e;static falsey=e=>e=>!e;static not=this.falsey;static eq=e=>t=>t==e[0];static ne=e=>t=>t!=e[0];static lt=e=>t=>Number(t)<Number(e[0]);static le=e=>t=>Number(t)<=Number(e[0]);static gt=e=>t=>Number(t)>Number(e[0]);static ge=e=>t=>Number(t)>=Number(e[0]);static oi=e=>t=>Number(e[0])<Number(t)&&Number(t)<Number(e[1]);static ci=e=>t=>Number(e[0])<=Number(t)&&Number(t)<=Number(e[1]);static embed=e=>t=>null!=t?(e[0]??"").replaceAll("%s",t):null;static ifText=e=>t=>t?e[0]??null:e[1]??null;static null=e=>e=>null==e;static offset=e=>t=>Number(t)+Number(e[0]);static unit=e=>t=>String(t)+String(e[0]);static inc=this.offset;static mul=e=>t=>Number(t)*Number(e[0]);static div=e=>t=>Number(t)/Number(e[0]);static mod=e=>t=>Number(t)%Number(e[0]);static object=e=>t=>t[e[0]];static prefix=e=>t=>String(e[0])+String(t);static suffix=this.unit;static date=e=>t=>V(t,e,((e,t)=>e.toLocaleDateString("ja-JP",t[0]?t[0]:{})));static isodate=e=>t=>V(t,e,((e,t)=>e.toLocaleDateString("sv-SE",t[0]?t[0]:{})));static#I=e=>t=>U(t,e,((e,t)=>e.at(...t)));static#U=e=>t=>U(t,e,((e,t)=>e.charAt(...t)));static#R=e=>t=>U(t,e,((e,t)=>e.charCodeAt(...t)));static#V=e=>t=>U(t,e,((e,t)=>e.codePointAt(...t)));static#F=e=>t=>U(t,e,((e,t)=>e.concat(...t)));static#H=e=>t=>U(t,e,((e,t)=>e.endsWith(...t)));static#W=e=>t=>U(t,e,((e,t)=>e.includes(...t)));static#j=e=>t=>U(t,e,((e,t)=>e.indexOf(...t)));static#z=e=>t=>U(t,e,((e,t)=>e.lastIndexOf(...t)));static#K=e=>t=>U(t,e,((e,t)=>e.localeCompare(...t)));static#q=e=>t=>U(t,e,((e,t)=>e.match(...t)));static#G=e=>t=>U(t,e,((e,t)=>e.normalize(...t)));static#Y=e=>t=>U(t,e,((e,t)=>e.padEnd(...t)));static#J=e=>t=>U(t,e,((e,t)=>e.padStart(...t)));static#Z=e=>t=>U(t,e,((e,t)=>e.repeat(...t)));static#Q=e=>t=>U(t,e,((e,t)=>e.replace(...t)));static#X=e=>t=>U(t,e,((e,t)=>e.replaceAll(...t)));static#ee=e=>t=>U(t,e,((e,t)=>e.search(...t)));static#te=e=>t=>U(t,e,((e,t)=>e.slice(...t)));static#se=e=>t=>U(t,e,((e,t)=>e.split(...t)));static#ie=e=>t=>U(t,e,((e,t)=>e.startsWith(...t)));static#ne=e=>t=>U(t,e,((e,t)=>e.substring(...t)));static#re=e=>t=>U(t,e,((e,t)=>e.toLocaleLowerCase(...t)));static#oe=e=>t=>U(t,e,((e,t)=>e.toLocaleUpperCase(...t)));static#ae=e=>t=>U(t,e,((e,t)=>e.toLowerCase(...t)));static#le=e=>t=>U(t,e,((e,t)=>e.toUpperCase(...t)));static#ce=e=>t=>U(t,e,((e,t)=>e.trim(...t)));static#de=e=>t=>U(t,e,((e,t)=>e.trimEnd(...t)));static#pe=e=>t=>U(t,e,((e,t)=>e.trimStart(...t)));static#he=e=>t=>I(t,e,((e,t)=>e.toExponential(...t)));static#ue=e=>t=>I(t,e,((e,t)=>e.toFixed(...t)));static#me=e=>t=>I(t,e,((e,t)=>e.toLocaleString(...t)));static#ge=e=>t=>I(t,e,((e,t)=>e.toPrecision(...t)));static#fe=e=>t=>R(t,e,((e,t)=>e.at(...t)));static#ye=e=>t=>R(t,e,((e,t)=>e.concat(...t)));static#ve=e=>t=>R(t,e,((e,t)=>e.entries(...t)));static#be=e=>t=>R(t,e,((e,t)=>e.flat(...t)));static#we=e=>t=>R(t,e,((e,t)=>e.includes(...t)));static#Pe=e=>t=>R(t,e,((e,t)=>e.indexOf(...t)));static#xe=e=>t=>R(t,e,((e,t)=>e.join(...t)));static#Ne=e=>t=>R(t,e,((e,t)=>e.keys(...t)));static#Ce=e=>t=>R(t,e,((e,t)=>e.lastIndexOf(...t)));static#Se=e=>t=>R(t,e,((e,t)=>e.slice(...t)));static#Me=e=>t=>R(t,e,((e,t)=>e.toLocaleString(...t)));static#Be=e=>t=>R(t,e,((e,t)=>e.toReversed(...t)));static#_e=e=>t=>R(t,e,((e,t)=>e.toSorted(...t)));static#Ee=e=>t=>R(t,e,((e,t)=>e.toSpliced(...t)));static#Te=e=>t=>R(t,e,((e,t)=>e.values(...t)));static#Ae=e=>t=>R(t,e,((e,t)=>e.with(...t)));static#Oe=e=>t=>V(t,e,((e,t)=>e.getDate(...t)));static#Le=e=>t=>V(t,e,((e,t)=>e.getDay(...t)));static#$e=e=>t=>V(t,e,((e,t)=>e.getFullYear(...t)));static#ke=e=>t=>V(t,e,((e,t)=>e.getHours(...t)));static#De=e=>t=>V(t,e,((e,t)=>e.getMilliseconds(...t)));static#Ie=e=>t=>V(t,e,((e,t)=>e.getMinutes(...t)));static#Ue=e=>t=>V(t,e,((e,t)=>e.getMonth(...t)));static#Re=e=>t=>V(t,e,((e,t)=>e.getSeconds(...t)));static#Ve=e=>t=>V(t,e,((e,t)=>e.getTime(...t)));static#Fe=e=>t=>V(t,e,((e,t)=>e.getTimezoneOffset(...t)));static#He=e=>t=>V(t,e,((e,t)=>e.getUTCDate(...t)));static#We=e=>t=>V(t,e,((e,t)=>e.getUTCDay(...t)));static#je=e=>t=>V(t,e,((e,t)=>e.getUTCFullYear(...t)));static#ze=e=>t=>V(t,e,((e,t)=>e.getUTCHours(...t)));static#Ke=e=>t=>V(t,e,((e,t)=>e.getUTCMilliseconds(...t)));static#qe=e=>t=>V(t,e,((e,t)=>e.getUTCMinutes(...t)));static#Ge=e=>t=>V(t,e,((e,t)=>e.getUTCMonth(...t)));static#Ye=e=>t=>V(t,e,((e,t)=>e.getUTCSeconds(...t)));static#Je=e=>t=>V(t,e,((e,t)=>e.toDateString(...t)));static#Ze=e=>t=>V(t,e,((e,t)=>e.toISOString(...t)));static#Qe=e=>t=>V(t,e,((e,t)=>e.toJSON(...t)));static#Xe=e=>t=>V(t,e,((e,t)=>e.toLocaleDateString(...t)));static#et=e=>t=>V(t,e,((e,t)=>e.toLocaleString(...t)));static#tt=e=>t=>V(t,e,((e,t)=>e.toLocaleTimeString(...t)));static#st=e=>t=>V(t,e,((e,t)=>e.toTimeString(...t)));static#it=e=>t=>V(t,e,((e,t)=>e.toUTCString(...t)));static get at(){return e=>t=>(Array.isArray(t)?this.#fe:this.#I)(e)(t)}static get charAt(){return this.#U}static get charCodeAt(){return this.#R}static get codePointAt(){return this.#V}static get concat(){return e=>t=>(Array.isArray(t)?this.#ye:this.#F)(e)(t)}static get endsWith(){return this.#H}static get entries(){return this.#ve}static get flat(){return this.#be}static get includes(){return e=>t=>(Array.isArray(t)?this.#we:this.#W)(e)(t)}static get indexOf(){return e=>t=>(Array.isArray(t)?this.#Pe:this.#j)(e)(t)}static get join(){return this.#xe}static get keys(){return this.#Ne}static get lastIndexOf(){return e=>t=>(Array.isArray(t)?this.#Ce:this.#z)(e)(t)}static get localeCompare(){return this.#K}static get match(){return this.#q}static get normalize(){return this.#G}static get padEnd(){return this.#Y}static get padStart(){return this.#J}static get repeat(){return this.#Z}static get replace(){return this.#Q}static get replaceAll(){return this.#X}static get search(){return this.#ee}static get slice(){return e=>t=>(Array.isArray(t)?this.#Se:this.#te)(e)(t)}static get split(){return this.#se}static get startsWith(){return this.#ie}static get substring(){return this.#ne}static get toExponential(){return this.#he}static get toFixed(){return this.#ue}static get toLocaleString(){return e=>t=>(t instanceof Date?this.#et:Array.isArray(t)?this.#Me:this.#me)(e)(t)}static get toLocaleLowerCase(){return this.#re}static get toLocaleUpperCase(){return this.#oe}static get toLowerCase(){return this.#ae}static get toPrecision(){return this.#ge}static get toReversed(){return this.#Be}static get toSorted(){return this.#_e}static get toSpliced(){return this.#Ee}static get toUpperCase(){return this.#le}static get trim(){return this.#ce}static get trimEnd(){return this.#de}static get trimStart(){return this.#pe}static get values(){return this.#Te}static get with(){return this.#Ae}static get getDate(){return this.#Oe}static get getDay(){return this.#Le}static get getFullYear(){return this.#$e}static get getHours(){return this.#ke}static get getMilliseconds(){return this.#De}static get getMinutes(){return this.#Ie}static get getMonth(){return this.#Ue}static get getSeconds(){return this.#Re}static get getTime(){return this.#Ve}static get getTimezoneOffset(){return this.#Fe}static get getUTCDate(){return this.#He}static get getUTCDay(){return this.#We}static get getUTCFullYear(){return this.#je}static get getUTCHours(){return this.#ze}static get getUTCMilliseconds(){return this.#Ke}static get getUTCMinutes(){return this.#qe}static get getUTCMonth(){return this.#Ge}static get getUTCSeconds(){return this.#Ye}static get toDateString(){return this.#Je}static get toISOString(){return this.#Ze}static get toJSON(){return this.#Qe}static get toLocaleDateString(){return this.#Xe}static get toLocaleTimeString(){return this.#tt}static get toTimeString(){return this.#st}static get toUTCString(){return this.#it}}class H{static date=e=>e=>""===e?null:new Date(e);static isodate=e=>e=>""===e?null:new Date(new Date(e).setHours(0));static number=e=>e=>""===e?null:Number(e);static boolean=e=>e=>""===e?null:Boolean(e)}class W{static preventDefault=e=>e=>(e.preventDefault(),e);static noStopPropagation=e=>e=>(e.noStopPropagation=!0,e);static pd=this.preventDefault;static nsp=this.noStopPropagation}const j="Selector",z=e=>Array.from(e.childNodes).flatMap((e=>z(e).concat((e=>e instanceof Comment&&(e.textContent.startsWith("@@:")||e.textContent.startsWith("@@|")))(e)?e:null))).filter((e=>e)),K=new Map;function q(e,t){let s;void 0===e&&c.raise(`${j}: template is undefined`),void 0===t&&c.raise(`${j}: rootElement is undefined`);const i=K.get(e);return void 0!==i?s=i.map((e=>((e,t)=>{for(let s=0;s<t.length;s++)e=e.childNodes[t[s]];return e})(t,e))):(s=Array.from(t.querySelectorAll("[data-bind]")).concat(z(t)),K.set(e,s.map((e=>(e=>{let t=[];for(;null!==e.parentNode;)t=[Array.from(e.parentNode.childNodes).indexOf(e)].concat(t),e=e.parentNode;return t})(e))))),s}const G=e=>e;class Y{name;options;inputFilterFunc;outputFilterFunc;eventFilterFunc;constructor(e,t,s,i,n){this.name=e,this.options=t,this.inputFilterFunc=s(t)??G,this.outputFilterFunc=i(t)??G,this.eventFilterFunc=n(t)??G}static applyForInput(e,t){return t.reduceRight(((e,t)=>t.inputFilterFunc(e)),e)}static applyForOutput(e,t){return t.reduce(((e,t)=>t.outputFilterFunc(e)),e)}static applyForEvent(e,t){return t.reduce(((e,t)=>t.eventFilterFunc(e)),e)}static createFilter=e=>(t,s)=>{const i=e.filters.in[t],n=e.filters.out[t],r=e.filters.event[t];return new Y(t,s,i,n,r)};static register(e,t,s,i){e in F&&c.raise(`register filter error duplicate name (${e})`),e in H&&c.raise(`register filter error duplicate name (${e})`),e in W&&c.raise(`register filter error duplicate name (${e})`),t&&(F[e]=t),s&&(H[e]=s),i&&(W[e]=i)}}class J{#nt;get node(){return this.#nt}#e;get name(){return this.#e}#rt=[];get nameElements(){return this.#rt}get value(){return this.node[this.name]}set value(e){this.node[this.name]=e}#ot;get filters(){return this.#ot}get filteredValue(){return this.filters.length>0?Y.applyForInput(this.value,this.filters):this.value}get applicable(){return!0}#at;get binding(){return this.#at}get expandable(){return!1}get isSelectValue(){return!1}get loopable(){return!1}constructor(e,t,s,i){t instanceof Node||c.raise("NodeProperty: not Node"),this.#at=e,this.#nt=t,this.#e=s,this.#rt=s.split("."),this.#ot=i}initialize(){}postUpdate(e){}isSameValue(e){return this.value===e}applyToChildNodes(e){}clearValue(){}}class Z extends J{get template(){return u(this.uuid)??c.raise(`TemplateProperty: invalid uuid ${this.uuid}`)}get uuid(){return Z.getUUID(this.node)}static getUUID(e){return e.textContent.slice(3)}get expandable(){return!0}constructor(e,t,s,i){t instanceof Comment||c.raise("TemplateProperty: not Comment"),super(e,t,s,i)}}const Q=e=>e.applyToNode();class X extends Z{get loopable(){return!0}get value(){return this.binding.children.length}set value(e){if(Array.isArray(e)||c.raise(`Repeat: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not array`),this.value<e.length){this.binding.children.forEach(Q);for(let t=this.value;t<e.length;t++){const[e,s]=[this.binding.viewModelProperty.name,t],i=Qe.create(this.binding.component,this.template,this.binding,{name:e,index:s});this.binding.appendChild(i),i.registerBindingsToSummary(),i.applyToNode()}}else if(this.value>e.length){const t=this.binding.children.splice(e.length);this.binding.children.forEach(Q),t.forEach((e=>e.dispose()))}else this.binding.children.forEach(Q)}constructor(e,t,s,i){"loop"!==s&&c.raise(`Repeat: invalid property name '${s}'`),super(e,t,s,i)}isSameValue(e){return!1}}class ee extends Z{get value(){return this.binding.children.length>0}set value(e){if("boolean"!=typeof e&&c.raise(`Branch: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not boolean`),this.value!==e)if(e){const e=Qe.create(this.binding.component,this.template,this.binding);this.binding.appendChild(e),e.registerBindingsToSummary()}else{this.binding.children.splice(0,this.binding.children.length).forEach((e=>e.dispose()))}this.binding.children.forEach((e=>e.applyToNode()))}constructor(e,t,s,i){"if"!==s&&c.raise(`Branch: invalid property name ${s}`),super(e,t,s,i)}isSameValue(e){return!1}}class te{#lt;get value(){return this.#lt}#ct;get enabled(){return this.#ct}constructor(e,t){this.#lt=e,this.#ct=t}}class se{get viewModel(){return this.#at.component.viewModel}#e;get name(){return this.#e}#dt;get propertyName(){return this.#dt}#l;get level(){return this.#l}get indexes(){return this.binding.loopContext?.indexes.slice(0,this.level)??[]}get indexesString(){return this.indexes.toString()}get key(){return this.name+"\t"+this.indexesString}#pt;get oldKey(){return this.#pt}get isChagedKey(){return this.#pt!==this.key}getKey(){return this.#pt=this.key,this.key}get value(){return this.viewModel[a.directlyGet](this.name,this.indexes)}set value(e){const t=e=>{this.viewModel[a.directlySet](this.name,this.indexes,e)};if(e instanceof te){const s=this.value;if(Array.isArray(s)){const i=new Set(s);e.enabled?i.add(e.value):i.delete(e.value),t(Array.from(i))}else t(e.enabled?e.value:void 0)}else t(e)}#ot;get filters(){return this.#ot}get filteredValue(){return this.filters.length>0?Y.applyForOutput(this.value,this.filters):this.value}get applicable(){return!0}#at;get binding(){return this.#at}constructor(e,t,s){this.#at=e,this.#e=t,this.#ot=s,this.#dt=r.create(this.name),this.#l=this.#dt.level}initialize(){}getChildValue(e){return this.viewModel[a.directlyGet](`${this.name}.*`,this.indexes.concat(e))}setChildValue(e,t){return this.viewModel[a.directlySet](`${this.name}.*`,this.indexes.concat(e),t)}}const ie=RegExp(/^\$[0-9]+$/);class ne extends se{get index(){return Number(this.name.slice(1))-1}get value(){return this.binding.loopContext.allIndexes[this.index]}get indexes(){return[]}get indexesString(){return""}constructor(e,t,s){ie.test(t)||c.raise(`ContextIndex: invalid name ${t}`),super(e,t,s)}}class re extends J{get element(){return this.node}constructor(e,t,s,i){t instanceof Element||c.raise("ElementBase: not element"),super(e,t,s,i)}}class oe extends re{get value(){return this.element.className.length>0?this.element.className.split(" "):[]}set value(e){Array.isArray(e)||c.raise(`ElementClassName: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not array`),this.element.className=e.join(" ")}constructor(e,t,s,i){"class"!==s&&c.raise(`ElementClassName: invalid property name ${s}`),super(e,t,s,i)}}class ae extends re{get inputElement(){return this.node}get value(){return new te(this.inputElement.value,this.inputElement.checked)}set value(e){Array.isArray(e)||c.raise(`Checkbox: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not array`);const t=this.filteredValue;this.inputElement.checked=e.some((e=>e===t.value))}get filteredValue(){const e=this.value;return new te(this.filters.length>0?Y.applyForInput(e.value,this.filters):e.value,e.enabled)}constructor(e,t,s,i){t instanceof HTMLInputElement||c.raise("Checkbox: not htmlInputElement"),"checkbox"!==t.type&&c.raise("Checkbox: not checkbox"),super(e,t,s,i)}isSameValue(e){return!1}}class le extends re{get inputElement(){return this.element}get value(){return new te(this.inputElement.value,this.inputElement.checked)}set value(e){const t=this.filteredValue;this.inputElement.checked=e===t.value}get filteredValue(){const e=this.value;return new te(this.filters.length>0?Y.applyForInput(e.value,this.filters):e.value,e.enabled)}constructor(e,t,s,i){t instanceof HTMLInputElement||c.raise("Radio: not htmlInputElement"),"radio"!==t.type&&"checkbox"!==t.type&&c.raise("Radio: not radio or checkbox"),super(e,t,s,i)}isSameValue(e){return!1}}class ce extends re{get eventType(){return this.name.slice(2)}get applicable(){return!1}#ht;get handler(){return void 0===this.#ht&&(this.#ht=e=>this.eventHandler(e)),this.#ht}constructor(e,t,s,i){s.startsWith("on")||c.raise(`ElementEvent: invalid property name ${s}`),super(e,t,s,i)}initialize(){this.element.addEventListener(this.eventType,this.handler)}async directlyCall(e){const{viewModelProperty:t,loopContext:s}=this.binding;return t.viewModel[a.directlyCall](t.name,s,e)}createProcessData(e){return new M(this.directlyCall,this,[e])}eventHandler(e){if(!this.binding.component.bindingSummary.allBindings.has(this.binding))return;e=this.filters.length>0?Y.applyForEvent(e,this.filters):e,!e?.noStopPropagation&&e.stopPropagation();const t=this.createProcessData(e);this.binding.component.updateSlot.addProcess(t)}}class de extends re{get className(){return this.nameElements[1]}get value(){return this.element.classList.contains(this.className)}set value(e){"boolean"!=typeof e&&c.raise(`ElementClass: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not boolean`),e?this.element.classList.add(this.className):this.element.classList.remove(this.className)}constructor(e,t,s,i){s.startsWith("class.")||c.raise(`ElementClass: invalid property name ${s}`),super(e,t,s,i)}}class pe extends re{get attributeName(){return this.nameElements[1]}get value(){return this.element.getAttribute(this.attributeName)}set value(e){this.element.setAttribute(this.attributeName,e)}}class he extends re{get htmlElement(){return this.node}get styleName(){return this.nameElements[1]}get value(){return this.htmlElement.style[this.styleName]}set value(e){this.htmlElement.style[this.styleName]=e}constructor(e,t,s,i){t instanceof HTMLElement||c.raise("ElementStyle: not htmlElement"),super(e,t,s,i)}}class ue extends re{#ut;get isSelectValue(){return void 0===this.#ut&&(this.#ut=this.node.constructor===HTMLSelectElement&&"value"===this.name),this.#ut}}class me{#mt;get name(){return this.#mt.name}get indexes(){return this.#mt.indexes}get loopContext(){return this.#mt.binding.loopContext}constructor(e){this.#mt=e}}class ge extends re{get propName(){return this.nameElements[1]}get applicable(){return!1}get thisComponent(){return this.node}constructor(e,t,s,i){t.constructor[a.isComponent]||c.raise("ComponentProperty: not Component"),super(e,t,s,i)}initialize(){this.thisComponent.props[a.bindProperty](this.propName,new me(this.binding.viewModelProperty))}postUpdate(e){const t=this.binding.viewModelProperty.name,s=this.propName;for(const[i,n]of e.entries())if(n.propName.name===t||n.propName.setOfParentPaths.has(t)){const e=n.propName.name.slice(t.length);this.thisComponent.viewModel?.[a.writeCallback](`${s}${e}`,n.indexes),this.thisComponent.viewModel?.[a.notifyForDependentProps](`${s}${e}`,n.indexes)}}isSameValue(e){return!1}}const fe=new Set(["boolean","number","string"]);class ye extends X{get loopable(){return!0}#gt=[];get value(){return this.#gt}set value(e){Array.isArray(e)||c.raise(`RepeatKeyed: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not array`);const t=new Map,s=new Set;let i;const n=new Set,r=new Map;for(let i=0;i<e.length;i++){const e=this.binding.viewModelProperty.getChildValue(i),o=this.#gt.indexOf(e,t.get(e)??0);-1===o||!1===o?n.add(i):(t.set(e,o+1),s.add(o),r.set(i,o))}for(let e=0;e<this.binding.children.length;e++)s.has(e)||this.binding.children[e].dispose();const o=e.map(((e,t)=>{let s;const o=i?.lastNode??this.node,a=this.node.parentNode;if(n.has(t)){const[e,i]=[this.binding.viewModelProperty.name,t];s=Qe.create(this.binding.component,this.template,this.binding,{name:e,index:i}),a.insertBefore(s.fragment,o.nextSibling??null)}else{const e=r.get(t);s=this.binding.children[e],s.nodes&&s.nodes[0].previousSibling!==o&&(s.removeNodes(),a.insertBefore(s.fragment,o.nextSibling??null))}return i=s,s}));this.binding.children.splice(0,this.binding.children.length,...o),o.forEach((e=>{e.registerBindingsToSummary(),e.applyToNode()})),this.#gt=e.slice()}applyToChildNodes(e){const t=new Map;for(const s of e){const e=this.binding.children[s];if(void 0===e)continue;const i=this.#gt[s],n=typeof i;"undefined"!==n&&(fe.has(n)||(e.removeNodes(),t.set(i,e)))}for(const s of Array.from(e).sort()){const e=this.binding.viewModelProperty.getChildValue(s),i=typeof e;if("undefined"===i)continue;if(fe.has(i))continue;let n=t.get(e);if(void 0===n){const e=this.binding.viewModelProperty.name;n=Qe.create(this.binding.component,this.template,this.binding,{name:e,index:s})}this.binding.replaceChild(s,n),n.registerBindingsToSummary(),n.applyToNode()}}clearValue(){this.#gt=[]}}const ve=RegExp(/^\$[0-9]+$/);class be{static#ft;static get#yt(){return void 0===this.#ft&&(this.#ft={true:{if:ee},false:{class:oe,checkbox:ae,radio:le}}),this.#ft}static#vt;static get#bt(){return void 0===this.#vt&&(this.#vt={class:de,attr:pe,style:he,props:ge}),this.#vt}static create(e,t,s,i,n,r){let o;const a=ve.test(n)?ne:se;do{const i=t instanceof Comment;if(o=this.#yt[i][s],void 0!==o)break;if(i&&"loop"===s){o=e.component.useKeyed?ye:X;break}i&&c.raise(`Factory: unknown node property ${s}`);const n=s.split(".");if(o=this.#bt[n[0]],void 0!==o)break;o=t instanceof Element?s.startsWith("on")?ce:ue:J}while(0);return Ze.create(e,t,s,o,n,a,r)}}class we{nodeProperty;viewModelProperty;filters}const Pe=e=>e.trim(),xe=e=>e.length>0,Ne=e=>decodeURIComponent(e),Ce=e=>{const[t,...s]=e.split("|").map(Pe);return{viewModelProperty:t,filters:s.map((e=>(e=>{const[t,...s]=e.split(",").map(Pe);return{name:t,options:s.map(Ne)}})(e)))}},Se=(e,t)=>e.split(";").map(Pe).filter(xe).map((e=>{let{nodeProperty:s,viewModelProperty:i,filters:n}=((e,t)=>{const[s,i]=[t].concat(...e.split(":").map(Pe)).splice(-2),{viewModelProperty:n,filters:r}=Ce(i);return{nodeProperty:s,viewModelProperty:n,filters:r}})(e,"$");return i="@"===i?s:i,s="$"===s?t:s,void 0===s&&c.raise("parseBindText: default property undefined"),{nodeProperty:s,viewModelProperty:i,filters:n}})),Me={};function Be(e,t,s,i,n){return void 0===i&&c.raise("BindToDom: text is undefined"),""===i.trim()?[]:function(e,t){if(void 0===e&&c.raise("Parser: text is undefined"),""===e.trim())return[];const s=e+"\t"+t;let i=Me[s];return void 0===i&&(i=Se(e,t).map((e=>Object.assign(new we,e))),Me[s]=i),i}(i,n).map((i=>be.create(e,t,i.nodeProperty,s,i.viewModelProperty,i.filters)))}const _e="BindToHTMLElement",Ee="data-bind",Te="oninput",Ae=Te.slice(2),Oe=e=>e instanceof HTMLElement?e:c.raise(`${_e}: not HTMLElement`),Le=e=>e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLOptionElement?"value":e instanceof HTMLButtonElement||e instanceof HTMLAnchorElement?"onclick":e instanceof HTMLFormElement?"onsubmit":e instanceof HTMLInputElement?"radio"===e.type||"checkbox"===e.type?"checked":"button"===e.type?"onclick":"value":"textContent",$e=e=>e instanceof HTMLElement&&(e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&"button"!==e.type);const ke="BindToSVGElement",De="data-bind",Ie=e=>e instanceof SVGElement?e:c.raise(`${ke}: not SVGElement`);const Ue="BindToText",Re="textContent",Ve=e=>e instanceof Comment?e:c.raise(`${Ue}: not Comment`);const Fe="BindToTemplate",He="data-bind",We=e=>e instanceof Comment?e:c.raise(`${Fe}: not Comment`);function je(e,t){return t.flatMap((t=>t instanceof Comment&&":"==t.textContent[2]?function(e,t){const s=e.component.viewModel,i=Ve(t),n=i.parentNode??void 0;void 0===n&&c.raise(`${Ue}: no parent`);const r=i.textContent.slice(3);if(""===r.trim())return[];const o=document.createTextNode("");return n.replaceChild(o,i),Be(e,o,s,r,Re)}(e,t):t instanceof HTMLElement?function(e,t){const s=e.component.viewModel,i=Oe(t),n=i.getAttribute(Ee)??void 0;void 0===n&&c.raise(`${_e}: data-bind is not defined`),i.removeAttribute(Ee);const r=Le(i),o=Be(e,t,s,n,r);let a=!1,l=null,d=null,p=null;o.forEach((e=>{a||=e.nodeProperty.name===Te,d=e.nodeProperty.constructor===le?e:d,p=e.nodeProperty.constructor===ae?e:p,l=e.nodeProperty.name===r?e:l}));const h=e=>{i.addEventListener(Ae,e.defaultEventHandler)};return d?a||h(d):p?a||h(p):l&&!a&&$e(t)&&h(l),o}(e,t):t instanceof Comment&&"|"==t.textContent[2]?function(e,t){const s=e.component.viewModel,i=u(We(t).textContent.slice(3));void 0===i&&c.raise(`${Fe}: template not found`);const n=i.getAttribute(He)??void 0;return void 0===n&&c.raise(`${Fe}: data-bind is not defined`),Be(e,t,s,n,void 0)}(e,t):t instanceof SVGElement?function(e,t){const s=e.component.viewModel,i=Ie(t),n=i.getAttribute(De)??void 0;return void 0===n&&c.raise(`${ke}: data-bind is not defined`),i.removeAttribute(De),Be(e,t,s,n,void 0)}(e,t):c.raise("Binder: unknown node type")))}const ze=new Map;class Ke{static initialize(e){const t=Array.from(e.fragment.querySelectorAll("[popovertarget]"));0!==t.length&&t.forEach((t=>{const s=t.getAttribute("popovertarget");let i=ze.get(e)?.get(s);void 0===i&&(i=()=>e.component.popoverContextIndexesById.set(s,e.loopContext.indexes),ze.get(e)?.set(s,i)??ze.set(e,new Map([[s,i]]))),t.removeEventListener("click",i),t.addEventListener("click",i)}))}static dispose(e){ze.delete(e)}}const qe=new Map;class Ge{static dispose(e){e.removeNodes(),e.parentBinding=void 0,e.bindings.forEach((t=>{t.nodeProperty.clearValue(),e.component.bindingSummary.delete(t);t.children.splice(0).forEach((e=>e.dispose()))})),e.component.useKeyed||(qe.get(e.template)?.push(e)??qe.set(e.template,[e])),Ke.dispose(e)}static create(e,t,s,i){let n=qe.get(t)?.pop();return"object"!=typeof n?(n=new Qe(e,t,s,i),n.initialize()):n.parentBinding=s,Ke.initialize(n),n}}class Ye{#wt;get bindingManager(){return this.#wt}get parentBindingManager(){return this.bindingManager.parentBinding?.bindingManager}get binding(){return this.bindingManager.parentBinding}get nearestBindingManager(){const e=r.create(this.name);if(e.level<=0)return;const t=r.create(e.nearestWildcardParentName).name;let s=this.parentBindingManager;for(;void 0!==s;){if(s.loopContext.binding.viewModelProperty.name===t)return s;s=s.loopContext.parentBindingManager}}get nearestLoopContext(){return this.nearestBindingManager?.loopContext}get _index(){return this.binding.children.indexOf(this.#wt)}get index(){if(this.binding?.loopable)return this._index;{const e=this.parentBindingManager?.loopContext;return e?.index??-1}}get name(){if(this.binding?.loopable)return this.binding.viewModelProperty.name;{const e=this.parentBindingManager?.loopContext;return e?.name??""}}get indexes(){if(this.binding?.loopable)return this.nearestLoopContext?.indexes.concat(this.index)??[this.index];{const e=this.parentBindingManager?.loopContext;return e?.indexes??[]}}get allIndexes(){if(void 0===this.binding)return[];const e=this.binding.loopable?this._index:-1,t=this.parentBindingManager.loopContext.allIndexes;return e>=0?t.concat(e):t}constructor(e){this.#wt=e}find(e){let t=this;for(;void 0!==t;){if(t.name===e)return t;t=t.parentBindingManager.loopContext}}}let Je=0;class Ze{#Pt;get id(){return this.#Pt}#wt;get bindingManager(){return this.#wt}#xt;get nodeProperty(){return this.#xt}#mt;get viewModelProperty(){return this.#mt}get component(){return this.#wt.component}get loopContext(){return this.#wt.loopContext}#Nt=[];get children(){return this.#Nt}get expandable(){return this.nodeProperty.expandable}get loopable(){return this.nodeProperty.loopable}get isSelectValue(){return this.nodeProperty.isSelectValue}constructor(e,t,s,i,n,r,o){const a=Y.createFilter(e.component),l=o.map((e=>a(e.name,e.options)));this.#Pt=++Je,this.#wt=e,this.#xt=new i(this,t,s,l),this.#mt=new r(this,n,l)}applyToNode(){const{component:e,nodeProperty:t,viewModelProperty:s}=this;if(!e.bindingSummary.updatedBindings.has(this))try{if(!t.applicable)return;const e=s.filteredValue??"";if(t.isSameValue(e))return;t.value=e}finally{e.bindingSummary.updatedBindings.add(this)}}applyToChildNodes(e){this.nodeProperty.applyToChildNodes(e)}applyToViewModel(){const{viewModelProperty:e,nodeProperty:t}=this;e.applicable&&(e.value=t.filteredValue)}execDefaultEventHandler(e){if(!this.component.bindingSummary.allBindings.has(this))return;e.stopPropagation();const t=new M(this.applyToViewModel,this,[]);this.component.updateSlot.addProcess(t)}#Ct;get defaultEventHandler(){var e;return void 0===this.#Ct&&(this.#Ct=(e=this,t=>e.execDefaultEventHandler(t))),this.#Ct}initialize(){this.nodeProperty.initialize(),this.viewModelProperty.initialize()}appendChild(e){this.expandable||c.raise("Binding.appendChild: not expandable");const t=this.children[this.children.length-1];this.children.push(e);const s=this.nodeProperty.node.parentNode,i=t?.lastNode??this.nodeProperty.node;s.insertBefore(e.fragment,i.nextSibling??null)}replaceChild(e,t){this.expandable||c.raise("Binding.replaceChild: not expandable");const s=this.children[e-1];this.children[e]=t;const i=this.nodeProperty.node.parentNode,n=s?.lastNode??this.nodeProperty.node;i.insertBefore(t.fragment,n.nextSibling??null)}static create(e,t,s,i,n,r,o){const a=new Ze(e,t,s,i,n,r,o);return a.initialize(),a}}class Qe{#g;get component(){return this.#g}#St=[];get bindings(){return this.#St}#Mt=[];get nodes(){return this.#Mt}get elements(){return this.#Mt.filter((e=>e.nodeType===Node.ELEMENT_NODE))}get lastNode(){return this.#Mt[this.#Mt.length-1]}#Bt;get fragment(){return this.#Bt}#_t;get loopContext(){return this.#_t}#Et;get template(){return this.#Et}#Tt;get parentBinding(){return this.#Tt}set parentBinding(e){this.#Tt=e}constructor(e,t,s,i){this.#Tt=s,this.#g=e,this.#Et=t,this.#_t=new Ye(this)}initialize(){const e=document.importNode(this.#Et.content,!0),t=q(this.#Et,e);this.#St=je(this,t),this.#Mt=Array.from(e.childNodes),this.#Bt=e}registerBindingsToSummary(){this.#St.forEach((e=>this.#g.bindingSummary.add(e)))}applyToNode(){const e=new Set;for(const t of this.bindings)t.isSelectValue?e.add(t):t.applyToNode();for(const t of e)t.applyToNode()}applyToViewModel(){this.bindings.forEach((e=>e.applyToViewModel()))}removeNodes(){this.#Mt.forEach((e=>this.fragment.appendChild(e)))}dispose(){Ge.dispose(this)}static updateNode(e,t){const{bindingSummary:s}=e.component;s.initUpdate();const i=Array.from(s.expandableBindings);i.sort(((e,t)=>{const s=e.viewModelProperty.propertyName.level-t.viewModelProperty.propertyName.level;if(0!==s)return s;return e.viewModelProperty.propertyName.pathNames.length-t.viewModelProperty.propertyName.pathNames.length}));for(const e of i)t.has(e.viewModelProperty.key)&&e.applyToNode();s.flush();const n=new Map;for(const e of t.values()){if("*"!==e.propName.lastPathName)continue;const t=e.indexes?.at(-1);if(void 0===t)continue;const s=e.propName.parentPath+"\t"+e.indexes.slice(0,e.indexes.length-1);n.get(s)?.add(t)??n.set(s,new Set([t]))}for(const[e,t]of n.entries()){const i=s.bindingsByKey.get(e)??new Set;for(const e of i)s.updatedBindings.has(e)||e.expandable&&e.applyToChildNodes(t)}const r=new Set;for(const e of t.keys())for(const t of s.bindingsByKey.get(e)??new Set)t.expandable||(t.isSelectValue?r.add(t):t.applyToNode());for(const e of r)e.applyToNode();for(const e of s.componentBindings)e.nodeProperty.postUpdate(t)}static create(e,t,s,i){return Ge.create(e,t,s,i)}static getByComponent(e){if(null===e.parentComponent)return;const t=function(e,s){e.elements.forEach((t=>{s.set(t,e)}));for(const i of e.bindings)i.children.forEach((e=>t(e,s)))},s=new Map;t(e.parentComponent.rootBinding,s);const i=function(e,t){const s=[];for(;null!==t&&t!==e;)s.push(t),t=t.parentElement;return s}(e.parentComponent,e);for(const e of i){const t=s.get(e);if(void 0!==t)return t}}}class Xe{#At=new Set;#Ot=new Map;get setOfPropsByRefProp(){return this.#Ot}hasDefaultProp(e){return this.#At.has(e)}addDefaultProp(e){let t=r.create(e);for(;""!==t.parentPath;){const e=r.create(t.parentPath);this.#At.has(t.name)||(this.#Ot.get(e.name)?.add(t.name)??this.#Ot.set(e.name,new Set([t.name])),this.#At.add(t.name)),t=e}}setDependentProps(e){for(const[t,s]of Object.entries(e))for(const e of s)this.#Ot.get(e)?.add(t)??this.#Ot.set(e,new Set([t]))}}const et={[a.connectedCallback]:"$connectedCallback",[a.disconnectedCallback]:"$disconnectedCallback",[a.writeCallback]:"$writeCallback",[a.updatedCallback]:"$updatedCallback"},tt=new Set([a.connectedCallback,a.disconnectedCallback,a.writeCallback,a.updatedCallback]);class st{static get(e,t,s,i){const n=et[i],r=(...s)=>async()=>Reflect.apply(e[n],t,s);return i===a.connectedCallback?n in e?(...e)=>r(...e)():()=>{}:n in e?(...e)=>s.addProcess(r(...e),t,[]):()=>{}}static has(e){return tt.has(e)}}const it=new Set([a.directlyCall,a.getDependentProps,a.notifyForDependentProps,a.clearCache,a.createBuffer,a.flushBuffer]),nt={[a.directlyCall]:({viewModel:e,viewModelProxy:t,handler:s})=>async(i,n,r)=>s.directlyCallback(n,(async()=>Reflect.apply(e[i],t,[r,...n?.allIndexes??[]]))),[a.notifyForDependentProps]:({viewModel:e,viewModelProxy:t,handler:s})=>(i,n)=>s.addNotify(e,{propName:r.create(i),indexes:n},t),[a.getDependentProps]:({handler:e})=>()=>e.dependentProps,[a.clearCache]:({handler:e})=>()=>e.cache.clear(),[a.createBuffer]:({viewModelProxy:e})=>t=>e.$createBuffer?.apply(e,[t]),[a.flushBuffer]:({viewModelProxy:e})=>(t,s)=>e.$flushBuffer?.apply(e,[t,s])};class rt{static get(e,t,s,i){return nt[i]?.({viewModel:e,viewModelProxy:t,handler:s})}static has(e){return it.has(e)}}const ot="$globals",at="$dependentProps",lt="$component",ct=new Set([ot,at,lt]),dt={[ot]:({component:e})=>e.globals,[at]:({viewModel:e})=>e[at],[lt]:({component:e})=>e};class pt{static get(e,t,s){return dt[s]?.({component:e,viewModel:t})}static has(e){return ct.has(e)}}class ht{#Lt=new Map;get(e,t){return this.#Lt.get(e)?.get(t.toString())??void 0}set(e,t,s){return this.#Lt.get(e)?.set(t.toString(),s)??this.#Lt.set(e,new Map([[t.toString(),s]])),s}clear(){this.#Lt.clear()}}class ut extends _{#$t=new ht;get cache(){return this.#$t}getByPropertyName(e,{propName:t},s){if(t.isPrimitive||!this.dependentProps.hasDefaultProp(t.name)&&this.dependentProps.addDefaultProp(t.name),pt.has(t.name))return pt.get(this.component,e,t.name);if(!t.isPrimitive||this.setOfAccessorProperties.has(t.name)){const i=t.level>0?this.lastIndexes.slice(0,t.level):[];let n=this.#$t.get(t,i);return void 0===n&&(n=super.getByPropertyName(e,{propName:t},s),this.#$t.set(t,i,n)),n}return super.getByPropertyName(e,{propName:t},s)}setByPropertyName(e,{propName:t,value:s},i){c.raise("ReadOnlyViewModelHandler: viewModel is read only")}get(e,t,s){return st.has(t)?st.get(e,s,this,t):rt.has(t)?rt.get(e,s,this,t):super.get(e,t,s)}set(e,t,s,i){c.raise("ReadOnlyViewModelHandler: viewModel is read only")}}const mt=new Map;function gt(e){let t=mt.get(e.constructor);if(!t){const s=function(e){const t=new Map;let s=e;for(;s!==Object.prototype;){const e=Object.getOwnPropertyDescriptors(s);for(const[s,i]of Object.entries(e))t.has(s)||t.set(s,i);s=Object.getPrototypeOf(s)}return t}(e),i=Array.from(s.entries()),n=[],o=[],a=[],l=[],c=function(e,t){return e.filter((([e,s])=>s.value!==t&&"function"==typeof s.value))}(i,e.constructor).map((([e,t])=>e));(function(e,t){return e.filter((([e,s])=>s.value!==t&&"function"!=typeof s.value))})(i,e.constructor).forEach((([e,t])=>{o.push(e);r.create(e).isPrimitive?a.push(e):"value"in t&&void 0===t.value&&n.push(e),"get"in t&&void 0!==t.get&&l.push(e)})),t={removeProps:n,definedProps:o,primitiveProps:a,methods:c,accessorProps:l},mt.set(e.constructor,t)}return t.removeProps.forEach((t=>Reflect.deleteProperty(e,t))),{definedProps:t.definedProps,primitiveProps:t.primitiveProps,methods:t.methods,accessorProps:t.accessorProps,viewModel:e}}class ft{#_t;get loopContext(){return this.#_t}async callback(e,t){void 0!==this.#_t&&c.raise("DirectlyCallContext: already set loopContext"),this.#_t=e;try{return await t()}finally{this.#_t=void 0}}}class yt extends _{#kt=new ft;getByPropertyName(e,{propName:t},s){return t.isPrimitive||!this.dependentProps.hasDefaultProp(t.name)&&this.dependentProps.addDefaultProp(t.name),pt.has(t.name)?pt.get(this.component,e,t.name):super.getByPropertyName(e,{propName:t},s)}setByPropertyName(e,{propName:t,value:s},i){t.isPrimitive||!this.dependentProps.hasDefaultProp(t.name)&&this.dependentProps.addDefaultProp(t.name);const n=super.setByPropertyName(e,{propName:t,value:s},i),r=this.lastIndexes;return i[a.writeCallback](t.name,r),this.addNotify(e,{propName:t,indexes:r},i),n}async directlyCallback(e,t){return this.#kt.callback(e,(async()=>{this.stackIndexes.push(void 0);try{return await t()}finally{this.stackIndexes.pop()}}))}#Dt(e){if(void 0===this.#kt.loopContext)return;if("string"!=typeof e||e.startsWith("@@__")||"constructor"===e)return;const t=r.create(e);if(0===t.level||"@"===e.at(0))return;const s=this.#kt.loopContext.find(t.nearestWildcardParentName);return void 0===s&&c.raise(`WritableViewModelHandler: ${e} is outside loop`),s}get(e,t,s){if(st.has(t))return st.get(e,s,this,t);if(rt.has(t))return rt.get(e,s,this,t);{const i=this.#Dt(t);return void 0!==i?this.directlyGet(e,{prop:t,indexes:i.allIndexes},s):super.get(e,t,s)}}set(e,t,s,i){const n=this.#Dt(t);return void 0!==n?this.directlySet(e,{prop:t,indexes:n.allIndexes,value:s},i):super.set(e,t,s,i)}}class vt{#It=!1;get updated(){return this.#It}set updated(e){this.#It=e}#Ut=0;get updateRevision(){return this.#Ut}#Rt=new Map;get bindingsByKey(){return this.#Rt}#Vt=new Set;get expandableBindings(){return this.#Vt}#Ft=new Set;get componentBindings(){return this.#Ft}#Ht=new Set;#Wt=new Set;get allBindings(){return this.#Wt}#jt=new Set;get updatedBindings(){return this.#jt}initUpdate(){this.#It=!1,this.#Ut++,this.#jt=new Set}add(e){this.#It=!0,this.#Ht.has(e)?this.#Ht.delete(e):this.#Wt.add(e)}delete(e){this.#It=!0,this.#Ht.add(e)}flush(){l.debug&&performance.mark("BindingSummary.flush:start");try{if(!this.#It)return;const e=Array.from(this.#Wt).filter((e=>!this.#Ht.has(e)));this.rebuild(e),this.#Ht=new Set}finally{l.debug&&(performance.mark("BindingSummary.flush:end"),performance.measure("BindingSummary.flush","BindingSummary.flush:start","BindingSummary.flush:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures("BindingSummary.flush"),performance.clearMarks("BindingSummary.flush:start"),performance.clearMarks("BindingSummary.flush:end"))}}rebuild(e){this.#Wt=new Set(e),this.#Rt=Map.groupBy(e,(e=>e.viewModelProperty.key)),this.#Vt=new Set(e.filter((e=>e.nodeProperty.expandable))),this.#Ft=new Set(e.filter((e=>e.nodeProperty.constructor===ge))),this.#Ht=new Set}}const bt=new Map;function wt(e,t){Array.from(e.cssRules).map((e=>{"CSSImportRule"===e.constructor.name?wt(e.styleSheet,t):t.insertRule(e.cssText,t.cssRules.length)}))}function Pt(e){const t=new CSSStyleSheet,s=Array.from(document.styleSheets).find((t=>t.title===e));if(s)return wt(s,t),bt.set(e,t),t}const xt=e=>e.trim(),Nt=e=>e.length>0,Ct=e=>bt.get(e)??Pt(e),St=e=>e;const Mt=new WeakMap;class Bt{get baseViewModel(){return this._viewModels.base}get writableViewModel(){return this._viewModels.writable}get readOnlyViewModel(){return this._viewModels.readonly}get viewModel(){return void 0===this.updateSlot||this.updateSlot.phase!==L?this.writableViewModel:this.readOnlyViewModel}get rootBinding(){return this._rootBinding}set rootBinding(e){this._rootBinding=e}get thread(){return this._thread}set thread(e){this._thread=e}get updateSlot(){if(void 0!==this._thread)return void 0===this._updateSlot&&(this._updateSlot=k.create(this,(()=>{this._updateSlot=void 0}),(e=>{e===L&&this.viewModel[a.clearCache]()})),this.thread.wakeup(this._updateSlot)),this._updateSlot}set updateSlot(e){this._updateSlot=e}get props(){return this._props}set props(e){this._props[a.setBuffer](e)}get globals(){return this._globals}get initialPromises(){return this._initialPromises}get alivePromises(){return this._alivePromises}set alivePromises(e){this._alivePromises=e}get parentComponent(){return void 0===this._parentComponent&&(this._parentComponent=(e=>{for(;;){if(null==(e=e.parentNode))return null;if(e.constructor[a.isComponent])return e;if(e instanceof ShadowRoot){if(e.host.constructor[a.isComponent])return e.host;e=e.host}const t=Mt.get(e);if(void 0!==t)return t}})(this)),this._parentComponent}get useShadowRoot(){return this._useShadowRoot}get useWebComponent(){return this._useWebComponent}get useLocalTagName(){return this._useLocalTagName}get useKeyed(){return this._useKeyed}get useLocalSelector(){return this._useLocalSelector}get useOverscrollBehavior(){return this._useOverscrollBehavior}get useBufferedBind(){return this.hasAttribute("buffered-bind")}get viewRootElement(){return this.useWebComponent?this.shadowRoot??this:this.pseudoParentNode}get queryRoot(){return this.viewRootElement}get pseudoParentNode(){return this.useWebComponent?c.raise("mixInComponent: useWebComponent must be false"):this._pseudoParentNode}get pseudoNode(){return this._pseudoNode}get filters(){return this._filters}get bindingSummary(){return this._bindingSummary}get shadowRootOrDocument(){let e=this.parentNode;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}return document}initializeCallback(){const e=this.constructor;this._viewModels=function(e,t){const s=gt(Reflect.construct(t,[])),{viewModel:i,accessorProps:n}=s,r=new Set(n),o=new Xe;return o.setDependentProps(i.$dependentProps??{}),{readonly:new Proxy(i,new ut(e,r,o)),writable:new Proxy(i,new yt(e,r,o)),base:i}}(this,e.ViewModel),this._rootBinding=void 0,this._thread=void 0,this._updateSlot=void 0,this._props=new Proxy({},new w(this)),this._globals=function(e){return new Proxy({},new N(e))}(),this._initialPromises=void 0,this._alivePromises=void 0,this._parentComponent=void 0,this._useShadowRoot=e.useShadowRoot,this._useWebComponent=e.useWebComponent,this._useLocalTagName=e.useLocalTagName,this._useKeyed=e.useKeyed,this._useLocalSelector=e.useLocalSelector,this._useOverscrollBehavior=e.useOverscrollBehavior,this._pseudoParentNode=void 0,this._pseudoNode=void 0,this._filters={in:class extends H{},out:class extends F{},event:class extends W{}},this._bindingSummary=new vt,this._initialPromises=Promise.withResolvers(),this._setOfObservedAttributes=new Set}async build(){const{template:e,styleSheet:t,inputFilters:s,outputFilters:i,eventFilters:n}=this.constructor;for(const[e,t]of Object.entries(s))e in this.filters.in&&c.raise(`mixInComponent: already exists filter ${e}`),this.filters.in[e]=t;for(const[e,t]of Object.entries(i))e in this.filters.out&&c.raise(`mixInComponent: already exists filter ${e}`),this.filters.out[e]=t;for(const[e,t]of Object.entries(n))e in this.filters.event&&c.raise(`mixInComponent: already exists filter ${e}`),this.filters.event[e]=t;if(((e=>-1!==e.indexOf("-"))(o=this.tagName.toLowerCase())||D.has(o))&&this.useShadowRoot&&this.useWebComponent){this.attachShadow({mode:"open"});const e=function(e){return e.map(Ct).filter(St)}((r=this,getComputedStyle(r)?.getPropertyValue("--adopted-css")?.split(" ").map(xt).filter(Nt)??[]));void 0!==t&&e.push(t),this.shadowRoot.adoptedStyleSheets=e}else if(void 0!==t){let e=t;this.useLocalSelector&&(e=void 0!==this.constructor.localStyleSheet?this.constructor.localStyleSheet:this.constructor.localStyleSheet=function(e,t){for(let s of e.cssRules)if(s instanceof CSSStyleRule){const e=s.selectorText.split(",").map((e=>e.trim().startsWith(":host")?e.replace(":host",t):`${t} ${e}`)).join(",");s.selectorText=e}return e}(t,this.selectorName));const s=this.shadowRootOrDocument,i=Array.from(s.adoptedStyleSheets);i.includes(e)||(s.adoptedStyleSheets=[...i,e])}var r,o;if(this.useOverscrollBehavior&&("DIALOG"===this.tagName||this.hasAttribute("popover"))&&(this.style.overscrollBehavior="contain"),this.thread=new S,this.useWebComponent)for(let e=0;e<this.attributes.length;e++){const t=this.attributes[e],[s,i]=t.name.split(":");"props"===s&&(this.props[a.bindProperty](i),this._setOfObservedAttributes.add(t.name))}await this.viewModel[a.connectedCallback](),this.rootBinding=Qe.create(this,e),this.rootBinding.registerBindingsToSummary(),this.rootBinding.applyToNode(),this.bindingSummary.flush(),this.useWebComponent?this.viewRootElement.appendChild(this.rootBinding.fragment):(this.viewRootElement.insertBefore(this.rootBinding.fragment,this.pseudoNode.nextSibling),this.rootBinding.nodes.forEach((e=>Mt.set(e,this)))),this.updateSlot.isEmpty&&this.updateSlot.waitPromises.resolve(!0),await this.updateSlot.alivePromises.promise}async connectedCallback(){try{if(this.parentComponent&&await this.parentComponent.initialPromises.promise,!this.useWebComponent){const e=document.createComment(`@@/${this.tagName}`);this._pseudoParentNode=this.parentNode,this._pseudoNode=e,this.pseudoParentNode.replaceChild(e,this)}this.alivePromises=Promise.withResolvers(),await this.build()}finally{this.initialPromises?.resolve&&this.initialPromises.resolve()}}disconnectedCallback(){this.alivePromises?.resolve&&this.alivePromises.resolve(this.props)}updateNode(e){this.rootBinding&&Qe.updateNode(this.rootBinding,e)}static get observedAttributes(){const e=gt(Reflect.construct(this.ViewModel,[]));return this._propByObservedAttribute=new Map(e.primitiveProps.filter((e=>!e.startsWith("_"))).map((e=>[`props:${c.toKebabCase(e)}`,e]))),Array.from(this._propByObservedAttribute.keys())}static get propByObservedAttribute(){return this._propByObservedAttribute}attributeChangedCallback(e,t,s){if(!this._setOfObservedAttributes.has(e))return;if(void 0===this.constructor.propByObservedAttribute.get(e))return;if(void 0===this.updateSlot)return;const i=new CustomEvent("changeprops");i.propName=e,i.propValue=s,this.dispatchEvent(i),this.updateSlot.phase!==O&&this.viewModel[a.notifyForDependentProps](e,[])}addProcess(e,t,s){const i=new M(e,t,s??[]);this.updateSlot.addProcess(i)}}class _t{get dialogPromises(){return this._dialogPromises}set dialogPromises(e){this._dialogPromises=e}initializeCallback(){this.addEventListener("closed",(()=>{if(void 0!==this.dialogPromises){if(""===this.returnValue)this.dialogPromises.reject();else{const e=this.props[a.getBuffer]();this.props[a.clearBuffer](),this.dialogPromises.resolve(e)}this.dialogPromises=void 0}this.useBufferedBind&&void 0!==this.parentComponent&&""!==this.returnValue&&this.props[a.flushBuffer]()})),this.addEventListener("close",(()=>{const e=new CustomEvent("closed");this.dispatchEvent(e)}))}async _show(e,t=!0){return this.returnValue="",this.dialogPromises=Promise.withResolvers(),this.props[a.setBuffer](e),t?HTMLDialogElement.prototype.showModal.apply(this):HTMLDialogElement.prototype.show.apply(this),this.dialogPromises.promise}async asyncShowModal(e){return this instanceof HTMLDialogElement||c.raise("mixInDialog: asyncShowModal is only for HTMLDialogElement"),this._show(e,!0)}async asyncShow(e){return this instanceof HTMLDialogElement||c.raise("mixInDialog: asyncShow is only for HTMLDialogElement"),this._show(e,!1)}showModal(){if(this instanceof HTMLDialogElement||c.raise("mixInDialog: showModal is only for HTMLDialogElement"),this.useBufferedBind&&void 0!==this.parentComponent){this.returnValue="";const e=this.props[a.createBuffer]();this.props[a.setBuffer](e)}return HTMLDialogElement.prototype.showModal.apply(this)}show(){if(this instanceof HTMLDialogElement||c.raise("mixInDialog: show is only for HTMLDialogElement"),this.useBufferedBind&&void 0!==this.parentComponent){this.returnValue="";const e=this.props[a.createBuffer]();this.props[a.setBuffer](e)}return HTMLDialogElement.prototype.show.apply(this)}close(e=""){return this instanceof HTMLDialogElement||c.raise("mixInDialog: close is only for HTMLDialogElement"),HTMLDialogElement.prototype.close.apply(this,[e])}}class Et{get canceled(){return this._canceled??!1}set canceled(e){this._canceled=e}get popoverPromises(){return this._popoverPromises}set popoverPromises(e){this._popoverPromises=e}initializeCallback(){this.addEventListener("hidden",(()=>{if(void 0!==this.popoverPromises){if(this.canceled)this.popoverPromises.reject();else{const e=this.props[a.getBuffer]();this.props[a.clearBuffer](),this.popoverPromises.resolve(e)}this.popoverPromises=void 0}this.useBufferedBind&&void 0!==this.parentComponent&&(this.canceled||this.props[a.flushBuffer]()),this.canceled=!0;const e=this.id;void 0!==e&&this.popoverContextIndexesById.delete(e)})),this.addEventListener("shown",(()=>{if(this.canceled=!0,this.useBufferedBind&&void 0!==this.parentComponent){const e=this.props[a.createBuffer]();this.props[a.setBuffer](e)}for(const e in this.props)this.viewModel[a.notifyForDependentProps](e,[])})),this.addEventListener("toggle",(e=>{if("closed"===e.newState){const e=new CustomEvent("hidden");this.dispatchEvent(e)}else if("open"===e.newState){const e=new CustomEvent("shown");this.dispatchEvent(e)}}))}async asyncShowPopover(e){return this.popoverPromises=Promise.withResolvers(),this.props[a.setBuffer](e),HTMLElement.prototype.showPopover.apply(this),this.popoverPromises.promise}hidePopover(){this.canceled=!1,HTMLElement.prototype.hidePopover.apply(this)}cancelPopover(){HTMLElement.prototype.hidePopover.apply(this)}get popoverContextIndexesById(){return void 0===this._popoverContextIndexesById&&(this._popoverContextIndexesById=new Map),this._popoverContextIndexesById}}function Tt(e){const t=Object.assign(new y,e);t.filters=Object.assign({},e.filters),t.config=Object.assign({},e.config),t.options=Object.assign({},e.options);const s=function(e){return class extends HTMLElement{static template=e.template;static styleSheet=e.styleSheet;static localStyleSheet;static ViewModel=e.ViewModel;static inputFilters=e.filters?.input??{};static outputFilters=e.filters?.output??{};static eventFilters=e.filters?.event??{};static useShadowRoot=e.config?.useShadowRoot??l.useShadowRoot;static useWebComponent=e.config?.useWebComponent??l.useWebComponent;static useLocalTagName=e.config?.useLocalTagName??l.useLocalTagName;static useKeyed=e.config?.useKeyed??l.useKeyed;static useLocalSelector=e.config?.useLocalSelector??l.useLocalSelector;static useOverscrollBehavior=e.config?.useOverscrollBehavior??l.useOverscrollBehavior;static get[a.isComponent](){return!0}static initializeCallbacks=[];static lowerTagName;get lowerTagName(){return this.constructor.lowerTagName}static selectorName;get selectorName(){return this.constructor.selectorName}static isAutonomousCustomElement;get isAutonomousCustomElement(){return this.constructor.isAutonomousCustomElement}static isCostomizedBuiltInElement;get isCostomizedBuiltInElement(){return this.constructor.isCostomizedBuiltInElement}constructor(){if(super(),void 0===this.constructor.lowerTagName){const e=this.tagName.toLowerCase(),t=e.includes("-"),s=this.hasAttribute("is");if(t)this.constructor.selectorName=e;else{const t=this.getAttribute("is");this.constructor.selectorName=`${e}[is="${t}"]`}this.constructor.lowerTagName=e,this.constructor.isAutonomousCustomElement=t,this.constructor.isCostomizedBuiltInElement=s}this.initialize()}initialize(){this.constructor.initializeCallbacks.forEach((e=>e.apply(this,[])))}}}(t);if(void 0===t.options?.extends);else{const e=document.createElement(t.options.extends).constructor;s.prototype.__proto__=e.prototype,s.__proto__=e}const i=e=>{for(let[t,i]of Object.entries(Object.getOwnPropertyDescriptors(e)))(i.enumerable||void 0!==i.get)&&Object.defineProperty(s,t,i);for(let[t,i]of Object.entries(Object.getOwnPropertyDescriptors(e.prototype)))"constructor"!==t&&("initializeCallback"===t?s.initializeCallbacks.push(i.value):Object.defineProperty(s.prototype,t,i))};return i(Bt),i(_t),i(Et),Ot(t.componentModulesForRegister),s}function At(e,t){const s=c.toKebabCase(e),i=Tt(t);void 0===t.options?.extends?customElements.define(s,i):customElements.define(s,i,{extends:t.options.extends})}function Ot(e){for(const[t,s]of Object.entries(e??{}))At(t,s)}class Lt{static register(e,t){}}class $t{static toKebabCase=e=>"string"==typeof e?e.replaceAll(/[\._]/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e}const kt="kebab",Dt="snake",It="uppercamel",Ut="lowercamel",Rt="dotted";class Vt{static getNames(e){const t=$t.toKebabCase(e),s=t.replaceAll("-","_"),i=t.replaceAll("-","."),n=t.split("-").map(((e,t)=>(void 0!==e[0]&&(e=e[0].toUpperCase()+e.slice(1)),e))).join(""),r=n.length>0?n[0].toLowerCase()+n.slice(1):n;return{[kt]:t,[Dt]:s,[It]:n,[Ut]:r,[Rt]:i}}}const Ft=Ut;class Ht{defaultNameType=Ft;defaultPath="./";loadNames=[];prefixMap}class Wt{prefix;path;get matchPrefix(){return`${this.prefix}-`}isMatch(e){return e.startsWith(this.matchPrefix)}getNames(e){const{prefix:t,path:s}=this;if(e.startsWith(this.matchPrefix)){return{prefixName:t,subName:e.slice(this.matchPrefix.length),path:s}}}}const jt=Vt.getNames("prefix-name"),zt=Vt.getNames("sub-name");class Kt{static getPathInfo(e,t,s,i){const[n,r]=e.split("#");let o=n,a=r;const l=Vt.getNames(t),c=Vt.getNames(s);return o=o.replaceAll(`{${jt[kt]}}`,l[kt]),o=o.replaceAll(`{${jt[Dt]}}`,l[Dt]),o=o.replaceAll(`{${jt[Ut]}}`,l[Ut]),o=o.replaceAll(`{${jt[It]}}`,l[It]),o=o.replaceAll(`{${jt[Rt]}}`,l[Rt]),o=o.replaceAll(`{${zt[kt]}}`,c[kt]),o=o.replaceAll(`{${zt[Dt]}}`,c[Dt]),o=o.replaceAll(`{${zt[Ut]}}`,c[Ut]),o=o.replaceAll(`{${zt[It]}}`,c[It]),o=o.replaceAll(`{${zt[Rt]}}`,c[Rt]),n===o&&".js"!==o.slice(-3)&&(o=o+("/"!==e.slice(-1)?"/":"")+c[i]+".js"),a&&(a=a.replaceAll(`{${zt[kt]}}`,c[kt]),a=a.replaceAll(`{${zt[Dt]}}`,c[Dt]),a=a.replaceAll(`{${zt[Ut]}}`,c[Ut]),a=a.replaceAll(`{${zt[It]}}`,c[It]),a=a.replaceAll(`{${zt[Rt]}}`,c[Rt])),{filePath:o,exportName:a}}}class qt{#zt;#Kt;#qt;#Gt;#Yt;constructor(e){this.#Gt=e,this.#Yt=window.location,this.setConfig(new Ht)}setConfig(e){this.#Kt=Object.assign(new Ht,e),"prefixMap"in e&&void 0!==e.prefixMap&&this.setPrefixMap(e.prefixMap)}getConfig(){return this.#Kt}setPrefixMap(e){this.#qt=new Map(Object.entries(e).map((([e,t])=>[e=$t.toKebabCase(e),Object.assign(new Wt,{prefix:e,path:t})])))}getPrefixMap(){return this.#qt}configFile(e){return this.#zt=e,this}config(e){return this.setConfig(e),this}prefixMap(e){return this.setPrefixMap(e),this}get registrar(){return this.#Gt}async loadConfig(e){const t=this.#Yt.pathname.split("/");t[t.length-1]=e;const s=this.#Yt.origin+t.join("/");try{const e=await fetch(s),t=await e.json();return Object.assign(new Ht,t)}catch(e){throw new Error(e)}}async load(...e){if(void 0!==this.#zt){const e=await this.loadConfig(this.#zt);this.setConfig(e)}if(void 0===this.#qt)throw new Error("prefixMap is not defined");if(void 0===this.#Gt)throw new Error("registrar is not defined");const t=Array.from(this.#qt.values()),{defaultNameType:s,defaultPath:i}=this.#Kt;e=e.length>0?e:this.#Kt.loadNames;for(let n of e){let e;n=$t.toKebabCase(n);const r=t.find((e=>e.isMatch(n)));if(void 0!==r){const t=r.getNames(n);e=Kt.getPathInfo(t.path,t.prefixName,t.subName,s)}if(void 0===e&&void 0!==i&&(e=Kt.getPathInfo(i,"",n,s)),void 0===e)throw new Error(`unmatch prefix and no defaultPath (loadName:${n})`);const o=this.#Yt.pathname.split("/");o[o.length-1]=e.filePath;const a=this.#Yt.origin+o.join("/");let l,c;try{l=await import(a)}catch(e){throw new Error(e)}if(void 0!==e.exportName){if(void 0!==l.default?e.exportName in l.default&&(c=l.default[e.exportName]):e.exportName in l&&(c=l[e.exportName]),void 0===c)throw new Error(`${e.exportName} not found in module (exportName:${e.exportName}, ${e.filePath})`)}else c=void 0!==l.default?l.default:Object.assign({},l);this.#Gt.register(n,c)}return this}static create(e){return new qt(e)}}const Gt="*filter-";const Yt=qt.create(class extends Lt{static register(e,t){if(e.startsWith(Gt)){const s=e.slice(8),{output:i,input:n,event:r}=t;Y.register(s,i,n,r)}else!function(e,t){if("function"!=typeof e)return!1;let s=e;for(;s;){if(s===t)return!0;s=Object.getPrototypeOf(s)}return!1}(t,HTMLElement)?"ViewModel"in t&&"html"in t&&At(e,t):customElements.define(e,t)}});function Jt(e){return new URL(e.url).search.slice(1)}async function Zt(e){return await fetch(e.url.replace(".js",".html")).then((e=>e.text()))}async function Qt(e){return await fetch(e.url.replace(".js",".css")).then((e=>e.text()))}async function Xt(e,t){const s=await fetch(e.resolve(t??"./quel.config.json")),i=await s.json();for(let[e,t]of Object.entries(l))l[e]=void 0!==i[e]?i[e]:t;await Yt.config(i).load()}function es(e){Object.entries(e).forEach((([e,t])=>{const{input:s,output:i}=t;Y.register(e,i,s)}))}function ts(e){Object.assign(x.data,e)}export{Xt as bootFromImportMeta,l as config,Tt as generateComponentClass,Jt as getCustomTagFromImportMeta,Qt as importCssFromImportMeta,Zt as importHtmlFromImportMeta,Yt as loader,Ot as registerComponentModules,es as registerFilters,ts as registerGlobal};
