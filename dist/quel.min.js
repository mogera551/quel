const e={debug:!1,useShadowRoot:!1,useKeyed:!0,useWebComponent:!0,useLocalTagName:!0,useLocalSelector:!0,useOverscrollBehavior:!0};function t(e){return new URL(e.url).search.slice(1)}async function n(e){return await fetch(e.url.replace(".js",".html")).then((e=>e.text()))}async function s(e){return await fetch(e.url.replace(".js",".css")).then((e=>e.text()))}class o{defaultNameType="lowerCamel";defaultPath="./";loadNames=[];prefixMap}class i{prefix;path;get matchPrefix(){return`${this.prefix}-`}constructor(e,t){this.prefix=e,this.path=t}isMatch(e){return e.startsWith(this.matchPrefix)}getNames(e){const{prefix:t,path:n}=this;if(e.startsWith(this.matchPrefix)){return{prefixName:t,subName:e.slice(this.matchPrefix.length),path:n}}}}const r=e=>"string"==typeof e?e.replaceAll(/[\._]/g,"-").replaceAll(/([A-Z])/g,((e,t,n)=>(n>0?"-":"")+t.toLowerCase())):e;function a(e){const t=r(e),n=t.replaceAll("-","_"),s=t.replaceAll("-","."),o=t.split("-").map(((e,t)=>(void 0!==e[0]&&(e=e[0].toUpperCase()+e.slice(1)),e))).join(""),i=o.length>0?o[0].toLowerCase()+o.slice(1):o;return{kebab:t,snake:n,upperCamel:o,lowerCamel:i,dotted:s}}const l=a("prefix-name"),d=a("sub-name");function c(e,t,n,s){const[o,i]=e.split("#");let r=o,c=i;const p=a(t),u=a(n);return r=r.replaceAll(`{${l.kebab}}`,p.kebab),r=r.replaceAll(`{${l.snake}}`,p.snake),r=r.replaceAll(`{${l.lowerCamel}}`,p.lowerCamel),r=r.replaceAll(`{${l.upperCamel}}`,p.upperCamel),r=r.replaceAll(`{${l.dotted}}`,p.dotted),r=r.replaceAll(`{${d.kebab}}`,u.kebab),r=r.replaceAll(`{${d.snake}}`,u.snake),r=r.replaceAll(`{${d.lowerCamel}}`,u.lowerCamel),r=r.replaceAll(`{${d.upperCamel}}`,u.upperCamel),r=r.replaceAll(`{${d.dotted}}`,u.dotted),o===r&&".js"!==r.slice(-3)&&(r=r+("/"!==e.slice(-1)?"/":"")+u[s]+".js"),c&&(c=c.replaceAll(`{${d.kebab}}`,u.kebab),c=c.replaceAll(`{${d.snake}}`,u.snake),c=c.replaceAll(`{${d.lowerCamel}}`,u.lowerCamel),c=c.replaceAll(`{${d.upperCamel}}`,u.upperCamel),c=c.replaceAll(`{${d.dotted}}`,u.dotted)),{filePath:r,exportName:c}}class p{static raise(e){throw new Error(e)}static toKebabCase=e=>"string"==typeof e?e.replaceAll(/_/g,"-").replaceAll(/([A-Z])/g,((e,t,n)=>(n>0?"-":"")+t.toLowerCase())):e;static createUUID(){return window?.crypto?.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=((new Date).getTime()+16*Math.random())%16|0;return("x"==e?t:3&t|8).toString(16)}))}}class u{#e;#t;#n=new Map;#s;#o;constructor(e){this.#s=e,this.#o=window.location,this.#t=Object.assign(new o)}setConfig(e){this.#t=Object.assign(new o,e),"prefixMap"in e&&void 0!==e.prefixMap&&this.setPrefixMap(e.prefixMap)}getConfig(){return this.#t}setPrefixMap(e){this.#n=new Map(Object.entries(e).map((([e,t])=>[r(e),new i(e,t)])))}getPrefixMap(){return this.#n}configFile(e){return this.#e=e,this}config(e){return this.setConfig(e),this}prefixMap(e){return this.setPrefixMap(e),this}get registrar(){return this.#s}async loadConfig(e){const t=this.#o.pathname.split("/");t[t.length-1]=e;const n=this.#o.origin+t.join("/");try{const e=await fetch(n),t=await e.json();return Object.assign(new o,t)}catch(t){throw console.error(`config file load error (configFile:${e}, ${n})`,t),new Error("config file load error")}}async load(...e){if(void 0!==this.#e){const e=await this.loadConfig(this.#e);this.setConfig(e)}if(void 0===this.#n)throw new Error("prefixMap is not defined");if(void 0===this.#s)throw new Error("registrar is not defined");const t=Array.from(this.#n.values()),{defaultNameType:n,defaultPath:s}=this.#t;e=e.length>0?e:this.#t.loadNames;for(let o of e){let e;o=r(o);const i=t.find((e=>e.isMatch(o)));if(void 0!==i){const t=i.getNames(o)??p.raise(`names not found (loadName:${o})`);e=c(t.path,t.prefixName,t.subName,n)}if(void 0===e&&void 0!==s&&(e=c(s,"",o,n)),void 0===e)throw new Error(`unmatch prefix and no defaultPath (loadName:${o})`);const a=this.#o.pathname.split("/");a[a.length-1]=e.filePath;const l=this.#o.origin+a.join("/");let d,u;try{d=await import(l)}catch(e){throw console.error(`import error (loadName:${o}, ${l})`,e),new Error("import error")}if(void 0!==e.exportName){if(void 0!==d.default?e.exportName in d.default&&(u=d.default[e.exportName]):e.exportName in d&&(u=d[e.exportName]),void 0===u)throw new Error(`${e.exportName} not found in module (exportName:${e.exportName}, ${e.filePath})`)}else u=void 0!==d.default?d.default:Object.assign({},d);this.#s(o,u)}return this}static create(e){return new u(e)}}const h={objectClass:Object,prefix:"object",prefixShort:"o",prototypeFuncs:new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),staticFuncs:new Set(["create","defineProperties","defineProperty","entries","fromEntries","getOwnPropertyDescriptor","getOwnPropertyDescriptors","getOwnPropertyNames","getOwnPropertySymbols","getPrototypeOf","is","isExtensible","isFrozen","isSealed","keys","preventExtensions","values"])},m={objectClass:Array,prefix:"array",prefixShort:"a",prototypeFuncs:new Set(["at","concat","entries","flat","includes","indexOf","join","keys","lastIndexOf","slice","toLocaleString","toReversed","toSorted","toSpliced","values","with","toString"]),staticFuncs:new Set(["from","isArray","of"])},f={objectClass:Number,prefix:"number",prefixShort:"n",prototypeFuncs:new Set(["toExponential","toFixed","toLocaleString","toPrecision","toString","valueOf"]),staticFuncs:new Set(["isFinite","isInteger","isNaN","isSafeInteger","parseFloat","parseInt"])},g={objectClass:String,prefix:"string",prefixShort:"s",prototypeFuncs:new Set(["at","charAt","charCodeAt","codePointAt","concat","endsWith","includes","indexOf","lastIndexOf","localeCompare","match","normalize","padEnd","padStart","repeat","replace","replaceAll","search","slice","split","startsWith","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim","trimEnd","trimStart","valueOf","toString"]),staticFuncs:new Set(["fromCharCode","fromCodePoint","raw"])},y={objectClass:Date,prefix:"date",prefixShort:"",prototypeFuncs:new Set(["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","toDateString","toISOString","toJSON","toLocaleDateString","toLocaleString","toLocaleTimeString","toTimeString","toUTCString","valueOf","toString"]),staticFuncs:new Set(["now","parse","UTC"])},x={objectClass:Set,prefix:"set",prefixShort:"",prototypeFuncs:new Set(["entries","forEach","has","keys","values"]),staticFuncs:new Set([])},b={objectClass:Map,prefix:"map",prefixShort:"",prototypeFuncs:new Set(["entries","forEach","get","has","keys","values"]),staticFuncs:new Set(["groupBy"])},v={objectClass:JSON,prefix:"json",prefixShort:"",prototypeFuncs:new Set([]),staticFuncs:new Set(["parse","stringify"])},w={objectClass:Math,prefix:"math",prefixShort:"",prototypeFuncs:new Set([]),staticFuncs:new Set(["abs","acos","acosh","asin","asinh","atan","atan2","atanh","cbrt","ceil","clz32","cos","cosh","exp","expm1","floor","fround","hypot","imul","log","log10","log1p","log2","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc"])},C={objectClass:RegExp,prefix:"regexp",prefixShort:"",prototypeFuncs:new Set(["exec","test","toString"]),staticFuncs:new Set([])};class P{static"truthy*"=e=>e=>!!e;static"falsey*"=e=>e=>!e;static"not*"=this["falsey*"];static eq=e=>t=>t==e[0];static ne=e=>t=>t!=e[0];static lt=e=>t=>Number(t)<Number(e[0]);static le=e=>t=>Number(t)<=Number(e[0]);static gt=e=>t=>Number(t)>Number(e[0]);static ge=e=>t=>Number(t)>=Number(e[0]);static oi=e=>t=>Number(e[0])<Number(t)&&Number(t)<Number(e[1]);static ci=e=>t=>Number(e[0])<=Number(t)&&Number(t)<=Number(e[1]);static embed=e=>t=>(e[0]??"").replaceAll("%s",t);static iftext=e=>t=>t?e[0]??null:e[1]??null;static"isnull*"=e=>e=>null==e;static offset=e=>t=>Number(t)+Number(e[0]);static unit=e=>t=>String(t)+String(e[0]);static inc=this.offset;static mul=e=>t=>Number(t)*Number(e[0]);static div=e=>t=>Number(t)/Number(e[0]);static mod=e=>t=>Number(t)%Number(e[0]);static prop=e=>t=>t[e[0]];static prefix=e=>t=>String(e[0])+String(t);static suffix=this.unit;static date=e=>t=>Date.prototype.toLocaleDateString.apply(t,["sv-SE",e[0]?e[0]:{}]);static"isnan*"=e=>e=>isNaN(e)}new Set([]);const N=new Set(["truthy*","falsey*","not*","eq","ne","lt","le","gt","ge","oi","ci","embed","iftext","isnull*","offset","unit","inc","mul","div","mod","prop","prefix","suffix","date","isnan*"]);function S(e,t){if(Reflect.has(e,"prototype")){const n=Reflect.get(e,"prototype");if(Reflect.has(n,t)){const e=Reflect.get(n,t);return t=>n=>e.apply(n,t)}}}function B(e,t){if(Reflect.has(e,t)){const n=Reflect.get(e,t);return e=>t=>n.apply(null,[t,...e])}}const I=[y,x,b,v,C,m,h,f,g,w],L=e=>t=>n=>null==n?n:e(t)(n),E=(e,t)=>t(e),F=e=>e=>e;class T{static create(e,t){const n=[];for(let s=0;s<e.length;s++){const o=e[s],i=t.getFilterFunc(o.name)(o.options);n.push(i)}return n}}class M{ambigousNames=new Set;funcByName=new Map;registerFilter(e,t){const n=e.endsWith("*"),s=n?e.slice(0,-1):e;this.funcByName.has(s)&&p.raise(`${this.constructor.name}: ${s} is already registered`);const o=n?t:L(t);this.funcByName.set(s,o)}getFilterFunc(e){return this.ambigousNames.has(e)&&p.raise(`${this.constructor.name}: ${e} is ambigous`),this.funcByName.get(e)??F}static applyFilter(e,t){return t.reduce(E,e)}}class $ extends M{constructor(){super(),this.ambigousNames=new Set($.#i),this.funcByName=new Map($.#r)}static#i=new Set;static#r=new Map;static{const e=new Set,t=new Map;for(const n of I){for(const s of n.prototypeFuncs){const o=s.endsWith("*"),i=o?s.slice(0,-1):s,r=S(n.objectClass,i);if(void 0!==r){const s=o?r:L(r);n.prefix&&t.set(`${n.prefix}.${i}`,s),n.prefixShort&&t.set(`${n.prefixShort}.${i}`,s),t.has(i)?e.add(i):t.set(i,s)}}for(const s of n.staticFuncs){const o=s.endsWith("*"),i=o?s.slice(0,-1):s,r=B(n.objectClass,i);if(void 0!==r){const s=o?r:L(r);n.prefix&&t.set(`${n.prefix}.${i}`,s),n.prefixShort&&t.set(`${n.prefixShort}.${i}`,s),t.has(i)?e.add(i):t.set(i,s)}}}for(const e of N){const n=e.endsWith("*"),s=n?e.slice(0,-1):e,o=Reflect.get(P,e);void 0===o&&p.raise(`${this.name}: ${e} is not found in defaultFilterGroup`);const i=n?o:L(o);t.set(s,i)}for(const n of e)t.delete(n);this.#i=e,this.#r=t}static registerFilter(e,t){const n=e.endsWith("*"),s=n?e.slice(0,-1):e;this.#r.has(s)&&p.raise(`${this.name}: ${s} is already registered`);const o=n?t:L(t);this.#r.set(s,o)}}class k{static date=e=>e=>""===e?null:new Date(new Date(e).setHours(0));static number=e=>e=>""===e?null:Number(e);static boolean=e=>e=>"false"!==e&&""!==e}class V extends M{constructor(){super(),this.ambigousNames=new Set(V.#i),this.funcByName=new Map(V.#r)}static#i=new Set;static#r=new Map;static{this.#r.set("date",k.date),this.#r.set("number",k.number),this.#r.set("boolean",k.boolean)}static registerFilter(e,t){this.#r.has(e)&&p.raise(`${this.name}: ${e} is already registered`),this.#r.set(e,t)}}class A{static preventDefault=e=>e=>(e.preventDefault(),e);static noStopPropagation=e=>e=>(Reflect.set(e,"noStopPropagation",!0),e);static pd=this.preventDefault;static nsp=this.noStopPropagation}class R extends M{constructor(){super(),this.ambigousNames=new Set(R.#i),this.funcByName=new Map(R.#r)}static#i=new Set;static#r=new Map;static{this.#r.set("preventDefault",A.preventDefault),this.#r.set("noStopPropagation",A.noStopPropagation),this.#r.set("pd",A.preventDefault),this.#r.set("nsp",A.noStopPropagation)}static registerFilter(e,t){this.#r.has(e)&&p.raise(`${this.name}: ${e} is already registered`),this.#r.set(e,t)}}const O="data-bind",j="data-uuid",D={};function H(e){const t=Array.from(e.childNodes);for(let e=0;e<t.length;e++){const n=t[e];n.nodeType===Node.TEXT_NODE&&(n.textContent?.match(/^\s*$/)&&n.parentNode?.removeChild(n))}}function U(e){return D[e]}function W(e,t,n){const s=document.createElement("template");return s.innerHTML=function(e,t,n){const s=[],o=e.replaceAll(/\{\{([^\}]+)\}\}/g,((e,t)=>{if((t=t.trim()).startsWith("loop:")||t.startsWith("if:"))return s.push(t),`<template data-bind="${t}">`;if(t.startsWith("else:")){const e=s[s.length-1];return void 0!==e&&e.startsWith("if:")||p.raise(`Template: endif: is not matched with if:, but {{ ${t} }} `),`</template><template data-bind="${e}|not">`}if(t.startsWith("end:"))return void 0===s.pop()&&p.raise(`Template: end: is not matched with loop: or if:, but {{ ${t} }} `),"</template>";if(t.startsWith("endif:")){const e=s.pop();return void 0!==e&&e.startsWith("if:")||p.raise(`Template: endif: is not matched with if:, but {{ ${e} }} `),"</template>"}if(t.startsWith("endloop:")){const e=s.pop();return void 0!==e&&e.startsWith("loop:")||p.raise(`Template: endloop: is not matched with loop:, but {{ ${e} }} `),"</template>"}return`\x3c!--@@:${t}--\x3e`}));s.length>0&&p.raise(`Template: loop: or if: is not matched with endloop: or endif:, but {{ ${s[s.length-1]} }} `);const i=document.createElement("template");i.innerHTML=o;const r=n.map((e=>p.toKebabCase(e))),a=e=>{for(const n of r){const s=Array.from(e.querySelectorAll(n));for(const e of s){const s=document.createElement(`${n}-${t}`);for(let t=0;t<e.attributes.length;t++){const n=e.attributes[t];s.setAttribute(n.name,n.value)}s.setAttribute("data-orig-tag-name",n),e.parentNode?.replaceChild(s,e)}const o=Array.from(e.querySelectorAll(`[is="${n}"]`));for(const e of o){const s=document.createElement(e.tagName,{is:`${n}-${t}`});for(let t=0;t<e.attributes.length;t++){const n=e.attributes[t];"is"!==n.name&&s.setAttribute(n.name,n.value)}s.setAttribute("data-orig-is",n),e.parentNode?.replaceChild(s,e)}}const n=Array.from(e.querySelectorAll("template"));for(const e of n)a(e.content)};r.length>0&&a(i.content);const l=e=>{let t;for(;t=e.querySelector("template");){const e=p.createUUID(),n=document.createComment(`@@|${e}`);if(t.parentNode?.replaceChild(n,t),t.constructor!==HTMLTemplateElement){const e=document.createElement("template");for(let n of Array.from(t.childNodes))e.content.appendChild(n);const n=t.getAttribute(O);n&&e.setAttribute(O,n),t=e}t.setAttribute(j,e),l(t.content),H(t.content),D[e]=t}};return l(i.content),i.innerHTML}(e,t,n),s.setAttribute(j,t),H(s.content),D[t]=s,s}const _=new Map;function z(e,t){const n=_.get(t);if(n)return n;const s=function(e){const t=new CSSStyleSheet;return t.replaceSync(e),t}(e);return _.set(t,s),s}class K{#a=p.createUUID();get uuid(){return this.#a}#l="";get html(){return this.#l}set html(e){this.#l=e,this.#d=void 0}#c;get css(){return this.#c}set css(e){this.#c=e,this.#p=void 0}#d;get template(){if(void 0===this.#d){const t=this.config.useLocalTagName??e.useLocalTagName?Object.keys(this.componentModules??{}):[];this.#d=W(this.html,this.uuid,t)}return this.#d}#p;get styleSheet(){return void 0===this.#p&&(this.#p=this.css?z(this.css,this.uuid):void 0),this.#p}State=class{};config={};moduleConfig={};options={};filters={};componentModules;get componentModulesForRegister(){if((this.config.useLocalTagName??e.useLocalTagName)&&void 0!==this.componentModules){const e={};for(const[t,n]of Object.entries(this.componentModules))e[`${p.toKebabCase(t)}-${this.uuid}`]=n;return e}return this.componentModules}}const q="state",G=Symbol.for(`${q}.accessorProperties`),Q=Symbol.for(`${q}.dependencies`),J=Symbol.for(`${q}.connectedEvent`),Y=Symbol.for(`${q}.disconnectedEvent`),Z=Symbol.for(`${q}.updatedEvent`),X=Symbol.for(`${q}.connectedCallback`),ee=Symbol.for(`${q}.disconnectedCallback`),te=Symbol.for(`${q}.updatedCallback`),ne=Symbol.for(`${q}.directlyCallApi`),se=Symbol.for(`${q}.notifyForDependentPropsApi`),oe=Symbol.for(`${q}.getDependentPropsApi`),ie=Symbol.for(`${q}.clearCacheApi`),re=Symbol.for(`${q}.createBufferApi`),ae=Symbol.for(`${q}.flushBufferApi`),le=new Set(["articles","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]),de=e=>-1!==e.indexOf("-");const ce=new Map;function pe(e,t){Array.from(e.cssRules).map((e=>{if("CSSImportRule"===e.constructor.name){const n=e;n.styleSheet?pe(n.styleSheet,t):console.log(`import rule not found: ${n.href}`)}else t.insertRule(e.cssText,t.cssRules.length)}))}function ue(e){const t=new CSSStyleSheet,n=Array.from(document.styleSheets).filter((t=>t.title===e));if(0!==n.length)return n.forEach((e=>pe(e,t))),ce.set(e,t),t;console.log(`style sheet not found: ${e}`)}const he=e=>ce.get(e)??ue(e),me=e=>void 0!==e;async function fe(e,t){return void 0===t.loopContext?e.namedLoopIndexesStack.asyncSetNamedLoopIndexes({},(async()=>Reflect.apply(t.target,t.thisArgument,t.argumentList))):e.loopContextStack.setLoopContext(e.namedLoopIndexesStack,t.loopContext,(async()=>Reflect.apply(t.target,t.thisArgument,t.argumentList)))}async function ge(e,t){for(let n=0;n<t.length;n++)await fe(e,t[n]);return e.retrieveAllUpdatedStateProperties()}function ye(e,t,n){const s=n.map((e=>({name:e.pattern,indexes:e.loopIndexes?.values})));e.addProcess((async()=>{await t.current[te](s)}),void 0,[],void 0)}async function xe(e,t){const n=[];return await t.writable((async()=>{for(;;){const s=e.retrieveAllProcesses();if(0===s.length)break;const o=await ge(e,s);o.length>0&&(n.push(...o),ye(e,t,o))}})),n}const be=new Map;function ve(e){let t;return be.get(e)??(t=function(e){const t=e.split("."),n=[],s=[];for(let e=0;e<t.length;e++){let o="";for(let n=0;n<=e;n++)o+=t[n]+(n<e?".":"");"*"===t[e]&&s.push(o),n.push(o)}return{patternElements:t,patternPaths:n,wildcardPaths:s}}(e),be.set(e,t),t)}const we="do-notation",Ce=Symbol.for(`${we}.getDirect`),Pe=Symbol.for(`${we}.setDirect`),Ne=Symbol.for(`${we}.getAccessor`),Se=Symbol.for(`${we}.setAccessor`),Be=Symbol.for(`${we}.getAccessor`),Ie=Symbol.for(`${we}.setAccessor`);class Le{#u;#h;#m;#f;#g;get parentLoopIndexes(){return this.#u}get value(){return this.#h}get values(){return void 0===this.#m&&(void 0===this.parentLoopIndexes?this.#m=[this.#h]:this.#m=this.parentLoopIndexes.values.concat(this.#h)),this.#m}get index(){return void 0===this.#g&&(void 0===this.parentLoopIndexes?this.#g=0:this.#g=this.parentLoopIndexes.index+1),this.#g}get size(){return this.index+1}truncate(e){let t=this;for(;void 0!==t;){if(t.index<e)return t;t=t.parentLoopIndexes}}constructor(e,t){this.#u=e,this.#h=t}add(e){return new Le(this,e)}*backward(){yield this.#h,void 0!==this.#u&&(yield*this.#u.backward())}*forward(){void 0!==this.#u&&(yield*this.#u.forward()),yield this.#h}toString(){return void 0===this.#f&&(void 0!==this.#u?this.#f=this.#u.toString()+","+this.#h:this.#f=this.#h?.toString()??""),this.#f}at(e){let t,n;for(e>=0?t=this.forward():(e=-e-1,t=this.backward());e>=0;)n=t.next(),e--;return n?.value}}function Ee(e,t=e.length-1){const n=e[t];return new Le(t>0?Ee(e,t-1):void 0,n)}function Fe(e,t){return void 0===e?Ee([t]):e.add(t)}const Te=new Map;function Me(e){let t;return Te.get(e)??(t=function(e){let t=!1;"@"===e[0]&&(e=e.slice(1),t=!0);const n=new Map,s=e.split("."),o=s.slice();let i;const r=[];let a=0,l=0,d="",c=0,p="none";for(let e=0;e<s.length;e++){const t=s[e];if("*"===t)i=Fe(i,void 0),o[e]="*",a++,c++;else{const n=Number(t);Number.isNaN(n)||(i=Fe(i,n),o[e]="*",l++,c++)}d+=t,r.push(d),d+=e<s.length-1?".":""}const u=o.join("."),h=ve(u);let m=i;for(let e=h.wildcardPaths.length-1;e>=0;e--){if(void 0===m)throw new Error("_getPropInfo: tmpWildcardLoopIndexes is undefined.");n.set(h.wildcardPaths[e],m),m=m?.parentLoopIndexes}return(a>0||l>0)&&(p=a===c?"context":l===c?"all":"partial"),{name:e,expandable:t,pattern:u,elements:s,paths:r,wildcardCount:c,wildcardLoopIndexes:i,wildcardNamedLoopIndexes:n,patternElements:h.patternElements,patternPaths:h.patternPaths,wildcardPaths:h.wildcardPaths,wildcardType:p}}(e),Te.set(e,t),t)}class $e{#y;#x;#b;#v;get pattern(){return this.#y}get patternInfo(){return void 0===this.#x&&(this.#x=Me(this.#y)),this.#x}get loopIndexes(){return this.#b}get key(){return void 0===this.#v&&(this.#v=this.pattern+"\t"+(this.loopIndexes?.toString()??"")),this.#v}constructor(e,t=void 0){this.#y=e,this.#b=t}}function ke(e,t){return new $e(e,t)}function Ve(e,t,n,s=new Set([])){const{pattern:o,loopIndexes:i}=t,r=o+"\t"+(i?.toString()??"");if(s.has(r))return[];s.add(r);const a=e[oe]().propsByRefProp[o];if(void 0===a)return[];const l=[],d=[],c=[];for(let e=0;e<(i?.size??0);e++)c.push(i?.at(e)),d.push(c.toString());for(const t of a){const o=ve(t);if(!o.wildcardPaths.some(((e,t)=>{const s=ve(e).patternPaths.at(-2)+"\t"+(d[t-1]??"");return n.has(s)}))){if((i?.size??0)<o.wildcardPaths.length){const n=Ae(e,ke(t,i));l.push(...n.map((e=>ke(t,e))))}else{const e=i?.truncate(o.wildcardPaths.length);l.push(ke(t,e))}l.push(...Ve(e,ke(t,i),n,s))}}return l}function Ae(e,t){const{pattern:n,loopIndexes:s}=t;if(void 0===s)return[];const o=Me(n);if(o.wildcardCount===s.size)return[s];if(o.wildcardCount<s.size)return[s.truncate(o.wildcardCount)];{const t=(t,n)=>e[Ne](ke(t,n)).length,n=(e,i,r)=>{const a=""!==e?e+".":e,l=o.elements[i];if(o.elements.length-1===i){if("*"===l){const n=[],s=t(e,r);for(let e=0;e<s;e++)n.push(Fe(r,e));return n}return void 0!==r?[r]:[]}{const o=a+l;if("*"===l){if(s.size<(r?.size??0))return n(o,i+1,r?.truncate(s.size+1));{const s=[],a=t(e,r);for(let e=0;e<a;e++)s.push(...n(o,i+1,Fe(r,e)));return s}}return n(o,i+1,s)}};return n("",0,void 0)}}function Re(e,t){const n=t.slice(0),s=new Set(t.map((e=>e.pattern+"\t"+(e.loopIndexes?.toString()??""))));for(let o=0;o<t.length;o++)n.push.apply(n,Ve(e.current,t[o],s));return n}const Oe=[];function je(e=void 0){const t=Oe.pop()??new Map;if(void 0===e)return t;const n=e.patternInfo.wildcardPaths;if(0===n.length||void 0===e.loopIndexes)return t;let s=e.loopIndexes;for(let e=0;e<n.length;e++){void 0===s&&p.raise("createNamedLoopIndexesFromAccessor: loopIndexes is undefined.");const o=n.at(-(e+1))??p.raise("createNamedLoopIndexesFromAccessor: wildcardPath is undefined.");t.set(o,s),s=s.parentLoopIndexes}return t}async function De(e,t,n,s){for(let o=0;o<n.length;o++){const i=n[o],r=t.gatherBindings(i);for(let t=0;t<r.length;t++){const n=r[t];if(!n.expandable)continue;const o=n.stateProperty.name+".",a=s.some((e=>e.startsWith(o))),l=je(i);e.setFullRebuild(a,(()=>{e.namedLoopIndexesStack.setNamedLoopIndexes(l,(()=>{n.rebuild()}))}))}}}function He(e,t,n,s){t?.applyNodeUpdatesByBinding(e,(()=>{n.applyToChildNodes(s)}))}function Ue(e,t,n){const s={},o={};for(const e of n){const t=e.patternInfo.patternElements;if("*"!==t[t.length-1])continue;const n=e.loopIndexes?.index;if(void 0===n)continue;const i=e.patternInfo.patternPaths,r=e.loopIndexes?.parentLoopIndexes,a=ke(i.at(-2)??"",r),l=a.key;o[l]?.add(n)??(o[l]=new Set([n])),s[l]=a}for(const[n,i]of Object.entries(o)){const o=s[n];t.gatherBindings(o).forEach((t=>{const n=je(o);e.namedLoopIndexesStack.setNamedLoopIndexes(n,(()=>{He(t,e,t.nodeProperty,i)}))}))}}async function We(e,t,n){const s=[];for(let o=0;o<n.length;o++){const i=n[o],r=ke(i.patternInfo.wildcardPaths.at(-1)??"",i.loopIndexes);t.gatherBindings(i).forEach((async t=>{if(!t.expandable)if(t.nodeProperty.isSelectValue)s.push({binding:t,propertyAccessor:i});else{const n=je(r);e.namedLoopIndexesStack.setNamedLoopIndexes(n,(()=>{t.updateNodeForNoRecursive()}))}}))}for(let t=0;t<s.length;t++){const n=s[t],o=n.propertyAccessor,i=je(ke(o.patternInfo.wildcardPaths.at(-1)??"",o.loopIndexes));e.namedLoopIndexesStack.setNamedLoopIndexes(i,(()=>{n.binding.updateNodeForNoRecursive()}))}}class _e{stack;async setLoopContext(e,t,n){e.stack.length>0&&p.raise("namedLoopIndexesStack is already set.");let s=t;const o={};for(;void 0!==s;){o[s.patternName]=s.namedLoopIndexes,s=s.parentLoopContext}this.stack=t;try{await e.asyncSetNamedLoopIndexes(o,(async()=>{await n()}))}finally{this.stack=void 0}}}class ze{stack=[];get lastNamedLoopIndexes(){return this.stack[this.stack.length-1]}async asyncSetNamedLoopIndexes(e,t){const n=new Map(Object.entries(e));this.stack.push(n);try{await t()}finally{this.stack.pop()}}setNamedLoopIndexes(e,t){this.stack.push(e);try{return t()}finally{this.stack.pop()}}setSubIndex(e,t,n,s){const o=this.lastNamedLoopIndexes;o?.set(t,o?.get(e??"")?.add(n)??Fe(void 0,n));try{return s()}finally{o?.delete(t)}}getLoopIndexes(e){const t=this.lastNamedLoopIndexes;return t?.get(e)}}class Ke{#w;processQueue=[];updatedStateProperties=[];expandedStateProperties=[];updatedBindings=new Set;bindingsForUpdateNode=[];loopContextStack=function(){return new _e}();namedLoopIndexesStack=function(){return new ze}();executing=!1;get states(){return this.#w.states}get newBindingSummary(){return this.#w.newBindingSummary}get component(){return this.#w}constructor(e){this.#w=e}addProcess(e,t,n,s){this.processQueue.push({target:e,thisArgument:t,argumentList:n,loopContext:s}),this.executing||this.exec()}retrieveAllProcesses(){const e=this.processQueue;return this.processQueue=[],e}addUpdatedStateProperty(e){this.updatedStateProperties.push(e)}retrieveAllUpdatedStateProperties(){const e=this.updatedStateProperties;return this.updatedStateProperties=[],e}async execCallbackWithPerformance(t){this.executing=!0,e.debug&&performance.mark("Updator.exec:start");try{await t()}finally{e.debug&&(performance.mark("Updator.exec:end"),performance.measure("Updator.exec","Updator.exec:start","Updator.exec:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures("Updator.exec"),performance.clearMarks("Updator.exec:start"),performance.clearMarks("Updator.exec:end")),this.executing=!1}}async exec(){await this.execCallbackWithPerformance((async()=>{for(;this.processQueue.length>0;){this.updatedBindings.clear();const e=await xe(this,this.states),t=e.map((e=>e.pattern+"\t"+(e.loopIndexes?.toString()??""))),n=Re(this.states,e);await De(this,this.newBindingSummary,n,t),Ue(this,this.newBindingSummary,n),await We(this,this.newBindingSummary,n)}}))}applyNodeUpdatesByBinding(e,t){if(!this.updatedBindings.has(e))try{t(this)}finally{this.updatedBindings.add(e)}}#C;get isFullRebuild(){return void 0===this.#C&&p.raise("fullRebuild is not set"),this.#C}setFullRebuild(e,t){this.#C=e;try{t()}finally{this.#C=void 0}}}const qe=Symbol.for("component.isComponent"),Ge="props",Qe=Symbol.for(`${Ge}.bindProperty`),Je=Symbol.for(`${Ge}.setBuffer`),Ye=Symbol.for(`${Ge}.getBuffer`),Ze=Symbol.for(`${Ge}.clearBuffer`),Xe=Symbol.for(`${Ge}.createBuffer`),et=Symbol.for(`${Ge}.flushBuffer`),tt=Symbol.for(`${Ge}.clear`),nt=new RegExp(/^\$([0-9]+)$/);function st(e){return e.parentComponent?.popoverLoopIndexesById?.get(e.id)}const ot=(e,t)=>{let n;const s=ve(t.name);return s.wildcardPaths.length>0&&0===t.loopIndexes?.size&&e.component.hasAttribute("popover")&&(n=st(e.component)?.truncate(s.wildcardPaths.length)),n??t.loopIndexes};let it=class{constructor(e){this.#w=e}#w;get component(){return this.#w}#P;get buffer(){return this.#P}#N=[];get binds(){return this.#N}#S={};#B(e,t){this.#S[e]=Object.getOwnPropertyDescriptor(this.#w.states.base,e)??{value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(this.#w.states.base,e,{get:((e,t,n)=>function(){if(void 0!==e.buffer)return e.buffer[t];{void 0===n&&p.raise("PropertyAccess is required");const t=nt.exec(n.name);if(t){const s=Number(t[1])-1;let o=n.loopContext?.loopIndexes;return void 0===o&&e.component.hasAttribute("popover")&&(o=st(e.component)),o?.at(s)}{const t=ot(e,n);return e.component.parentComponent?.states.current[Ce](n.name,t)??p.raise(`Property ${n.name} is not found`)}}})(this,e,t),set:((e,t,n)=>function(s){if(void 0!==e.buffer)e.buffer[t]=s;else{void 0===n&&p.raise("PropertyAccess is required");const t=ot(e,n);e.component.parentComponent?.states.writable((async()=>{e.component.parentComponent?.states.current[Pe](n.name,t,s)??p.raise(`Property ${n.name} is not found`)}))}return!0})(this,e,t),configurable:!0,enumerable:!0}),void 0!==t&&this.#N.push({prop:e,propAccess:t})}#I(e){this.#P=e;for(const t in e)this.#B(t),this.#w.states.current[se](t,void 0)}#L(){return this.#P}#E(){this.#P=void 0}#F(){let e;return e=this.#w.parentComponent?.states.current[re](this.#w)??p.raise("CreateBufferApiSymbol is not found"),void 0!==e||(e={},this.#N.forEach((({prop:t,propAccess:n})=>{const s=ot(this,n);e[t]=this.#w.parentComponent?.states.current[Ce](n.name,s)??p.raise(`Property ${n.name} is not found`)}))),e}#T(){if(void 0!==this.#P){const e=this.#P;this.#w.parentComponent?.states.writable((async()=>{!0!==(this.#w.parentComponent?.states.current[ae](e,this.#w)??p.raise("FlushBufferApiSymbol is not found"))&&this.#N.forEach((({prop:t,propAccess:n})=>{const s=ot(this,n);this.#w.parentComponent?.states.current[Pe](n.name,s,e[t])??p.raise(`Property ${n.name} is not found`)}))}))}}#M(){this.#P=void 0,this.#N=[];for(const[e,t]of Object.entries(this.#S))Object.defineProperty(this.#w.states.base,e,t);this.#S={}}get(e,t,n){return t===Qe?(e,t)=>this.#B(e,t):t===Je?e=>this.#I(e):t===Ye?()=>this.#L():t===Ze?()=>this.#E():t===Xe?()=>this.#F():t===et?()=>this.#T():t===tt?()=>this.#M():this.#w.states.current[t]}set(e,t,n,s){return this.#w.states.writable((async()=>{this.#w.states.current[t]=n})),!0}ownKeys(e){return void 0!==this.buffer?Reflect.ownKeys(this.buffer):this.#N.map((({prop:e})=>e))}getOwnPropertyDescriptor(e,t){return{enumerable:!0,configurable:!0}}};const rt=Symbol.for("globalData.boundByComponent"),at=e=>function t(n,s,o,i,r,a,l,d,c=e.cache,u=e.findPropertyCallback,h=void 0!==e.cache,m=s.length>1&&"function"==typeof e.findPropertyCallback,f=void 0){let g,y,x,b,v=s[a];m&&u(v);const w=r.get(i[l]);return h?g=c[b=v+":"+(w?.toString()??"")]??(b in c?g:c[b]=(g=Reflect.get(n,v,d))??(v in n||0===a?g:(y=o[a],x="*"===y,t(n,s,o,i,r,a-1,l-(x?1:0),d,c,u,h,m,f)[x?w?.value??p.raise("wildcard is undefined"):y]))):(g=Reflect.get(n,v,d))??(v in n||0===a?g:(y=o[a],x="*"===y,t(n,s,o,i,r,a-1,l-(x?1:0),d,c,u,h,m,f)[x?w?.value??p.raise("wildcard is undefined"):y]))};function lt(e,t){let n;const s=e.forward(),o=t.forward();for(;;){const e=s.next(),t=o.next();if(e.done||t.done)break;n=Fe(n,t.value??e.value)}return n??p.raise("createOverrideLoopIndexes: loopIndexes is undefined.")}let dt=class{cache=void 0;getValue=at(this);getExpandValues=(e=>{const t=at(e);return function(n,s,o){"none"!==s.wildcardType&&"all"!==s.wildcardType||p.raise("wildcard type is invalid");const i=(e.getNamedLoopIndexesStack?.()??p.raise("getExpandValuesFn: namedLoopIndexesStack is undefined")).lastNamedLoopIndexes??p.raise("getExpandValuesFn: namedLoopIndexes is undefined");let r,a;if("context"===s.wildcardType)a=(s.wildcardLoopIndexes?.size??0)-1,r=i.get(s.pattern)?.values??p.raise("namedLoopIndexes is undefined"),r[r.length-1]=void 0;else{let e=[];const t=s.wildcardLoopIndexes?.values??[];for(let n=t.length-1;n>=0&&(void 0===a&&void 0===t[n]&&(a=n),void 0===e&&i.has(s.wildcardPaths[n])&&(e=i.get(s.wildcardPaths[n])?.values??p.raise("loopIndexes is undefined")),void 0===a||void 0===e);n--);r=[];const n=s.wildcardLoopIndexes?.values??p.raise("wildcardIndexes is undefined");for(let t=0;t<s.wildcardCount;t++)t===a?r.push(void 0):r.push(n[t]??e[t])}void 0===a&&p.raise("lastIndex is undefined");const l=Me(s.wildcardPaths[a]??p.raise("wildcard path is undefined")),d=Me(l.paths.at(-2)??p.raise("wildcard parent path is undefined")),c=Ee(r.slice(0,a)),u=je(ke(d.pattern,c)),h=t(n,d.patternPaths,d.patternElements,d.wildcardPaths,u,d.paths.length-1,d.wildcardCount-1,o).length,m=[];for(let e=0;e<h;e++){r[a]=e;const i=Ee(r),l=je(ke(s.pattern,i)),d=t(n,s.patternPaths,s.patternElements,s.wildcardPaths,l,s.paths.length-1,s.wildcardCount-1,o);m.push(d)}return m}})(this);setExpandValues=(e=>{const t=at(e);return function(n,s,o,i){"none"!==s.wildcardType&&"all"!==s.wildcardType||p.raise("wildcard type is invalid");const r=e.notifyCallback,a=(e.getNamedLoopIndexesStack?.()??p.raise("getExpandValuesFn: namedLoopIndexesStack is undefined")).lastNamedLoopIndexes??p.raise("getExpandValuesFn: namedLoopIndexes is undefined");let l,d;if("context"===s.wildcardType)d=(s.wildcardLoopIndexes?.size??0)-1,l=a.get(s.pattern)?.values??p.raise("namedLoopIndexes is undefined"),l[l.length-1]=void 0;else{let e=[];const t=s.wildcardLoopIndexes?.values??[];for(let n=t.length-1;n>=0&&(void 0===d&&void 0===t[n]&&(d=n),void 0===e&&a.has(s.wildcardPaths[n])&&(e=a.get(s.wildcardPaths[n])?.values??p.raise("loopIndexes is undefined")),void 0===d||void 0===e);n--);l=[];const n=s.wildcardLoopIndexes?.values??p.raise("wildcardIndexes is undefined");for(let t=0;t<s.wildcardCount;t++)t===d?l.push(void 0):l.push(n[t]??e[t])}void 0===d&&p.raise("lastIndex is undefined");const c=Me(s.wildcardPaths[d]??p.raise("wildcard path is undefined")),u=Me(c.paths.at(-2)??p.raise("wildcard parent path is undefined")),h=Ee(l.slice(0,d)),m=je(ke(u.pattern,h)),f=t(n,u.patternPaths,u.patternElements,u.wildcardPaths,m,u.paths.length-1,u.wildcardCount-1,i).length;for(let e=0;e<f;e++){l[d]=e;const c=Me(s.patternPaths.at(-2)??p.raise("setValueFromPropInfoFn: parentPropInfo is undefined")),u=Ee(l.slice(0,c.wildcardCount-1)),h=je(ke(c.pattern,u)),m=t(n,c.patternPaths,c.patternElements,c.wildcardPaths,h,c.paths.length-1,c.wildcardCount-1,i),f=s.elements.at(-1)??p.raise("setValueFromPropInfoFn: lastElement is undefined"),g="*"===f;Reflect.set(m,g?a.get(s.pattern)?.value??p.raise("setValueFromPropInfoFn: wildcard index is undefined"):f,Array.isArray(o)?o[e]:o),r&&r(s.pattern,a.get(s.pattern))}}})(this);getValueByPropInfo=function(e){const t=at(e);return function(n,s,o){let i;s.expandable;const r=()=>t(n,s.patternPaths,s.patternElements,s.wildcardPaths,i,s.paths.length-1,s.wildcardCount-1,o),a=e.getNamedLoopIndexesStack?.()??p.raise("getValueFromPropInfoFn: namedLoopIndexesStack is undefined");if("context"===s.wildcardType||"none"===s.wildcardType)return i=a.lastNamedLoopIndexes??p.raise("getValueFromPropInfoFn: namedLoopIndexes is undefined"),r();if("all"===s.wildcardType)return i=s.wildcardNamedLoopIndexes,a.setNamedLoopIndexes(i,r);{const e=lt(a.lastNamedLoopIndexes?.get(s.pattern)??p.raise("getValueFromPropInfoFn: namedLoopIndexes is undefined"),s.wildcardNamedLoopIndexes.get(s.pattern)??p.raise("getValueFromPropInfoFn: namedLoopIndexes is undefined")),t=ke(s.pattern,e);return i=je(t),a.setNamedLoopIndexes(i,r)}}}(this);setValueByPropInfo=function(e){const t=at(e);return function(n,s,o,i){const r=e.notifyCallback;let a;const l=()=>{try{if(1===s.elements.length)return Reflect.set(n,s.name,o,i);if(s.pattern in n)return Reflect.set(n,s.pattern,o,i);const e=Me(s.patternPaths.at(-2)??p.raise("setValueFromPropInfoFn: parentPropInfo is undefined")),r=t(n,e.patternPaths,e.patternElements,e.wildcardPaths,a,e.paths.length-1,e.wildcardCount-1,i),l=s.elements.at(-1)??p.raise("setValueFromPropInfoFn: lastElement is undefined"),d="*"===l;return Reflect.set(r,d?a.get(s.pattern)?.value??p.raise("setValueFromPropInfoFn: wildcard index is undefined"):l,o)}finally{r&&r(s.pattern,a.get(s.wildcardPaths.at(-1)??""))}},d=e.getNamedLoopIndexesStack?.()??p.raise("getValueFromPropInfoFn: namedLoopIndexesStack is undefined");if("context"===s.wildcardType||"none"===s.wildcardType)return a=d.lastNamedLoopIndexes??p.raise("getValueFromPropInfoFn: namedLoopIndexes is undefined"),l();if("all"===s.wildcardType)return a=s.wildcardNamedLoopIndexes,d.setNamedLoopIndexes(a,l);{const e=lt(d.lastNamedLoopIndexes?.get(s.pattern)??p.raise("getValueFromPropInfoFn: namedLoopIndexes is undefined"),s.wildcardNamedLoopIndexes.get(s.pattern)??p.raise("getValueFromPropInfoFn: namedLoopIndexes is undefined")),t=ke(s.pattern,e);return a=je(t),d.setNamedLoopIndexes(a,l)}}}(this);getNamedLoopIndexesStack;clearCache(){void 0!==this.cache&&(this.cache={})}findPropertyCallback;notifyCallback;get(e,t,n){const s="string"==typeof t;do{if(s&&(t.startsWith("@@__")||"constructor"===t))break;if(t===Be)return t=>this.getValueByPropInfo(e,t,n);if(t===Ie)return(t,s)=>this.setValueByPropInfo(e,t,s,n);if(!s)break;if("$"===t[0]){const e=Number(t.slice(1));if(isNaN(e))break;const n=(this.getNamedLoopIndexesStack?.()??p.raise("get: namedLoopIndexesStack is undefined")).lastNamedLoopIndexes??p.raise("get: namedLoopIndexes is undefined"),s=Array.from(n.values()).filter((t=>t.size===e));return 1!==s.length&&p.raise(`context index(${t}) is ambiguous or null`),s[0].value}const o=Me(t);return this.getValueByPropInfo(e,o,n)}while(0);return Reflect.get(e,t,n)}set(e,t,n,s){const o="string"==typeof t;do{if(o&&t.startsWith("@@__"))break;if(!o)break;if("$"===t[0]){const e=Number(t.slice(1));if(isNaN(e))break;p.raise(`context index(${t}) is read only`)}const i=Me(t);return this.setValueByPropInfo(e,i,n,s)}while(0);return Reflect.set(e,t,n,s)}};class ct extends dt{#$=new Map;get(e,t,n){return t===rt?(e,t)=>{let n=this.#$.get(t);void 0===n?this.#$.set(t,new Set([e])):n.add(e)}:super.get(e,t,n)}set(e,t,n,s){if("string"!=typeof t)return Reflect.set(e,t,n,s);const{pattern:o,wildcardLoopIndexes:i}=Me(t),r=s[Se](ke(o,i),n);let a=this.#$.get(o);if(a)for(const e of a)e.states.current[se]("$globals."+o,i);return r}}class pt{static create(e={}){return new Proxy(e,new ct)}static#k=this.create();static get data(){return this.#k}static set data(e){this.#k=this.create(e)}}class ut extends dt{#w;setOfProps=new Set;constructor(e){super(),this.#w=e}bindProperty(e){pt.data[rt](this.#w,e),this.setOfProps.add(e)}directGet=(e,t)=>(this.setOfProps.has(e)||this.bindProperty(e),pt.data[Ce](e,t));directSet=(e,t,n)=>(this.setOfProps.has(e)||this.bindProperty(e),pt.data[Pe](e,t,n));get(e,t,n){if(t===Ce)return this.directGet;if(t===Pe)return this.directSet;if("string"!=typeof t)return Reflect.get(e,t,n);const{pattern:s,wildcardLoopIndexes:o}=Me(t);return this.directGet(s,o)}set(e,t,n,s){if("string"!=typeof t)return Reflect.set(e,t,n,s);const{pattern:o,wildcardLoopIndexes:i}=Me(t);return this.directSet(o,i,n)}}const ht=e=>e,mt={Text:e=>{const t=document.createTextNode("");return e.parentNode?.replaceChild(t,e),t},HTMLElement:ht,SVGElement:ht,Template:ht};const ft=e=>{const t=e;return t.removeAttribute("data-bind"),t},gt=e=>e,yt={HTMLElement:ft,SVGElement:ft,Text:gt,Template:gt};const xt=new Set(["button","image","hidden","reset","submit","unknown"]),bt=e=>!1,vt={HTMLElement:e=>e instanceof HTMLElement&&(e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&!xt.has(e.type)),SVGElement:bt,Text:bt,Template:bt};const wt=e=>e.trim(),Ct=e=>e.length>0,Pt=new RegExp(/^#(.*)#$/),Nt=e=>{const t=Pt.exec(e);return t?decodeURIComponent(t[1]):e},St=e=>{const[t,...n]=e.split(",").map(wt);return{name:t,options:n.map(Nt)}},Bt=e=>{const[t,...n]=e.split("|").map(wt);return{property:t,filters:n.map(St)}},It=(e,t)=>e.split(";").map(wt).filter(Ct).map((e=>{let{nodeProperty:n,stateProperty:s,inputFilters:o,outputFilters:i}=((e,t)=>{const[n,s]=[t].concat(...e.split(":").map(wt)).splice(-2),{property:o,filters:i}=Bt(n),{property:r,filters:a}=Bt(s);return{nodeProperty:o,stateProperty:r,inputFilters:i,outputFilters:a}})(e,"$");return s="@"===s?n:s,n="$"===n?t:n,{nodeProperty:n,stateProperty:s,inputFilters:o,outputFilters:i}})),Lt={};const Et="textContent",Ft={radio:"checked",checkbox:"checked",button:"onclick"},Tt={},Mt=e=>{},$t={HTMLElement:e=>e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLOptionElement?"value":e instanceof HTMLButtonElement||e instanceof HTMLAnchorElement?"onclick":e instanceof HTMLFormElement?"onsubmit":e instanceof HTMLInputElement?Ft[e.type]??"value":Et,SVGElement:Mt,Text:e=>Et,Template:Mt};class kt{#V;get node(){return this.#V}#A;get name(){return this.#A}#R;get nameElements(){return this.#R}getValue(){return this.node[this.name]}setValue(e){this.node[this.name]=e}#O;#j;get filters(){return void 0===this.#j&&(this.#j=T.create(this.#O,this.binding.inputFilterManager)),this.#j}getFilteredValue(){const e=this.getValue();return 0===this.filters.length?e:M.applyFilter(e,this.filters)}get applicable(){return!0}#D;get binding(){return this.#D}get expandable(){return!1}get isSelectValue(){return!1}get revisionForLoop(){return p.raise("not loopable")}get loopable(){return!1}constructor(e,t,n,s){t instanceof Node||p.raise("NodeProperty: not Node"),this.#D=e,this.#V=t,this.#A=n,this.#R=n.split("."),this.#O=s}initialize(){}postUpdate(e){}equals(e){return this.getValue()===e}applyToChildNodes(e){}dispose(){}revisionUpForLoop(){return 0}}class Vt extends kt{#d;get template(){return void 0===this.#d&&(this.#d=U(this.uuid)??p.raise(`TemplateProperty: invalid uuid ${this.uuid}`)),this.#d}#a;get uuid(){var e;return void 0===this.#a&&(this.#a=(e=this.node,e.textContent?.slice(3)??p.raise("TemplateProperty: invalid node"))),this.#a}get expandable(){return!0}constructor(e,t,n,s){t instanceof Comment||p.raise("TemplateProperty: not Comment"),super(e,t,n,s)}}class At extends Vt{#H=0;get revisionForLoop(){return this.#H}get loopable(){return!0}dispose(){super.dispose(),this.#H++}revisionUpForLoop(){return++this.#H}}const Rt=e=>e.rebuild();class Ot extends At{getValue(){return this.binding.childrenContentBindings}setValue(e){Array.isArray(e)||p.raise(`Repeat: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not array`);const t=this.uuid,n=this.binding,s=this.getValue().length,o=this.binding.stateProperty.propInfo?.wildcardPaths,i=o?.[o.length-1],r=this.binding.stateProperty.name;if(this.revisionUpForLoop(),s<e.length){this.binding.childrenContentBindings.forEach(Rt);for(let o=s;o<e.length;o++){const e=Mn(t,n);this.binding.appendChildContentBindings(e),this.binding.updator?.namedLoopIndexesStack.setSubIndex(i,r,o,(()=>{e.rebuild()}))}}else if(s>e.length){const t=this.binding.childrenContentBindings.splice(e.length);this.binding.childrenContentBindings.forEach(Rt),t.forEach((e=>e.dispose()))}else this.binding.childrenContentBindings.forEach(Rt)}constructor(e,t,n,s){"loop"!==n&&p.raise(`Repeat: invalid property name '${n}'`),super(e,t,n,s)}equals(e){return!1}}class jt extends kt{get element(){return this.node}constructor(e,t,n,s){t instanceof Element||p.raise("ElementBase: not element"),super(e,t,n,s)}}class Dt{value;enabled=!1;constructor(e,t){this.value=e,this.enabled=t}}class Ht extends jt{get inputElement(){return this.node}_value=new Dt(void 0,!1);getValue(){return this._value.value=this.inputElement.value,this._value.enabled=this.inputElement.checked,this._value}setValue(e){Array.isArray(e)||p.raise(`Checkbox: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not array`);const t=this.getFilteredValue();this.inputElement.checked=e.some((e=>e===t.value))}_filteredValue=new Dt(void 0,!1);getFilteredValue(){const e=this.getValue();return this._filteredValue.value=this.filters.length>0?M.applyFilter(e.value,this.filters):e.value,this._filteredValue.enabled=e.enabled,this._filteredValue}constructor(e,t,n,s){t instanceof HTMLInputElement||p.raise("Checkbox: not htmlInputElement"),"checkbox"!==t.type&&p.raise("Checkbox: not checkbox"),super(e,t,n,s)}equals(e){return!1}}class Ut extends jt{get inputElement(){return this.element}_value=new Dt(void 0,!1);getValue(){return this._value.value=this.inputElement.value,this._value.enabled=this.inputElement.checked,this._value}setValue(e){const t=this.filteredValue;this.inputElement.checked=e===t.value}_filteredValue=new Dt(void 0,!1);get filteredValue(){const e=this.getValue();return this._filteredValue.value=this.filters.length>0?M.applyFilter(e.value,this.filters):e.value,this._filteredValue.enabled=e.enabled,this._filteredValue}constructor(e,t,n,s){t instanceof HTMLInputElement||p.raise("Radio: not htmlInputElement");const o=t;"radio"!==o.type&&"checkbox"!==o.type&&p.raise("Radio: not radio or checkbox"),super(e,t,n,s)}equals(e){return!1}}class Wt extends jt{get eventType(){return this.name.slice(2)}get applicable(){return!1}#U;get handler(){return void 0===this.#U&&(this.#U=e=>this.eventHandler(e)),this.#U}#O;#W;get eventFilters(){return void 0===this.#W&&(this.#W=T.create(this.#O,this.binding.eventFilterManager)),this.#W}constructor(e,t,n,s){n.startsWith("on")||p.raise(`ElementEvent: invalid property name ${n}`),super(e,t,n,s),this.#O=s}initialize(){this.element.addEventListener(this.eventType,this.handler)}async directlyCall(e){if(this.binding.newBindingSummary?.exists(this.binding))return this.binding.stateProperty.state[ne](this.binding.stateProperty.name,e,this.binding.parentContentBindings.currentLoopContext)}eventHandler(e){this.binding.newBindingSummary?.exists(this.binding)&&(e=this.eventFilters.length>0?M.applyFilter(e,this.eventFilters):e,!1===(Reflect.get(e,"noStopPropagation")??!1)&&e.stopPropagation(),this.binding.updator?.addProcess(this.directlyCall,this,[e],this.binding.parentContentBindings?.currentLoopContext))}}class _t extends jt{#_;get isSelectValue(){return void 0===this.#_&&(this.#_=this.node.constructor===HTMLSelectElement&&"value"===this.name),this.#_}}class zt{#z;get name(){return this.#z.name}get loopIndexes(){return this.#z.loopIndexes}get loopContext(){return this.#z.binding.parentContentBindings.currentLoopContext}constructor(e){this.#z=e}}const Kt=new Set(["boolean","number","string"]);class qt extends At{#K=new Map;#q=new Set;#G=new Set;#Q=new Map;#J=[];getValue(){return this.#J}setValue(e){Array.isArray(e)||p.raise(`RepeatKeyed: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not array`);const t=this.binding.stateProperty.propInfo?.wildcardPaths,n=t?.[t.length-1],s=this.binding.statePropertyName+".*";this.revisionUpForLoop(),this.#K.clear(),this.#q.clear(),this.#G.clear(),this.#Q.clear();const o=this.binding.childrenContentBindings,i=e.length;let r=!0;for(let e=0;e<i;e++){const t=this.binding.stateProperty.getChildValue(e),n=this.#J.indexOf(t,this.#K.get(t)??0);-1===n?this.#G.add(e):(this.#K.set(t,n+1),this.#q.add(n),this.#Q.set(e,o[n]),r=!1)}for(let e=0;e<o.length;e++)this.#q.has(e)||o[e].dispose();const a=this.uuid,l=this.binding;if(r){const e=this.node.nextSibling,t=this.node.parentNode??p.raise("parentNode is null");for(let r=0;r<i;r++){const i=Mn(a,l);o[r]=i,this.binding.updator?.namedLoopIndexesStack.setSubIndex(n,s,r,(()=>{i.rebuild()})),t.insertBefore(i.fragment,e)}}else{let e;const t=this.node.parentNode??p.raise("parentNode is null");for(let r=0;r<i;r++){const i=r;let d;const c=e?.lastChildNode??this.node;this.#G.has(i)?(d=Mn(a,l),o[i]=d,this.binding.updator?.namedLoopIndexesStack.setSubIndex(n,s,i,(()=>{d.rebuild()})),t.insertBefore(d.fragment,c.nextSibling)):(d=this.#Q.get(i)??p.raise("contentBindings is undefined"),d.childNodes[0]?.previousSibling!==c?(d.removeChildNodes(),o[i]=d,this.binding.updator?.namedLoopIndexesStack.setSubIndex(n,s,i,(()=>{d.rebuild()})),t.insertBefore(d.fragment,c.nextSibling)):(o[i]=d,this.binding.updator?.isFullRebuild&&this.binding.updator?.namedLoopIndexesStack.setSubIndex(n,s,i,(()=>{d.rebuild()})))),e=d}}i<o.length&&(o.length=i),this.#J=e.slice()}applyToChildNodes(e){this.revisionUpForLoop();const t=this.uuid,n=this.binding,s=this.binding.stateProperty.propInfo?.wildcardPaths,o=s?.[s.length-1],i=this.binding.statePropertyName+".*",r=new Map;for(const t of e){const e=this.binding.childrenContentBindings[t];if(void 0===e)continue;const n=this.#J[t],s=typeof n;"undefined"!==s&&(Kt.has(s)||(e.removeChildNodes(),r.set(n,e)))}const a=[];for(const s of Array.from(e).sort()){const e=this.binding.stateProperty.getChildValue(s),l=typeof e;if("undefined"===l)continue;if(Kt.has(l))continue;let d=r.get(e);void 0===d?(d=Mn(t,n),this.binding.replaceChildContentBindings(d,s),this.binding.updator?.namedLoopIndexesStack.setSubIndex(o,i,s,(()=>{d?.rebuild()})),a.push(...d.allChildBindings)):(this.binding.replaceChildContentBindings(d,s),this.binding.updator?.namedLoopIndexesStack.setSubIndex(o,i,s,(()=>{d?.rebuild()})),a.push(...d.allChildBindings))}this.#J=this.binding.stateProperty.getValue().slice()}initialize(){super.initialize(),this.#J=[]}dispose(){super.dispose(),this.#J=[]}}const Gt={0:{class:class extends jt{getValue(){return this.element.className.length>0?this.element.className.split(" "):[]}setValue(e){Array.isArray(e)||p.raise(`ElementClassName: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not array`),this.element.className=e.join(" ")}constructor(e,t,n,s){"class"!==n&&p.raise(`ElementClassName: invalid property name ${n}`),super(e,t,n,s)}},checkbox:Ht,radio:Ut},1:{if:class extends Vt{getValue(){return this.binding.childrenContentBindings.length>0}setValue(e){"boolean"!=typeof e&&p.raise(`Branch: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not boolean`);const t=this.getValue(),n=this.uuid,s=this.binding;if(t!==e)if(e){const e=Mn(n,s);this.binding.appendChildContentBindings(e),e.rebuild()}else this.binding.removeAllChildrenContentBindings();else this.binding.childrenContentBindings.forEach((e=>e.rebuild()))}constructor(e,t,n,s){"if"!==n&&p.raise(`Branch: invalid property name ${n}`),super(e,t,n,s)}equals(e){return!1}}}},Qt=e=>(t,n,s,o)=>Reflect.construct(e,[t,n,s,o]),Jt={class:class extends jt{get className(){return this.nameElements[1]}getValue(){return this.element.classList.contains(this.className)}setValue(e){"boolean"!=typeof e&&p.raise(`ElementClass: ${this.binding.selectorName}.State['${this.binding.stateProperty.name}'] is not boolean`),e?this.element.classList.add(this.className):this.element.classList.remove(this.className)}constructor(e,t,n,s){n.startsWith("class.")||p.raise(`ElementClass: invalid property name ${n}`),super(e,t,n,s)}},attr:class extends jt{get attributeName(){return this.nameElements[1]}getValue(){return this.element.getAttribute(this.attributeName)}setValue(e){this.element.setAttribute(this.attributeName,e)}},style:class extends jt{get htmlElement(){return this.node}get styleName(){return this.nameElements[1]}getValue(){return this.htmlElement.style.getPropertyValue(this.styleName)}setValue(e){this.htmlElement.style.setProperty(this.styleName,e)}constructor(e,t,n,s){t instanceof HTMLElement||p.raise("ElementStyle: not htmlElement"),super(e,t,n,s)}},props:class extends jt{get propertyName(){return this.nameElements[1]}get applicable(){return!0}get thisComponent(){return this.node}constructor(e,t,n,s){!0!==Reflect.get(t,qe)&&p.raise("ComponentProperty: not Quel Component"),super(e,t,n,s)}getValue(){return super.getValue()}setValue(e){try{this.thisComponent.states.current[se](this.propertyName,void 0)}catch(e){console.log(e)}}initialize(){this.thisComponent.props[Qe](this.propertyName,new zt(this.binding.stateProperty))}postUpdate(e){const t=this.binding.stateProperty.name;for(const[n,s]of e.entries()){const e=ve(s.pattern);if(s.pattern===t||e.patternPaths.includes(t)){const e=s.pattern.slice(t.length);this.thisComponent.states.current[te]([{name:`${this.propertyName}${e}`,indexes:s.loopIndexes?.values}]),this.thisComponent.states.current[se](`${this.propertyName}${e}`,s.loopIndexes)}}}equals(e){return!1}}};const Yt={};function Zt(e,t,n){const s=e instanceof Comment,o=e instanceof Element,i=s+"\t"+o+"\t"+t+"\t"+n;return Yt[i]??(Yt[i]=function(e,t,n,s){let o;do{if(o=Gt[e?1:0][n],void 0!==o)break;if(e&&"loop"===n){o=s?qt:Ot;break}e&&p.raise(`NodePropertyCreateor: unknown node property ${n}`);const i=n.split(".");if(o=Jt[i[0]],void 0!==o)break;o=t?n.startsWith("on")?Wt:_t:kt}while(0);return Qt(o)}(s,o,t,n))}class Xt{get state(){return this.#D.state??p.raise("StateProperty: state is undefined")}#A;get name(){return this.#A}#Y;get childName(){return this.#Y}#Z;get propInfo(){return this.#Z}#X;get lastWildCard(){return this.#X}#ee;get level(){return this.#ee}get loopIndexes(){return this.binding.updator?.namedLoopIndexesStack?.getLoopIndexes(this.lastWildCard)}getValue(){return this.state[Be](this.propInfo)}setValue(e){const t=e=>{this.state[Ie](this.propInfo,e)};if(e instanceof Dt){const n=this.getValue();if(Array.isArray(n)){const s=new Set(n);e.enabled?s.add(e.value):s.delete(e.value),t(Array.from(s))}else t(e.enabled?e.value:void 0)}else t(e)}#te;#j;get filters(){return void 0===this.#j&&(this.#j=T.create(this.#te,this.binding.outputFilterManager)),this.#j}getFilteredValue(){const e=this.getValue();return 0===this.filters.length?e:M.applyFilter(e,this.filters)}get applicable(){return!0}#D;get binding(){return this.#D}constructor(e,t,n){this.#D=e,this.#A=t,this.#Y=t+".*",this.#Z=Me(t),this.#ee=this.#Z.wildcardCount,this.#te=n,this.#X=this.#Z.wildcardPaths[this.#Z.wildcardPaths.length-1]}initialize(){}getChildValue(e){return this.binding.updator?.namedLoopIndexesStack?.setSubIndex(this.#A,this.#Y,e,(()=>{const e=Me(this.#Y);return this.state[Be](e)}))}setChildValue(e,t){return this.binding.updator?.namedLoopIndexesStack?.setSubIndex(this.#A,this.#Y,e,(()=>{const e=Me(this.#Y);return this.state[Ie](e,t)}))}dispose(){}}const en=RegExp(/^\$[0-9]+$/);class tn extends Xt{#g;get index(){return this.#g}getValue(){return this.binding.parentContentBindings?.currentLoopContext?.loopIndexes.at(this.index)??p.raise(`ContextIndex: invalid index ${this.name}`)}get loopIndexes(){}get indexes(){return[]}constructor(e,t,n){en.test(t)||p.raise(`ContextIndex: invalid name ${t}`),super(e,t,n),this.#g=Number(t.slice(1))-1}}const nn=RegExp(/^\$[0-9]+$/),sn=e=>(t,n,s)=>Reflect.construct(e,[t,n,s]);function on(e){const t=nn.test(e)?tn:Xt;return sn(t)}function rn(e,t,n,s){return{nodePropertyConstructor:Zt(e,t,s),statePropertyConstructor:on(n)}}function an(e,t){t.applicable&&t.setValue(e.getFilteredValue())}function ln(e,t,n,s){n.applicable&&t?.applyNodeUpdatesByBinding(e,(()=>{n.setValue(s.getFilteredValue()??"")}))}let dn=1;class cn{#ne;#se;#z;childrenContentBindings=[];#oe;get id(){return this.#ne.toString()}get nodeProperty(){return this.#se}get stateProperty(){return this.#z}get statePropertyName(){return this.#z.name}get parentContentBindings(){return this.#oe}get loopable(){return this.#se.loopable}get expandable(){return this.#se.expandable}get component(){return this.#oe.component}get updator(){return this.component?.updator}get newBindingSummary(){return this.component?.newBindingSummary}get state(){return this.component?.states.current}get selectorName(){return this.component?.selectorName}get eventFilterManager(){return this.component?.eventFilterManager??p.raise("Binding.eventFilterManager: undefined")}get inputFilterManager(){return this.component?.inputFilterManager??p.raise("Binding.inputFilterManager: undefined")}get outputFilterManager(){return this.component?.outputFilterManager??p.raise("Binding.outputFilterManager: undefined")}constructor(e,t,n,s,o,i,r,a){this.#ne=++dn,this.#oe=e,this.#se=s(this,t,n,o),this.#z=r(this,i,a)}execDefaultEventHandler(e){if(!this.newBindingSummary?.exists(this))return;e.stopPropagation();const{nodeProperty:t,stateProperty:n}=this;this.updator?.addProcess(an,void 0,[t,n],this.parentContentBindings?.currentLoopContext)}#ie=void 0;get defaultEventHandler(){var e;return void 0===this.#ie&&(this.#ie=(e=this,t=>e.execDefaultEventHandler(t))),this.#ie}initialize(){this.nodeProperty.initialize(),this.stateProperty.initialize()}appendChildContentBindings(e){this.expandable||p.raise("Binding.appendChild: not expandable"),this.childrenContentBindings.push(e);const t=this.childrenContentBindings[this.childrenContentBindings.length-1],n=this.nodeProperty.node.parentNode,s=t?.lastChildNode??this.nodeProperty.node;n?.insertBefore(e.fragment,s.nextSibling??null)}replaceChildContentBindings(e,t){this.expandable||p.raise("Binding.replaceChild: not expandable"),this.childrenContentBindings[t]=e;const n=this.childrenContentBindings[t-1],s=this.nodeProperty.node.parentNode,o=n?.lastChildNode??this.nodeProperty.node;s?.insertBefore(e.fragment,o.nextSibling??null)}removeAllChildrenContentBindings(){const e=this.childrenContentBindings;this.childrenContentBindings=[];for(let t=0;t<e.length;t++)e[t].dispose();return e}dispose(){this.newBindingSummary?.delete(this),this.nodeProperty.dispose(),this.stateProperty.dispose(),this.childrenContentBindings.forEach((e=>e.dispose())),this.childrenContentBindings=[]}rebuild(){const{updator:e,nodeProperty:t,stateProperty:n}=this;ln(this,e,t,n)}updateNodeForNoRecursive(){if(!this.expandable){const{updator:e,nodeProperty:t,stateProperty:n}=this;ln(this,e,t,n)}}}const pn=(e,t)=>(n,s)=>function(e,t,n,s,o,i,r,a){const l=new cn(e,t,n,s,o,i,r,a);return l.initialize(),l}(n,s,e.nodeProperty,t.nodePropertyConstructor,e.inputFilters,e.stateProperty,t.statePropertyConstructor,e.outputFilters);const un=()=>{},hn={HTMLElement:function(e,t,n,s){const o=e;let i=!1,r=null,a=null,l=null;for(let e=0;e<n.length;e++){const t=n[e];i||="oninput"===t.nodeProperty.name,a=t.nodeProperty.constructor===Ut?t:a,l=t.nodeProperty.constructor===Ht?t:l,r=t.nodeProperty.name===s?t:r}if(!i){const e=(e=>t=>e.addEventListener("input",t.defaultEventHandler))(o);a?e(a):l?e(l):r&&t&&e(r)}},SVGElement:un,Text:un,Template:un};class mn{nodeType;nodeRoute;nodeRouteKey;bindTexts;acceptInput;defaultProperty;initializeForNode;constructor(e,t,n,s,o,i){var r;this.nodeType=e,this.nodeRoute=t,this.nodeRouteKey=n,this.bindTexts=s,this.acceptInput=o,this.defaultProperty=i,this.initializeForNode=(r=this,(e,t)=>hn[r.nodeType](e,r.acceptInput,t,r.defaultProperty))}}function fn(e,t,n,s){e=function(e,t){return mt[t](e)}(e,t),function(e,t){yt[t](e)}(e,t);const o=function(e,t){return vt[t](e)}(e,t),i=function(e,t){const n=e.constructor.name+"\t"+(e.type??"");return Tt[n]??(Tt[n]=$t[t](e))}(e,t)??"",r=function(e,t){if(""===e.trim())return[];const n=e+"\t"+t;return Lt[n]??(Lt[n]=It(e,t))}(n,i),a=[];for(let t=0;t<r.length;t++){const n=r[t],{nodeProperty:o,stateProperty:i}=n,l=rn(e,o,i,s);a.push({...n,...l,createBinding:pn(n,l)})}const l=function(e){let t=[];for(;null!==e.parentNode;)t=[Array.from(e.parentNode.childNodes).indexOf(e),...t],e=e.parentNode;return t}(e),d=l.join(",");return new mn(t,l,d,a,o,i)}const gn="bind",yn={HTMLElement:e=>e.dataset[gn]??"",SVGElement:e=>e.dataset[gn]??"",Text:e=>e.textContent?.slice(3)??"",Template:e=>U(e.textContent?.slice(3)??"")?.dataset[gn]??""};function xn(e,t){return yn[t](e)}const bn=e=>e instanceof Comment&&((e.textContent?.startsWith("@@:")??!1)||(e.textContent?.startsWith("@@|")??!1));function vn(e){return Array.from(e.childNodes).flatMap((e=>vn(e).concat(bn(e)?e:[])))}const wn=e=>e.constructor.name+"\t"+(e instanceof Comment?e.textContent?.[2]??"":""),Cn={},Pn=e=>e instanceof Comment&&":"===e.textContent?.[2]?"Text":e instanceof HTMLElement?"HTMLElement":e instanceof Comment&&"|"===e.textContent?.[2]?"Template":e instanceof SVGElement?"SVGElement":p.raise(`Unknown NodeType: ${e.nodeType}`);function Nn(e,t=wn(e)){return Cn[t]??(Cn[t]=Pn(e))}function Sn(e,t){const n=[],s=e.content,o=Array.from(s.querySelectorAll("[data-bind]")).concat(vn(s));for(let e=0;e<o.length;e++){const s=o[e],i=Nn(s),r=xn(s,i);""!==r.trim()&&(n[n.length]=fn(o[e],i,r,t))}return n}function Bn(e,t){for(let n=0;void 0!==e&&n<t.length;e=e.childNodes[t[n++]]);return e}const In={};class Ln{#d;#re;constructor(e,t){this.#d=e,this.#re=Sn(this.#d,t)}createBindings(e,t){return function(e,t,n){const s=[];for(let o=0;o<n.length;o++){const i=n[o],r=Bn(e,i.nodeRoute)??p.raise(`Node not found: ${i.nodeRoute}`),a=[];for(let e=0;e<i.bindTexts.length;e++)a[a.length]=i.bindTexts[e].createBinding(t,r);i.initializeForNode(r,a),s.push(...a)}return s}(e,t,this.#re)}}class En{#ae;#le;#g;#b;#de;#ce;#pe={};#ue={};constructor(e){this.#le=e}get contentBindings(){return this.#le}get patternName(){return this.contentBindings.patternName}get parentPatternName(){return ve(this.patternName).wildcardPaths.at(-2)}get parentNamedLoopContext(){const e=this.parentPatternName;if(void 0!==e)return this.namedLoopContexts[e]}get parentLoopContext(){let e=this.contentBindings.parentBinding?.parentContentBindings;for(;void 0!==e;){if(void 0!==e.loopContext&&e.loopContext!==this)return e.loopContext;e=e.parentBinding?.parentContentBindings}}get index(){return this.checkRevision(),void 0===this.#g&&(this.#g=this.contentBindings.parentBinding?.childrenContentBindings.indexOf(this.contentBindings)??p.raise("index is undefined")),this.#g}get namedLoopIndexes(){return this.checkRevision(),void 0===this.#de&&(this.#de=void 0===this.parentNamedLoopContext?Fe(void 0,this.index):this.parentNamedLoopContext.loopIndexes.add(this.index)),this.#de}get loopIndexes(){return this.checkRevision(),void 0===this.#b&&(this.#b=void 0===this.parentLoopContext?Fe(void 0,this.index):this.parentLoopContext.loopIndexes.add(this.index)),this.#b}get namedLoopContexts(){return void 0===this.#ce&&(this.#ce=Object.assign(this.parentLoopContext?.namedLoopContexts??{},{[this.patternName]:this})),this.#ce}get loopTreeNodesByName(){return this.#pe}get loopTreeLoopableNodesByName(){return this.#ue}checkRevision(){const e=this.contentBindings.parentBinding?.nodeProperty.revisionForLoop;return(void 0===this.#ae||this.#ae!==e)&&(this.#g=void 0,this.#b=void 0,this.#de=void 0,this.#ce=void 0,!0)}dispose(){this.#g=void 0,this.#b=void 0,this.#de=void 0,this.#ce=void 0}}class Fn{#a;#w;#d;#he;#me;#fe;#ge;#ye;#xe=!1;#be;#ve;#we=new Set;get component(){return this.#w}set component(e){void 0!==e&&this.#be!==e.useKeyed&&p.raise("useKeyed is different"),this.#w=e}get template(){return void 0===this.#d&&(this.#d=U(this.#a)??p.raise("template is undefined")),this.#d}get childBindings(){return void 0===this.#he&&p.raise("childBindings is undefined"),this.#he}get parentBinding(){return this.#me}set parentBinding(e){void 0!==e&&this.#xe!==e.loopable&&p.raise("loopable is different"),this.#me=e}get loopContext(){return this.#fe}get childNodes(){return void 0===this.#ge&&p.raise("childNodes is undefined"),this.#ge}get lastChildNode(){return this.childNodes[this.childNodes.length-1]}get currentLoopContext(){return void 0===this.#fe?this.parentContentBindings?.loopContext:this.#fe}get parentContentBindings(){return this.parentBinding?.parentContentBindings}get fragment(){return void 0===this.#ye&&p.raise("fragment is undefined"),this.#ye}get allChildBindings(){const e=[];for(let t=0;t<this.childBindings.length;t++){e.push(this.childBindings[t]);for(let n=0;n<this.childBindings[t].childrenContentBindings.length;n++)e.push(...this.childBindings[t].childrenContentBindings[n].allChildBindings)}return e}get loopable(){return this.#xe}get useKeyed(){return this.#be}get patternName(){return this.#ve}get localTreeNodes(){return this.#we}constructor(e,t=!1,n=!1,s=""){this.#a=e,this.#be=t,this.#xe=n,this.#ve=s;const o=function(e,t){const n=e.dataset.uuid??p.raise("uuid not found");return In[n]??(In[n]=new Ln(e,t))}(this.template,this.useKeyed);if(this.#ye=document.importNode(this.template.content,!0),this.#he=o.createBindings(this.#ye,this),this.#ge=Array.from(this.#ye.childNodes),n){this.#fe=new En(this);for(let e=0;e<this.childBindings.length;e++){const t=this.childBindings[e];t.stateProperty.lastWildCard===this.patternName&&(this.#we.add(t),this.#fe?.loopTreeNodesByName[t.statePropertyName]?.add(t)??(this.#fe.loopTreeNodesByName[t.statePropertyName]=new Set([t])))}}}removeChildNodes(){this.fragment.append.apply(this.fragment,this.childNodes)}registerBindingsToSummary(){const e=this.component?.newBindingSummary??p.raise("bindingSummary is undefined");for(let t=0;t<this.childBindings.length;t++)e.register(this.childBindings[t])}dispose(){this.childBindings.forEach((e=>e.dispose())),this.loopContext?.dispose(),this.#me=void 0,this.removeChildNodes();const e=`${this.#a}\t${this.#be}\t${this.#xe}\t${this.#ve}`;Tn[e]?.push(this)??(Tn[e]=[this])}rebuild(){const e=[];for(let t=0;t<this.childBindings.length;t++){const n=this.childBindings[t];n.nodeProperty.isSelectValue?e.push(n):n.rebuild()}for(let t=0;t<e.length;t++)e[t].rebuild()}}const Tn={};function Mn(e,t){const n=t.component??p.raise("component is undefined"),s=n.useKeyed,o=t.loopable,i=o?t.statePropertyName+".*":"",r=`${e}\t${s}\t${o}\t${i}`;let a=Tn[r]?.pop();return void 0===a&&(a=new Fn(e,s,o,i)),a.component=n,a.parentBinding=t,a.registerBindingsToSummary(),a}const $n={[ne]:({state:e,stateProxy:t,handler:n})=>async(n,s,o)=>e[n].apply(t,[s,...o?.loopIndexes.values??[]]),[se]:({handler:e})=>(t,n)=>e.updator.addUpdatedStateProperty(ke(t,n)),[oe]:({handler:e})=>()=>e.dependentProps,[ie]:({handler:e})=>()=>e.clearCache(),[re]:({stateProxy:e})=>t=>e.$createBuffer?.apply(e,[t]),[ae]:({stateProxy:e})=>(t,n)=>e.$flushBuffer?.apply(e,[t,n])};const kn={[J]:(...e)=>({}),[Y]:(...e)=>({}),[Z]:(...e)=>({props:e})},Vn={[J]:"connected",[Y]:"disconnected",[Z]:"updated"};const An={[X]:"$connectedCallback",[ee]:"$disconnectedCallback",[te]:"$updatedCallback"},Rn=new Set([X,ee,te]),On={[X]:J,[ee]:Y,[te]:Z},jn=(e,t,n,s)=>async(...o)=>{const i=e[An[s]]?.apply(t,o);return function(e,t,n){const s=Vn[t]??p.raise(`Unknown event symbol: ${t.description} `),o=(kn[t]??p.raise(`Unknown detail function for event symbol: ${t.description}`))(...n),i=new CustomEvent(s,{detail:o});e.dispatchEvent(i)}(n.element,On[s],o),i};function Dn(e,t){return void 0!==e.prototype&&(e.prototype!==Object.prototype&&(void 0!==e.prototype[t]||Dn(Object.getPrototypeOf(e),t)))}const Hn=new Set(["element","addProcess","viewRootElement ","queryRoot","asyncShowModal","asyncShow","asyncShowPopover","cancelPopover"]);class Un{get(e,t){return Hn.has(t)||Dn(e.baseClass,t)?Reflect.get(e,t):void p.raise(`property ${t} is not found in ${e.baseClass.name}`)}}const Wn="$globals",_n="$dependentProps",zn="$component",Kn="$addProcess",qn={[Wn]:({handler:e})=>e.element.globals,[_n]:({state:e})=>e[_n],[zn]:({handler:e})=>{return t=e.element,new Proxy(t,new Un);var t},[Kn]:({handler:e,stateProxy:t})=>n=>e.updator.addProcess(n,t,[],e.loopContext)};function Gn(e){const t=function(e){const t={};let n=e;for(;n!==Object.prototype;){const e=Object.getOwnPropertyDescriptors(n);for(const[n,s]of Object.entries(e))Reflect.has(t,n)||(t[n]=s);n=Object.getPrototypeOf(n)}return t}(e),n=[];for(const[e,s]of Object.entries(t))(s.get||s.set)&&n.push(e);return n}const Qn=new Map;function Jn(e){let t=Qn.get(e.constructor);return void 0===t&&(t=Gn(e),{}.constructor!==e.constructor&&Qn.set(e.constructor,t)),t}class Yn{defaultProps=new Set;propsByRefProp={};constructor(e){this.#Ce(e)}setDefaultProp(e){if(this.defaultProps.has(e))return;const t=ve(e);for(let e=t.patternPaths.length-1;e>=1;e--){const n=t.patternPaths[e-1],s=t.patternPaths[e];this.propsByRefProp[n]?.add(s)??(this.propsByRefProp[n]=new Set([s])),this.defaultProps.add(s)}}#Ce(e){for(const[t,n]of Object.entries(e))for(const e of n)this.propsByRefProp[e]?.add(t)??(this.propsByRefProp[e]=new Set([t]))}}function Zn(e){return new Yn(e)}const Xn=new Map;class es extends dt{#w;#Pe;#Ne;#Se;get accessorProperties(){return this.#Pe}get dependentProps(){return this.#Ne}get element(){return this.#w}get component(){return this.#w}get updator(){return this.component.updator}get loopContext(){}constructor(e,t){super(),this.#w=e;const{accessorProperties:n,dependentProps:s}=function(e){let t=Xn.get(e);return void 0===t&&(t={accessorProperties:new Set(Jn(e)),dependentProps:Zn(e.$dependentProps??{})},Xn.set(e,t)),t}(t);this.#Pe=n,this.#Ne=s,this.#Se={[G]:this.#Pe,[Q]:this.#Ne},this.#Be.symbol=(e,t,n)=>this.#Ie.apply(this,[e,t,n]),this.#Be.string=(e,t,n)=>this.#Le.apply(this,[e,t,n])}findPropertyCallback=(e=>function(t){const n=e.dependentProps;n.defaultProps.has(t)||n.setDefaultProp(t)})(this);getNamedLoopIndexesStack=function(e){return function(){return e.updator.namedLoopIndexesStack}}(this);#Ie(e,t,n){return this.#Se[t]??function(e,t,n,s){return Rn.has(s)?(...o)=>jn(e,t,n,s)(...o):void 0}(e,n,this,t)??function(e,t,n,s){return $n[s]?.({state:e,stateProxy:t,handler:n})}(e,n,this,t)??void 0}#Le(e,t,n){return function(e,t,n,s){return qn[s]?.({state:e,stateProxy:t,handler:n,prop:s})}(e,n,this,t)??void 0}#Be={};get(e,t,n){return this.#Be[typeof t]?.(e,t,n)??super.get(e,t,n)}}class ts extends es{cache={};set(e,t,n,s){p.raise("ReadonlyHandler: set is not allowed")}}class ns extends es{notifyCallback=(e=>function(t,n){e.updator.addUpdatedStateProperty(ke(t,n))})(this)}class ss{#Ee;#Fe;#Te;#Me=!1;constructor(e,t,n){this.#Ee=e,this.#Fe=t,this.#Te=n}get base(){return this.#Ee}get#$e(){return this.#Me}set#$e(e){this.#Me=e,!1===e&&this.#Fe[ie]()}get current(){return this.#$e?this.#Te:this.#Fe}async writable(e){this.#$e&&p.raise("States: already writable"),this.#$e=!0;try{return await e()}finally{this.#$e=!1}}}function os(e,t,n=function(e,t){return new Proxy(t,new ts(e,t))}(e,t),s=function(e,t){return new Proxy(t,new ns(e,t))}(e,t)){return new ss(t,n,s)}const is="--adopted-css",rs=e=>e.trim(),as=e=>e.length>0;class ls{allBindings=new Set;noloopBindings={};rootLoopableBindings={};register(e){const t=e.parentContentBindings?.currentLoopContext;if(this.allBindings.add(e),e.loopable&&(void 0===t?this.rootLoopableBindings[e.statePropertyName]?.add(e)??(this.rootLoopableBindings[e.statePropertyName]=new Set([e])):t.loopTreeLoopableNodesByName[e.statePropertyName]?.add(e)??(t.loopTreeLoopableNodesByName[e.statePropertyName]=new Set([e]))),0===e.stateProperty.propInfo.wildcardCount)this.noloopBindings[e.statePropertyName]?.add(e)??(this.noloopBindings[e.statePropertyName]=new Set([e]));else if(!e.parentContentBindings.localTreeNodes.has(e)){const n=t?.namedLoopContexts[e.stateProperty.lastWildCard]??p.raise("loopContext is undefined");n.loopTreeNodesByName[e.statePropertyName]?.add(e)??(n.loopTreeNodesByName[e.statePropertyName]=new Set([e]))}}delete(e){const t=e.parentContentBindings?.currentLoopContext;if(this.allBindings.delete(e),e.loopable&&(void 0===t?this.rootLoopableBindings[e.statePropertyName]?.delete(e):t.loopTreeLoopableNodesByName[e.statePropertyName]?.delete(e)),0===e.stateProperty.propInfo.wildcardCount)this.noloopBindings[e.statePropertyName]?.delete(e);else if(!e.parentContentBindings.localTreeNodes.has(e)){const n=t?.namedLoopContexts[e.stateProperty.lastWildCard]??p.raise("loopContext is undefined");n.loopTreeNodesByName[e.statePropertyName]?.delete(e)}}exists(e){return this.allBindings.has(e)}_search(e,t,n,s,o,i){if(o<s.length){const r=ve(s[o]),a=n.next().value??p.raise(`loopIndexes.at(${o}) is null`),l=r.patternPaths.at(-2)??"",d=void 0===e?Array.from(this.rootLoopableBindings[l]):Array.from(e.loopTreeLoopableNodesByName[l]);for(let e=0;e<d.length;e++)void 0!==d[e].childrenContentBindings[a]&&this._search(d[e].childrenContentBindings[a].loopContext,t,n,s,o+1,i)}else void 0===e||i.push(...Array.from(e.loopTreeNodesByName[t]??[]))}gatherBindings(e){let t;return void 0===e.loopIndexes||0===e.loopIndexes.size?t=Array.from(this.noloopBindings[e.pattern]??[]):(t=[],this._search(void 0,e.pattern,e.loopIndexes.forward(),e.patternInfo.wildcardPaths,0,t)),t}}const ds=new Map,cs=new Map;function ps(e){return class extends e{constructor(...e){super(),this.#ke=os(this,Reflect.construct(this.State,[])),this.#Ve=new ls,this.#Ae=Promise.withResolvers(),this.#Re=new Ke(this),this.#Oe=function(e){return new Proxy({},new it(e))}(this),this.#je=function(e){return new Proxy({},new ut(e))}(this)}get component(){return this}#De;get parentComponent(){return void 0===this.#De&&(this.#De=(e=>{let t=e;for(;;){if(t=t.parentNode,null==t)return;if(!0===Reflect.get(t,"isQuelComponent"))return t;if(t instanceof ShadowRoot){if(!0===Reflect.get(t.host,"isQuelComponent"))return t.host;t=t.host}const e=ds.get(t);if(void 0!==e)return e}})(this)),this.#De}#Ae;get initialPromises(){return this.#Ae}#He;get alivePromises(){return this.#He??p.raise("alivePromises is undefined")}set alivePromises(e){this.#He=e}#ke;get states(){return this.#ke}#Ue;get rootBindingManager(){return this.#Ue??p.raise("rootBindingManager is undefined")}set rootBindingManager(e){this.#Ue=e}get viewRootElement(){return this.useWebComponent?this.shadowRoot??this:this.pseudoParentNode}get queryRoot(){return this.viewRootElement}#We;get pseudoParentNode(){return this.useWebComponent?p.raise("mixInComponent: useWebComponent must be false"):this.#We??p.raise("pseudoParentNode is undefined")}set pseudoParentNode(e){this.#We=e}#_e;get pseudoNode(){return this.#_e??p.raise("pseudoNode is undefined")}set pseudoNode(e){this.#_e=e}get shadowRootOrDocument(){let e=this.parentNode;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}return document}#Ve;get newBindingSummary(){return this.#Ve}#Re;get updator(){return this.#Re}#Oe;get props(){return this.#Oe}#je;get globals(){return this.#je}async build(){if(t=this.tagName.toLowerCase(),(de(t)||le.has(t))&&this.useShadowRoot&&this.useWebComponent){const t=this.attachShadow({mode:"open"}),n=function(e){return e.map(he).filter(me)}((e=this,getComputedStyle(e)?.getPropertyValue(is)?.split(" ").map(rs).filter(as)??[]));void 0!==this.styleSheet&&n.push(this.styleSheet),t.adoptedStyleSheets=n}else if(void 0!==this.styleSheet){let e=this.styleSheet;if(this.useLocalSelector){const t=cs.get(this.tagName);void 0!==t?e=t:(e=function(e,t){for(let n=0;n<e.cssRules.length;n++){const s=e.cssRules[n];if(s instanceof CSSStyleRule){const e=s.selectorText.split(",").map((e=>e.trim().startsWith(":host")?e.replace(":host",t):`${t} ${e}`)).join(",");s.selectorText=e}}return e}(this.styleSheet,this.selectorName),cs.set(this.tagName,e))}const t=this.shadowRootOrDocument,n=t.adoptedStyleSheets;n.includes(e)||(t.adoptedStyleSheets=n.concat(e))}var e,t;this.useOverscrollBehavior&&("DIALOG"===this.tagName||this.hasAttribute("popover"))&&(this.style.overscrollBehavior="contain"),this.states.writable((async()=>{await this.states.current[X]()}));const n=this.template.dataset.uuid??p.raise("uuid is undefined");this.rootBindingManager=function(e,t){const n=e.useKeyed,s=!1,o=`${t}\t${n}\tfalse\t`;let i=Tn[o]?.pop();return void 0===i&&(i=new Fn(t,n,s)),i.component=e,i.registerBindingsToSummary(),i}(this,n),this.updator.namedLoopIndexesStack.setNamedLoopIndexes(je(),(()=>{this.rootBindingManager.rebuild()})),this.useWebComponent?this.viewRootElement.appendChild(this.rootBindingManager.fragment):(this.viewRootElement.insertBefore(this.rootBindingManager.fragment,this.pseudoNode?.nextSibling??null),this.rootBindingManager.childNodes.forEach((e=>ds.set(e,this))))}async connectedCallback(){try{if(this.parentComponent&&await this.parentComponent.initialPromises.promise,!this.useWebComponent){const e=document.createComment(`@@/${this.tagName}`);this.pseudoParentNode=this.parentNode??p.raise("parentNode is undefined"),this.pseudoNode=e,this.pseudoParentNode.replaceChild(e,this)}this.alivePromises=Promise.withResolvers(),await this.build()}finally{this.initialPromises?.resolve&&this.initialPromises.resolve()}}async disconnectedCallback(){this.updator.addProcess((async()=>{await this.states.current[ee]()}),void 0,[],void 0)}}}function us(e){for(const[t,n]of Object.entries(e))gs(t,n)}const hs=new Map,ms=new Map,fs=t=>{const n=function(e){return Object.assign(new K,e)}(t);n.filters=Object.assign({},t.filters),n.config=Object.assign({},t.moduleConfig),n.options=Object.assign({},t.options);const s=n.config?.extends??n.options?.extends,o=function(t,n){const s=class extends n{#ze=t;get module(){return this.#ze}get isQuelComponent(){return!0}#Ke;get customElementInfo(){return void 0===this.#Ke&&(this.#Ke=hs.get(this.thisClass)??p.raise("customElementInfo is not found ")),this.#Ke}#qe(){if(void 0===hs.get(this.thisClass)){const e=this.tagName.toLowerCase(),t=e.includes("-"),n=this.getAttribute("is"),s=!!n,o=t?e:`${e}[is="${n}"]`;hs.set(this.thisClass,{selectorName:o,lowerTagName:e,isAutonomousCustomElement:t,isCostomizedBuiltInElement:s})}}get html(){return this.module.html}set html(e){this.module.html=e}get template(){return this.module.template}get css(){return this.module.css}set css(e){this.module.css=e}get styleSheet(){return this.module.styleSheet}get State(){return this.module.State}get inputFilters(){return this.module.filters.input??{}}get outputFilters(){return this.module.filters.output??{}}get eventFilters(){return this.module.filters.event??{}}get useShadowRoot(){return this.module.moduleConfig.useShadowRoot??e.useShadowRoot}get useWebComponent(){return this.module.moduleConfig.useWebComponent??e.useWebComponent}get useLocalTagName(){return this.module.moduleConfig.useLocalTagName??e.useLocalTagName}get useKeyed(){return this.module.moduleConfig.useKeyed??e.useKeyed}get useLocalSelector(){return this.module.moduleConfig.useLocalSelector??e.useLocalSelector}get useOverscrollBehavior(){return this.module.moduleConfig.useOverscrollBehavior??e.useOverscrollBehavior}get lowerTagName(){return this.customElementInfo.lowerTagName}get selectorName(){return this.customElementInfo.selectorName}get isAutonomousCustomElement(){return this.customElementInfo.isAutonomousCustomElement}get isCostomizedBuiltInElement(){return this.customElementInfo.isCostomizedBuiltInElement}#Ge;get filterManagers(){return void 0===this.#Ge&&(this.#Ge=ms.get(this.thisClass)??p.raise(`filterManagers is not found for ${this.tagName}`)),this.#Ge}#Qe(){if(void 0===ms.get(this.thisClass)){const e={inputFilterManager:new V,outputFilterManager:new $,eventFilterManager:new R};for(const[t,n]of Object.entries(this.inputFilters))e.inputFilterManager.registerFilter(t,n);for(const[t,n]of Object.entries(this.outputFilters))e.outputFilterManager.registerFilter(t,n);for(const[t,n]of Object.entries(this.eventFilters))e.eventFilterManager.registerFilter(t,n);ms.set(this.thisClass,e)}}get inputFilterManager(){return this.filterManagers.inputFilterManager}get outputFilterManager(){return this.filterManagers.outputFilterManager}get eventFilterManager(){return this.filterManagers.eventFilterManager}get element(){return this}constructor(){super(),this.#qe(),this.#Qe()}static baseClass=n;get baseClass(){return Reflect.get(this.constructor,"baseClass")}static thisClass;get thisClass(){return Reflect.get(this.constructor,"thisClass")}static _module=t;static get html(){return this._module.html}static set html(e){this._module.html=e}static get css(){return this._module.css}static set css(e){this._module.css=e}};return s.thisClass=s,s}(n,s?document.createElement(s).constructor:HTMLElement),i=function(e){return class extends e{#Je=!1;get canceled(){return this.#Je}set canceled(e){this.#Je=e}#Ye;get popoverPromises(){return this.#Ye}set popoverPromises(e){this.#Ye=e}#Ze;get popoverLoopIndexesById(){return void 0===this.#Ze&&(this.#Ze=new Map),this.#Ze}constructor(...e){super(),this.addEventListener("hidden",(()=>{if(void 0!==this.popoverPromises){if(this.canceled)this.popoverPromises.reject();else{const e=this.props[Ye]();this.props[Ze](),this.popoverPromises.resolve(e)}this.popoverPromises=void 0}this.useBufferedBind&&void 0!==this.parentComponent&&(this.canceled||this.props[et]()),this.canceled=!0;const e=this.id;void 0!==e&&this.popoverLoopIndexesById.delete(e)})),this.addEventListener("shown",(()=>{if(this.canceled=!0,this.useBufferedBind&&void 0!==this.parentComponent){const e=this.props[Xe]();this.props[Je](e)}for(const e in this.props)this.states.current[se](e,void 0)})),this.addEventListener("toggle",(e=>{const t=e;if("closed"===t.newState){const e=new CustomEvent("hidden");this.dispatchEvent(e)}else if("open"===t.newState){const e=new CustomEvent("shown");this.dispatchEvent(e)}}))}async asyncShowPopover(e){return this.popoverPromises=Promise.withResolvers(),this.props[Je](e),HTMLElement.prototype.showPopover.apply(this),this.popoverPromises.promise}hidePopover(){this.canceled=!1,HTMLElement.prototype.hidePopover.apply(this)}cancelPopover(){HTMLElement.prototype.hidePopover.apply(this)}}}((r=ps(o),class extends r{#Xe;get dialogPromises(){return this.#Xe}set dialogPromises(e){this.#Xe=e}#et="";get returnValue(){return this.#et}set returnValue(e){this.#et=e}get useBufferedBind(){return this.hasAttribute("buffered-bind")}constructor(...e){super(),this.addEventListener("closed",(()=>{if(void 0!==this.dialogPromises){if(""===this.returnValue)this.dialogPromises.reject();else{const e=this.props[Ye]();this.props[Ze](),this.dialogPromises.resolve(e)}this.dialogPromises=void 0}this.useBufferedBind&&void 0!==this.parentComponent&&""!==this.returnValue&&this.props[et]()})),this.addEventListener("close",(()=>{const e=new CustomEvent("closed");this.dispatchEvent(e)}))}async#tt(e,t=!0){return this.returnValue="",this.dialogPromises=Promise.withResolvers(),this.props[Je](e),t?HTMLDialogElement.prototype.showModal.apply(this):HTMLDialogElement.prototype.show.apply(this),this.dialogPromises.promise}async asyncShowModal(e){return this instanceof HTMLDialogElement||p.raise("DialogComponent: asyncShowModal is only for HTMLDialogElement"),this.#tt(e,!0)}async asyncShow(e){return this instanceof HTMLDialogElement||p.raise("DialogComponent: asyncShow is only for HTMLDialogElement"),this.#tt(e,!1)}showModal(){if(this instanceof HTMLDialogElement||p.raise("DialogComponent: showModal is only for HTMLDialogElement"),this.useBufferedBind&&void 0!==this.parentComponent){this.returnValue="";const e=this.props[Xe]();this.props[Je](e)}return HTMLDialogElement.prototype.showModal.apply(this)}show(){if(this instanceof HTMLDialogElement||p.raise("DialogComponent: show is only for HTMLDialogElement"),this.useBufferedBind&&void 0!==this.parentComponent){this.returnValue="";const e=this.props[Xe]();this.props[Je](e)}return HTMLDialogElement.prototype.show.apply(this)}close(e=""){return this instanceof HTMLDialogElement||p.raise("DialogComponent: close is only for HTMLDialogElement"),HTMLDialogElement.prototype.close.apply(this,[e])}}));var r;return us(n.componentModulesForRegister??{}),i};function gs(e,t){const n=p.toKebabCase(e),s=fs(t),o=t.moduleConfig?.extends??t.options?.extends;void 0===o?customElements.define(n,s):customElements.define(n,s,{extends:o})}const ys="*filter-";const xs=u.create(((e,t)=>{if(e.startsWith(ys)){const n=e.slice(8),{output:s,input:o,event:i}=t;s&&$.registerFilter(n,s),o&&V.registerFilter(n,o),i&&R.registerFilter(n,i)}else!function(e,t){if("function"!=typeof e)return!1;let n=e;for(;n;){if(n===t)return!0;n=Object.getPrototypeOf(n)}return!1}(t,HTMLElement)?"State"in t&&"html"in t&&gs(e,t):customElements.define(e,t)}));async function bs(t,n){const s=await fetch(t.resolve(n??"./quel.config.json")),o=await s.json();for(let[t,n]of Object.entries(e))e[t]=void 0!==o[t]?o[t]:n;await xs.config(o).load()}function vs(e){return e.replaceAll(/<!--\{\{([^\}]+)\}\}-->/g,((e,t)=>`{{${t}}}`))}async function ws(e){const t=document.createElement("template"),n=await fetch(function(e,t){return e.resolve(t)}(import.meta,e));let s;t.innerHTML=(await n.text()).replaceAll(/\{\{([^\}]+)\}\}/g,((e,t)=>`\x3c!--{{${t}}}--\x3e`));const o=t.content.querySelector("script");let i;o?(s=await import("data:text/javascript;charset=utf-8,"+o.text),o.remove()):s={State:class{}};const r=t.content.querySelector("style");r?(i={css:r.textContent},r.remove()):i={};const a={html:vs(t.innerHTML).trim()};return Object.assign({},s,a,i)}async function Cs(e,t){gs(e,await ws(t))}async function Ps(e){for(const[t,n]of Object.entries(e??{}))await Cs(t,n)}async function Ns(e){const t=await ws(e);return fs(t)}function Ss(e){Object.entries(e).forEach((([e,t])=>{const{input:n,output:s,event:o}=t;n&&V.registerFilter(e,n),s&&$.registerFilter(e,s),o&&R.registerFilter(e,o)}))}function Bs(e){Object.assign(pt.data,e)}void 0===Map.groupBy&&(Map.groupBy=function(e,t){return e.reduce(((e,n,s)=>{const o=t(n,s);return e.has(o)||e.set(o,[]),e.get(o).push(n),e}),new Map)}),void 0===Object.groupBy&&(Object.groupBy=function(e,t){return e.reduce((function(e,n){return(e[n[t]]=e[n[t]]||[]).push(n),e}),{})}),void 0===Promise.withResolvers&&(Promise.withResolvers=function(){let e,t;return{promise:new Promise(((n,s)=>{e=n,t=s})),resolve:e,reject:t}}),void 0===Array.prototype.toSorted&&(Array.prototype.toSorted=function(e){return this.slice().sort(e)}),void 0===Array.prototype.toReversed&&(Array.prototype.toReversed=function(){return this.slice().reverse()});export{bs as bootFromImportMeta,e as config,fs as generateComponentClass,Ns as generateSingleFileComponentClass,t as getCustomTagFromImportMeta,s as importCssFromImportMeta,n as importHtmlFromImportMeta,ws as loadSingleFileComponent,xs as loader,us as registerComponentModules,Ss as registerFilters,Bs as registerGlobal,Ps as registerSingleFileComponents};
