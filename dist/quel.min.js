const e="quel",t="*",n="dot-notation",s={directlyGet:Symbol.for(n+".direct_get"),directlySet:Symbol.for(n+".direct_set"),isSupportDotNotation:Symbol.for(n+".is_support_dot_notation")},i=new RegExp(/^\$([0-9]+)$/);class r{#e;get name(){return this.#e}#t;get pathNames(){return this.#t}#n;get parentPathNames(){return this.#n}#s;get parentPath(){return this.#s}#i;get parentPaths(){return this.#i}#r;get setOfParentPaths(){return this.#r}#o;get lastPathName(){return this.#o}#a;get regexp(){return this.#a}#l;get level(){return this.#l}#c;get isPrimitive(){return this.#c}#d;get nearestWildcardName(){return this.#d}#p;get nearestWildcardParentName(){return this.#p}constructor(e){if(this.#e=e,this.#t=e.split("."),this.#n=this.#t.slice(0,-1),this.#i=this.#n.reduce(((e,t)=>(e.push(e.at(-1)?.concat(t)??[t]),e)),[]).map((e=>e.join("."))),this.#r=new Set(this.#i),this.#s=this.#n.join("."),this.#o=this.#t.at(-1),this.#a=new RegExp("^"+e.replaceAll(".","\\.").replaceAll("*","([0-9a-zA-Z_]*)")+"$"),this.#l=this.#t.reduce(((e,n)=>e+(n===t?1:0)),0),this.#c=1===this.#t.length,this.#d=void 0,this.#p=void 0,this.#l>0)for(let e=this.#t.length-1;e>=0;e--)if(this.#t[e]===t){this.#d=this.#t.slice(0,e+1).join("."),this.#p=this.#t.slice(0,e).join(".");break}}static create(e){const t=this.#h[e];return void 0!==t?t:this.#h[e]=new r(e)}static#h={};static get propertyNameByName(){return this.#h}static parse(e){const t=[],n=[];for(const s of e.split(".")){const e=Number(s);isNaN(e)?n.push(s):(t.push(e),n.push("*"))}return{propName:r.create(n.join(".")),indexes:t}}}const o={[s.directlyGet]:(e,t,n)=>(s,i)=>Reflect.apply(e.directlyGet,e,[t,{prop:s,indexes:i},n]),[s.directlySet]:(e,t,n)=>(s,i,r)=>Reflect.apply(e.directlySet,e,[t,{prop:s,indexes:i,value:r},n]),[s.isSupportDotNotation]:(e,t,n)=>!0};let a=class{#u=[];#m=new Map;get lastIndexes(){return this.#u[this.#u.length-1]}#f;get lastIndexesString(){return void 0===this.#f&&(this.#f=this.lastIndexes?.join(",")),this.#f}get stackIndexes(){return this.#u}get matchByName(){return this.#m}getByPropertyName(e,{propName:n},s){const i=Reflect.get(e,n.name,s);if(void 0!==i)return i;if(""===n.parentPath)return;const o=this.getByPropertyName(e,{propName:r.create(n.parentPath)},s);if(void 0===o)return;return o[n.lastPathName===t?this.lastIndexes[n.level-1]:n.lastPathName]}setByPropertyName(e,{propName:n,value:s},i){if(Reflect.has(e,n.name)||n.isPrimitive)return Reflect.set(e,n.name,s,i);{const o=this.getByPropertyName(e,{propName:r.create(n.parentPath)},i);if(void 0===o)return!1;return o[n.lastPathName===t?this.lastIndexes[n.level-1]:n.lastPathName]=s,!0}}#g(e,t){this.#f=void 0,this.#u.push(e);try{return Reflect.apply(t,this,[])}finally{this.#u.pop()}}#y=(e,t)=>({propName:n,indexes:s})=>this.#g(s,(()=>this.getByPropertyName(e,{propName:n},t)));#v=(e,t)=>({propName:n,indexes:s},i)=>this.#g(s,(()=>this.setByPropertyName(e,{propName:n,value:i},t)));#b(e,{propName:t,indexes:n},s){const i=this.#y(e,s);if(void 0===t.nearestWildcardName)throw new Error(`not found wildcard path of '${t.name}'`);const o=r.create(t.nearestWildcardParentName);return i({propName:o,indexes:n}).map(((e,s)=>i({propName:t,indexes:n.concat(s)})))}#x(e,{propName:t,indexes:n,values:s},i){const o=this.#y(e,i),a=this.#v(e,i);if(void 0===t.nearestWildcardName)throw new Error(`not found wildcard path of '${t.name}'`);const l=r.create(t.nearestWildcardParentName),c=o({propName:l,indexes:n}),d=Array.isArray(s)?s:[...Array(c.length)].map((e=>s));if(t.nearestWildcardName===t.name)a({propName:l,indexes:n},d);else{if(d.length!==c.length)throw new Error(`not match array count '${t.name}'`);for(let e in c)a({propName:t,indexes:n.concat(Number(e))},d[e])}return!0}directlyGet(e,{prop:t,indexes:n},s){const i=r.create(t);return this.#g(n,(()=>this.getByPropertyName(e,{propName:i},s)))}directlySet(e,{prop:t,indexes:n,value:s},i){const o=r.create(t);return this.#g(n,(()=>this.setByPropertyName(e,{propName:o,value:s},i)))}get(e,t,n){const s="string"==typeof t;if(s&&(t.startsWith("@@__")||"constructor"===t))return Reflect.get(e,t,n);const a=o[t];if(void 0!==a)return a(this,e,n);const l=this.#y(e,n),c=this.lastIndexes;let d;if(s){if("$"===t[0]&&(d=i.exec(t)))return c?.[Number(d[1])-1]??void 0;if("@"===t[0]){const s=t.slice(1),i=r.create(s);if((c?.length??0)+1<i.level)throw new Error("array level not match");const o=c?.slice(0,i.level-1)??[];return this.#b(e,{propName:i,indexes:o},n)}if(void 0!==this.#m.get(t))return l(this.#m.get(t));{const e=r.parse(t);return e.propName.level===e.indexes.length?(this.#m.set(t,e),l(e)):l({propName:e.propName,indexes:e.indexes.concat(c?.slice(e.indexes.length)??[])})}}return Reflect.get(e,t,n)}set(e,t,n,s){if("string"==typeof t){if(t.startsWith("@@__")||"constructor"===t)return Reflect.set(e,t,n,s);const i=this.#v(e,s),o=this.lastIndexes;if("@"===t.at(0)){const i=t.slice(1),o=r.create(i);if((this.lastIndexes?.length??0)+1<o.level)throw new Error("array level not match");const a=this.lastIndexes?.slice(0,o.level-1)??[];return this.#x(e,{propName:o,indexes:a,values:n},s)}if(this.#m.has(t))return i(this.#m.get(t),n);const a=r.parse(t);return a.propName.level===a.indexes.length?(this.#m.set(t,a),i(a,n)):i({propName:a.propName,indexes:a.indexes.concat(o?.slice(a.indexes.length)??[])},n)}return Reflect.set(e,t,n,s)}};const l=Object.assign({connectedCallback:Symbol.for(`${e}:viewModel.connectedCallback`),disconnectedCallback:Symbol.for(`${e}:viewModel.disconnectedCallback`),updatedCallback:Symbol.for(`${e}:viewModel.updatedCallback`),connectedEvent:Symbol.for(`${e}:viewModel.connectedEvent`),disconnectedEvent:Symbol.for(`${e}:viewModel.disconnectedEvent`),updatedEvent:Symbol.for(`${e}:viewModel.updatedEvent`),getDependentProps:Symbol.for(`${e}:viewModel.getDependentProps`),clearCache:Symbol.for(`${e}:viewModel.clearCache`),directlyCall:Symbol.for(`${e}:viewModel.directCall`),notifyForDependentProps:Symbol.for(`${e}:viewModel.notifyForDependentProps`),createBuffer:Symbol.for(`${e}:viewModel.createBuffer`),flushBuffer:Symbol.for(`${e}:viewModel.flushBuffer`),boundByComponent:Symbol.for(`${e}:globalData.boundByComponent`),bindTo:Symbol.for(`${e}:componentModule.bindTo`),bindProperty:Symbol.for(`${e}:props.bindProperty`),setBuffer:Symbol.for(`${e}:props.setBuffer`),getBuffer:Symbol.for(`${e}:props.getBuffer`),clearBuffer:Symbol.for(`${e}:props.clearBuffer`),createBuffer:Symbol.for(`${e}:props.createBuffer`),flushBuffer:Symbol.for(`${e}:props.flushBuffer`),clear:Symbol.for(`${e}:props.clear`),toObject:Symbol.for(`${e}:props.toObject`),propInitialize:Symbol.for(`${e}:props.initialize`),isComponent:Symbol.for(`${e}:component.isComponent`),nullSafe:Symbol.for(`${e}:filter.nullSafe`),noNullSafe:Symbol.for(`${e}:filter.noNullSafe`)},s),c={debug:!1,useShadowRoot:!1,useKeyed:!0,useWebComponent:!0,useLocalTagName:!0,useLocalSelector:!0,useOverscrollBehavior:!0};class d{static raise(e){throw new Error(e)}static toKebabCase=e=>"string"==typeof e?e.replaceAll(/_/g,"-").replaceAll(/([A-Z])/g,((e,t,n)=>(n>0?"-":"")+t.toLowerCase())):e;static createUUID(){return window?.crypto?.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=((new Date).getTime()+16*Math.random())%16|0;return("x"==e?t:3&t|8).toString(16)}))}}const p="data-bind",h="data-uuid",u=new Map;function m(e){return u.get(e)}function f(e,t,n){const s=document.createElement("template");return s.innerHTML=e?function(e,t,n){const s=[],i=e.replaceAll(/\{\{([^\}]+)\}\}/g,((e,t)=>{if((t=t.trim()).startsWith("loop:")||t.startsWith("if:"))return s.push(t),`<template data-bind="${t}">`;if(t.startsWith("else:")){const e=s.at(-1);return void 0!==e&&e.startsWith("if:")||d.raise(`Template: endif: is not matched with if:, but {{ ${t} }} `),`</template><template data-bind="${e}|not">`}if(t.startsWith("end:"))return void 0===s.pop()&&d.raise(`Template: end: is not matched with loop: or if:, but {{ ${t} }} `),"</template>";if(t.startsWith("endif:")){const e=s.pop();return void 0!==e&&e.startsWith("if:")||d.raise(`Template: endif: is not matched with if:, but {{ ${e} }} `),"</template>"}if(t.startsWith("endloop:")){const e=s.pop();return void 0!==e&&e.startsWith("loop:")||d.raise(`Template: endloop: is not matched with loop:, but {{ ${e} }} `),"</template>"}return`\x3c!--@@:${t}--\x3e`}));s.length>0&&d.raise(`Template: loop: or if: is not matched with endloop: or endif:, but {{ ${s.at(-1)} }} `);const r=document.createElement("template");r.innerHTML=i;const o=n.map((e=>d.toKebabCase(e))),a=e=>{for(const n of o){const s=Array.from(e.querySelectorAll(n));for(const e of s){const s=document.createElement(`${n}-${t}`);if(e.hasAttributes){for(const t of e.attributes)s.setAttribute(t.name,t.value);s.setAttribute("data-orig-tag-name",n)}e.parentNode.replaceChild(s,e)}const i=Array.from(e.querySelectorAll(`[is="${n}"]`));for(const e of i){const s=document.createElement(e.tagName,{is:`${n}-${t}`});if(e.hasAttributes){for(const t of e.attributes)"is"!==t.name&&s.setAttribute(t.name,t.value);s.setAttribute("data-orig-is",n)}e.parentNode.replaceChild(s,e)}}const n=Array.from(e.querySelectorAll("template"));for(const e of n)a(e.content)};o.length>0&&a(r.content);const l=e=>{let t;for(;t=e.querySelector("template");){const e=d.createUUID(),n=document.createComment(`@@|${e}`);if(t.parentNode.replaceChild(n,t),t.constructor!==HTMLTemplateElement){const e=document.createElement("template");for(let n of Array.from(t.childNodes))e.content.appendChild(n);e.setAttribute(p,t.getAttribute(p)),t=e}t.setAttribute(h,e),l(t.content),u.set(e,t)}};return l(r.content),r.innerHTML}(e,t,n):"",s.setAttribute(h,t),u.set(t,s),s}const g=new Map;function y(e,t){const n=g.get(t);if(n)return n;const s=function(e){const t=new CSSStyleSheet;return t.replaceSync(e),t}(e);return g.set(t,s),s}class v{#P=d.createUUID();get uuid(){return this.#P}html="";css;get template(){const e=this.config.useLocalTagName??c.useLocalTagName?Object.keys(this.componentModules??{}):[];return f(this.html,this.uuid,e)}get styleSheet(){return this.css?y(this.css,this.uuid):void 0}ViewModel=void 0;State=void 0;config={};moduleConfig={};options={};filters={};componentModules;get componentModulesForRegister(){if((this.config.useLocalTagName??c.useLocalTagName)&&void 0!==this.componentModules){const e={};for(const[t,n]of Object.entries(this.componentModules))e[`${d.toKebabCase(t)}-${this.uuid}`]=n;return e}return this.componentModules}}const b=e=>{const t=e.id;return e.parentComponent?.popoverContextIndexesById?.get(t)},x=(e,t)=>{let n;const s=new r(t.name);return s.level>0&&0===t.indexes.length&&e.component.hasAttribute("popover")&&(n=b(e.component)?.slice(0,s.level)),n??t.indexes};let P=class{#w;#N;#S=[];constructor(e){this.#w=e}get component(){return this.#w}get buffer(){return this.#N}get binds(){return this.#S}#B={};#M(e,t){this.#B[e]=Object.getOwnPropertyDescriptor(this.#w.baseViewModel,e)??{value:void 0,writable:!0,enumerable:!0,configurable:!0},Object.defineProperty(this.#w.baseViewModel,e,{get:((e,t,n)=>function(){if(void 0!==e.buffer)return e.buffer[t];{const t=i.exec(n.name);if(t){const s=Number(t[1])-1;let i=n.loopContext.indexes;return 0===i.length&&e.component.hasAttribute("popover")&&(i=b(e.component)??[]),i[s]}{const t=x(e,n);return e.component.parentComponent.readOnlyViewModel[l.directlyGet](n.name,t)}}})(this,e,t),set:((e,t,n)=>function(s){if(void 0!==e.buffer)e.buffer[t]=s;else{const t=x(e,n);e.component.parentComponent.writableViewModel[l.directlySet](n.name,t,s)}return!0})(this,e,t),configurable:!0,enumerable:!0}),void 0!==t&&this.#S.push({prop:e,propAccess:t})}#C(e){this.#N=e;for(const t in e)this.#M(t),this.#w.viewModel[l.notifyForDependentProps](t,[])}#E(){return this.#N}#T(){this.#N=void 0}#$(){let e;return e=this.#w.parentComponent.readOnlyViewModel[l.createBuffer](this.#w),void 0!==e||(e={},this.#S.forEach((({prop:t,propAccess:n})=>{const s=x(this,n);e[t]=this.#w.parentComponent.readOnlyViewModel[l.directlyGet](n.name,s)}))),e}#O(){if(void 0!==this.#N){!0!==this.#w.parentComponent.writableViewModel[l.flushBuffer](this.#N,this.#w)&&this.#S.forEach((({prop:e,propAccess:t})=>{const n=x(this,t);this.#w.parentComponent.writableViewModel[l.directlySet](t.name,n,this.#N[e])}))}}#I(){this.#N=void 0,this.#S=[];for(const[e,t]of Object.entries(this.#B))Object.defineProperty(this.#w.baseViewModel,e,t);this.#B={}}get(e,t,n){return t===l.bindProperty?(e,t)=>this.#M(e,t):t===l.setBuffer?e=>this.#C(e):t===l.getBuffer?()=>this.#E():t===l.clearBuffer?()=>this.#T():t===l.createBuffer?()=>this.#$():t===l.flushBuffer?()=>this.#O():t===l.clear?()=>this.#I():this.#w.viewModel[t]}set(e,t,n,s){return this.#w.viewModel[t]=n,!0}ownKeys(e,t){return void 0!==this.buffer?Reflect.ownKeys(this.buffer):this.#S.map((({prop:e})=>e))}getOwnPropertyDescriptor(e,t,n){return{enumerable:!0,configurable:!0}}};class w extends a{#L=new Map;get(e,t,n){return t===l.boundByComponent?(e,t)=>{let n=this.#L.get(t);null==n?this.#L.set(t,new Set([e])):n.add(e)}:super.get(e,t,n)}set(e,t,n,s){const{propName:i,indexes:o}=r.parse(t),a=s[l.directlySet](i.name,o,n);let c=this.#L.get(i.name);if(c)for(const e of c)e.viewModel[l.notifyForDependentProps]("$globals."+i.name,o);return a}}class N{static create(){return new Proxy({},new w)}static data=this.create()}let S=class{#w;setOfProps=new Set;constructor(e){this.#w=e}bindProperty(e){N.data[l.boundByComponent](this.#w,e),this.setOfProps.add(e)}directGet=(e,t)=>(this.setOfProps.has(e)||this.bindProperty(e),N.data[l.directlyGet](e,t));directSet=(e,t,n)=>(this.setOfProps.has(e)||this.bindProperty(e),N.data[l.directlySet](e,t,n));get(e,t,n){if(t===l.directlyGet)return this.directGet;if(t===l.directlySet)return this.directSet;if(t===l.isSupportDotNotation)return!0;const{propName:s,indexes:i}=r.parse(t);return this.directGet(s.name,i)}set(e,t,n,s){const{propName:i,indexes:o}=r.parse(t);return this.directSet(i.name,o,n)}};const B=new Set(["articles","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]);const M=new Map;class C{static initialize(e){const t=e.fragment.querySelectorAll("[popovertarget]");if(0!==t.length)for(const n of t){const t=n.getAttribute("popovertarget");let s=M.get(e)?.get(t);void 0===s&&(s=()=>e.component.popoverContextIndexesById.set(t,e.loopContext.indexes),M.get(e)?.set(t,s)??M.set(e,new Map([[t,s]]))),n.removeEventListener("click",s),n.addEventListener("click",s)}}static dispose(e){M.delete(e)}}const E={};class T{#_;get bindingManager(){return this.#_}get parentBindingManager(){return this.bindingManager.parentBinding?.bindingManager}get binding(){return this.bindingManager.parentBinding}get nearestBindingManager(){const e=r.create(this.name);if(e.level<=0)return;const t=r.create(e.nearestWildcardParentName).name;let n=this.parentBindingManager;for(;void 0!==n;){if(n.loopContext.binding.viewModelProperty.name===t)return n;n=n.loopContext.parentBindingManager}}get nearestLoopContext(){return this.nearestBindingManager?.loopContext}#A;#F;get _index(){const e=this.bindingManager.component.contextRevision;return this.#A!==e&&(this.#F=this.binding.children.indexOf(this.#_),this.#A=e),this.#F}get index(){if(this.binding?.loopable)return this._index;{const e=this.parentBindingManager?.loopContext;return e?.index??-1}}get name(){if(this.binding?.loopable)return this.binding.viewModelProperty.name;{const e=this.parentBindingManager?.loopContext;return e?.name??""}}get indexes(){if(this.binding?.loopable)return this.nearestLoopContext?.indexes.concat(this.index)??[this.index];{const e=this.parentBindingManager?.loopContext;return e?.indexes??[]}}get allIndexes(){if(void 0===this.binding)return[];const e=this.binding.loopable?this._index:-1,t=this.parentBindingManager.loopContext.allIndexes;return e>=0?t.concat(e):t}constructor(e){this.#_=e}find(e){let t=this;for(;void 0!==t;){if(t.name===e)return t;t=t.parentBindingManager.loopContext}}}const $={HTMLElement:1,SVGElement:2,Text:3,Template:4},O=e=>e.constructor.name+"\t"+e.textContent?.[2]??"",I={},L=e=>I[O(e)]??(I[O(e)]=(e=>e instanceof Comment&&":"===e.textContent?.[2]?$.Text:e instanceof HTMLElement?$.HTMLElement:e instanceof Comment&&"|"===e.textContent?.[2]?$.Template:e instanceof SVGElement?$.SVGElement:$.Unknown)(e)),_="textContent",A={radio:"checked",checkbox:"checked",button:"onclick"},F={},V=e=>{},k={[$.HTMLElement]:(e,t=e)=>t instanceof HTMLSelectElement||t instanceof HTMLTextAreaElement||t instanceof HTMLOptionElement?"value":t instanceof HTMLButtonElement||t instanceof HTMLAnchorElement?"onclick":t instanceof HTMLFormElement?"onsubmit":t instanceof HTMLInputElement?A[t.type]??"value":_,[$.SVGElement]:V,[$.Text]:e=>_,[$.Template]:V},D=(e,t)=>{const n=e.constructor.name+"\t"+(e.type??"");return F[n]??(F[n]=k[t](e))},R="bind",j={[$.HTMLElement]:e=>e.dataset[R]??"",[$.SVGElement]:e=>e.dataset[R]??"",[$.Text]:e=>e.textContent.slice(3)??"",[$.Template]:e=>m(e.textContent.slice(3)??"")?.dataset[R]??""},H=(e,t)=>j[t](e),W=e=>e.trim(),U=e=>e.length>0,z=new RegExp(/^#(.*)#$/),K=e=>{const t=z.exec(e);return t?decodeURIComponent(t[1]):e},G=e=>{const[t,...n]=e.split(",").map(W);return{name:t,options:n.map(K)}},q=(e,t)=>{const[n,s]=[t].concat(...e.split(":").map(W)).splice(-2),{viewModelProperty:i,filters:r}=(e=>{const[t,...n]=e.split("|").map(W);return{viewModelProperty:t,filters:n.map(G)}})(s);return{nodeProperty:n,viewModelProperty:i,filters:r}},Q={};function Z(e,t){if(void 0===e&&d.raise("Parser: text is undefined"),""===e.trim())return[];const n=e+"\t"+t;return Q[n]??(Q[n]=((e,t)=>e.split(";").map(W).filter(U).map((e=>{let{nodeProperty:n,viewModelProperty:s,filters:i}=q(e,"$");return s="@"===s?n:s,n="$"===n?t:n,void 0===n&&d.raise("parseBindText: default property undefined"),{nodeProperty:n,viewModelProperty:s,filters:i}})))(e,t))}const J={ObjectClass:Object,prefix:"object",prefixShort:"o",prototypeFuncs:new Set(["hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),staticFuncs:new Set(["create","defineProperties","defineProperty","entries","fromEntries","getOwnPropertyDescriptor","getOwnPropertyDescriptors","getOwnPropertyNames","getOwnPropertySymbols","getPrototypeOf","is","isExtensible","isFrozen","isSealed","keys","preventExtensions","values"])},Y={ObjectClass:Array,prefix:"array",prefixShort:"a",prototypeFuncs:new Set(["at","concat","entries","flat","includes","indexOf","join","keys","lastIndexOf","slice","toLocaleString","toReversed","toSorted","toSpliced","values","with","toString"]),staticFuncs:new Set(["from","isArray","of"])},X={ObjectClass:Number,prefix:"number",prefixShort:"n",prototypeFuncs:new Set(["toExponential","toFixed","toLocaleString","toPrecision","toString","valueOf"]),staticFuncs:new Set(["isFinite","isInteger","isNaN","isSafeInteger","parseFloat","parseInt"])},ee={ObjectClass:String,prefix:"string",prefixShort:"s",prototypeFuncs:new Set(["at","charAt","charCodeAt","codePointAt","concat","endsWith","includes","indexOf","lastIndexOf","localeCompare","match","normalize","padEnd","padStart","repeat","replace","replaceAll","search","slice","split","startsWith","substring","toLocaleLowerCase","toLocaleUpperCase","toLowerCase","toUpperCase","trim","trimEnd","trimStart","valueOf","toString"]),staticFuncs:new Set(["fromCharCode","fromCodePoint","raw"])},te={ObjectClass:Date,prefix:"date",prefixShort:"",prototypeFuncs:new Set(["getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","toDateString","toISOString","toJSON","toLocaleDateString","toLocaleString","toLocaleTimeString","toTimeString","toUTCString","valueOf","toString"]),staticFuncs:new Set(["now","parse","UTC"])},ne={ObjectClass:Set,prefix:"set",prefixShort:"",prototypeFuncs:new Set(["entries","forEach","has","keys","values"]),staticFuncs:new Set([])},se={ObjectClass:Map,prefix:"map",prefixShort:"",prototypeFuncs:new Set(["entries","forEach","get","has","keys","values"]),staticFuncs:new Set(["groupBy"])},ie={ObjectClass:JSON,prefix:"json",prefixShort:"",prototypeFuncs:new Set([]),staticFuncs:new Set(["parse","stringify"])},re={ObjectClass:Math,prefix:"math",prefixShort:"",prototypeFuncs:new Set([]),staticFuncs:new Set(["abs","acos","acosh","asin","asinh","atan","atan2","atanh","cbrt","ceil","clz32","cos","cosh","exp","expm1","floor","fround","hypot","imul","log","log10","log1p","log2","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc"])},oe={ObjectClass:RegExp,prefix:"regexp",prefixShort:"",prototypeFuncs:new Set(["exec","test","toString"]),staticFuncs:new Set([])};class ae{static"truthy*"=e=>e=>!!e;static"falsey*"=e=>e=>!e;static"not*"=this["falsey*"];static eq=e=>t=>t==e[0];static ne=e=>t=>t!=e[0];static lt=e=>t=>Number(t)<Number(e[0]);static le=e=>t=>Number(t)<=Number(e[0]);static gt=e=>t=>Number(t)>Number(e[0]);static ge=e=>t=>Number(t)>=Number(e[0]);static oi=e=>t=>Number(e[0])<Number(t)&&Number(t)<Number(e[1]);static ci=e=>t=>Number(e[0])<=Number(t)&&Number(t)<=Number(e[1]);static embed=e=>t=>(e[0]??"").replaceAll("%s",t);static iftext=e=>t=>t?e[0]??null:e[1]??null;static"isnull*"=e=>e=>null==e;static offset=e=>t=>Number(t)+Number(e[0]);static unit=e=>t=>String(t)+String(e[0]);static inc=this.offset;static mul=e=>t=>Number(t)*Number(e[0]);static div=e=>t=>Number(t)/Number(e[0]);static mod=e=>t=>Number(t)%Number(e[0]);static prop=e=>t=>t[e[0]];static prefix=e=>t=>String(e[0])+String(t);static suffix=this.unit;static date=e=>t=>Date.prototype.toLocaleDateString.apply(t,["sv-SE",e[0]?e[0]:{}]);static"isnan*"=e=>e=>isNaN(e);static nullsafe=e=>e=>l.nullSafe;static nonullsafe=e=>e=>l.noNullSafe}new Set([]);const le=new Set(["truthy*","falsey*","not*","eq","ne","lt","le","gt","ge","oi","ci","embed","iftext","isnull*","offset","unit","inc","mul","div","mod","prop","prefix","suffix","date","isnan*"]);function ce(e,t){const n=e.prototype[t];return e=>t=>n.apply(t,e)}function de(e,t){const n=e[t];return e=>t=>n.apply(null,[t,...e])}const pe=[te,ne,se,ie,oe,Y,J,X,ee,re],he=e=>t=>n=>null==n?n:e(t)(n),ue=(e,t)=>t(e),me=e=>e=>e;class fe{static create(e,t){const n=[];for(let s=0;s<e.length;s++){const i=e[s];n.push(t.getFilterFunc(i.name)(i.options))}return n}}class ge{ambigousNames;funcByName;registerFilter(e,t){const n=e.endsWith("*"),s=n?e.slice(0,-1):e;this.funcByName.has(s)&&d.raise(`${this.constructor.name}: ${s} is already registered`);const i=n?t:he(t);this.funcByName.set(s,i)}getFilterFunc(e){return this.ambigousNames.has(e)&&d.raise(`${this.constructor.name}: ${e} is ambigous`),this.funcByName.get(e)??me}static applyFilter(e,t){return t.reduce(ue,e)}}class ye extends ge{constructor(){super(),this.ambigousNames=new Set(ye.#V),this.funcByName=new Map(ye.#k)}static#V=new Set;static#k=new Map;static{const e=new Set,t=new Map;for(const n of pe){for(const s of n.prototypeFuncs){const i=s.endsWith("*"),r=i?s.slice(0,-1):s,o=ce(n.ObjectClass,r),a=i?o:he(o);n.prefix&&t.set(`${n.prefix}.${r}`,a),n.prefixShort&&t.set(`${n.prefixShort}.${r}`,a),t.has(r)?e.add(r):t.set(r,a)}for(const s of n.staticFuncs){const i=s.endsWith("*"),r=i?s.slice(0,-1):s,o=de(n.ObjectClass,r),a=i?o:he(o);n.prefix&&t.set(`${n.prefix}.${r}`,a),n.prefixShort&&t.set(`${n.prefixShort}.${r}`,a),t.has(r)?e.add(r):t.set(r,a)}}for(const e of le){const n=e.endsWith("*"),s=n?e.slice(0,-1):e,i=ae[e];void 0===i&&d.raise(`${this.name}: ${e} is not found in defaultFilterGroup`);const r=n?i:he(i);t.set(s,r)}for(const n of e)t.delete(n);this.#V=e,this.#k=t}static registerFilter(e,t){const n=e.endsWith("*"),s=n?e.slice(0,-1):e;this.#k.has(s)&&d.raise(`${this.name}: ${s} is already registered`);const i=n?t:he(t);this.#k.set(s,i)}}class ve{static date=e=>e=>""===e?null:new Date(new Date(e).setHours(0));static number=e=>e=>""===e?null:Number(e);static boolean=e=>e=>"false"!==e&&""!==e}class be extends ge{constructor(){super(),this.ambigousNames=new Set(be.#V),this.funcByName=new Map(be.#k)}static#V=new Set;static#k=new Map;static{this.#k.set("date",ve.date),this.#k.set("number",ve.number),this.#k.set("boolean",ve.boolean)}static registerFilter(e,t){this.#k.has(e)&&d.raise(`${this.name}: ${e} is already registered`),this.#k.set(e,t)}}class xe{static preventDefault=e=>e=>(e.preventDefault(),e);static noStopPropagation=e=>e=>(e.noStopPropagation=!0,e);static pd=this.preventDefault;static nsp=this.noStopPropagation}class Pe extends ge{constructor(){super(),this.ambigousNames=new Set(Pe.#V),this.funcByName=new Map(Pe.#k)}static#V=new Set;static#k=new Map;static{this.#k.set("preventDefault",xe.preventDefault),this.#k.set("noStopPropagation",xe.noStopPropagation),this.#k.set("pd",xe.preventDefault),this.#k.set("nsp",xe.noStopPropagation)}static registerFilter(e,t){this.#k.has(e)&&d.raise(`${this.name}: ${e} is already registered`),this.#k.set(e,t)}}const we={};class Ne{#D;get node(){return this.#D}#e;get name(){return this.#e}#R=[];get nameElements(){return this.#R}get value(){return this.node[this.name]}set value(e){this.node[this.name]=e}#j;get filters(){return this.#j}get filteredValue(){return 0===this.filters.length?this.value:ge.applyFilter(this.value,this.filters)}get applicable(){return!0}#H;get binding(){return this.#H}get expandable(){return!1}get isSelectValue(){return!1}get loopable(){return!1}constructor(e,t,n,s){t instanceof Node||d.raise("NodeProperty: not Node"),this.assign(e,t,n,s)}assign(e,t,n,s){return this.#H=e,this.#D=t,this.#e=n,this.#R=n.split("."),this.#j=fe.create(s.toReversed(),e.component.filters.in),this}initialize(){}postUpdate(e){}isSameValue(e){return this.value===e}applyToChildNodes(e){}dispose(){const e=this.constructor.name;this.#H=void 0,this.#D=void 0,this.#j=void 0,we[e]?.push(this)??(we[e]=[this])}}class Se extends Ne{#W;get template(){return void 0===this.#W&&(this.#W=m(this.uuid)??d.raise(`TemplateProperty: invalid uuid ${this.uuid}`)),this.#W}#P;get uuid(){return void 0===this.#P&&(this.#P=Se.getUUID(this.node)),this.#P}static getUUID(e){return e.textContent.slice(3)}get expandable(){return!0}constructor(e,t,n,s){t instanceof Comment||d.raise("TemplateProperty: not Comment"),super(e,t,n,s)}dispose(){super.dispose(),this.#W=void 0,this.#P=void 0}}const Be=e=>e.applyToNode();class Me extends Se{get loopable(){return!0}get value(){return this.binding.children.length}set value(e){if(Array.isArray(e)||d.raise(`Repeat: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not array`),this.value<e.length){this.binding.children.forEach(Be);for(let t=this.value;t<e.length;t++){const e=bt.create(this.binding.component,this.template,this.uuid,this.binding);this.binding.appendChild(e),e.registerBindingsToSummary(),e.applyToNode()}}else if(this.value>e.length){const t=this.binding.children.splice(e.length);this.binding.children.forEach(Be),t.forEach((e=>e.dispose()))}else this.binding.children.forEach(Be)}constructor(e,t,n,s){"loop"!==n&&d.raise(`Repeat: invalid property name '${n}'`),super(e,t,n,s)}isSameValue(e){return!1}}class Ce{value;enabled;constructor(e,t){this.value=e,this.enabled=t}}const Ee={};class Te{get viewModel(){return this.#H.component.viewModel}#e;get name(){return this.#e}#U;get propertyName(){return this.#U}#l;get level(){return this.#l}get indexes(){const e=this.binding.loopContext?.indexes??[];return e.length===this.level?e:e.slice(0,this.level)}get indexesString(){return this.indexes.toString()}get key(){return this.name+"\t"+this.indexesString}#z;get oldKey(){return this.#z}get isChagedKey(){return this.#z!==this.key}getKey(){return this.#z=this.key,this.key}get value(){return this.viewModel[l.directlyGet](this.name,this.indexes)}set value(e){const t=e=>{this.viewModel[l.directlySet](this.name,this.indexes,e)};if(e instanceof Ce){const n=this.value;if(Array.isArray(n)){const s=new Set(n);e.enabled?s.add(e.value):s.delete(e.value),t(Array.from(s))}else t(e.enabled?e.value:void 0)}else t(e)}#j;get filters(){return this.#j}get filteredValue(){return 0===this.filters.length?this.value:ge.applyFilter(this.value,this.filters)}get applicable(){return!0}#H;get binding(){return this.#H}constructor(e,t,n){this.assign(e,t,n)}assign(e,t,n){return this.#H=e,this.#e=t,this.#j=fe.create(n,e.component.filters.out),this.#U=r.create(this.name),this.#l=this.#U.level,this}initialize(){}getChildValue(e){return this.viewModel[l.directlyGet](`${this.name}.*`,this.indexes.concat(e))}setChildValue(e,t){return this.viewModel[l.directlySet](`${this.name}.*`,this.indexes.concat(e),t)}dispose(){const e=this.constructor.name;this.#H=void 0,this.#j=void 0,Ee[e]?.push(this)??(Ee[e]=[this])}}const $e=RegExp(/^\$[0-9]+$/);class Oe extends Te{get index(){return Number(this.name.slice(1))-1}get value(){return this.binding.loopContext.allIndexes[this.index]}get indexes(){return[]}get indexesString(){return""}constructor(e,t,n){$e.test(t)||d.raise(`ContextIndex: invalid name ${t}`),super(e,t,n)}}class Ie extends Ne{get element(){return this.node}constructor(e,t,n,s){t instanceof Element||d.raise("ElementBase: not element"),super(e,t,n,s)}}class Le extends Ie{get inputElement(){return this.node}_value=new Ce(void 0,!1);get value(){return this._value.value=this.inputElement.value,this._value.enabled=this.inputElement.checked,this._value}set value(e){Array.isArray(e)||d.raise(`Checkbox: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not array`);const t=this.filteredValue;this.inputElement.checked=e.some((e=>e===t.value))}_filteredValue=new Ce(void 0,!1);get filteredValue(){const e=this.value;return this._filteredValue.value=this.filters.length>0?ge.applyFilter(e.value,this.filters):e.value,this._filteredValue.enabled=e.enabled,this._filteredValue}constructor(e,t,n,s){t instanceof HTMLInputElement||d.raise("Checkbox: not htmlInputElement"),"checkbox"!==t.type&&d.raise("Checkbox: not checkbox"),super(e,t,n,s)}isSameValue(e){return!1}}class _e extends Ie{get inputElement(){return this.element}_value=new Ce(void 0,!1);get value(){return this._value.value=this.inputElement.value,this._value.enabled=this.inputElement.checked,this._value}set value(e){const t=this.filteredValue;this.inputElement.checked=e===t.value}_filteredValue=new Ce(void 0,!1);get filteredValue(){const e=this.value;return this._filteredValue.value=this.filters.length>0?ge.applyFilter(e.value,this.filters):e.value,this._filteredValue.enabled=e.enabled,this._filteredValue}constructor(e,t,n,s){t instanceof HTMLInputElement||d.raise("Radio: not htmlInputElement"),"radio"!==t.type&&"checkbox"!==t.type&&d.raise("Radio: not radio or checkbox"),super(e,t,n,s)}isSameValue(e){return!1}}class Ae extends Ie{get eventType(){return this.name.slice(2)}get applicable(){return!1}#K;get handler(){return void 0===this.#K&&(this.#K=e=>this.eventHandler(e)),this.#K}#G=[];get eventFilters(){return this.#G}constructor(e,t,n,s){n.startsWith("on")||d.raise(`ElementEvent: invalid property name ${n}`),super(e,t,n,s),this.#G=fe.create(s,e.component.filters.event)}initialize(){this.element.addEventListener(this.eventType,this.handler)}async directlyCall(e){const{viewModelProperty:t,loopContext:n}=this.binding??{};return t?.viewModel[l.directlyCall](t.name,n,e)}eventHandler(e){this.binding.component.bindingSummary.exists(this.binding)&&(e=this.eventFilters.length>0?ge.applyFilter(e,this.eventFilters):e,!e?.noStopPropagation&&e.stopPropagation(),this.binding.component.updator.addProcess(this.directlyCall,this,[e]))}dispose(){this.element.removeEventListener(this.eventType,this.handler),super.dispose()}}class Fe extends Ie{#q;get isSelectValue(){return void 0===this.#q&&(this.#q=this.node.constructor===HTMLSelectElement&&"value"===this.name),this.#q}}class Ve{#Q;get name(){return this.#Q.name}get indexes(){return this.#Q.indexes}get loopContext(){return this.#Q.binding.loopContext}constructor(e){this.#Q=e}}class ke extends Ie{get propName(){return this.nameElements[1]}get applicable(){return!0}get thisComponent(){return this.node}constructor(e,t,n,s){t.constructor[l.isComponent]||d.raise("ComponentProperty: not Component"),super(e,t,n,s)}get value(){return super.value}set value(e){this.thisComponent.viewModel?.[l.updatedCallback]([[`${this.propName}`,[]]]),this.thisComponent.viewModel?.[l.notifyForDependentProps](this.propName,[])}initialize(){this.thisComponent.props[l.bindProperty](this.propName,new Ve(this.binding.viewModelProperty))}postUpdate(e){const t=this.binding.viewModelProperty.name,n=this.propName;for(const[s,i]of e.entries())if(i.propName.name===t||i.propName.setOfParentPaths.has(t)){const e=i.propName.name.slice(t.length);this.thisComponent.viewModel?.[l.updatedCallback]([[`${n}${e}`,i.indexes]]),this.thisComponent.viewModel?.[l.notifyForDependentProps](`${n}${e}`,i.indexes)}}isSameValue(e){return!1}}const De=new Set(["boolean","number","string"]),Re=new Map,je=new Set,He=new Set,We=new Map;class Ue extends Me{get loopable(){return!0}#Z=[];get value(){return this.#Z}set value(e){Array.isArray(e)||d.raise(`RepeatKeyed: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not array`),Re.clear(),je.clear(),He.clear(),We.clear();for(let t=0;t<e.length;t++){const n=e[t],s=this.#Z.indexOf(n,Re.get(n)??0);-1===s||!1===s?He.add(t):(Re.set(n,s+1),je.add(s),We.set(t,s))}for(let e=0;e<this.binding.children.length;e++)je.has(e)||this.binding.children[e].dispose();let t;const n=this.node.parentNode,s=[];for(let i=0;i<e.length;i++){const e=i;let r;const o=t?.lastNode??this.node;if(He.has(e))r=bt.create(this.binding.component,this.template,this.uuid,this.binding),n.insertBefore(r.fragment,o.nextSibling??null);else{const t=We.get(e);r=this.binding.children[t],r.nodes?.[0]?.previousSibling!==o&&(r.removeNodes(),n.insertBefore(r.fragment,o.nextSibling??null))}t=r,s.push(r)}this.binding.children.splice(0,this.binding.children.length,...s);for(let e=0;e<s.length;e++){const t=s[e];t.registerBindingsToSummary(),t.applyToNode()}this.#Z=e.slice()}applyToChildNodes(e){const t=new Map;for(const n of e){const e=this.binding.children[n];if(void 0===e)continue;const s=this.#Z[n],i=typeof s;"undefined"!==i&&(De.has(i)||(e.removeNodes(),t.set(s,e)))}for(const n of Array.from(e).sort()){const e=this.binding.viewModelProperty.getChildValue(n),s=typeof e;if("undefined"===s)continue;if(De.has(s))continue;let i=t.get(e);void 0===i&&(i=bt.create(this.binding.component,this.template,this.uuid,this.binding)),this.binding.replaceChild(n,i),i.registerBindingsToSummary(),i.applyToNode()}}initialize(){this.#Z=[]}}const ze=RegExp(/^\$[0-9]+$/),Ke={true:{if:class extends Se{get value(){return this.binding.children.length>0}set value(e){if("boolean"!=typeof e&&d.raise(`Branch: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not boolean`),this.value!==e)if(e){const e=bt.create(this.binding.component,this.template,this.uuid,this.binding);this.binding.appendChild(e),e.registerBindingsToSummary()}else{this.binding.children.splice(0,this.binding.children.length).forEach((e=>e.dispose()))}this.binding.children.forEach((e=>e.applyToNode()))}constructor(e,t,n,s){"if"!==n&&d.raise(`Branch: invalid property name ${n}`),super(e,t,n,s)}isSameValue(e){return!1}}},false:{class:class extends Ie{get value(){return this.element.className.length>0?this.element.className.split(" "):[]}set value(e){Array.isArray(e)||d.raise(`ElementClassName: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not array`),this.element.className=e.join(" ")}constructor(e,t,n,s){"class"!==n&&d.raise(`ElementClassName: invalid property name ${n}`),super(e,t,n,s)}},checkbox:Le,radio:_e}},Ge={class:class extends Ie{get className(){return this.nameElements[1]}get value(){return this.element.classList.contains(this.className)}set value(e){"boolean"!=typeof e&&d.raise(`ElementClass: ${this.binding.component.selectorName}.ViewModel['${this.binding.viewModelProperty.name}'] is not boolean`),e?this.element.classList.add(this.className):this.element.classList.remove(this.className)}constructor(e,t,n,s){n.startsWith("class.")||d.raise(`ElementClass: invalid property name ${n}`),super(e,t,n,s)}},attr:class extends Ie{get attributeName(){return this.nameElements[1]}get value(){return this.element.getAttribute(this.attributeName)}set value(e){this.element.setAttribute(this.attributeName,e)}},style:class extends Ie{get htmlElement(){return this.node}get styleName(){return this.nameElements[1]}get value(){return this.htmlElement.style[this.styleName]}set value(e){this.htmlElement.style[this.styleName]=e}constructor(e,t,n,s){t instanceof HTMLElement||d.raise("ElementStyle: not htmlElement"),super(e,t,n,s)}},props:ke},qe=(e,t,n,s)=>{const i=ze.test(n)?Oe:Te;let r;do{const n=e instanceof Comment;if(r=Ke[n][t],void 0!==r)break;if(n&&"loop"===t){r=s?Ue:Me;break}n&&d.raise(`Factory: unknown node property ${t}`);const i=t.split(".");if(r=Ge[i[0]],void 0!==r)break;r=e instanceof Element?t.startsWith("on")?Ae:Fe:Ne}while(0);return{nodePropertyConstructor:r,viewModelPropertyConstructor:i}},Qe=e=>e,Ze={[$.Text]:e=>{const t=document.createTextNode("");return e.parentNode.replaceChild(t,e),t},[$.HTMLElement]:Qe,[$.SVGElement]:Qe,[$.Template]:Qe},Je=(e,t)=>Ze[t](e),Ye=e=>{let t=[];for(;null!==e.parentNode;)t=[Array.from(e.parentNode.childNodes).indexOf(e),...t],e=e.parentNode;return t},Xe=(e,t)=>{for(let n=0;n<t.length;e=e.childNodes[t[n++]]);return e},et=e=>(t,n)=>yt.create(t,n,e.nodeProperty,e.nodePropertyConstructor,e.viewModelProperty,e.viewModelPropertyConstructor,e.filters),tt=e=>{const t=e;return t.removeAttribute("data-bind"),t},nt=e=>e,st={[$.HTMLElement]:tt,[$.SVGElement]:tt,[$.Text]:nt,[$.Template]:nt},it=(e,t)=>st[t](e),rt=e=>!1,ot={[$.HTMLElement]:e=>e instanceof HTMLElement&&(e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&"button"!==e.type),[$.SVGElement]:rt,[$.Text]:rt,[$.Template]:rt},at=(e,t)=>ot[t](e),lt=new Set;const ct=()=>{},dt={[$.HTMLElement]:function(e,t,n,s){const i=e;let r=!1,o=null,a=null,l=null;for(let e=0;e<n.length;e++){const t=n[e];r||="oninput"===t.nodeProperty.name,a=t.nodeProperty.constructor===_e?t:a,l=t.nodeProperty.constructor===Le?t:l,o=t.nodeProperty.name===s?t:o}if(!r){const e=(e=>t=>e.addEventListener("input",t.defaultEventHandler))(i);a?(e(a),lt.add(a.defaultEventHandler)):l?(e(l),lt.add(l.defaultEventHandler)):o&&t&&(e(o),lt.add(o.defaultEventHandler))}},[$.SVGElement]:ct,[$.Text]:ct,[$.Template]:ct},pt=e=>(t,n)=>dt[e.nodeType](t,e.isInputable,n,e.defaultProperty),ht=e=>Array.from(e.childNodes).flatMap((e=>ht(e).concat((e=>e instanceof Comment&&(e.textContent.startsWith("@@:")||e.textContent.startsWith("@@|")))(e)?e:[])));class ut{template;uuid;nodeInfos={};constructor(e,t,n){this.template=e,this.uuid=t,this.parse(n)}parse(e){const t=this.template.content,n=Array.from(t.querySelectorAll("[data-bind]")).concat(ht(t));this.nodeInfos=[];for(let t=0;t<n.length;t++){let s=n[t];const i={};i.nodeType=L(s),void 0===i.nodeType&&d.raise("Binder: unknown node type");const r=H(s,i.nodeType);if(""!==r.trim()){s=Je(s,i.nodeType),it(s,i.nodeType),i.isInputable=at(s,i.nodeType),i.defaultProperty=D(s,i.nodeType),i.bindTextInfos=Z(r,i.defaultProperty);for(let t=0;t<i.bindTextInfos.length;t++){const n=i.bindTextInfos[t],{nodeProperty:r,viewModelProperty:o}=n;n.createBinding=et(n);const{nodePropertyConstructor:a,viewModelPropertyConstructor:l}=qe(s,r,o,e);n.nodePropertyConstructor=a,n.viewModelPropertyConstructor=l}i.nodeRoute=Ye(s),i.nodeRouteKey=i.nodeRoute.join(","),i.initializeNode=pt(i),this.nodeInfos[this.nodeInfos.length]=i}}}createBindings(e,t){const n=[];for(let s=0;s<this.nodeInfos.length;s++){const i=this.nodeInfos[s],r=Xe(e,i.nodeRoute),o=[];for(let e=0;e<i.bindTextInfos.length;e++)o[o.length]=i.bindTextInfos[e].createBinding(t,r);i.initializeNode(r,o),n.push(...o)}return n}static#J={};static create(e,t){const n=e.dataset.uuid??"";return this.#J[n]??(this.#J[n]=new ut(e,n,t))}}const mt={},ft=[];let gt=0;class yt{#Y;get id(){return this.#Y}#_;get bindingManager(){return this.#_}#X;get nodeProperty(){return this.#X}#Q;get viewModelProperty(){return this.#Q}get component(){return this.#_.component}get loopContext(){return this.#_.loopContext}#ee=[];get children(){return this.#ee}get expandable(){return this.nodeProperty.expandable}get loopable(){return this.nodeProperty.loopable}#q;get isSelectValue(){return void 0===this.#q&&(this.#q=this.nodeProperty.isSelectValue),this.#q}constructor(e,t,n,s,i,r,o){this.assign(e,t,n,s,i,r,o)}assign(e,t,n,s,i,r,o){return this.#Y=++gt,this.#_=e,this.#X=((e,t)=>we[e.name]?.pop()?.assign(...t)??Reflect.construct(e,t))(s,[this,t,n,o]),this.#Q=((e,t)=>Ee[e.name]?.pop()?.assign(...t)??Reflect.construct(e,t))(r,[this,i,o]),this}applyToNode(){if(this.component.updator.updatedBindings.has(this))return;const{component:e,nodeProperty:t,viewModelProperty:n}=this;try{if(!t.applicable)return;const e=n.filteredValue??"";if(t.isSameValue(e))return;t.value=e}finally{e.updator.updatedBindings.add(this)}}applyToChildNodes(e){if(!this.component.updator.updatedBindings.has(this))try{this.nodeProperty.applyToChildNodes(e)}finally{this.component.updator.updatedBindings.add(this)}}applyToViewModel(){const{viewModelProperty:e,nodeProperty:t}=this;e.applicable&&(e.value=t.filteredValue)}execDefaultEventHandler(e){this.component.bindingSummary.exists(this)&&(e.stopPropagation(),this.component.updator.addProcess(this.applyToViewModel,this,[]))}#te;get defaultEventHandler(){var e;return void 0===this.#te&&(this.#te=(e=this,t=>e.execDefaultEventHandler(t))),this.#te}initialize(){this.nodeProperty.initialize(),this.viewModelProperty.initialize()}appendChild(e){this.expandable||d.raise("Binding.appendChild: not expandable");const t=this.children[this.children.length-1];this.children.push(e);const n=this.nodeProperty.node.parentNode,s=t?.lastNode??this.nodeProperty.node;n.insertBefore(e.fragment,s.nextSibling??null)}replaceChild(e,t){this.expandable||d.raise("Binding.replaceChild: not expandable");const n=this.children[e-1];this.children[e]=t;const s=this.nodeProperty.node.parentNode,i=n?.lastNode??this.nodeProperty.node;s.insertBefore(t.fragment,i.nextSibling??null)}dispose(){lt.has(this.defaultEventHandler)&&(this.#X.node.removeEventListener("input",this.defaultEventHandler),lt.delete(this.defaultEventHandler));for(let e=0;e<this.children.length;e++)this.children[e].dispose();this.children.length=0,this.component.bindingSummary.delete(this),this.#X.dispose(),this.#Q.dispose(),this.#_=void 0,this.#X=void 0,this.#Q=void 0,ft.push(this)}static create(e,t,n,s,i,r,o){const a=ft.pop()?.assign(e,t,n,s,i,r,o)??Reflect.construct(yt,[e,t,n,s,i,r,o]);return a.initialize(),a}}const vt=e=>e.nodeType===Node.ELEMENT_NODE;class bt{#w;get component(){return this.#w}#ne=[];get bindings(){return this.#ne}#se=[];get nodes(){return this.#se}get elements(){return this.#se.filter(vt)}get lastNode(){return this.#se[this.#se.length-1]}#ie;get fragment(){return this.#ie}set fragment(e){this.#ie=e}#re;get loopContext(){return this.#re}#W;get template(){return this.#W}#oe;get parentBinding(){return this.#oe}set parentBinding(e){this.#oe=e}#ae;#P;get uuid(){return this.#P}constructor(e,t,n,s){this.assign(e,t,n,s)}assign(e,t,n,s){return this.#oe=s,this.#w=e,this.#W=t,this.#re=new T(this),this.#ae=e.bindingSummary,this.#P=n,this}initialize(){const e=ut.create(this.#W,this.#w.useKeyed);this.#ie=mt[this.#P]?.pop()??document.importNode(this.#W.content,!0),this.#ne=e.createBindings(this.#ie,this),this.#se=Array.from(this.#ie.childNodes)}registerBindingsToSummary(){for(let e=0;e<this.#ne.length;e++)this.#ae.add(this.#ne[e])}applyToNode(){const e=[];for(let t=0;t<this.#ne.length;t++){const n=this.#ne[t];n.isSelectValue?e.push(n):n.applyToNode()}for(let t=0;t<e.length;t++)e[t].applyToNode()}applyToViewModel(){for(let e=0;e<this.#ne.length;e++)this.#ne[e].applyToViewModel()}removeNodes(){for(let e=0;e<this.#se.length;e++)this.#ie.appendChild(this.#se[e])}dispose(){this.removeNodes();for(let e=0;e<this.bindings.length;e++)this.bindings[e].dispose();this.bindings.length=0;const e=this.#P,t=this.#ie;this.#oe=void 0,this.#w=void 0,this.#W=void 0,this.#re=void 0,this.#ae=void 0,this.#P=void 0,this.#ie=void 0,mt[e]?.push(t)??(mt[e]=[t]),E[e]?.push(this)??(E[e]=[this])}static updateNode(e,t){e.component.contextRevision++;const{bindingSummary:n}=e.component;(()=>{n.initUpdate();const e=Array.from(n.expandableBindings);e.sort(((e,t)=>{const n=e.viewModelProperty.propertyName.level-t.viewModelProperty.propertyName.level;if(0!==n)return n;return e.viewModelProperty.propertyName.pathNames.length-t.viewModelProperty.propertyName.pathNames.length}));for(const s of e)n.deleteBindings.has(s)||t.has(s.viewModelProperty.key)&&s.applyToNode();n.flush()})();(()=>{const e=new Map;for(const n of t.values()){if("*"!==n.propName.lastPathName)continue;const t=n.indexes?.at(-1);if(void 0===t)continue;const s=n.propName.parentPath+"\t"+n.indexes.slice(0,n.indexes.length-1);e.get(s)?.add(t)??e.set(s,new Set([t]))}for(const[t,s]of e.entries()){const e=n.bindingsByKey.get(t)??new Set;for(const t of e)n.updatedBindings.has(t)||t.expandable&&t.applyToChildNodes(s)}})();(()=>{const e=[],s=t.keys();for(const t of s){const s=n.bindingsByKey.get(t);if(void 0!==s)for(let t=0;t<s.length;t++){const n=s[t];n.expandable||(n.isSelectValue?e.push(n):n.applyToNode())}}for(let t=0;t<e.length;t++)e[t].applyToNode();for(const e of n.componentBindings)e.nodeProperty.postUpdate(t)})()}static create(e,t,n,s){return((e,t,n,s)=>{const i=E[n]?.pop()?.assign(e,t,n,s)??new bt(e,t,n,s);return i.initialize(),C.initialize(i),i})(e,t,n,s)}}class xt{#le=new Set;#ce=new Map;get setOfPropsByRefProp(){return this.#ce}hasDefaultProp(e){return this.#le.has(e)}addDefaultProp(e){let t=r.create(e);for(;""!==t.parentPath;){const e=r.create(t.parentPath);this.#le.has(t.name)||(this.#ce.get(e.name)?.add(t.name)??this.#ce.set(e.name,new Set([t.name])),this.#le.add(t.name)),t=e}}setDependentProps(e){for(const[t,n]of Object.entries(e))for(const e of n)this.#ce.get(e)?.add(t)??this.#ce.set(e,new Set([t]))}}const Pt={[l.connectedEvent]:(...e)=>{},[l.disconnectedEvent]:(...e)=>{},[l.updatedEvent]:(...e)=>({props:e})},wt={[l.connectedEvent]:"connected",[l.disconnectedEvent]:"disconnected",[l.updatedEvent]:"updated"};class Nt extends a{#w;get component(){return this.#w}#de;get dependentProps(){return this.#de}#pe;get setOfAccessorProperties(){return this.#pe}constructor(e,t,n){super(),this.#w=e,this.#pe=t,this.#de=n}addProcess(e,t,n){this.#w.updator?.addProcess(e,t,n)}addNotify(e,t,n){this.#w.updator?.addUpdatedStateProperty(Object.assign({},t))}static makeNotifyForDependentProps(e,t,n=new Set([])){const{propName:s,indexes:i}=t,o=s.name+"\t"+i.toString();if(n.has(o))return[];n.add(o);const a=e[l.getDependentProps]().setOfPropsByRefProp.get(s.name),c=[];if(void 0===a)return[];for(const t of a){const s=r.create(t);if(i.length<s.level){const t=Nt.expandIndexes(e,{propName:s,indexes:i});c.push(...t.map((e=>({propName:s,indexes:e}))))}else{const e=i.slice(0,s.level);c.push({propName:s,indexes:e})}c.push(...this.makeNotifyForDependentProps(e,{propName:s,indexes:i},n))}return c}static expandIndexes(e,t){const{propName:n,indexes:s}=t;if(n.level===s.length)return[s];if(n.level<s.length)return[s.slice(0,n.level)];{const t=e[l.directlyGet],i=(e,r,o)=>{const a=""!==e?e+".":e,l=n.pathNames[r];if(n.pathNames.length-1===r){if("*"===l){const n=[],s=t(e,o).length;for(let e=0;e<s;e++)n.push(o.concat(e));return n}return[o]}{const n=a+l;if("*"===l){if(o.length<s.length)return i(n,r+1,s.slice(0,o.length+1));{const s=[],a=t(e,o).length;for(let e=0;e<a;e++)s.push(...i(n,r+1,o.concat(e)));return s}}return i(n,r+1,o)}};return i("",0,[])}}}const St={[l.connectedCallback]:"$connectedCallback",[l.disconnectedCallback]:"$disconnectedCallback",[l.updatedCallback]:"$updatedCallback"},Bt=new Set([l.connectedCallback,l.disconnectedCallback,l.updatedCallback]),Mt={[l.connectedCallback]:l.connectedEvent,[l.disconnectedCallback]:l.disconnectedEvent,[l.updatedCallback]:l.updatedEvent};class Ct{static get(e,t,n,s){const i=St[s],r=(...r)=>async()=>{i in e&&Reflect.apply(e[i],t,r),((e,t,n)=>{const s=new CustomEvent(wt[t],{detail:Pt[t](...n)});e.dispatchEvent(s)})(n.component,Mt[s],r)};return s===l.connectedCallback?(...e)=>r(...e)():(...e)=>n.addProcess(r(...e),t,[])}static has(e){return Bt.has(e)}}const Et=new Set([l.directlyCall,l.getDependentProps,l.notifyForDependentProps,l.clearCache,l.createBuffer,l.flushBuffer]),Tt={[l.directlyCall]:({viewModel:e,viewModelProxy:t,handler:n})=>async(s,i,r)=>n.directlyCallback(i,(async()=>Reflect.apply(e[s],t,[r,...i?.allIndexes??[]]))),[l.notifyForDependentProps]:({viewModel:e,viewModelProxy:t,handler:n})=>(s,i)=>n.addNotify(e,{propName:r.create(s),indexes:i},t),[l.getDependentProps]:({handler:e})=>()=>e.dependentProps,[l.clearCache]:({handler:e})=>()=>e.cache.clear(),[l.createBuffer]:({viewModelProxy:e})=>t=>e.$createBuffer?.apply(e,[t]),[l.flushBuffer]:({viewModelProxy:e})=>(t,n)=>e.$flushBuffer?.apply(e,[t,n])};class $t{static get(e,t,n,s){return Tt[s]?.({viewModel:e,viewModelProxy:t,handler:n})}static has(e){return Et.has(e)}}const Ot=e=>t=>"function"==typeof t?t.bind(e):t;class It{get(e,t,n){const s=new Set(e.accessibleProperties);return new Set(e.allProperties).has(t)?s.has(t)?Ot(e)(e[t]):void 0:Ot(e)(e[t])}}const Lt="$globals",_t="$dependentProps",At="$component",Ft=new Set([Lt,_t,At]),Vt={[Lt]:({component:e})=>e.globals,[_t]:({viewModel:e})=>e[_t],[At]:({component:e})=>(e=>new Proxy(e,new It))(e)};class kt{static get(e,t,n){return Vt[n]?.({component:e,viewModel:t})}static has(e){return Ft.has(e)}}class Dt{#he=new Map;get(e,t){return this.#he.get(e)?.get(t)??void 0}has(e,t){return this.#he.get(e)?.has(t)??!1}set(e,t,n){return this.#he.get(e)?.set(t,n)??this.#he.set(e,new Map([[t,n]])),n}clear(){this.#he.clear()}}class Rt extends Nt{#ue=new Dt;get cache(){return this.#ue}getByPropertyName(e,{propName:t},n){if(t.isPrimitive||!this.dependentProps.hasDefaultProp(t.name)&&this.dependentProps.addDefaultProp(t.name),kt.has(t.name))return kt.get(this.component,e,t.name);if(!t.isPrimitive||this.setOfAccessorProperties.has(t.name)){const s=t.level>0?t.level===this.lastIndexes.length?this.lastIndexesString:this.lastIndexes.slice(0,t.level).join(","):"",i=this.#ue.get(t,s);if(void 0!==i)return i;if(this.#ue.has(t,s))return;const r=super.getByPropertyName(e,{propName:t},n);return this.#ue.set(t,s,r),r}return super.getByPropertyName(e,{propName:t},n)}setByPropertyName(e,{propName:t,value:n},s){d.raise("ReadOnlyViewModelHandler: viewModel is read only")}get(e,t,n){return Ct.has(t)?Ct.get(e,n,this,t):$t.has(t)?$t.get(e,n,this,t):super.get(e,t,n)}set(e,t,n,s){d.raise("ReadOnlyViewModelHandler: viewModel is read only")}}const jt=new Map;function Ht(e){let t=jt.get(e.constructor);if(!t){const n=function(e){const t=new Map;let n=e;for(;n!==Object.prototype;){const e=Object.getOwnPropertyDescriptors(n);for(const[n,s]of Object.entries(e))t.has(n)||t.set(n,s);n=Object.getPrototypeOf(n)}return t}(e),s=Array.from(n.entries()),i=[],o=[],a=[],l=[],c=function(e,t){return e.filter((([e,n])=>n.value!==t&&"function"==typeof n.value))}(s,e.constructor).map((([e,t])=>e));(function(e,t){return e.filter((([e,n])=>n.value!==t&&"function"!=typeof n.value))})(s,e.constructor).forEach((([e,t])=>{o.push(e);r.create(e).isPrimitive?a.push(e):"value"in t&&void 0===t.value&&i.push(e),"get"in t&&void 0!==t.get&&l.push(e)})),t={removeProps:i,definedProps:o,primitiveProps:a,methods:c,accessorProps:l},jt.set(e.constructor,t)}return t.removeProps.forEach((t=>Reflect.deleteProperty(e,t))),{definedProps:t.definedProps,primitiveProps:t.primitiveProps,methods:t.methods,accessorProps:t.accessorProps,viewModel:e}}class Wt{#re;get loopContext(){return this.#re}async callback(e,t){void 0!==this.#re&&d.raise("DirectlyCallContext: already set loopContext"),this.#re=e;try{return await t()}finally{this.#re=void 0}}}class Ut extends Nt{#me=new Wt;getByPropertyName(e,{propName:t},n){return t.isPrimitive||!this.dependentProps.hasDefaultProp(t.name)&&this.dependentProps.addDefaultProp(t.name),kt.has(t.name)?kt.get(this.component,e,t.name):super.getByPropertyName(e,{propName:t},n)}setByPropertyName(e,{propName:t,value:n},s){t.isPrimitive||!this.dependentProps.hasDefaultProp(t.name)&&this.dependentProps.addDefaultProp(t.name);const i=super.setByPropertyName(e,{propName:t,value:n},s),r=this.lastIndexes;return this.addNotify(e,{propName:t,indexes:r},s),i}async directlyCallback(e,t){return this.#me.callback(e,(async()=>{this.stackIndexes.push(void 0);try{return await t()}finally{this.stackIndexes.pop()}}))}#fe(e){if(void 0===this.#me.loopContext)return;if("string"!=typeof e||e.startsWith("@@__")||"constructor"===e)return;const t=r.create(e);if(0===t.level||"@"===e.at(0))return;const n=this.#me.loopContext.find(t.nearestWildcardParentName);return void 0===n&&d.raise(`WritableViewModelHandler: ${e} is outside loop`),n}get(e,t,n){if(Ct.has(t))return Ct.get(e,n,this,t);if($t.has(t))return $t.get(e,n,this,t);{const s=this.#fe(t);return void 0!==s?this.directlyGet(e,{prop:t,indexes:s.allIndexes},n):super.get(e,t,n)}}set(e,t,n,s){const i=this.#fe(t);return void 0!==i?this.directlySet(e,{prop:t,indexes:i.allIndexes,value:n},s):super.set(e,t,n,s)}}const zt=e=>e.viewModelProperty.key,Kt=e=>e.nodeProperty.expandable,Gt=e=>e.nodeProperty.constructor===ke;class qt{#ge=!1;get updated(){return this.#ge}set updated(e){this.#ge=e}#ye=0;get updateRevision(){return this.#ye}#ve=new Map;get bindingsByKey(){return this.#ve}#be=new Set;get expandableBindings(){return this.#be}#xe=new Set;get componentBindings(){return this.#xe}#Pe=new Set;get deleteBindings(){return this.#Pe}#we=new Set;get addBindings(){return this.#we}#Ne=new Set;get allBindings(){return this.#Ne}initUpdate(){this.#ge=!1,this.#ye++}add(e){this.#ge=!0,this.#Pe.has(e)?this.#Pe.delete(e):this.#Ne.add(e)}delete(e){this.#ge=!0,this.#Ne.has(e)?this.#Ne.delete(e):this.#Pe.add(e)}exists(e){return this.#Ne.has(e)}flush(){c.debug&&performance.mark("BindingSummary.flush:start");try{if(!this.#ge)return;const e=Array.from(this.#Ne).filter((e=>!this.#Pe.has(e)));this.rebuild(e)}finally{c.debug&&(performance.mark("BindingSummary.flush:end"),performance.measure("BindingSummary.flush","BindingSummary.flush:start","BindingSummary.flush:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures("BindingSummary.flush"),performance.clearMarks("BindingSummary.flush:start"),performance.clearMarks("BindingSummary.flush:end"))}}rebuild(e){this.#Ne=new Set(e),this.#ve=Map.groupBy(e,zt),this.#be=new Set(e.filter(Kt)),this.#xe=new Set(e.filter(Gt)),this.#Pe=new Set}}const Qt=new Map;function Zt(e,t){Array.from(e.cssRules).map((e=>{"CSSImportRule"===e.constructor.name?Zt(e.styleSheet,t):t.insertRule(e.cssText,t.cssRules.length)}))}function Jt(e){const t=new CSSStyleSheet,n=Array.from(document.styleSheets).filter((t=>t.title===e));if(0!==n.length)return n.forEach((e=>Zt(e,t))),Qt.set(e,t),t}const Yt=e=>e.trim(),Xt=e=>e.length>0,en=e=>Qt.get(e)??Jt(e),tn=e=>e;const nn=e=>e.propName.name+"\t"+e.indexes.toString(),sn=e=>async()=>Reflect.apply(e.target,e.thisArgument,e.argumentList);class rn{component;state;processQueue=[];updatedStateProperties=[];expandedStateProperties=[];updatedBindings=new Set;executing=!1;constructor(e){this.component=e}addProcess(e,t,n){this.processQueue.push({target:e,thisArgument:t,argumentList:n}),this.executing||this.exec()}addUpdatedStateProperty(e){this.updatedStateProperties.push(e)}async process({component:e,processQueue:t,updatedStateProperties:n}=this){const s=[];for(;t.length>0;){const i=t.slice(0);t.length=0;for(let t=0;t<i.length;t++)await e.writableViewModelCallback(sn(i[t]));n.length>0&&(e.writableViewModel[l.updatedCallback](n),s.push(...n),n.length=0)}return e.readOnlyViewModel[l.clearCache](),s}expandStateProperties(e,{component:t}=this){const n=e.slice(0);for(let s=0;s<e.length;s++)n.push(...Nt.makeNotifyForDependentProps(t.readOnlyViewModel,e[s]));return n}async exec(){this.executing=!0;try{for(;this.processQueue.length>0;){this.updatedBindings.clear(),this.component.contextRevision++;const e=await this.process(),t=this.expandStateProperties(e),n=new Map(t.map((e=>[nn(e),e]))),s=this.component.bindingSummary,i=Array.from(s.expandableBindings).toSorted(((e,t)=>e.viewModelProperty.propertyName.level-t.viewModelProperty.propertyName.level));s.initUpdate();for(let e=0;e<i.length;e++){const t=i[e];s.exists(t)&&(n.has(t.viewModelProperty.key)&&t.applyToNode())}s.flush();const r=new Map;for(const e of n.values()){if("*"!==e.propName.lastPathName)continue;const t=e.indexes?.at(-1);if(void 0===t)continue;const n=e.propName.parentPath+"\t"+e.indexes.slice(0,e.indexes.length-1);r.get(n)?.add(t)??r.set(n,new Set([t]))}for(const[e,t]of r.entries())for(const n of s.bindingsByKey.get(e)??new Set)n.expandable&&n.applyToChildNodes(t);const o=[];for(const e of n.keys()){const t=s.bindingsByKey.get(e);if(void 0!==t)for(let e=0;e<t.length;e++){const n=t[e];n.expandable||(n.isSelectValue?o.push(n):n.applyToNode())}}for(let e=0;e<o.length;e++)o[e].applyToNode();for(const e of s.componentBindings)e.nodeProperty.postUpdate(n)}}finally{this.executing=!1}}}const on=new WeakMap;class an{get baseViewModel(){return this._viewModels.base}get writableViewModel(){return this._viewModels.writable}get readOnlyViewModel(){return this._viewModels.readonly}get isWritable(){return this._isWritable}get viewModel(){return this.cachableInBuilding?this.readOnlyViewModel:this.isWritable?this.writableViewModel:this.readOnlyViewModel}get rootBinding(){return this._rootBinding}set rootBinding(e){this._rootBinding=e}get props(){return this._props}set props(e){this._props[l.setBuffer](e)}get globals(){return this._globals}get initialPromises(){return this._initialPromises}get alivePromises(){return this._alivePromises}set alivePromises(e){this._alivePromises=e}get parentComponent(){return void 0===this._parentComponent&&(this._parentComponent=(e=>{for(;;){if(null==(e=e.parentNode))return null;if(e.constructor[l.isComponent])return e;if(e instanceof ShadowRoot){if(e.host.constructor[l.isComponent])return e.host;e=e.host}const t=on.get(e);if(void 0!==t)return t}})(this)),this._parentComponent}get useShadowRoot(){return this._useShadowRoot}get useWebComponent(){return this._useWebComponent}get useLocalTagName(){return this._useLocalTagName}get useKeyed(){return this._useKeyed}get useLocalSelector(){return this._useLocalSelector}get useOverscrollBehavior(){return this._useOverscrollBehavior}get useBufferedBind(){return this.hasAttribute("buffered-bind")}get viewRootElement(){return this.useWebComponent?this.shadowRoot??this:this.pseudoParentNode}get queryRoot(){return this.viewRootElement}get pseudoParentNode(){return this.useWebComponent?d.raise("mixInComponent: useWebComponent must be false"):this._pseudoParentNode}get pseudoNode(){return this._pseudoNode}get filters(){return this._filters}get bindingSummary(){return this._bindingSummary}get shadowRootOrDocument(){let e=this.parentNode;for(;e;){if(e instanceof ShadowRoot)return e;e=e.parentNode}return document}get contextRevision(){return this._contextRevision}set contextRevision(e){this._contextRevision=e}get cachableInBuilding(){return this._cachableInBuilding}set cachableInBuilding(e){this._cachableInBuilding=e}get updator(){return this._updator}initializeCallback(){const e=this.constructor;this._isWritable=!1,this._viewModels=function(e,t){const{viewModel:n,accessorProps:s}=Ht(Reflect.construct(t,[])),i=new Set(s),r=new xt;return r.setDependentProps(n.$dependentProps??{}),{readonly:new Proxy(n,new Rt(e,i,r)),writable:new Proxy(n,new Ut(e,i,r)),base:n}}(this,e.ViewModel),this._rootBinding=void 0,this._props=new Proxy({},new P(this)),this._globals=function(e){return new Proxy({},new S(e))}(),this._initialPromises=void 0,this._alivePromises=void 0,this._parentComponent=void 0,this._useShadowRoot=e.useShadowRoot,this._useWebComponent=e.useWebComponent,this._useLocalTagName=e.useLocalTagName,this._useKeyed=e.useKeyed,this._useLocalSelector=e.useLocalSelector,this._useOverscrollBehavior=e.useOverscrollBehavior,this._pseudoParentNode=void 0,this._pseudoNode=void 0,this._filters=void 0,this._bindingSummary=new qt,this._initialPromises=Promise.withResolvers(),this._contextRevision=0,this._cachableInBuilding=!1,this._updator=new rn(this)}async build(){this.cachableInBuilding=!1;const{template:e,styleSheet:t,inputFilterManager:n,outputFilterManager:s,eventFilterManager:i}=this.constructor;if(this._filters={in:n,out:s,event:i},((e=>-1!==e.indexOf("-"))(o=this.tagName.toLowerCase())||B.has(o))&&this.useShadowRoot&&this.useWebComponent){this.attachShadow({mode:"open"});const e=function(e){return e.map(en).filter(tn)}((r=this,getComputedStyle(r)?.getPropertyValue("--adopted-css")?.split(" ").map(Yt).filter(Xt)??[]));void 0!==t&&e.push(t),this.shadowRoot.adoptedStyleSheets=e}else if(void 0!==t){let e=t;this.useLocalSelector&&(e=void 0!==this.constructor.localStyleSheet?this.constructor.localStyleSheet:this.constructor.localStyleSheet=function(e,t){for(let n of e.cssRules)if(n instanceof CSSStyleRule){const e=n.selectorText.split(",").map((e=>e.trim().startsWith(":host")?e.replace(":host",t):`${t} ${e}`)).join(",");n.selectorText=e}return e}(t,this.selectorName));const n=this.shadowRootOrDocument,s=Array.from(n.adoptedStyleSheets);s.includes(e)||(n.adoptedStyleSheets=[...s,e])}var r,o;this.useOverscrollBehavior&&("DIALOG"===this.tagName||this.hasAttribute("popover"))&&(this.style.overscrollBehavior="contain"),await this.viewModel[l.connectedCallback](),this.cachableInBuilding=!0,this.rootBinding=bt.create(this,e,e.dataset.uuid),this.rootBinding.registerBindingsToSummary(),this.rootBinding.applyToNode(),this.bindingSummary.flush(),this.useWebComponent?this.viewRootElement.appendChild(this.rootBinding.fragment):(this.viewRootElement.insertBefore(this.rootBinding.fragment,this.pseudoNode.nextSibling),this.rootBinding.nodes.forEach((e=>on.set(e,this)))),this.cachableInBuilding=!1}async connectedCallback(){try{if(this.parentComponent&&await this.parentComponent.initialPromises.promise,!this.useWebComponent){const e=document.createComment(`@@/${this.tagName}`);this._pseudoParentNode=this.parentNode,this._pseudoNode=e,this.pseudoParentNode.replaceChild(e,this)}this.alivePromises=Promise.withResolvers(),await this.build()}finally{this.initialPromises?.resolve&&this.initialPromises.resolve()}}disconnectedCallback(){this.rootBinding?.dispose(),this.props[l.clear](),this.alivePromises?.resolve&&this.alivePromises.resolve(this.props),this.initialize()}updateNode(e){this.rootBinding&&bt.updateNode(this.rootBinding,e)}addProcess(e,t,n){this.updator.addProcess(e,t,n??[])}async writableViewModelCallback(e){this._isWritable=!0;try{await e()}finally{this._isWritable=!1}}get accessibleProperties(){return["addProcess","viewRootElement ","queryRoot"]}}class ln{get dialogPromises(){return this._dialogPromises}set dialogPromises(e){this._dialogPromises=e}initializeCallback(){this.addEventListener("closed",(()=>{if(void 0!==this.dialogPromises){if(""===this.returnValue)this.dialogPromises.reject();else{const e=this.props[l.getBuffer]();this.props[l.clearBuffer](),this.dialogPromises.resolve(e)}this.dialogPromises=void 0}this.useBufferedBind&&void 0!==this.parentComponent&&""!==this.returnValue&&this.props[l.flushBuffer]()})),this.addEventListener("close",(()=>{const e=new CustomEvent("closed");this.dispatchEvent(e)}))}async _show(e,t=!0){return this.returnValue="",this.dialogPromises=Promise.withResolvers(),this.props[l.setBuffer](e),t?HTMLDialogElement.prototype.showModal.apply(this):HTMLDialogElement.prototype.show.apply(this),this.dialogPromises.promise}async asyncShowModal(e){return this instanceof HTMLDialogElement||d.raise("mixInDialog: asyncShowModal is only for HTMLDialogElement"),this._show(e,!0)}async asyncShow(e){return this instanceof HTMLDialogElement||d.raise("mixInDialog: asyncShow is only for HTMLDialogElement"),this._show(e,!1)}showModal(){if(this instanceof HTMLDialogElement||d.raise("mixInDialog: showModal is only for HTMLDialogElement"),this.useBufferedBind&&void 0!==this.parentComponent){this.returnValue="";const e=this.props[l.createBuffer]();this.props[l.setBuffer](e)}return HTMLDialogElement.prototype.showModal.apply(this)}show(){if(this instanceof HTMLDialogElement||d.raise("mixInDialog: show is only for HTMLDialogElement"),this.useBufferedBind&&void 0!==this.parentComponent){this.returnValue="";const e=this.props[l.createBuffer]();this.props[l.setBuffer](e)}return HTMLDialogElement.prototype.show.apply(this)}close(e=""){return this instanceof HTMLDialogElement||d.raise("mixInDialog: close is only for HTMLDialogElement"),HTMLDialogElement.prototype.close.apply(this,[e])}get accessibleProperties(){if("DIALOG"===this.tagName)return["showModal","show","close","asyncShowModal","asyncShow"]}}class cn{get canceled(){return this._canceled??!1}set canceled(e){this._canceled=e}get popoverPromises(){return this._popoverPromises}set popoverPromises(e){this._popoverPromises=e}initializeCallback(){this.addEventListener("hidden",(()=>{if(void 0!==this.popoverPromises){if(this.canceled)this.popoverPromises.reject();else{const e=this.props[l.getBuffer]();this.props[l.clearBuffer](),this.popoverPromises.resolve(e)}this.popoverPromises=void 0}this.useBufferedBind&&void 0!==this.parentComponent&&(this.canceled||this.props[l.flushBuffer]()),this.canceled=!0;const e=this.id;void 0!==e&&this.popoverContextIndexesById.delete(e)})),this.addEventListener("shown",(()=>{if(this.canceled=!0,this.useBufferedBind&&void 0!==this.parentComponent){const e=this.props[l.createBuffer]();this.props[l.setBuffer](e)}for(const e in this.props)this.viewModel[l.notifyForDependentProps](e,[])})),this.addEventListener("toggle",(e=>{if("closed"===e.newState){const e=new CustomEvent("hidden");this.dispatchEvent(e)}else if("open"===e.newState){const e=new CustomEvent("shown");this.dispatchEvent(e)}}))}async asyncShowPopover(e){return this.popoverPromises=Promise.withResolvers(),this.props[l.setBuffer](e),HTMLElement.prototype.showPopover.apply(this),this.popoverPromises.promise}hidePopover(){this.canceled=!1,HTMLElement.prototype.hidePopover.apply(this)}cancelPopover(){HTMLElement.prototype.hidePopover.apply(this)}get popoverContextIndexesById(){return void 0===this._popoverContextIndexesById&&(this._popoverContextIndexesById=new Map),this._popoverContextIndexesById}get accessibleProperties(){if(this.hasAttribute("popover"))return["showPopover","asyncShowPopover","hidePopover","cancelPopover"]}}function dn(e){const t=Object.assign(new v,e);t.filters=Object.assign({},e.filters),t.config=Object.assign({},e.moduleConfig??e.config),t.options=Object.assign({},e.options);const n=function(e){return class extends HTMLElement{static template=e.template;static styleSheet=e.styleSheet;static localStyleSheet;static ViewModel=e.ViewModel??e.State??class{};static inputFilters=e.filters?.input??{};static outputFilters=e.filters?.output??{};static eventFilters=e.filters?.event??{};static useShadowRoot=e.config?.useShadowRoot??c.useShadowRoot;static useWebComponent=e.config?.useWebComponent??c.useWebComponent;static useLocalTagName=e.config?.useLocalTagName??c.useLocalTagName;static useKeyed=e.config?.useKeyed??c.useKeyed;static useLocalSelector=e.config?.useLocalSelector??c.useLocalSelector;static useOverscrollBehavior=e.config?.useOverscrollBehavior??c.useOverscrollBehavior;static get[l.isComponent](){return!0}static initializeCallbacks=[];static accessiblePropertiesFn=[];static allProperties=["initialize","accessibleProperties","allProperties"];static lowerTagName;get lowerTagName(){return this.constructor.lowerTagName}static selectorName;get selectorName(){return this.constructor.selectorName}static isAutonomousCustomElement;get isAutonomousCustomElement(){return this.constructor.isAutonomousCustomElement}static isCostomizedBuiltInElement;get isCostomizedBuiltInElement(){return this.constructor.isCostomizedBuiltInElement}static inputFilterManager=new be;static outputFilterManager=new ye;static eventFilterManager=new Pe;constructor(){if(super(),void 0===this.constructor.lowerTagName){const e=this.tagName.toLowerCase(),t=e.includes("-"),n=this.getAttribute("is"),s=!!n;this.constructor.selectorName=t?e:`${e}[is="${n}"]`,this.constructor.lowerTagName=e,this.constructor.isAutonomousCustomElement=t,this.constructor.isCostomizedBuiltInElement=s}this.initialize()}initialize(){this.constructor.initializeCallbacks.forEach((e=>e.apply(this,[])))}get accessibleProperties(){return this.constructor.accessiblePropertiesFn.flatMap((e=>e.apply(this,[])??[])).concat([])}get allProperties(){return this.constructor.allProperties}static{for(const[e,t]of Object.entries(this.inputFilters))this.inputFilterManager.registerFilter(e,t);for(const[e,t]of Object.entries(this.outputFilters))this.outputFilterManager.registerFilter(e,t);for(const[e,t]of Object.entries(this.eventFilters))this.eventFilterManager.registerFilter(e,t)}}}(t),s=t.config?.extends??t.options?.extends;if(void 0===s);else{const e=document.createElement(s).constructor;n.prototype.__proto__=e.prototype,n.__proto__=e}const i=e=>{for(let[t,s]of Object.entries(Object.getOwnPropertyDescriptors(e)))(s.enumerable||void 0!==s.get)&&("accessibleProperties"===t?n.accessiblePropertiesFn.push(s.get??(()=>s.value)):Object.defineProperty(n,t,s),n.allProperties.push(t));for(let[t,s]of Object.entries(Object.getOwnPropertyDescriptors(e.prototype)))"constructor"!==t&&("initializeCallback"===t?n.initializeCallbacks.push(s.value):"accessibleProperties"===t?n.accessiblePropertiesFn.push(s.get??(()=>s.value)):Object.defineProperty(n.prototype,t,s),n.allProperties.push(t))};return i(an),i(ln),i(cn),hn(t.componentModulesForRegister),n}function pn(e,t){const n=d.toKebabCase(e),s=dn(t),i=t.moduleConfig?.extends??t.options?.extends;void 0===i?customElements.define(n,s):customElements.define(n,s,{extends:i})}function hn(e){for(const[t,n]of Object.entries(e??{}))pn(t,n)}class un{static register(e,t){}}class mn{static toKebabCase=e=>"string"==typeof e?e.replaceAll(/[\._]/g,"-").replaceAll(/([A-Z])/g,((e,t,n)=>(n>0?"-":"")+t.toLowerCase())):e}const fn="kebab",gn="snake",yn="uppercamel",vn="lowercamel",bn="dotted";class xn{static getNames(e){const t=mn.toKebabCase(e),n=t.replaceAll("-","_"),s=t.replaceAll("-","."),i=t.split("-").map(((e,t)=>(void 0!==e[0]&&(e=e[0].toUpperCase()+e.slice(1)),e))).join(""),r=i.length>0?i[0].toLowerCase()+i.slice(1):i;return{[fn]:t,[gn]:n,[yn]:i,[vn]:r,[bn]:s}}}const Pn=vn;class wn{defaultNameType=Pn;defaultPath="./";loadNames=[];prefixMap}class Nn{prefix;path;get matchPrefix(){return`${this.prefix}-`}isMatch(e){return e.startsWith(this.matchPrefix)}getNames(e){const{prefix:t,path:n}=this;if(e.startsWith(this.matchPrefix)){return{prefixName:t,subName:e.slice(this.matchPrefix.length),path:n}}}}const Sn=xn.getNames("prefix-name"),Bn=xn.getNames("sub-name");class Mn{static getPathInfo(e,t,n,s){const[i,r]=e.split("#");let o=i,a=r;const l=xn.getNames(t),c=xn.getNames(n);return o=o.replaceAll(`{${Sn[fn]}}`,l[fn]),o=o.replaceAll(`{${Sn[gn]}}`,l[gn]),o=o.replaceAll(`{${Sn[vn]}}`,l[vn]),o=o.replaceAll(`{${Sn[yn]}}`,l[yn]),o=o.replaceAll(`{${Sn[bn]}}`,l[bn]),o=o.replaceAll(`{${Bn[fn]}}`,c[fn]),o=o.replaceAll(`{${Bn[gn]}}`,c[gn]),o=o.replaceAll(`{${Bn[vn]}}`,c[vn]),o=o.replaceAll(`{${Bn[yn]}}`,c[yn]),o=o.replaceAll(`{${Bn[bn]}}`,c[bn]),i===o&&".js"!==o.slice(-3)&&(o=o+("/"!==e.slice(-1)?"/":"")+c[s]+".js"),a&&(a=a.replaceAll(`{${Bn[fn]}}`,c[fn]),a=a.replaceAll(`{${Bn[gn]}}`,c[gn]),a=a.replaceAll(`{${Bn[vn]}}`,c[vn]),a=a.replaceAll(`{${Bn[yn]}}`,c[yn]),a=a.replaceAll(`{${Bn[bn]}}`,c[bn])),{filePath:o,exportName:a}}}class Cn{#Se;#Be;#Me;#Ce;#Ee;constructor(e){this.#Ce=e,this.#Ee=window.location,this.setConfig(new wn)}setConfig(e){this.#Be=Object.assign(new wn,e),"prefixMap"in e&&void 0!==e.prefixMap&&this.setPrefixMap(e.prefixMap)}getConfig(){return this.#Be}setPrefixMap(e){this.#Me=new Map(Object.entries(e).map((([e,t])=>[e=mn.toKebabCase(e),Object.assign(new Nn,{prefix:e,path:t})])))}getPrefixMap(){return this.#Me}configFile(e){return this.#Se=e,this}config(e){return this.setConfig(e),this}prefixMap(e){return this.setPrefixMap(e),this}get registrar(){return this.#Ce}async loadConfig(e){const t=this.#Ee.pathname.split("/");t[t.length-1]=e;const n=this.#Ee.origin+t.join("/");try{const e=await fetch(n),t=await e.json();return Object.assign(new wn,t)}catch(e){throw new Error(e)}}async load(...e){if(void 0!==this.#Se){const e=await this.loadConfig(this.#Se);this.setConfig(e)}if(void 0===this.#Me)throw new Error("prefixMap is not defined");if(void 0===this.#Ce)throw new Error("registrar is not defined");const t=Array.from(this.#Me.values()),{defaultNameType:n,defaultPath:s}=this.#Be;e=e.length>0?e:this.#Be.loadNames;for(let i of e){let e;i=mn.toKebabCase(i);const r=t.find((e=>e.isMatch(i)));if(void 0!==r){const t=r.getNames(i);e=Mn.getPathInfo(t.path,t.prefixName,t.subName,n)}if(void 0===e&&void 0!==s&&(e=Mn.getPathInfo(s,"",i,n)),void 0===e)throw new Error(`unmatch prefix and no defaultPath (loadName:${i})`);const o=this.#Ee.pathname.split("/");o[o.length-1]=e.filePath;const a=this.#Ee.origin+o.join("/");let l,c;try{l=await import(a)}catch(e){throw new Error(e)}if(void 0!==e.exportName){if(void 0!==l.default?e.exportName in l.default&&(c=l.default[e.exportName]):e.exportName in l&&(c=l[e.exportName]),void 0===c)throw new Error(`${e.exportName} not found in module (exportName:${e.exportName}, ${e.filePath})`)}else c=void 0!==l.default?l.default:Object.assign({},l);this.#Ce.register(i,c)}return this}static create(e){return new Cn(e)}}const En="*filter-";const Tn=Cn.create(class extends un{static register(e,t){if(e.startsWith(En)){const n=e.slice(8),{output:s,input:i,event:r}=t;s&&ye.registerFilter(n,s),i&&be.registerFilter(n,i),r&&Pe.registerFilter(n,r)}else!function(e,t){if("function"!=typeof e)return!1;let n=e;for(;n;){if(n===t)return!0;n=Object.getPrototypeOf(n)}return!1}(t,HTMLElement)?"ViewModel"in t&&"html"in t&&pn(e,t):customElements.define(e,t)}});function $n(e){return new URL(e.url).search.slice(1)}async function On(e){return await fetch(e.url.replace(".js",".html")).then((e=>e.text()))}async function In(e){return await fetch(e.url.replace(".js",".css")).then((e=>e.text()))}async function Ln(e,t){const n=await fetch(e.resolve(t??"./quel.config.json")),s=await n.json();for(let[e,t]of Object.entries(c))c[e]=void 0!==s[e]?s[e]:t;await Tn.config(s).load()}function _n(e){Object.entries(e).forEach((([e,t])=>{const{input:n,output:s,event:i}=t;n&&be.registerFilter(e,n),s&&ye.registerFilter(e,s),i&&Pe.registerFilter(e,i)}))}function An(e){Object.assign(N.data,e)}export{Ln as bootFromImportMeta,c as config,dn as generateComponentClass,$n as getCustomTagFromImportMeta,In as importCssFromImportMeta,On as importHtmlFromImportMeta,Tn as loader,hn as registerComponentModules,_n as registerFilters,An as registerGlobal};
