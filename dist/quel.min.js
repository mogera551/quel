class e{static raise(e){throw new Error(e)}static isFunction=e=>{const t=Object.prototype.toString.call(e).slice(8,-1).toLowerCase();return"function"===t||"asyncfunction"===t};static isInputableElement(e){return e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&"button"!==e.type}static toKebabCase=e=>"string"==typeof e?e.replaceAll(/_/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e;static createUUID(){return window?.crypto?.randomUUID?window.crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){let t=((new Date).getTime()+16*Math.random())%16|0;return("x"==e?t:3&t|8).toString(16)}))}}class t{static localeString=(e,t)=>null!=e?Number(e).toLocaleString():null;static fixed=(e,t)=>null!=e?Number(e).toFixed(t[0]??0):null;static styleDisplay=(e,t)=>e?t[0]??"":"none";static truthy=(e,t)=>!!e;static falsey=(e,t)=>!e;static not=this.falsey;static upperCase=(e,t)=>null!=e?String(e).toUpperCase():null;static lowerCase=(e,t)=>null!=e?String(e).toLowerCase():null;static eq=(e,t)=>e==t[0];static ne=(e,t)=>e!=t[0];static lt=(e,t)=>Number(e)<Number(t[0]);static le=(e,t)=>Number(e)<=Number(t[0]);static gt=(e,t)=>Number(e)>Number(t[0]);static ge=(e,t)=>Number(e)>=Number(t[0]);static embed=(e,t)=>null!=e?decodeURIComponent((t[0]??"").replaceAll("%s",e)):null;static ifText=(e,t)=>e?t[0]??null:t[1]??null;static null=(e,t)=>null==e}class s{static number=(e,t)=>""===e?null:Number(e);static boolean=(e,t)=>""===e?null:Boolean(e)}class n{name;options;static applyForInput(e,t){return t.reduceRight(((e,t)=>t.name in s?s[t.name](e,t.options):e),e)}static applyForOutput(e,s){return s.reduce(((e,s)=>s.name in t?t[s.name](e,s.options):e),e)}static regist(n,o,i){n in t&&e.raise(`regist filter error duplicate name (${n})`),n in s&&e.raise(`regist filter error duplicate name (${n})`),o&&(t[n]=o),i&&(s[n]=i)}}const o=1,i=2,r=3,a=10,l=20,c=30,d=91,p=92,h=95,u="loop",m="quel",f="*",y="dot-notation",g={directlyGet:Symbol.for(y+".direct_get"),directlySet:Symbol.for(y+".direct_set"),isSupportDotNotation:Symbol.for(y+".is_support_dot_notation")},P=new RegExp(/^\$([0-9]+)$/);class x{name;pathNames=[];parentPathNames=[];parentPath;parentPaths=[];setOfParentPaths;regexp;level=0;isPrimitive;constructor(e){if(this.name=e,this.pathNames=e.split("."),this.parentPathNames=this.pathNames.slice(0,-1),this.parentPaths=this.parentPathNames.reduce(((e,t)=>(e.push(e.at(-1)?.concat(t)??[t]),e)),[]).map((e=>e.join("."))),this.setOfParentPaths=new Set(this.parentPaths),this.parentPath=this.parentPathNames.join("."),this.lastPathName=this.pathNames.at(-1),this.regexp=new RegExp("^"+e.replaceAll(".","\\.").replaceAll("*","([0-9a-zA-Z_]*)")+"$"),this.level=this.pathNames.filter((e=>e===f)).length,this.isPrimitive=1===this.pathNames.length,this.nearestWildcardName=void 0,this.nearestWildcardParentName=void 0,this.level>0)for(let e=this.pathNames.length-1;e>=0;e--)if(this.pathNames[e]===f){this.nearestWildcardName=this.pathNames.slice(0,e+1).join("."),this.nearestWildcardParentName=this.pathNames.slice(0,e).join(".");break}}static create(e){const t=this.propertyNameByName.get(e);if(t)return t;const s=new x(e);return this.propertyNameByName.set(e,s),s}static propertyNameByName=new Map;static parse(e){const t=[],s=[];for(const n of e.split(".")){const e=Number(n);isNaN(e)?s.push(n):(t.push(e),s.push("*"))}return{propName:x.create(s.join(".")),indexes:t}}}let w=class{#e=[];#t=new Map;get lastIndexes(){return this.#e[this.#e.length-1]}get stackIndexes(){return this.#e}get matchByName(){return this.#t}getByPropertyName(e,{propName:t},s){let n;if(Reflect.has(e,t.name))n=Reflect.get(e,t.name,s);else if(""!==t.parentPath){const o=x.create(t.parentPath),i=this.getByPropertyName(e,{propName:o},s);if(void 0!==i){const e=t.lastPathName===f?this.lastIndexes[t.level-1]:t.lastPathName;n=Reflect.get(i,e)}}return n}setByPropertyName(e,{propName:t,value:s},n){let o=!1;if(Reflect.has(e,t.name)||t.isPrimitive)o=Reflect.set(e,t.name,s,n);else{const i=x.create(t.parentPath),r=this.getByPropertyName(e,{propName:i},n);if(void 0!==r){const e=t.lastPathName===f?this.lastIndexes[t.level-1]:t.lastPathName;o=Reflect.set(r,e,s)}}return o}pushIndexes(e,t){this.#e.push(e);try{return Reflect.apply(t,this,[])}finally{this.#e.pop()}}getFunc=(e,t)=>({propName:s,indexes:n})=>this.pushIndexes(n,(()=>this.getByPropertyName(e,{propName:s},t)));setFunc=(e,t)=>({propName:s,indexes:n},o)=>this.pushIndexes(n,(()=>this.setByPropertyName(e,{propName:s,value:o},t)));getExpandLastLevel(e,{propName:t,indexes:s},n){const o=this.getFunc(e,n);if(void 0===t.nearestWildcardName)throw new Error(`not found wildcard path of '${t.name}'`);const i=x.create(t.nearestWildcardParentName);return o({propName:i,indexes:s}).map(((e,n)=>o({propName:t,indexes:s.concat(n)})))}setExpandLastLevel(e,{propName:t,indexes:s,values:n},o){const i=this.getFunc(e,o),r=this.setFunc(e,o);if(void 0===t.nearestWildcardName)throw new Error(`not found wildcard path of '${t.name}'`);const a=x.create(t.nearestWildcardParentName),l=i({propName:a,indexes:s});if(t.nearestWildcardName===t.name)r({propName:a,indexes:s},n);else{if(n.length!==l.length)throw new Error(`not match array count '${t.name}'`);for(let e in l)r({propName:t,indexes:s.concat(Number(e))},n[e])}return!0}[g.directlyGet](e,{prop:t,indexes:s},n){const o=x.create(t);return this.pushIndexes(s,(()=>this.getByPropertyName(e,{propName:o},n)))}[g.directlySet](e,{prop:t,indexes:s,value:n},o){const i=x.create(t);return this.pushIndexes(s,(()=>this.setByPropertyName(e,{propName:i,value:n},o)))}get(e,t,s){const n="string"==typeof t;if(n&&(t.startsWith("@@__")||"constructor"===t))return Reflect.get(e,t,s);const o=this.getFunc(e,s),i=this.lastIndexes;let r;if(t===g.directlyGet)return(t,n)=>Reflect.apply(this[g.directlyGet],this,[e,{prop:t,indexes:n},s]);if(t===g.directlySet)return(t,n,o)=>Reflect.apply(this[g.directlySet],this,[e,{prop:t,indexes:n,value:o},s]);if(t===g.isSupportDotNotation)return!0;if(n){if(r=P.exec(t))return i?.[Number(r[1])-1]??void 0;if("@"===t.at(0)){const n=t.slice(1),o=x.create(n);if((i?.length??0)+1<o.level)throw new Error("array level not match");const r=i?.slice(0,o.level-1)??[];return this.getExpandLastLevel(e,{propName:o,indexes:r},s)}if(this.#t.has(t))return o(this.#t.get(t));const n=x.parse(t);return n.propName.level===n.indexes.length&&this.#t.set(t,n),o({propName:n.propName,indexes:n.indexes.concat(i?.slice(n.indexes.length)??[])})}return Reflect.get(e,t,s)}set(e,t,s,n){if("string"==typeof t){if(t.startsWith("@@__")||"constructor"===t)return Reflect.set(e,t,s,n);const o=this.setFunc(e,n),i=this.lastIndexes;if("@"===t.at(0)){const o=t.slice(1),i=x.create(o);if((this.lastIndexes?.length??0)+1<i.level)throw new Error("array level not match");const r=this.lastIndexes?.slice(0,i.level-1)??[];return this.setExpandLastLevel(e,{propName:i,indexes:r,values:s},n)}if(this.#t.has(t))return o(this.#t.get(t),s);const r=x.parse(t);return r.propName.level===r.indexes.length&&this.#t.set(t,r),o({propName:r.propName,indexes:r.indexes.concat(i?.slice(r.indexes.length)??[])},s)}return Reflect.set(e,t,s,n)}};const v=Object.assign({isProxy:Symbol.for(`${m}:arrayHandler.isProxy`),getRaw:Symbol.for(`${m}:arrayHandler.raw`),connectedCallback:Symbol.for(`${m}:viewModel.connectedCallback`),disconnectedCallback:Symbol.for(`${m}:viewModel.disconnectedCallback`),initCallback:Symbol.for(`${m}:viewModel.initCallback`),writeCallback:Symbol.for(`${m}:viewModel.writeCallback`),getDependentProps:Symbol.for(`${m}:viewModel.getDependentProps`),getHandler:Symbol.for(`${m}:viewModel.getHandler`),addNotify:Symbol.for(`${m}:viewModel.addNotify`),beCacheable:Symbol.for(`${m}:viewModel.beCacheable`),beUncacheable:Symbol.for(`${m}:viewModel.beUncacheable`),boundByComponent:Symbol.for(`${m}:globalData.boundByComponent`),directlyCall:Symbol.for(`${m}:viewModel.directCall`),bindTo:Symbol.for(`${m}:componentModule.bindTo`),notifyForDependentProps:Symbol.for(`${m}:viewModel.notifyForDependentProps`),bindProperty:Symbol.for(`${m}:props.bindProperty`),toObject:Symbol.for(`${m}:props.toObject`),isComponent:Symbol.for(`${m}:component.isComponent`)},g);class b{type;nodePropertyElements=[];eventType;static get(t,s){const n=new b;return n.nodePropertyElements=s.split("."),t instanceof Comment&&"|"===t.textContent[2]&&("if"===s||s===u)?(n.type=h,n):t[v.isComponent]&&"$props"===n.nodePropertyElements[0]?(n.type=p,n):(1===n.nodePropertyElements.length?n.nodePropertyElements[0].startsWith("on")?(n.type=d,n.eventType=n.nodePropertyElements[0].slice("on".length)):"radio"===n.nodePropertyElements[0]?n.type=l:"checkbox"===n.nodePropertyElements[0]?n.type=c:n.type=o:2===n.nodePropertyElements.length?"className"===n.nodePropertyElements[0]?n.type=a:n.type=i:3===n.nodePropertyElements.length?n.type=r:e.raise(`unknown property ${s}`),n)}}class N{#s;get node(){return this.#s}set node(e){this.#s=e}get element(){return this.node instanceof HTMLElement?this.node:e.raise("not HTMLElement")}#n;get nodeProperty(){return this.#n}set nodeProperty(e){this.#n=e}#o;get nodePropertyElements(){return this.#o}set nodePropertyElements(e){this.#o=e}component;viewModel;#i;get viewModelProperty(){return this.#i}set viewModelProperty(e){this.#i=e,this.#r=void 0,this.#a=void 0,this.#l=void 0,this.#c=void 0,this.#d=void 0,this.#p=void 0,this.#h=void 0}#r;get viewModelPropertyName(){return void 0===this.#r&&(this.#r=x.create(this.#i)),this.#r}#l;get contextIndex(){return void 0===this.#l&&!0===this.isContextIndex&&(this.#l=Number(this.viewModelProperty.slice(1))-1),this.#l}#a;get isContextIndex(){return void 0===this.#a&&(this.#a=!!P.exec(this.viewModelProperty)),this.#a}filters;#c;get contextParam(){if(void 0===this.#c){const e=this.viewModelPropertyName;e.level>0&&(this.#c=this.context.stack.find((t=>t.propName.name===e.nearestWildcardParentName)))}return this.#c}#d;get indexes(){return void 0===this.#d&&(this.#d=this.contextParam?.indexes??[]),this.#d}set indexes(e){}#p;get indexesString(){return void 0===this.#p&&(this.#p=this.indexes.toString()),this.#p}#h;get viewModelPropertyKey(){return void 0===this.#h&&(this.#h=this.viewModelProperty+"\t"+this.indexesString),this.#h}get contextIndexes(){return this.context.indexes}lastNodeValue;lastViewModelValue;context;getViewModelValue(){return this.isContextIndex?this.contextIndexes[this.contextIndex]:this.viewModel[v.directlyGet](this.viewModelProperty,this.indexes)}setViewModelValue(e){this.isContextIndex||this.viewModel[v.directlySet](this.viewModelProperty,this.indexes,e)}updateNode(){}updateViewModel(){}changeIndexes(e,t){}removeFromParent(){}}const M=1,C=2,E=3,S=4,R=5,T=6;class k{node;property;viewModelProperty;value;updateFunc;constructor(e,t,s,n,o){this.node=e,this.property=t,this.viewModelProperty=s,this.value=n,this.updateFunc=o}}class V{queue=[];#u;constructor(e){this.#u=e}reorder(e){return e.sort(((e,t)=>e.node instanceof HTMLTemplateElement&&t.node instanceof HTMLTemplateElement?0:t.node instanceof HTMLTemplateElement?1:e.node instanceof HTMLTemplateElement?-1:e.node instanceof HTMLSelectElement&&"value"===e.property&&t.node instanceof HTMLSelectElement&&"value"===t.property?0:e.node instanceof HTMLSelectElement&&"value"===e.property?1:t.node instanceof HTMLSelectElement&&"value"===t.property?-1:0)),e}async exec(){this.#u&&this.#u(R);try{for(;this.queue.length>0;){const e=this.queue.splice(0),t=this.reorder(e);for(const e of t)Reflect.apply(e.updateFunc,e,[])}}finally{this.#u&&this.#u(T)}}get isEmpty(){return 0===this.queue.length}}class I extends N{updateNode(){const{component:e,node:t,nodeProperty:s,viewModelProperty:o,filters:i}=this,r=n.applyForOutput(this.getViewModelValue(),i);this.lastViewModelValue!==r&&(e.updateSlot.addNodeUpdate(new k(t,s,o,r,(()=>{t[s]=r??""}))),this.lastViewModelValue=r)}updateViewModel(){const{node:e,nodeProperty:t,filters:s}=this,o=n.applyForInput(e[t],s);this.setViewModelValue(o),this.lastViewModelValue=o}}class O extends N{get nodeProperty1(){return this.nodePropertyElements[0]}get nodeProperty2(){return this.nodePropertyElements[1]}updateNode(){const{component:e,node:t,nodeProperty:s,viewModelProperty:o,filters:i}=this,{nodeProperty1:r,nodeProperty2:a}=this,l=n.applyForOutput(this.getViewModelValue(),i);this.lastViewModelValue!==l&&(e.updateSlot.addNodeUpdate(new k(t,s,o,l,(()=>{t[r][a]=l??""}))),this.lastViewModelValue=l)}updateViewModel(){const{node:e,filters:t}=this,{nodeProperty1:s,nodeProperty2:o}=this,i=n.applyForInput(e[s][o],t);this.setViewModelValue(i),this.lastViewModelValue=i}}class B extends N{get nodeProperty1(){return this.nodePropertyElements[0]}get nodeProperty2(){return this.nodePropertyElements[1]}get nodeProperty3(){return this.nodePropertyElements[2]}updateNode(){const{component:e,node:t,nodeProperty:s,viewModelProperty:o,filters:i}=this,{nodeProperty1:r,nodeProperty2:a,nodeProperty3:l}=this,c=n.applyForOutput(this.getViewModelValue(),i);this.lastViewModelValue!==c&&(e.updateSlot.addNodeUpdate(new k(t,s,o,c,(()=>{t[r][a][l]=c??""}))),this.lastViewModelValue=c)}updateViewModel(){const{node:e,filters:t}=this,{nodeProperty1:s,nodeProperty2:o,nodeProperty3:i}=this,r=n.applyForInput(e[s][o][i],t);this.setViewModelValue(r),this.lastViewModelValue=r}}const j=t=>t instanceof HTMLElement?t:e.raise("not HTMLElement");class $ extends N{get className(){return this.nodePropertyElements[1]}updateNode(){const{component:e,node:t,nodeProperty:s,viewModelProperty:o,filters:i,className:r}=this,a=j(t),l=n.applyForOutput(this.getViewModelValue(),i);this.lastViewModelValue!==l&&(e.updateSlot.addNodeUpdate(new k(t,s,o,l,(()=>{l?a.classList.add(r):a.classList.remove(r)}))),this.lastViewModelValue=l)}updateViewModel(){const{node:e,filters:t,className:s}=this,o=j(e),i=n.applyForInput(o.classList.contains(s),t);this.setViewModelValue(i),this.lastViewModelValue=i}}const _=t=>t instanceof HTMLInputElement?t:e.raise();class A extends N{updateNode(){const{component:e,node:t,nodeProperty:s,viewModelProperty:o,filters:i}=this,r=_(t),a=n.applyForOutput(this.getViewModelValue(),i);this.lastViewModelValue!==a&&(e.updateSlot.addNodeUpdate(new k(t,s,o,a,(()=>{r.checked=a===r.value}))),this.lastViewModelValue=a)}updateViewModel(){const{node:e,filters:t}=this,s=_(e),o=n.applyForInput(s.value,t);s.checked&&(this.setViewModelValue(o),this.lastViewModelValue=o)}}const L=t=>t instanceof HTMLInputElement?t:e.raise();class F extends N{updateNode(){const{component:e,node:t,nodeProperty:s,viewModelProperty:o,filters:i}=this,r=L(t),a=n.applyForOutput(this.getViewModelValue(),i);this.lastViewModelValue!==a&&(e.updateSlot.addNodeUpdate(new k(t,s,o,a,(()=>{r.checked=a.find((e=>e===r.value))}))),this.lastViewModelValue=a)}updateViewModel(){const{node:e,filters:t}=this,s=L(e),o=n.applyForInput(s.value,t),i=new Set(this.getViewModelValue());s.checked?i.add(o):i.delete(o);const r=Array.from(i);this.setViewModelValue(r),this.lastViewModelValue=r}}const D=e=>Array.from(e.childNodes).flatMap((e=>D(e).concat((e=>e instanceof Comment&&(e.textContent.startsWith("@@:")||e.textContent.startsWith("@@|")))(e)?e:null))).filter((e=>e));class U{static listOfRouteIndexesByTemplate=new Map;static getTargetNodes(e,t){let s;if(this.listOfRouteIndexesByTemplate.has(e)){s=this.listOfRouteIndexesByTemplate.get(e).map((e=>e.reduce(((e,t)=>e.childNodes[t]),t)))}else s=Array.from(t.querySelectorAll("[data-bind]")).concat(D(t)),this.listOfRouteIndexesByTemplate.set(e,s.map((e=>(e=>{let t=[];for(;null!=e.parentNode;)t=[Array.from(e.parentNode.childNodes).indexOf(e)].concat(t),e=e.parentNode;return t})(e))));return s}}class H{static create(){return{indexes:[],stack:[]}}static clone(e){const t=this.create();t.indexes=e.indexes.slice();for(const s of e.stack){const e={};e.indexes=s.indexes.slice(),e.pos=s.pos,e.propName=s.propName,t.stack.push(e)}return t}}class W{static templateByUUID=new Map}class q{binds;childNodes;fragment;context;get lastNode(){return this.childNodes[this.childNodes.length-1]}get nodesForAppend(){return this.fragment.childNodes.length>0?[this.fragment]:this.childNodes}removeFromParent(){this.childNodes.forEach((e=>e.parentNode?.removeChild(e))),this.binds.forEach((e=>e.removeFromParent()))}updateNode(){this.binds.forEach((e=>{e.updateNode()}))}changeIndexes(e,t){const s=this.context.stack.find((t=>t.propName.name===e.name));if(s){this.context.indexes[s.pos]+=t;const n=s.indexes.length-1;s.indexes[n]+=t,this.context.stack.filter((t=>t.propName.setOfParentPaths.has(e.name))).forEach((e=>{e.indexes[n]+=t}))}this.binds.forEach((s=>s.changeIndexes(e,t)))}static create(e,t){const{component:s,template:n}=e,o=document.importNode(n.content,!0),i=U.getTargetNodes(n,o),r=he.bind(i,s,t),a=Array.from(o.childNodes);return Object.assign(new q,{binds:r,childNodes:a,fragment:o,context:t})}}class G extends N{templateChildren=[];#m;get template(){return void 0===this.#m&&(this.#m=W.templateByUUID.get(this.uuid)),this.#m}#f;get uuid(){return void 0===this.#f&&(this.#f=this.node.textContent.slice(3)),this.#f}updateNode(){const t=this.nodeProperty===u?this.expandLoop():"if"===this.nodeProperty?this.expandIf():e.raise(`unknown property ${this.nodeProperty}`);this.lastViewModelValue=t instanceof Array?t.slice():t}removeFromParent(){this.templateChildren.forEach((e=>e.removeFromParent()))}appendToParent(){const e=document.createDocumentFragment();this.templateChildren.forEach((t=>e.appendChild(...t.nodesForAppend))),this.node.after(e)}expandIf(){const{filters:e,context:t}=this,s=this.lastViewModelValue,o=n.applyForOutput(this.getViewModelValue(),e);return s!==o&&(this.removeFromParent(),o?(this.templateChildren=[q.create(this,t)],this.appendToParent()):this.templateChildren=[]),this.templateChildren.forEach((e=>e.updateNode())),o}expandLoop(){const{filters:e,templateChildren:t,context:s}=this,o=this.lastViewModelValue??[],i=n.applyForOutput(this.getViewModelValue(),e)??[],r=o.reduce(((e,t,s)=>(e.get(t)?.push(s)??e.set(t,[s]),e)),new Map),a=new Map,l=[],c=s.indexes.length,d=this.viewModelPropertyName,p=this.contextParam?.indexes??[],h=i.map(((e,n)=>{const o=r.get(e);if(void 0===o||0===o.length){a.set(n,void 0),l.push(n);const e=H.clone(s);return e.indexes.push(n),e.stack.push({propName:d,indexes:p.concat(n),pos:c}),q.create(this,e)}{const e=o.shift();a.set(n,e);const s=t[e];n!==e&&s.changeIndexes(this.viewModelPropertyName,n-e);const i=a.get(n-1);return(void 0===i||i>e)&&l.push(n),s}}));for(const e of r.values())for(const s of e)t[s].removeFromParent();return l.forEach((e=>{const t=h[e];(h[e-1]?.lastNode??this.node).after(...t.nodesForAppend)})),h.forEach((e=>e.updateNode())),this.templateChildren=h,i}changeIndexes(e,t){super.changeIndexes(e,t),this.templateChildren.forEach((s=>s.changeIndexes(e,t)))}}class K{target;thisArgument;argumentsList;constructor(e,t,s){this.target=e,this.thisArgument=t,this.argumentsList=s}}class z{queue=[];#u;constructor(e){this.#u=e}async exec(){this.#u&&this.#u(M);try{for(;this.queue.length>0;){const e=this.queue.splice(0);for(const t of e)await Reflect.apply(t.target,t.thisArgument,t.argumentsList)}}finally{this.#u&&this.#u(C)}}get isEmpty(){return 0===this.queue.length}}class Z extends N{#y;get eventType(){return this.#y}set eventType(e){this.#y=e}addEventListener(){const{component:e,element:t,eventType:s,viewModel:n,viewModelProperty:o}=this;t.addEventListener(s,(t=>{t.stopPropagation();const s=this.context,i=new K(n[v.directlyCall],n,[o,s,t]);e.updateSlot.addProcess(i)}))}}class J extends N{get node(){return super.node}set node(t){this.thisComponent=(t=>t[v.isComponent]?t:e.raise("not Component"))(t),super.node=t}#g(){return void 0!==this.viewModelProperty&&void 0!==this.nodePropertyElements}get viewModelProperty(){return super.viewModelProperty}set viewModelProperty(e){super.viewModelProperty=e,this.#g()&&this.bindProperty()}get nodePropertyElements(){return super.nodePropertyElements}set nodePropertyElements(e){super.nodePropertyElements=e,this.#g()&&this.bindProperty()}get dataNameProperty(){return this.nodePropertyElements[0]}get dataProperty(){return this.nodePropertyElements[1]}#P;get thisComponent(){return this.#P}set thisComponent(e){this.#P=e}bindProperty(){this.thisComponent.props[v.bindProperty](this.dataProperty,this.viewModelProperty,this.indexes)}updateNode(){const{node:e,dataProperty:t}=this;this.thisComponent.viewModel?.[v.notifyForDependentProps](`$props.${t}`,[])}updateViewModel(){}}const Q=new Map;Q.set(o,((e,t)=>Object.assign(new I,e,t))),Q.set(i,((e,t)=>Object.assign(new O,e,t))),Q.set(r,((e,t)=>Object.assign(new B,e,t))),Q.set(a,((e,t)=>Object.assign(new $,e,t))),Q.set(l,((e,t)=>Object.assign(new A,e,t))),Q.set(c,((e,t)=>Object.assign(new F,e,t))),Q.set(h,((e,t)=>Object.assign(new G,e,t))),Q.set(d,((e,t)=>Object.assign(new Z,e,t))),Q.set(p,((e,t)=>Object.assign(new J,e,t)));class X{static create({component:t,node:s,nodeProperty:n,viewModel:o,viewModelProperty:i,filters:r,context:a}){const l={component:t,node:s,nodeProperty:n,viewModel:o,viewModelProperty:i,filters:r,context:a},c=b.get(s,n),d=Q.get(c.type)(l,c);return d.viewModelPropertyName.level>0&&0==d.indexes.length&&e.raise(`${d.viewModelPropertyName.name} be outside loop`),d}}class Y{nodeProperty;viewModelProperty;filters}const ee=e=>e.trim(),te=e=>e.length>0,se=e=>{const[t,...s]=e.split("|").map(ee);return{viewModelProperty:t,filters:s.map((e=>(e=>{const[t,...s]=e.split(",").map(ee);return Object.assign(new n,{name:t,options:s})})(e)))}},ne=(t,s)=>t.split(";").map(ee).filter(te).map((t=>{let{nodeProperty:n,viewModelProperty:o,filters:i}=((e,t)=>{const[s,n]=[t].concat(...e.split(":").map(ee)).splice(-2),{viewModelProperty:o,filters:i}=se(n);return{nodeProperty:s,viewModelProperty:o,filters:i}})(t,"$");return o="@"===o?n:o,n="$"===n?s:n,void 0===n&&e.raise("default property undefined"),{nodeProperty:n,viewModelProperty:o,filters:i}}));class oe{static bindTextsByKey=new Map;static parse(e,t){const s=e+"\t"+t;let n=this.bindTextsByKey.get(s);return void 0===n&&(n=ne(e,t).map((e=>Object.assign(new Y,e))),this.bindTextsByKey.set(s,n)),n}}class ie{static parseBindText=(e,t,s,n)=>(o,i)=>oe.parse(o,i).map((o=>X.create(Object.assign(o,{node:e,component:t,viewModel:s,context:n}))));static applyUpdateNode=e=>e.updateNode()}const re="oninput",ae=re.slice(2);class le{static bind(t,s,n){const o=s.viewModel,i=(t=>t instanceof HTMLElement?t:e.raise("not HTMLElement"))(t),r=i.dataset.bind,a=(e=>e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLOptionElement?"value":e instanceof HTMLInputElement?"radio"===e.type||"checkbox"===e.type?"checked":"value":"textContent")(i),l=ie.parseBindText(t,s,o,n)(r,a);l.forEach(ie.applyUpdateNode);let c=!1,d=null,p=null,h=null;l.forEach((e=>{c||=e.nodeProperty===re,p=e instanceof A?e:p,h=e instanceof F?e:h,d=e.nodeProperty===a?e:d,(e=>e instanceof Z?e:void 0)(e)?.addEventListener()}));const u=e=>{i.addEventListener(ae,(t=>{t.stopPropagation();const n=new K(e.updateViewModel,e,[]);s.updateSlot.addProcess(n)}))};return p?u(p):h?u(h):d&&!c&&(e=>e instanceof HTMLElement&&(e instanceof HTMLSelectElement||e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement))(t)&&u(d),l}}class ce{static bind(t,s,n){const o=s.viewModel,i=(t=>t instanceof SVGElement?t:e.raise("not SVGElement"))(t),r=i.dataset.bind,a=ie.parseBindText(t,s,o,n)(r,undefined);return a.forEach(ie.applyUpdateNode),a.forEach((e=>{(e=>e instanceof Z?e:void 0)(e)?.addEventListener()})),a}}class de{static bind(t,s,n){const o=s.viewModel,i=(t=>t instanceof Comment?t:e.raise("not Comment"))(t),r=i.textContent.slice(3),a=document.createTextNode("");i.parentNode.replaceChild(a,i);const l=ie.parseBindText(a,s,o,n)(r,"textContent");return l.forEach(ie.applyUpdateNode),l}}class pe{static bind(t,s,n){const o=s.viewModel,i=(t=>t instanceof Comment?t:e.raise("not Comment"))(t),r=i.textContent.slice(3),a=W.templateByUUID.get(r).dataset.bind;let l=ie.parseBindText(t,s,o,n)(a,void 0);return l=l.length>0?[l[0]]:[],l.forEach(ie.applyUpdateNode),l}}class he{static bind(t,s,n){return t.flatMap((t=>t instanceof Comment&&"|"==t.textContent[2]?pe.bind(t,s,n):t instanceof HTMLElement?le.bind(t,s,n):t instanceof SVGElement?ce.bind(t,s,n):t instanceof Comment&&":"==t.textContent[2]?de.bind(t,s,n):e.raise("unknown node type")))}}class ue{static render(e,t,s){const n=document.importNode(s.content,!0),o=U.getTargetNodes(s,n),i=he.bind(o,t,H.create());return e.appendChild(n),i}}class me{#x=new Map;get(e,t){const s=this.#x.get(e);return s?s.get(t.toString()):void 0}set(e,t,s){let n=this.#x.get(e);return n||(n=new Map,this.#x.set(e,n)),n.set(t.toString(),s),s}clear(){this.#x.clear()}}class fe{static getDescByName(e){const t=new Map;let s=e;for(;s!==Object.prototype;){const e=Object.getOwnPropertyDescriptors(s);for(const[s,n]of Object.entries(e))t.has(s)||t.set(s,n);s=Object.getPrototypeOf(s)}return t}static getMethods(e,t){return e.filter((([e,s])=>s.value!==t&&"function"==typeof s.value))}static getProperties(e,t){return e.filter((([e,s])=>s.value!==t&&"function"!=typeof s.value))}static viewModelize(e){const t=e.constructor;let s=this.viewModelInfoByConstructor.get(t);if(!s){const n=this.getDescByName(e),o=Array.from(n.entries()),i=[],r=[],a=[],l=this.getMethods(o,e.constructor).map((([e,t])=>e));this.getProperties(o,e.constructor).forEach((([e,t])=>{r.push(e);x.create(e).isPrimitive||"value"in t&&void 0===t.value&&i.push(e),"get"in t&&void 0!==t.get&&a.push(e)})),s={removeProps:i,definedProps:r,methods:l,accessorProps:a},this.viewModelInfoByConstructor.set(t,s)}return s.removeProps.forEach((t=>Reflect.deleteProperty(e,t))),{definedProps:s.definedProps,methods:s.methods,accessorProps:s.accessorProps,viewModel:e}}static viewModelInfoByConstructor=new Map}let ye=class{#w;get updateCallback(){return this.#w}constructor(e){this.#w=e}get(e,t,s){return t===v.isProxy||(t===v.getRaw?e:Reflect.get(e,t,s))}set(e,t,s,n){return Reflect.set(e,t,s,n),"length"===t&&this.updateCallback(),!0}};function ge(e,t){return new Proxy(e,new ye(t))}class Pe{#v=new Set;#b=new Map;get setOfPropsByRefProp(){return this.#b}hasDefaultProp(e){return this.#v.has(e)}addDefaultProp(e){let t=x.create(e);for(;""!==t.parentPath;){const e=x.create(t.parentPath);this.#v.has(t.name)||(this.#b.get(e.name)?.add(t.name)??this.#b.set(e.name,new Set([t.name])),this.#v.add(t.name)),t=e}}setDependentProps(e){for(const[t,s]of Object.entries(e))for(const e of s)this.#b.get(e)?.add(t)??this.#b.set(e,new Set([t]))}}const xe={[v.connectedCallback]:"$connectedCallback",[v.disconnectedCallback]:"$disconnectedCallback",[v.writeCallback]:"$writeCallback",[v.initCallback]:"$initCallback"},we=new Set([v.connectedCallback,v.disconnectedCallback,v.writeCallback,v.initCallback]),ve=new Set([v.directlyCall,v.getDependentProps,v.notifyForDependentProps,v.getHandler,v.beCacheable,v.beUncacheable]),be="$props",Ne="$globals",Me="$dependentProps",Ce="$openDialog",Ee=new Set([be,Ne,Me,Ce,"$closeDialog"]);class Se extends w{#N;get component(){return this.#N}#M=new me;get cache(){return this.#M}#C;get methods(){return this.#C}#E;get accessorProperties(){return this.#E}#S;get setOfAccessorProperties(){return this.#S}#R=new Pe;get dependentProps(){return this.#R}#T=!1;get cacheable(){return this.#T}set cacheable(e){this.#T=e}#k;get context(){return this.#k}set context(e){this.#k=e}constructor(e,t,s,n){super(),this.#N=e,this.#C=s,this.#E=t,this.#S=new Set(this.#E),this.#R.setDependentProps(n??{})}#V(e,t,s){this.#I(e,t,s)}getByPropertyName(e,{propName:t},s){let n;if(t.isPrimitive||!this.#R.hasDefaultProp(t.name)&&this.#R.addDefaultProp(t.name),Ee.has(t.name))return t.name===be?this.component.props:t.name===Ne?this.component.globals:t.name===Me?Reflect.get(e,Me,s):t.name===Ce?(t,n={},o={})=>Reflect.apply(this.#O,this,[e,{name:t,data:n,attributes:o},s]):(t={})=>Reflect.apply(this.#B,this,[e,t,s]);if(this.#S.has(t.name)&&this.#T){const o=t.level>0?this.lastIndexes.slice(0,t.level):[];n=this.#M.get(t,o),void 0===n&&(n=super.getByPropertyName(e,{propName:t},s),this.#M.set(t,o,n))}else n=super.getByPropertyName(e,{propName:t},s);return n}setByPropertyName(e,{propName:t,value:s},n){t.isPrimitive||!this.#R.hasDefaultProp(t.name)&&this.#R.addDefaultProp(t.name);const o=this.lastIndexes,i={propName:t,indexes:o},r=super.setByPropertyName(e,{propName:t,value:s},n);return n[v.writeCallback](t.name,o),this.#I(e,i,n),r}#j(e,t,s){this.#N.updateSlot.addProcess(new K(e,t,s))}#I(e,t,s){this.#N.updateSlot.addNotify(t)}async#O(t,{name:s,data:n,attributes:o},i){const r=e.toKebabCase(s),a=document.createElement(r);return Object.entries(o).forEach((([e,t])=>{a.setAttribute(e,t)})),Object.entries(n).forEach((([e,t])=>{a.props[v.bindProperty](e,e,[]),a.props[e]=t})),document.body.appendChild(a),a.alivePromise}#B(e,t,s){const n=this.#N;Object.entries(t).forEach((([e,t])=>{n.props[e]=t})),n.parentNode.removeChild(n)}[v.directlyGet](e,{prop:t,indexes:s},n){let o=super[v.directlyGet](e,{prop:t,indexes:s},n);if(o instanceof Array){const i=x.create(t);o=ge(o,(()=>{this.#V(e,{propName:i,indexes:s},n)}))}return o}[v.beCacheable](e,t){return this.cacheable=!0,this.#M.clear(),this.cacheable}[v.beUncacheable](e,t){return this.cacheable=!1,this.cacheable}async#$(t,{propName:s,context:n,event:o},i){void 0!==this.context&&e.raise("directCall already called"),this.context=n,this.stackIndexes.push(void 0);try{return await Reflect.apply(t[s.name],i,[o,...n.indexes])}finally{this.stackIndexes.pop(),this.context=void 0}}wrapArray(e,{prop:t,value:s},n){if(s instanceof Array){const o=this.lastIndexes;s=ge(s,(()=>{let{propName:s,indexes:i}=x.parse(t);s.isPrimitive||s.level>i.length&&(i=o.slice(0,s.level)),this.#V(e,{propName:s,indexes:i},n)}))}return s}get(t,s,n){if(we.has(s)){const e=xe[s],o=(...s)=>async()=>Reflect.apply(t[e],n,s);return s===v.initCallback?e in t?(...e)=>o(...e)():()=>{}:e in t?(...e)=>this.#j(o(...e),n,[]):()=>{}}if(ve.has(s))return s===v.directlyCall?async(e,s,o)=>this.#$(t,{propName:x.create(e),context:s,event:o},n):s===v.notifyForDependentProps?(e,s)=>{const o={propName:x.create(e),indexes:s};this.#I(t,o,n)}:s===v.getDependentProps?()=>this.dependentProps:s===v.getHandler?()=>this:s===v.beCacheable?()=>Reflect.apply(this[v.beCacheable],this,[t,n]):()=>Reflect.apply(this[v.beUncacheable],this,[t,n]);{let o;do{if("string"==typeof s&&!s.startsWith("@@__")&&"constructor"!==s){const i=x.create(s);if(void 0!==this.context&&i.level>0){const r=this.context.stack.find((e=>e.propName.name===i.nearestWildcardParentName));void 0===r&&e.raise(`${s} is outside loop`),o=this[v.directlyGet](t,{prop:s,indexes:r.indexes},n);break}}o=super.get(t,s,n)}while(0);return this.wrapArray(t,{prop:s,value:o},n)}}set(t,s,n,o){let i;n=n?.[v.isProxy]?n[v.getRaw]:n;do{if("string"==typeof s&&!s.startsWith("@@__")&&"constructor"!==s){const r=x.create(s);if(void 0!==this.context&&r.level>0){const a=this.context.stack.find((e=>e.propName.name===r.nearestWildcardParentName));void 0===a&&e.raise(`${s} is outside loop`),i=this[v.directlySet](t,{prop:s,indexes:a.indexes,value:n},o);break}}i=super.set(t,s,n,o)}while(0);return i}static makeNotifyForDependentProps(e,t,s=new Set([])){const{propName:n,indexes:o}=t,i=n.name+"\t"+o.toString();if(s.has(i))return[];s.add(i);const r=e[v.getDependentProps]().setOfPropsByRefProp.get(n.name),a=[];if(void 0===r)return[];for(const t of r){const n=x.create(t);if(o.length<n.level){const t=Se.expandIndexes(e,{propName:n,indexes:o});a.push(...t.map((e=>({propName:n,indexes:e}))))}else{const e=o.slice(0,n.level);a.push({propName:n,indexes:e})}a.push(...this.makeNotifyForDependentProps(e,{propName:n,indexes:o},s))}return a}static expandIndexes(e,t){const{propName:s,indexes:n}=t;if(s.level===n.length)return[n];if(s.level<n.length)return[n.slice(0,s.level)];{const t=(o,i,r)=>{const a=""!==o?o+".":o,l=s.pathNames[i],c=s.pathNames.length-1===i,d=a+l;let p;return p=c?"*"===l?e[v.directlyGet](o,r).flatMap(((e,t)=>[r.concat(t)])):[r]:"*"===l?r.length<n.length?t(d,i+1,n.slice(0,r.length+1)):e[v.directlyGet](o,r).flatMap(((e,s)=>t(d,i+1,r.concat(s)))):t(d,i+1,r),p};return t("",0,[])}}}const Re=e=>e instanceof G?e:void 0;class Te{static getTemplateBinds(e,t){const s=[],n=[{binds:e,children:null,index:-1}];for(;n.length>0;){const e=n[n.length-1];if(e.index++,e.binds)if(e.index<e.binds.length){const o=Re(e.binds[e.index]);o&&(t.has(o.viewModelPropertyKey)?s.push(o):o.templateChildren.length>0&&n.push({binds:null,children:o.templateChildren,index:-1}))}else n.pop();else if(e.index<e.children.length){const t=e.children[e.index];t.binds.length>0&&n.push({binds:t.binds,children:null,index:-1})}else n.pop()}return s}static applyToNode(e,t){const s=new Set(this.getTemplateBinds(e,t));if(s.size>0)for(const e of s)e.updateNode();const n=e=>{e.forEach((e=>{!s.has(e)&&t.has(e.viewModelPropertyKey)&&e.updateNode(),Re(e)?.templateChildren.forEach((e=>n(e.binds)))}))};n(e)}}let ke=class{#N;#_=new Map;#A=new Proxy({},new w);get hasParent(){return null!=this.#N?.parentComponent?.viewModel}get data(){return this.hasParent?this.#N.parentComponent.viewModel:this.#A}get object(){const e={};if(this.hasParent){const t=this.#N.parentComponent.viewModel;for(const[s,n]of this.#_.entries()){const{bindProp:o,bindIndexes:i}=n;e[s]=t[v.directlyGet](o,i)}}else for(const[t,s]of Object.entries(this.#A))e[t]=s;return e}constructor(e){this.#N=e}get(e,t,s){if(t===v.bindProperty)return(e,t,s)=>this.#_.set(e,{bindProp:t,bindIndexes:s});if(t===v.toObject)return()=>this.object;const{data:n}=this;if(this.hasParent){const{bindProp:e,bindIndexes:s}=this.#_.get(t)??{};return e?n[v.directlyGet](e,s):void console.error(`undefined property ${t}`)}return Reflect.get(n,t)}set(e,t,s,n){const{data:o}=this;if(this.hasParent){const{bindProp:e,bindIndexes:n}=this.#_.get(t)??{};return e?o[v.directlySet](e,n,s):(console.error(`undefined property ${t}`),!1)}return Reflect.set(o,t,s)}};class Ve extends w{#L=new Map;get(e,t,s){return t===v.boundByComponent?(e,t)=>{let s=this.#L.get(t);null==s?this.#L.set(t,new Set([e])):s.add(e)}:super.get(e,t,s)}set(e,t,s,n){const{propName:o,indexes:i}=x.parse(t),r=n[v.directlySet](o.name,i,s);let a=this.#L.get(o.name);if(a)for(const e of a)e.viewModel[v.notifyForDependentProps]("$globals."+o.name,i);return r}}class Ie{static create(){return new Proxy({},new Ve)}static data=this.create()}class Oe{#N;setOfProps=new Set;constructor(e){this.#N=e}bindProperty(e){Ie.data[v.boundByComponent](this.#N,e),this.setOfProps.add(e)}directGet=(e,t)=>(this.setOfProps.has(e)||this.bindProperty(e),Ie.data[v.directlyGet](e,t));directSet=(e,t,s)=>(this.setOfProps.has(e)||this.bindProperty(e),Ie.data[v.directlySet](e,t,s));get(e,t,s){if(t===v.directlyGet)return this.directGet;if(t===v.directlySet)return this.directSet;if(t===v.isSupportDotNotation)return!0;const{propName:n,indexes:o}=x.parse(t);return this.directGet(n.name,o)}set(e,t,s,n){const{propName:o,indexes:i}=x.parse(t);return this.directSet(o.name,i,s)}}class Be{html;css;ViewModel;extendClass;extendTag;#m;get template(){return void 0===this.#m&&(this.#m=Be.htmlToTemplate(this.html,this.css)),this.#m}static replaceTag(t){const s=[],n=t.replaceAll(/\{\{([^\}]+)\}\}/g,((e,t)=>{if((t=t.trim()).startsWith("loop:")||t.startsWith("if:"))return s.push(t),`<template data-bind="${t}">`;if(t.startsWith("else:")){return`</template><template data-bind="${s.at(-1)}|not">`}return t.startsWith("end:")?(s.pop(),"</template>"):`\x3c!--@@:${t}--\x3e`})),o=document.createElement("template");o.innerHTML=n;const i=t=>{let s;for(;s=t.querySelector("template");){const t=e.createUUID(),n=document.createComment(`@@|${t}`);if(s.parentNode.replaceChild(n,s),!(s instanceof HTMLTemplateElement)){const e=document.createElement("template");for(let t of Array.from(s.childNodes))e.content.appendChild(t);s=e}s.dataset.uuid=t,s.dataset.bind=s.dataset.bind,i(s.content),W.templateByUUID.set(t,s)}};return i(o.content),o.innerHTML}static htmlToTemplate(e,t){const s=document.createElement("template");return s.innerHTML=(t?`<style>\n${t}\n</style>`:"")+(e?Be.replaceTag(e):""),s}}class je{static#F={debug:!1};static components(t){return Object.entries(t).forEach((([t,s])=>{const n=e.toKebabCase(t);customElements.define(n,s)})),this}static componentModules(t){return Object.entries(t).forEach((([t,s])=>{const n=e.toKebabCase(t),o=Ue.generate(s);s.extendClass&&s.extendTag?customElements.define(n,o,{extends:s.extendTag}):void 0===s?.extendClass&&void 0===s?.extendTag?customElements.define(n,o):e.raise("extendClass and extendTag should be both set, or unset")})),this}static filters(e){return Object.entries(e).forEach((([e,t])=>{const{input:s,output:o}=t;n.regist(e,o,s)})),this}static globals(e){Object.assign(Ie.data,e)}static config({debug:e=!1}){return this.#F=Object.assign(this.#F,{debug:e}),this}static get debug(){return this.#F.debug}}class $e extends Error{}class _e{#D;#U;#H=!0;get alive(){return this.#H}constructor(){this.main()}async#W(){return new Promise(((e,t)=>{this.#D=e,this.#U=t}))}stop(){this.#U(new $e("stop"))}wakeup(e){this.#D(e)}async main(){for(;;)try{const e=await this.#W();await e.waiting(),je.debug&&performance.mark("slot-exec:start");try{await e.exec(),je.debug&&(performance.mark("slot-exec:end"),performance.measure("slot-exec","slot-exec:start","slot-exec:end"),console.log(performance.getEntriesByType("measure")),performance.clearMeasures(),performance.clearMarks())}finally{e.callback()}}catch(e){if(e instanceof $e)break;if(console.error(e),!confirm("致命的なエラーが発生しました。続行しますか？"))break}this.#H=!1}}class Ae{queue=[];#u;#N;constructor(e,t){this.#N=e,this.#u=t}async exec(){this.#u&&this.#u(E);try{for(;this.queue.length>0;){const e=this.queue.splice(0),t=[];for(const s of e)t.push(...Se.makeNotifyForDependentProps(this.#N.viewModel,s));const s=new Set(e.concat(t).map((e=>e.propName.name+"\t"+e.indexes.toString())));this.#N.applyToNode(s)}}finally{this.#u&&this.#u(S)}}get isEmpty(){return 0===this.queue.length}}class Le{#q;get viewModelUpdator(){return this.#q}#G;get notifyReceiver(){return this.#G}#K;get nodeUpdator(){return this.#K}#z;#Z;#J;#Q;#X;#Y;#ee;constructor(e,t=null,s=null){this.#q=new z(s),this.#G=new Ae(e,s),this.#K=new V(s),this.#z=t,this.#Z=new Promise(((e,t)=>{this.#Q=e,this.#X=t})),this.#J=new Promise(((e,t)=>{this.#Y=e,this.#ee=t}))}async waiting(){return this.#Z}waitResolve(e){this.#Q(e)}waitReject(){this.#X()}async alive(){return this.#J}async exec(){do{await this.#q.exec(),await this.#G.exec(),await this.#K.exec()}while(!this.#q.isEmpty||!this.#G.isEmpty||!this.#K.isEmpty);this.#Y()}async addProcess(e){this.#q.queue.push(e),this.#Q(!0)}async addNotify(e){this.#G.queue.push(e),this.#Q(!0)}async addNodeUpdate(e){this.#K.queue.push(e),this.#Q(!0)}callback(){this.#z&&this.#z()}static create(e,t,s){return new Le(e,t,s)}}class Fe{static setOfTags=new Set(["articles","aside","blockquote","body","div","footer","h1","h2","h3","h4","h5","h6","header","main","nav","p","section","span"]);static isCustomTag(e){return-1!==e.indexOf("-")}static isAttachableShadow(e){return this.isCustomTag(e)||this.setOfTags.has(e)}}const De={get viewModel(){return this._viewModel},set viewModel(e){this._viewModel=e},get binds(){return this._binds},set binds(e){this._binds=e},get thread(){return this._thread},set thread(e){this._thread=e},get updateSlot(){return void 0===this._updateSlot&&(this._updateSlot=Le.create(this,(()=>{this._updateSlot=void 0}),(e=>{e===M||e===E?this.viewModel[v.beUncacheable]():e===R&&this.viewModel[v.beCacheable]()})),this.thread.wakeup(this._updateSlot)),this._updateSlot},set updateSlot(e){this._updateSlot=e},get props(){return this._props},get globals(){return this._globals},get initialResolve(){return this._initialResolve},set initialResolve(e){this._initialResolve=e},get initialReject(){return this._initialReject},set initialReject(e){this._initialReject=e},get initialPromise(){return this._initialPromise},set initialPromise(e){this._initialPromise=e},get aliveResolve(){return this._aliveResolve},set aliveResolve(e){this._aliveResolve=e},get aliveReject(){return this._aliveReject},set aliveReject(e){this._aliveReject=e},get alivePromise(){return this._alivePromise},set alivePromise(e){this._alivePromise=e},get parentComponent(){return void 0===this._parentComponent&&(this._parentComponent=(e=>{for(;;){if(null==(e=e.parentNode))return null;if(e[v.isComponent])return e;if(e instanceof ShadowRoot){if(e.host[v.isComponent])return e.host;e=e.host}}})(this)),this._parentComponent},get withShadowRoot(){return this.hasAttribute("with-shadow-root")},get viewRootElement(){return this.shadowRoot??this},initialize(){this._viewModel=void 0,this._binds=void 0,this._thread=void 0,this._updateSlot=void 0,this._props=new Proxy({},new ke(this)),this._globals=function(e){return new Proxy({},new Oe(e))}(),this._initialPromise=void 0,this._initialResolve=void 0,this._initialReject=void 0,this._alivePromise=void 0,this._aliveResolve=void 0,this._aliveReject=void 0,this._parentComponent=void 0,this.initialPromise=new Promise(((e,t)=>{this.initialResolve=e,this.initialReject=t}))},async build(){const{template:e,ViewModel:t}=this.constructor;Fe.isAttachableShadow(this.tagName.toLowerCase())&&this.withShadowRoot&&this.attachShadow({mode:"open"}),this.thread=new _e,this.viewModel=function(e,t){const s=fe.viewModelize(Reflect.construct(t,[])),{viewModel:n,accessorProps:o,methods:i}=s;return new Proxy(n,new Se(e,o,i,n[Me]))}(this,t),await this.viewModel[v.initCallback]();const s=this.updateSlot;s.addProcess(new K((async()=>(this.binds=ue.render(this.viewRootElement,this,e),this.viewModel[v.connectedCallback]())),this,[])),await s.alive()},async connectedCallback(){try{this.parentComponent&&await this.parentComponent.initialPromise,this.alivePromise=new Promise(((e,t)=>{this.aliveResolve=e,this.aliveReject=t})),await this.build()}finally{this.initialResolve&&this.initialResolve()}},disconnectedCallback(){this.aliveResolve&&this.aliveResolve(this.props[v.toObject]())},applyToNode(e){this.binds&&Te.applyToNode(this.binds,e)}};class Ue{static generate(e){const t=Object.assign(new Be,e),s=function(e){return class extends HTMLElement{static template=e.template;static ViewModel=e.ViewModel;get[v.isComponent](){return!0}constructor(){super(),this.initialize()}initialize(){}}}(t);void 0===t.extendClass||(s.prototype.__proto__=t.extendClass.prototype,s.__proto__=t.extendClass);for(let[e,t]of Object.entries(Object.getOwnPropertyDescriptors(De)))Object.defineProperty(s.prototype,e,t);return s}}function He(e){return Ue.generate(e)}class We{static regist(e,t){}}class qe{static toKebabCase=e=>"string"==typeof e?e.replaceAll(/[\._]/g,"-").replaceAll(/([A-Z])/g,((e,t,s)=>(s>0?"-":"")+t.toLowerCase())):e}const Ge="kebab",Ke="snake",ze="uppercamel",Ze="lowercamel",Je="dotted";class Qe{static getNames(e){const t=qe.toKebabCase(e),s=t.replaceAll("-","_"),n=t.replaceAll("-","."),o=t.split("-").map(((e,t)=>(void 0!==e[0]&&(e=e[0].toUpperCase()+e.slice(1)),e))).join(""),i=o.length>0?o[0].toLowerCase()+o.slice(1):o;return{[Ge]:t,[Ke]:s,[ze]:o,[Ze]:i,[Je]:n}}}const Xe=Ze;class Ye{defaultNameType=Xe;defaultPath="./";loadNames=[];prefixMap}class et{prefix;path;get matchPrefix(){return`${this.prefix}-`}isMatch(e){return e.startsWith(this.matchPrefix)}getNames(e){const{prefix:t,path:s}=this;if(e.startsWith(this.matchPrefix)){return{prefixName:t,subName:e.slice(this.matchPrefix.length),path:s}}}}const tt=Qe.getNames("prefix-name"),st=Qe.getNames("sub-name");class nt{static getPathInfo(e,t,s,n){const[o,i]=e.split("#");let r=o,a=i;const l=Qe.getNames(t),c=Qe.getNames(s);return r=r.replaceAll(`{${tt[Ge]}}`,l[Ge]),r=r.replaceAll(`{${tt[Ke]}}`,l[Ke]),r=r.replaceAll(`{${tt[Ze]}}`,l[Ze]),r=r.replaceAll(`{${tt[ze]}}`,l[ze]),r=r.replaceAll(`{${tt[Je]}}`,l[Je]),r=r.replaceAll(`{${st[Ge]}}`,c[Ge]),r=r.replaceAll(`{${st[Ke]}}`,c[Ke]),r=r.replaceAll(`{${st[Ze]}}`,c[Ze]),r=r.replaceAll(`{${st[ze]}}`,c[ze]),r=r.replaceAll(`{${st[Je]}}`,c[Je]),o===r&&".js"!==r.slice(-3)&&(r=r+("/"!==e.slice(-1)?"/":"")+c[n]+".js"),a&&(a=a.replaceAll(`{${st[Ge]}}`,c[Ge]),a=a.replaceAll(`{${st[Ke]}}`,c[Ke]),a=a.replaceAll(`{${st[Ze]}}`,c[Ze]),a=a.replaceAll(`{${st[ze]}}`,c[ze]),a=a.replaceAll(`{${st[Je]}}`,c[Je])),{filePath:r,exportName:a}}}class ot{#te;#F;#se;#ne;#oe;constructor(e){this.#ne=e,this.#oe=window.location,this.setConfig(new Ye)}setConfig(e){this.#F=Object.assign(new Ye,e),"prefixMap"in e&&void 0!==e.prefixMap&&this.setPrefixMap(e.prefixMap)}getConfig(){return this.#F}setPrefixMap(e){this.#se=new Map(Object.entries(e).map((([e,t])=>[e=qe.toKebabCase(e),Object.assign(new et,{prefix:e,path:t})])))}getPrefixMap(){return this.#se}configFile(e){return this.#te=e,this}config(e){return this.setConfig(e),this}prefixMap(e){return this.setPrefixMap(e),this}get registrar(){return this.#ne}async loadConfig(e){const t=this.#oe.pathname.split("/");t[t.length-1]=e;const s=this.#oe.origin+t.join("/");try{const e=await fetch(s),t=await e.json();return Object.assign(new Ye,t)}catch(e){throw new Error(e)}}async load(...e){if(void 0!==this.#te){const e=await this.loadConfig(this.#te);this.setConfig(e)}if(void 0===this.#se)throw new Error("prefixMap is not defined");if(void 0===this.#ne)throw new Error("registrar is not defined");const t=Array.from(this.#se.values()),{defaultNameType:s,defaultPath:n}=this.#F;e=e.length>0?e:this.#F.loadNames;for(let o of e){let e;o=qe.toKebabCase(o);const i=t.find((e=>e.isMatch(o)));if(void 0!==i){const t=i.getNames(o);e=nt.getPathInfo(t.path,t.prefixName,t.subName,s)}if(void 0===e&&void 0!==n&&(e=nt.getPathInfo(n,"",o,s)),void 0===e)throw new Error(`unmatch prefix and no defaultPath (loadName:${o})`);const r=this.#oe.pathname.split("/");r[r.length-1]=e.filePath;const a=this.#oe.origin+r.join("/");let l,c;try{l=await import(a)}catch(e){throw new Error(e)}if(void 0!==e.exportName){if(!(e.exportName in l))throw new Error(`${e.exportName} not found in module (exportName:${e.exportName}, ${e.filePath})`);c=l[e.exportName]}else c=l.default;this.#ne.regist(o,c)}return this}static create(e){return new ot(e)}}const it=ot.create(class extends We{static regist(e,t){if(e.startsWith("filter-")){const s=e.slice("filter-".length),{output:o,input:i}=t;n.regist(s,o,i)}else{const s=e;t instanceof HTMLElement?window.customElements.define(s,t):window.customElements.define(s,Ue.generate(t))}}});export{je as default,He as generateComponentClass,it as loader};
